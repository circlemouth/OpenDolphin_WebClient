ganttConfig:
  defaultView: day
  startDate: 2025-12-30
  showFilters: true
  filters:
    priorities:
      High: true
      Medium: true
      Low: true
    statuses:
      completed: true
      in_progress: true
      not_started: true
    showDependencies: true
  labels:
    dayNames:
      - 日
      - 月
      - 火
      - 水
      - 木
      - 金
      - 土
    priorities:
      high: 高
      medium: 中
      low: 低
    statuses:
      completed: 完了
      inProgress: 進行中
      notStarted: 未開始
    buttons:
      filter: フィルター
      previousPeriod: 前へ
      nextPeriod: 次へ
    filterPanel:
      priorities: 優先度
      statuses: ステータス
      dependencies: 依存関係
      showDependencies: 依存関係を表示
      tasksCount: タスク数
    tooltipFields:
      startDate: 開始日
      duration: 期間
      priority: 優先度
      status: ステータス
      progress: 進捗
      agent: エージェント
      details: 詳細
      prerequisites: 前提タスク
      nextTasks: Next Tasks
labels:
  dayNames:
    - 日
    - 月
    - 火
    - 水
    - 木
    - 金
    - 土
  priorities:
    high: 高
    medium: 中
    low: 低
  statuses:
    completed: 完了
    inProgress: 進行中
    notStarted: 未開始
  buttons:
    filter: フィルター
    previousPeriod: 前へ
    nextPeriod: 次へ
  filterPanel:
    priorities: 優先度
    statuses: ステータス
    dependencies: 依存関係
    showDependencies: 依存関係を表示
    tasksCount: タスク数
  tooltipFields:
    startDate: 開始日
    duration: 期間
    priority: 優先度
    status: ステータス
    progress: 進捗
    agent: エージェント
    details: 詳細
    prerequisites: 前提タスク
    nextTasks: Next Tasks
filters:
  priorities:
    High: true
    Medium: true
    Low: true
  statuses:
    completed: true
    in_progress: true
    not_started: true
  showDependencies: true
src:
  structure.yaml:
    content: |-
      本タスクは「モダナイズ版クライアントのカルテ入力画面以外」について、
      開発ドキュメントと旧来版クライアントの実装を照合し、追加検討すべき機能・運用を洗い出すための調査計画です。

      目的:
      - 対象画面の機能一覧とユーザーフローを棚卸する
      - 旧来版とモダナイズ版の差分を可視化する
      - 追加検討項目の優先度と依存関係を整理し、実装検討に引き継ぐ

      文体: 調査計画として、作業手順と成果物の粒度が明確
    agent選定理由: 既存ドキュメントとコード参照の棚卸は codex を主担当とし、他モデルで補助レビューする。
    api選定理由: ローカル資料とコードの突き合わせが中心のため外部API不要。
    dependency: []
    agent: codex
    api: []
    ganttConfig:
      defaultView: day
      startDate: 2025-12-30
      showFilters: true
      filters:
        priorities:
          High: true
          Medium: true
          Low: true
        statuses:
          completed: true
          in_progress: true
          not_started: true
        showDependencies: true
      labels:
        dayNames:
          - 日
          - 月
          - 火
          - 水
          - 木
          - 金
          - 土
        priorities:
          high: 高
          medium: 中
          low: 低
        statuses:
          completed: 完了
          inProgress: 進行中
          notStarted: 未開始
        buttons:
          filter: フィルター
          previousPeriod: 前へ
          nextPeriod: 次へ
        filterPanel:
          priorities: 優先度
          statuses: ステータス
          dependencies: 依存関係
          showDependencies: 依存関係を表示
          tasksCount: タスク数
        tooltipFields:
          startDate: 開始日
          duration: 期間
          priority: 優先度
          status: ステータス
          progress: 進捗
          agent: エージェント
          details: 詳細
          prerequisites: 前提タスク
          nextTasks: Next Tasks
  discovery:
    対象範囲と成果物定義.md:
      content: |-
        # 対象範囲と成果物定義

        ## 目的
        「カルテ入力画面以外」の対象画面・機能を明確化し、洗い出し対象の境界を固定する。

        ## 対象
        - 受付/患者一覧/予約/帳票/設定/配信/管理など
        - Charts 画面のうちカルテ入力以外（監査、印刷、検索、権限）

        ## 成果物
        - 対象画面リスト
        - 参照ドキュメント一覧
        - 旧来版ソースの参照箇所
      dependency: []
      agent: codex
      api: []
      priority: High
      status: completed
      progress: 100
      schedule:
        start: 2025-12-30T00:00:00.000Z
        days: 1
  documentation:
    開発ドキュメント棚卸.md:
      content: |-
        # 開発ドキュメント棚卸

        ## 目的
        現行ドキュメント（docs/web-client、README、運用手順）から機能要件と画面一覧を抽出する。

        ## 手順
        - docs/DEVELOPMENT_STATUS.md を正本として参照順序を確認
        - 既存仕様や運用ガイドを整理
        - 画面単位で機能項目を抽出

        ## 成果物
        - ドキュメント索引
        - 画面別の要求機能一覧
      dependency:
        - src/discovery/対象範囲と成果物定義.md
      agent: claude code
      api: []
      priority: High
      status: completed
      progress: 100
      schedule:
        start: 2025-12-31T00:00:00.000Z
        days: 1
  legacy_review:
    旧来版クライアント機能棚卸.md:
      content: |-
        # 旧来版クライアント機能棚卸

        ## 目的
        旧来版クライアントの画面構成と機能を抽出し、モダナイズ版との差分候補を作る。

        ## 手順
        - client/ 配下の画面・ルート・コンポーネントを確認
        - 画面単位で機能と操作フローを整理
        - モダナイズ版で未対応の可能性がある要素を付記

        ## 成果物
        - 旧来版画面一覧
        - 画面別機能メモ
      dependency:
        - src/discovery/対象範囲と成果物定義.md
      agent: gemini cli
      api: []
      priority: High
      status: completed
      progress: 100
      schedule:
        start: 2025-12-31T00:00:00.000Z
        days: 2
  modernized_review:
    モダナイズ版実装範囲整理.md:
      content: |-
        # モダナイズ版実装範囲整理

        ## 目的
        web-client/src と server-modernized 連携点から、現行モダナイズ版で対応済みの機能を整理する。

        ## 手順
        - web-client/ 配下の画面構成・主要機能を棚卸
        - server-modernized 側の API 対応状況を確認
        - 対応済み/未対応のラベル付け

        ## 成果物
        - モダナイズ版機能一覧
      dependency:
        - src/documentation/開発ドキュメント棚卸.md
      agent: cursor cli
      api: []
      priority: Medium
      status: completed
      progress: 100
      schedule:
        start: 2026-01-01T00:00:00.000Z
        days: 1
    非カルテ入力ユーザーフロー整理.md:
      content: |-
        # 非カルテ入力ユーザーフロー整理

        ## 目的
        受付/患者/設定/管理などの画面遷移と操作フローを整理し、抜け漏れを検出するための基盤を作る。

        ## 成果物
        - 画面遷移図（テキストベース）
        - 主要操作の入口/出口
      dependency:
        - src/documentation/開発ドキュメント棚卸.md
      agent: codex
      api: []
      priority: Medium
      status: completed
      progress: 100
      schedule:
        start: 2026-01-01T00:00:00.000Z
        days: 1
  gap_analysis:
    機能ギャップ抽出.md:
      content: |-
        # 機能ギャップ抽出

        ## 目的
        旧来版とモダナイズ版の差分を一覧化し、追加検討項目を抽出する。

        ## 手順
        - 画面別に機能差分を比較
        - 影響範囲（UI/運用/権限/監査）をタグ付け
        - 追加検討候補を分類

        ## 成果物
        - ギャップ一覧表
      dependency:
        - src/legacy_review/旧来版クライアント機能棚卸.md
        - src/modernized_review/モダナイズ版実装範囲整理.md
        - src/modernized_review/非カルテ入力ユーザーフロー整理.md
      agent: claude code
      api: []
      priority: High
      status: completed
      progress: 100
      schedule:
        start: 2026-01-02T00:00:00.000Z
        days: 1
    追加検討項目の優先度付け.md:
      content: |-
        # 追加検討項目の優先度付け

        ## 目的
        抽出したギャップを重要度と影響度で整理し、次フェーズへの引き継ぎに備える。

        ## 成果物
        - 重要度/緊急度マトリクス
        - 初期バックログ案
      dependency:
        - src/gap_analysis/機能ギャップ抽出.md
      agent: codex
      api: []
      priority: Medium
      status: completed
      progress: 100
      schedule:
        start: 2026-01-02T00:00:00.000Z
        days: 1
  planning:
    依存関係と影響範囲整理.md:
      content: |-
        # 依存関係と影響範囲整理

        ## 目的
        追加検討項目の実装影響範囲と依存関係を整理し、計画化できる状態にする。

        ## 成果物
        - 依存関係マップ
        - 影響範囲のメモ（UI/API/運用/監査）
      dependency:
        - src/gap_analysis/追加検討項目の優先度付け.md
      agent: gemini cli
      api: []
      priority: Medium
      status: completed
      progress: 100
      schedule:
        start: 2026-01-03T00:00:00.000Z
        days: 1
    レビュー準備と合意形成.md:
      content: |-
        # レビュー準備と合意形成

        ## 目的
        チームレビュー用の資料を整え、合意形成のための確認観点を整理する。

        ## 成果物
        - レビュー観点リスト
        - 追加検討項目の説明資料
      dependency:
        - src/gap_analysis/追加検討項目の優先度付け.md
      agent: cursor cli
      api: []
      priority: Medium
      status: completed
      progress: 100
      schedule:
        start: 2026-01-03T00:00:00.000Z
        days: 1
  reporting:
    調査結果レポート作成.md:
      content: |-
        # 調査結果レポート作成

        ## 目的
        洗い出し結果をまとめ、次フェーズの実装計画に引き渡す。

        ## 成果物
        - 画面別の追加検討項目一覧
        - 優先度と依存関係のまとめ
        - 未確認事項とリスク
      dependency:
        - src/planning/依存関係と影響範囲整理.md
        - src/planning/レビュー準備と合意形成.md
      agent: claude code
      api: []
      priority: High
      status: completed
      progress: 100
      schedule:
        start: 2026-01-03T00:00:00.000Z
        days: 1
  implementation_planning:
    未実装項目の画面割当と実装箇所整理.md:
      content: |-
        # 未実装項目の画面割当と実装箇所整理

        ## 目的
        追加検討項目（BKL-001〜020）を **どの画面に実装するか**、**どのコードに配置するか** を確定し、
        後続実装タスクの粒度を固定する。

        ## 画面・コード配置の割当（ドラフト）
        | Backlog ID | 画面 | 実装箇所（web-client） | 主なサーバ連携候補 |
        | --- | --- | --- | --- |
        | BKL-001/002/009/012 | Administration/配信 | `web-client/src/features/administration/AdministrationPage.tsx` / `web-client/src/features/administration/api.ts` / `web-client/src/features/shared/*` | `/api/admin/config` `/api/admin/delivery` / 監査 API |
        | BKL-003/004/016 | Login/共通権限 | `web-client/src/features/login/*` / `web-client/src/AppRouter.tsx` / `web-client/src/routes/facilityRoutes.ts` | 認証/ユーザ切替 API / 監査 API |
        | BKL-006/010/011/013/05 | Reception | `web-client/src/features/reception/pages/ReceptionPage.tsx` / `web-client/src/features/reception/api.ts` / `web-client/src/features/reception/components/*` | `/api01rv2/appointment/outpatient/*` `/api01rv2/claim/outpatient` / 監査 API |
        | BKL-007/014/015 | Patients | `web-client/src/features/patients/PatientsPage.tsx` / `web-client/src/features/patients/api.ts` | `/orca12/patientmodv2/outpatient` / 監査 API |
        | BKL-005/008/017/018 | Charts（非カルテ領域） | `web-client/src/features/charts/*`（`print/` `DocumentTimeline.tsx` ほか） | `/orca21/medicalmodv2/outpatient` `/api01rv2/claim/outpatient` / 監査 API |
        | BKL-019/020 | 共通 | `web-client/src/libs/observability/*` / `web-client/src/libs/audit/*` / `web-client/src/features/shared/*` | 監査 API / runId 伝播 |

        ## 成果物
        - 画面別の実装担当リスト
        - web-client の実装配置表（主要ファイル/コンポーネント単位）
        - サーバ連携 API の仮割当リスト
      dependency:
        - src/reporting/調査結果レポート作成.md
      agent: codex
      api: []
      priority: High
      status: not_started
      progress: 0
      schedule:
        start: 2026-01-04T00:00:00.000Z
        days: 1
    モダナイズ版サーバー連携整理.md:
      content: |-
        # モダナイズ版サーバー連携整理

        ## 目的
        非カルテ領域の未実装項目を **モダナイズ版サーバーに接続するための契約** として整理し、
        UI と server-modernized の責務境界を確定する。

        ## 連携対象（暫定）
        - Reception/例外一覧・キュー状態: `/api01rv2/claim/outpatient` / `/api01rv2/appointment/outpatient/*`
        - Patients/反映状態: `/orca12/patientmodv2/outpatient`
        - Charts/送信・印刷: `/orca21/medicalmodv2/outpatient` / `/api01rv2/claim/outpatient`
        - Administration/配信: `/api/admin/config` / `/api/admin/delivery`
        - 共通監査: `auditEvent` 永続化/検索 API

        ## 接続計画（ドラフト）
        1. web-client 側の API 呼び出しを `fetchWithResolver` へ統一し、`dataSourceTransition/cacheHit/runId` を UI と監査に透過。
        2. server-modernized 側で不足する REST ルートがあれば `server-modernized/src/main/java/open/*/rest/*` に追加。
        3. 監査イベントの必須メタ（runId, dataSource, screenId, patientId など）を共通化。
        4. エラー時の UI バナー/例外一覧の表示条件を API レスポンスに合わせて更新。

        ## 成果物
        - 接続対象 API 一覧（URL/契約/監査メタ）
        - server-modernized 側の追加/修正ポイント整理
        - UI 側の API 置換/追加実装チェックリスト
      dependency:
        - src/implementation_planning/未実装項目の画面割当と実装箇所整理.md
      agent: codex
      api:
        - "/api01rv2/appointment/outpatient/*"
        - "/api01rv2/claim/outpatient"
        - "/orca12/patientmodv2/outpatient"
        - "/orca21/medicalmodv2/outpatient"
        - "/api/admin/config"
        - "/api/admin/delivery"
      priority: High
      status: not_started
      progress: 0
      schedule:
        start: 2026-01-04T00:00:00.000Z
        days: 1
    後続実装タスク分割とロードマップ.md:
      content: |-
        # 後続実装タスク分割とロードマップ

        ## 目的
        画面割当とサーバ連携整理を基に、実装タスクを **画面単位** で分割し優先度順に並べる。

        ## タスク分割（案）
        - 認証/権限（BKL-003/004/016）
        - Administration/配信（BKL-001/002/009/012/04）
        - Reception（BKL-006/010/011/013/05）
        - Patients（BKL-007/014/015）
        - Charts 非カルテ（BKL-005/008/017/018）
        - 共通（BKL-019/020）

        ## 成果物
        - 画面別の実装ロードマップ（P0→P2）
        - 依存関係の再確認と実装順の最終化
      dependency:
        - src/implementation_planning/未実装項目の画面割当と実装箇所整理.md
        - src/implementation_planning/モダナイズ版サーバー連携整理.md
      agent: codex
      api: []
      priority: Medium
      status: not_started
      progress: 0
      schedule:
        start: 2026-01-05T00:00:00.000Z
        days: 1
  implementation:
    認証_権限ギャップ実装計画.md:
      content: |-
        # 認証/権限ギャップ実装計画

        ## 対象
        - BKL-003/004/016（施設/ユーザ選択・切替、権限境界運用）

        ## 実装箇所
        - `web-client/src/features/login/FacilityLoginEntry.tsx`
        - `web-client/src/features/login/FacilityLoginResolver.tsx`
        - `web-client/src/AppRouter.tsx`
        - `web-client/src/routes/facilityRoutes.ts`

        ## サーバ連携
        - 認証/ユーザ切替 API の確定と監査イベント送出

        ## 完了条件
        - 施設/ユーザ切替時に権限境界が明示され、監査ログに runId が記録される
      dependency:
        - src/implementation_planning/後続実装タスク分割とロードマップ.md
      agent: codex
      api: []
      priority: High
      status: not_started
      progress: 0
      schedule:
        start: 2026-01-06T00:00:00.000Z
        days: 2
    Administration_配信ギャップ実装計画.md:
      content: |-
        # Administration/配信ギャップ実装計画

        ## 対象
        - BKL-001/002/009/012/04（管理メニュー/権限ガード/配信タイミング/証跡/監査）

        ## 実装箇所
        - `web-client/src/features/administration/AdministrationPage.tsx`
        - `web-client/src/features/administration/api.ts`
        - `web-client/src/features/shared/AdminBroadcastBanner.tsx`

        ## サーバ連携
        - `/api/admin/config` `/api/admin/delivery` の連携強化
        - system_admin ガードのサーバ側チェックと監査イベント

        ## 完了条件
        - 配信状態/環境ラベル/ETag が UI と監査に反映される
      dependency:
        - src/implementation_planning/後続実装タスク分割とロードマップ.md
      agent: codex
      api:
        - "/api/admin/config"
        - "/api/admin/delivery"
      priority: High
      status: not_started
      progress: 0
      schedule:
        start: 2026-01-08T00:00:00.000Z
        days: 3
    Reception_ギャップ実装計画.md:
      content: |-
        # Reception ギャップ実装計画

        ## 対象
        - BKL-006/010/011/013/05（例外一覧/右ペイン/列拡張/監査履歴/新規タブ導線）

        ## 実装箇所
        - `web-client/src/features/reception/pages/ReceptionPage.tsx`
        - `web-client/src/features/reception/api.ts`
        - `web-client/src/features/reception/components/*`

        ## サーバ連携
        - `/api01rv2/appointment/outpatient/*` / `/api01rv2/claim/outpatient`
        - 例外一覧用の監査イベント/キュー状態の取得

        ## 完了条件
        - 例外一覧が UI で可視化され、監査ログに runId/queue 状態が残る
      dependency:
        - src/implementation_planning/後続実装タスク分割とロードマップ.md
      agent: codex
      api:
        - "/api01rv2/appointment/outpatient/*"
        - "/api01rv2/claim/outpatient"
      priority: High
      status: not_started
      progress: 0
      schedule:
        start: 2026-01-10T00:00:00.000Z
        days: 3
    Patients_ギャップ実装計画.md:
      content: |-
        # Patients ギャップ実装計画

        ## 対象
        - BKL-007/014/015（ORCA 反映状態/監査履歴/未紐付警告）

        ## 実装箇所
        - `web-client/src/features/patients/PatientsPage.tsx`
        - `web-client/src/features/patients/api.ts`

        ## サーバ連携
        - `/orca12/patientmodv2/outpatient`
        - 反映状態・警告の取得と監査イベント連携

        ## 完了条件
        - 編集結果の反映状態が UI と監査で確認できる
      dependency:
        - src/implementation_planning/後続実装タスク分割とロードマップ.md
      agent: codex
      api:
        - "/orca12/patientmodv2/outpatient"
      priority: Medium
      status: not_started
      progress: 0
      schedule:
        start: 2026-01-12T00:00:00.000Z
        days: 2
    Charts_非カルテギャップ実装計画.md:
      content: |-
        # Charts（非カルテ領域）ギャップ実装計画

        ## 対象
        - BKL-005/008/017/018（診療終了/送信、印刷、患者安全ヘッダ、ドキュメント履歴）

        ## 実装箇所
        - `web-client/src/features/charts/*`（`print/` `DocumentTimeline.tsx` `ChartsActionBar.tsx` など）

        ## サーバ連携
        - `/orca21/medicalmodv2/outpatient` `/api01rv2/claim/outpatient`
        - 印刷/送信結果の監査イベント連携

        ## 完了条件
        - 送信/印刷結果が UI と監査に反映され、失敗時に復旧導線がある
      dependency:
        - src/implementation_planning/後続実装タスク分割とロードマップ.md
      agent: codex
      api:
        - "/orca21/medicalmodv2/outpatient"
        - "/api01rv2/claim/outpatient"
      priority: High
      status: not_started
      progress: 0
      schedule:
        start: 2026-01-13T00:00:00.000Z
        days: 3
    共通_監査通知ギャップ実装計画.md:
      content: |-
        # 共通（監査/通知）ギャップ実装計画

        ## 対象
        - BKL-019/020（data-run-id/aria-live 統一、RUN_ID コピー/通知）

        ## 実装箇所
        - `web-client/src/libs/observability/*`
        - `web-client/src/libs/audit/*`
        - `web-client/src/features/shared/*`

        ## サーバ連携
        - 監査イベントのメタ統一と runId 伝播

        ## 完了条件
        - 主要画面に data-run-id が統一され、RUN_ID の通知導線が追加される
      dependency:
        - src/implementation_planning/後続実装タスク分割とロードマップ.md
      agent: codex
      api: []
      priority: Medium
      status: not_started
      progress: 0
      schedule:
        start: 2026-01-15T00:00:00.000Z
        days: 2
