ganttConfig:
  defaultView: week
  startDate: 2026-01-19
  showFilters: true
  filters:
    priorities:
      High: true
      Medium: true
      Low: true
    statuses:
      completed: true
      in_progress: true
      not_started: true
    showDependencies: true
labels:
  dayNames:
    - 日
    - 月
    - 火
    - 水
    - 木
    - 金
    - 土
  priorities:
    high: 高
    medium: 中
    low: 低
  statuses:
    completed: 完了
    inProgress: 進行中
    notStarted: 未開始
  buttons:
    filter: フィルター
    previousPeriod: 前へ
    nextPeriod: 次へ
  filterPanel:
    priorities: 優先度
    statuses: ステータス
    dependencies: 依存関係
    showDependencies: 依存関係を表示
    tasksCount: タスク数
  tooltipFields:
    startDate: 開始日
    duration: 期間
    priority: 優先度
    status: ステータス
    progress: 進捗
    agent: エージェント
    details: 詳細
    prerequisites: 前提タスク
    nextTasks: Next Tasks
filters:
  priorities:
    High: true
    Medium: true
    Low: true
  statuses:
    completed: true
    in_progress: true
    not_started: true
  showDependencies: true
src:
  webclient_navigation_hardening_plan_20260119:
    00_RUN_IDと参照チェーン.md:
      content: |-
        # 00 RUN_ID と参照チェーン

        - RUN_ID: 20260119T131315Z
        - 参照順: `docs/DEVELOPMENT_STATUS.md` → `docs/web-client/architecture/web-client-navigation-review-20260119.md` → `docs/web-client/architecture/web-client-navigation-hardening-prerequisites-20260119.md` → `web-client/src/*` → 本ガント。
        - 対象: 403失効ガード / ログイン後遷移 / タブ間セッション共有 / ストレージ掃除 / サブパス対応 / ロールガード / 回帰テスト。
        - 実行モデル: codex（計画策定・タスク分解）。
      priority: High
      status: completed
      progress: 100
      agent: codex
      api: []
      dependency: []
      schedule:
        start: 2026-01-19T13:13:15.000Z
        days: 0.1
    auth_flow:
      10_403失効ガード調整.md:
        content: |-
          # 10 403 失効ガード調整

          - `libs/http/httpClient.ts` の `shouldNotifySessionExpired` から 403 を除外し、明示オプションのみ失効扱いにする。
          - 403 は UI バナー/トーストで吸収し、`suppressSessionExpiry` を置き換える専用フラグを追加。
          - 共通判定ユーティリティに単体テストを追加し、既存 401/419/440 のデバウンス判定を回帰確認。
          - 期待成果: 権限不足(403) で強制ログアウトが発生せず、エラー表示に留める。
        priority: High
        status: completed
        progress: 100
        agent: claude code
        api: []
        dependency:
          - src/webclient_navigation_hardening_plan_20260119/00_RUN_IDと参照チェーン.md
        schedule:
          start: 2026-01-20T00:00:00.000Z
          days: 0.5
      11_ログイン後即遷移と戻り検知.md:
        content: |-
          # 11 ログイン後即遷移と戻り検知

          - `AppRouter.tsx` の `handleLoginSuccess` で `state.from` 優先、なければ `/f/{facilityId}/reception` へ即 `navigate`。
          - `LoginSwitchNotice` を「戻り検知時のみ」表示する条件に変更し、二段階遷移を解消。
          - 受付/カルテ/患者の直リンク開封時に `location.state`・クエリ引き継ぎが維持されることを確認。
          - 期待成果: 成功ログイン直後に目的画面へ遷移し、不要な /login 滞在が消える。
        priority: High
        status: completed
        progress: 100
        agent: codex
        api: []
        dependency:
          - src/webclient_navigation_hardening_plan_20260119/auth_flow/10_403失効ガード調整.md
        schedule:
          start: 2026-01-20T12:00:00.000Z
          days: 0.5
    session_sync:
      20_認証とrunIdのタブ共有.md:
        content: |-
          # 20 認証と runId のタブ共有

          - 認証 + runId + authFlags を `localStorage` に保存し、`BroadcastChannel('opendolphin:web-client:auth')` で同期。
          - 新規タブ初期化時に sessionStorage を再構成し、`AuthServiceProvider` へ即反映する復元ルーチンを追加。
          - `applyObservabilityHeaders` が最新共有 runId を参照するよう更新し、メッセージフォーマットをドキュメント化。
          - テスト: タブ A の runId 更新がタブ B の API ヘッダに反映されることをユニット/統合で確認。
        priority: High
        status: completed
        progress: 100
        agent: gemini cli
        api: []
        dependency:
          - src/webclient_navigation_hardening_plan_20260119/auth_flow/10_403失効ガード調整.md
        schedule:
          start: 2026-01-21T00:00:00.000Z
          days: 1
      21_ストレージ掃除とスコープ化.md:
        content: |-
          # 21 ストレージ掃除とスコープ化

          - `facilityId:userId` サフィックス付きキーへ移行（encounter-context/returnTo/soap-history/print-preview/lock 系含む）。
          - ログアウト時に施設・ユーザー単位で sessionStorage/localStorage を一括削除するユーティリティを追加し、旧キーを移行後にクリーンアップ。
          - 旧バージョンキーの後方互換読込とバージョン識別を実装して回帰を防止。
          - 期待成果: ログアウト後に旧セッションの状態が残留しない。
        priority: Medium
        status: completed
        progress: 100
        agent: claude code
        api: []
        dependency:
          - src/webclient_navigation_hardening_plan_20260119/session_sync/20_認証とrunIdのタブ共有.md
        schedule:
          start: 2026-01-22T00:00:00.000Z
          days: 0.75
      22_失効同期ブロードキャスト.md:
        content: |-
          # 22 失効同期ブロードキャスト

          - `notifySessionExpired` を BroadcastChannel + storage event 経由で全タブに伝播し、理由メッセージとデバウンス状態を共有。
          - 受信側で共通ログアウト処理を実行し、UI 文言と監査ログを統一。403 はバナー提示のみに留める。
          - 401/419/440 のみ失効扱いにすることを自動テストで担保し、403 はログアウトしない回帰を追加。
        priority: High
        status: completed
        progress: 100
        agent: codex
        api: []
        dependency:
          - src/webclient_navigation_hardening_plan_20260119/session_sync/20_認証とrunIdのタブ共有.md
        schedule:
          start: 2026-01-22T12:00:00.000Z
          days: 0.5
    routing:
      30_VITE_BASE_PATHとbasename統一.md:
        content: |-
          # 30 VITE_BASE_PATH と basename 統一

          - `BrowserRouter` の `basename` と Vite `base` を `VITE_BASE_PATH`（デフォルト `/`）で統一し、サブパス配信でもリロード 404 が出ないようにする。
          - `buildFacilityPath` の二重スラッシュ回帰テストを Reception/Charts/Patients で追加。
          - `setup-modernized-env.sh` に `VITE_BASE_PATH` を追記し、`vite preview` と `docker compose` の動作を検証。
        priority: Medium
        status: completed
        progress: 100
        agent: cursor cli
        api: []
        dependency:
          - src/webclient_navigation_hardening_plan_20260119/auth_flow/10_403失効ガード調整.md
        schedule:
          start: 2026-01-21T12:00:00.000Z
          days: 0.75
      31_BrowserRouter_basename再適用.md:
        content: |-
          # 31 BrowserRouter basename 再適用

          - `BrowserRouter` に `basename=VITE_BASE_PATH` を再適用し、`navigate` / 直リンクリロードがサブパス配信で 404 にならないようにする。
          - `buildFacilityPath` / `ensureFacilityUrl` から生成される URL が `import.meta.env.BASE_URL` と整合することを E2E + ユニットで確認。
          - `vite preview --base /foo/` で `/foo/f/{id}/reception` リロードが成功することを確認し、回帰テストを追加。
        priority: High
        status: completed
        progress: 100
        agent: codex
        api: []
        dependency:
          - src/webclient_navigation_hardening_plan_20260119/routing/30_VITE_BASE_PATHとbasename統一.md
        schedule:
          start: 2026-01-21T18:00:00.000Z
          days: 0.5
    nav_guard:
      40_Administration_Debugロールガード.md:
        content: |-
          # 40 Administration / Debug ロールガード

          - `NAV_LINKS` に `roles: ['system_admin']` を設定し、権限不足はトースト/バナーで通知し監査ログに残す。
          - ページ側の 403 をログアウト扱いにせず、UI 表示で吸収するガードを追加。
          - ナビゲーション非表示条件とアクセス拒否時の動作をテストに追加。
        priority: Medium
        status: completed
        progress: 100
        agent: claude code
        api: []
        dependency:
          - src/webclient_navigation_hardening_plan_20260119/auth_flow/11_ログイン後即遷移と戻り検知.md
        schedule:
          start: 2026-01-22T12:00:00.000Z
          days: 0.5
    qa:
      90_回帰テストとデプロイ前確認.md:
        content: |-
          # 90 回帰テストとデプロイ前確認

          - 403/401/419 の挙動をカバーする単体・結合テストを追加し、BroadcastChannel/Storage Event のデバウンス共有を検証。
          - タブ間共有（auth/runId）とログアウトブロードキャストの e2e/Playwright シナリオを追加。
          - `VITE_BASE_PATH=/foo/` で `vite preview` を起動し、直接リロードでも 404 が発生しないことを確認。
          - ドキュメント更新: `docs/web-client/architecture/web-client-navigation-review-20260119.md` に対応状況を追記し、UAT チェックリストを残す。
        priority: High
        status: not_started
        progress: 0
        agent: codex
        api: []
        dependency:
          - src/webclient_navigation_hardening_plan_20260119/auth_flow/10_403失効ガード調整.md
          - src/webclient_navigation_hardening_plan_20260119/auth_flow/11_ログイン後即遷移と戻り検知.md
          - src/webclient_navigation_hardening_plan_20260119/session_sync/20_認証とrunIdのタブ共有.md
          - src/webclient_navigation_hardening_plan_20260119/session_sync/21_ストレージ掃除とスコープ化.md
          - src/webclient_navigation_hardening_plan_20260119/session_sync/22_失効同期ブロードキャスト.md
          - src/webclient_navigation_hardening_plan_20260119/routing/30_VITE_BASE_PATHとbasename統一.md
          - src/webclient_navigation_hardening_plan_20260119/nav_guard/40_Administration_Debugロールガード.md
        schedule:
          start: 2026-01-23T06:00:00.000Z
          days: 1
