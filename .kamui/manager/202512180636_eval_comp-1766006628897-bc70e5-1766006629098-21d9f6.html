<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ | 32 ãƒ‰ãƒ©ãƒ•ãƒˆä¿å­˜ã¨å¾©å…ƒ</title>
    <style>
      body {
        font-family: "Hiragino Sans", "Noto Sans JP", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.6;
        margin: 24px;
        background-color: #e9f0f2;
        color: #1f2a30;
      }
      .monitor-wrapper {
        max-width: 1180px;
        margin: 0 auto;
        padding: 32px;
        background: #ffffff;
        border: 1px solid #c4d3d7;
      }
      .monitor-header {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 24px;
      }
      .monitor-title {
        font-size: 26px;
        font-weight: 700;
        letter-spacing: 0.04em;
        color: #1f2a30;
      }
      .monitor-description {
        font-size: 14px;
        color: #3a4b53;
      }
      .scoreboard {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-bottom: 24px;
      }
      .score-card {
        padding: 16px;
        background: #f7fbfc;
        border: 1px solid #c4d3d7;
      }
      .score-card h2 {
        margin: 0 0 8px;
        font-size: 18px;
      }
      .score-value {
        font-size: 28px;
        font-weight: 800;
        display: flex;
        align-items: baseline;
        gap: 10px;
      }
      .score-value span.small {
        font-size: 16px;
        font-weight: 600;
        color: #3a4b53;
      }
      .radar-row {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-bottom: 8px;
      }
      .radar {
        background: #ffffff;
        border: 1px solid #c4d3d7;
        padding: 8px;
      }
      .radar svg {
        width: 100%;
        height: 220px;
      }
      table.monitor-report {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        background: #ffffff;
        border: 1px solid #c4d3d7;
      }
      col.timestamp-column { width: 180px; }
      col.agent-column { width: calc((100% - 180px) / 2); }
      th, td {
        border: 1px solid #c4d3d7;
        padding: 16px;
        vertical-align: top;
        background-color: #ffffff;
      }
      th {
        background: #d8e6e9;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        color: #2c3a40;
      }
      tbody tr:nth-child(even) td { background-color: #eef3f4; }
      details { display: block; margin: 0; }
      details summary { list-style: none; }
      details[open] summary { margin-bottom: 12px; }
      .details-toggle {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        font-weight: 500;
        font-size: 13px;
        color: #1f2a30;
        padding: 0;
        background: transparent;
        border: none;
      }
      .details-toggle::before { content: "â–¶"; font-size: 10px; transition: transform 160ms ease; display: inline-block; }
      details[open] .details-toggle::before { transform: rotate(90deg); }
      .timestamp { font-weight: 600; color: #2c3a40; overflow-wrap: anywhere; }
      .snapshot-summary { margin-bottom: 12px; font-weight: 500; color: #2c3a40; }
      pre {
        white-space: pre-wrap;
        word-break: break-word;
        margin: 0;
        font-size: 12px;
        line-height: 1.55;
        color: #1f2a30;
        background: #f2f6f7;
        border: 1px solid #c4d3d7;
        padding: 16px;
      }
      .status-badge {
        display: inline-block;
        font-size: 10px;
        font-weight: 600;
        letter-spacing: 0.02em;
        padding: 1px 6px;
        background: #d8e6e9;
        border: 1px solid #b8c9cd;
        color: #1f2a30;
        white-space: nowrap;
        line-height: 1.3;
        vertical-align: top;
      }
      .status-badge--completed { background: #c3d4d8; border-color: #aabfc5; }
      .status-badge--risk { background: #fef3cd; border-color: #f0e5a5; }
      .agent-meta { display: block; margin-bottom: 8px; line-height: 1.5; }
      .agent-meta .status-badge { margin-right: 6px; }
      .agent-meta .agent-label { display: inline; font-size: 13px; color: #3a4b53; }
      .metric-list { font-size: 13px; margin: 0; padding-left: 16px; }
      .metric-list li { margin-bottom: 6px; }
    </style>
  </head>
  <body>
    <div class="monitor-wrapper">
      <header class="monitor-header">
        <h1 class="monitor-title">è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ | 32 ãƒ‰ãƒ©ãƒ•ãƒˆä¿å­˜ã¨å¾©å…ƒï¼ˆæ¯”è¼ƒï¼‰</h1>
        <p class="monitor-description">å¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒ: task/task-1766006628897-bc70e5 ã¨ task/task-1766006629098-21d9f6ã€‚æ©Ÿèƒ½åˆç†æ€§ã¨ç·»å¯†æ€§ã‚’ä¸­å¿ƒã«ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå·®åˆ†ãƒ»è¨­è¨ˆå¦¥å½“æ€§ã‚’è©•ä¾¡ã€‚</p>
      </header>

      <div class="scoreboard">
        <div class="score-card">
          <h2>codex / task-1766006628897-bc70e5</h2>
          <div class="score-value">ğŸ† 528 / 600 <span class="small">(88/100)</span></div>
          <p class="monitor-description">facilityId ã¨ userId ã‚’å«ã‚€ã‚­ãƒ¼æŸç¸›ã¨ç›£æŸ»è©³ç´°ãŒå¼·ãã€autosave ãƒãƒƒã‚¯ã‚ªãƒ•ã¨ missingMaster/fallback ã‚¬ãƒ¼ãƒ‰ã‚‚æ˜ç¤ºã€‚</p>
        </div>
        <div class="score-card">
          <h2>codex / task-1766006629098-21d9f6</h2>
          <div class="score-value">ğŸ¥ˆ 450 / 600 <span class="small">(75/100)</span></div>
          <p class="monitor-description">ãƒ­ãƒ¼ã‚«ãƒ«+ã‚µãƒ¼ãƒãƒ¼äºŒå±¤ä¿å­˜ã¨ TTLãƒ»Timeline é€£æºã‚’æç¤ºã™ã‚‹ä¸€æ–¹ã€facility/user ã®ã‚¹ã‚³ãƒ¼ãƒ—æ¼ã‚Œã¨ 5s autosave/50KB åˆ¶ç´„ãŒãƒªã‚¹ã‚¯ã€‚</p>
        </div>
      </div>

      <div class="radar-row">
        <div class="radar">
          <svg id="radarA" viewBox="0 0 240 240"></svg>
        </div>
        <div class="radar">
          <svg id="radarB" viewBox="0 0 240 240"></svg>
        </div>
      </div>

      <table class="monitor-report">
        <colgroup>
          <col class="timestamp-column" />
          <col class="agent-column" />
          <col class="agent-column" />
        </colgroup>
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>codex / task-1766006628897-bc70e5</th>
            <th>codex / task-1766006629098-21d9f6</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="timestamp">2025-12-18 06:36</td>
            <td>
              <div class="agent-meta"><span class="status-badge status-badge--completed">å®Œäº†</span><span class="agent-label">è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ ã®ã¿ï¼ˆã‚³ãƒŸãƒƒãƒˆ 49b29ae6ï¼‰ã€‚</span></div>
              <div class="snapshot-summary">æˆæœç‰©ãƒªãƒ³ã‚¯</div>
              <ul class="metric-list">
                <li>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: <code>src/charts_production_outpatient/workflow/32_ãƒ‰ãƒ©ãƒ•ãƒˆä¿å­˜ã¨å¾©å…ƒ.md</code> ï¼ˆRUN_ID=20251217T212600Zï¼‰</li>
                <li>è¨¼è·¡: <code>docs/web-client/planning/phase2/logs/20251217T212600Z-charts-draft-save.md</code></li>
                <li>å‚ç…§ãƒã‚§ãƒ¼ãƒ³åæ˜ : README/DOC_STATUS æ›´æ–°æ¸ˆã¿ã€‚</li>
              </ul>
            </td>
            <td>
              <div class="agent-meta"><span class="status-badge status-badge--completed">å®Œäº†</span><span class="agent-label">è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ ã®ã¿ï¼ˆã‚³ãƒŸãƒƒãƒˆ 84d7c76eï¼‰ã€‚</span></div>
              <div class="snapshot-summary">æˆæœç‰©ãƒªãƒ³ã‚¯</div>
              <ul class="metric-list">
                <li>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: <code>src/charts_production_outpatient/workflow/32_ãƒ‰ãƒ©ãƒ•ãƒˆä¿å­˜ã¨å¾©å…ƒ.md</code> ï¼ˆRUN_ID=20251217T212703Zï¼‰</li>
                <li>è¨¼è·¡: <code>docs/web-client/planning/phase2/logs/20251217T212703Z-charts-draft-recovery.md</code></li>
                <li>README/DOC_STATUS ã¸ RUN_ID è¿½è¨˜æ¸ˆã¿ã€‚</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td class="timestamp">ä¸»ãªè©•ä¾¡</td>
            <td>
              <ul class="metric-list">
                <li>æ©Ÿèƒ½åˆç†æ€§: facilityId/userId/runId/patientId/receptionId/encounterDate ã®å³å¯†æŸç¸›ã§å–ã‚Šé•ãˆé˜²æ­¢ãŒæ˜ç¢ºã€‚</li>
                <li>ç·»å¯†æ€§: autosave 30sâ†’60sâ†’120s ãƒãƒƒã‚¯ã‚ªãƒ•ã€missingMaster/fallback guardã€audit details (draftKey/contentHash/source/outcome) ãŒæƒã£ã¦ã„ã‚‹ã€‚</li>
                <li>ã‚¬ãƒãƒŠãƒ³ã‚¹: å‚ç…§ãƒã‚§ãƒ¼ãƒ³éµå®ˆãƒ»RUN_ID è¨˜è¼‰ãƒ»ç›£æŸ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‘½åã‚’ 11ç« ã«åˆã‚ã›ã¦ã„ã‚‹ã€‚</li>
              </ul>
            </td>
            <td>
              <ul class="metric-list">
                <li>æ©Ÿèƒ½åˆç†æ€§: ãƒ­ãƒ¼ã‚«ãƒ«/ã‚µãƒ¼ãƒãƒ¼äºŒå±¤ä¿å­˜ã¨å¾©å…ƒãƒ¢ãƒ¼ãƒ€ãƒ«ã®ç«¶åˆè§£æ±ºã‚’æç¤ºã—ã€Timeline é€£æºã‚‚æ˜è¨˜ã€‚</li>
                <li>ç·»å¯†æ€§: TTL=72hã€draftVersion/etagã€ã‚µã‚¤ã‚ºä¸Šé™ã€å·®åˆ†ä¿å­˜ãªã©é‹ç”¨é¢ã‚’è£œå¼·ã€‚</li>
                <li>ã‚¬ãƒãƒŠãƒ³ã‚¹: å‚ç…§ãƒã‚§ãƒ¼ãƒ³ãƒ»RUN_ID è¨˜è¼‰ã¯é©åˆã ãŒã€ã‚¹ã‚³ãƒ¼ãƒ—ã‚­ãƒ¼ã« facility/user ã‚’å«ã‚ã¦ãŠã‚‰ãšãƒãƒªã‚·ãƒ¼é€¸è„±ãŒæ‡¸å¿µã€‚</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td class="timestamp">ãƒªã‚¹ã‚¯/èª²é¡Œ</td>
            <td>
              <ul class="metric-list">
                <li>ãƒ‰ãƒ©ãƒ•ãƒˆã‚’ localStorage/React Query ã«ã®ã¿ä¿å­˜ã— TTL/æƒé™¤ãŒæœªå®šç¾©ã®ãŸã‚ã€é•·æœŸåˆ©ç”¨ã§ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è‚¥å¤§ã¨å¤ã„ãƒ‰ãƒ©ãƒ•ãƒˆæ®‹å­˜ãƒªã‚¹ã‚¯ã€‚</li>
                <li>ã‚µãƒ¼ãƒãƒ¼ç‰ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã®ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆæ¤œå‡ºãŒæœªå…·ä½“åŒ–ï¼ˆdocumentRevision ä¾å­˜ã‚’è¨˜è¿°ã™ã‚‹ã ã‘ï¼‰ã€‚</li>
              </ul>
            </td>
            <td>
              <ul class="metric-list">
                <li>ã‚­ãƒ¼ã« facilityId/userId ã‚’å«ã¾ãšã€åŒä¸€ç«¯æœ«ã®åˆ¥ãƒ­ã‚°ã‚¤ãƒ³ã§ãƒ‰ãƒ©ãƒ•ãƒˆãŒå¾©å…ƒã•ã‚Œã‚‹ãƒªã‚¹ã‚¯ã€‚</li>
                <li>5 ç§’ autosave ã¨ 50KB ä¸Šé™ãŒå®Ÿé‹ç”¨ã®æ‰€è¦‹é‡ã«å¯¾ã—éå‰°/éå°‘ã§ã€è² è·ã¨ä¿å­˜å¤±æ•—ã‚’èª˜ç™ºã™ã‚‹æã‚Œã€‚</li>
                <li>ã‚µãƒ¼ãƒãƒ¼ `draft=true` API ã¨ draftVersion/etag ãŒç¾è¡Œå¥‘ç´„ã«å­˜åœ¨ã›ãšã€å®Ÿè£…å¯èƒ½æ€§ã«ä¸ç¢ºå®Ÿæ€§ã€‚</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td class="timestamp">æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</td>
            <td>
              <ul class="metric-list">
                <li>TTL/æƒé™¤ãƒ«ãƒ¼ãƒ«ã‚’ foundation/10 ãƒ•ãƒƒã‚¯ã«è¿½åŠ ã—ã€å¤ã„ãƒ‰ãƒ©ãƒ•ãƒˆè‡ªå‹•å‰Šé™¤ã‚’æ˜æ–‡åŒ–ã€‚</li>
                <li>documentRevision ã¨ contentHash ã®çªåˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æ“¬ä¼¼ã‚³ãƒ¼ãƒ‰ã§è¿½è¨˜ã—ã€ç«¶åˆ UI æ¡ä»¶ã‚’æ˜ç¤ºã€‚</li>
              </ul>
            </td>
            <td>
              <ul class="metric-list">
                <li>draftKey ã« facilityId ã¨ userId ã‚’è¿½åŠ ã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³å¢ƒç•Œã‚’è·¨ãå¾©å…ƒã‚’ç¦æ­¢ã€‚</li>
                <li>autosave é–“éš”ã‚’ 30s ãƒãƒƒã‚¯ã‚ªãƒ•å‹ã«ç·©å’Œã—ã€ã‚µã‚¤ã‚ºä¸Šé™ã‚’å®Ÿæ¸¬ãƒ™ãƒ¼ã‚¹ã§å†è¨­å®šã€‚</li>
                <li>ã‚µãƒ¼ãƒãƒ¼ä¸‹æ›¸ã API ã®æœ‰ç„¡ã‚’ DOC_STATUS ã‹ 03 ç« ã§ç¢ºèªã—ã€ä¸åœ¨ãªã‚‰ãƒ­ãƒ¼ã‚«ãƒ«é™å®šã«ã‚¹ã‚³ãƒ¼ãƒ—ãƒ€ã‚¦ãƒ³ã™ã‚‹æ–‡è¨€ãŒå¿…è¦ã€‚</li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <script>
      const radarData = {
        radarA: {
          name: "task-1766006628897-bc70e5",
          scores: [90, 88, 90, 92, 85, 83],
        },
        radarB: {
          name: "task-1766006629098-21d9f6",
          scores: [78, 74, 70, 82, 68, 78],
        },
      };
      const labels = [
        "æ©Ÿèƒ½åˆç†æ€§",
        "ç·»å¯†æ€§",
        "ã‚¬ãƒãƒŠãƒ³ã‚¹é †å®ˆ",
        "ç›£æŸ»/è¨¼è·¡é€£æº",
        "ãƒªã‚¹ã‚¯æŠ‘æ­¢",
        "å®Ÿè£…å®Ÿç¾å¯èƒ½æ€§",
      ];
      function drawRadar(id, scores) {
        const svg = document.getElementById(id);
        if (!svg) return;
        const size = 240;
        const center = size / 2;
        const maxR = 90;
        const gridLevels = [0.4, 0.7, 1];
        // draw grid
        gridLevels.forEach((level) => {
          const points = labels.map((_, i) => {
            const angle = -Math.PI / 2 + (i * 2 * Math.PI) / labels.length;
            const r = maxR * level;
            return [center + r * Math.cos(angle), center + r * Math.sin(angle)];
          });
          const poly = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
          poly.setAttribute("points", points.map((p) => p.join(",")).join(" "));
          poly.setAttribute("fill", "none");
          poly.setAttribute("stroke", "#c4d3d7");
          poly.setAttribute("stroke-width", level === 1 ? 1.4 : 1);
          svg.appendChild(poly);
        });
        // labels
        labels.forEach((label, i) => {
          const angle = -Math.PI / 2 + (i * 2 * Math.PI) / labels.length;
          const r = maxR + 18;
          const x = center + r * Math.cos(angle);
          const y = center + r * Math.sin(angle);
          const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
          text.setAttribute("x", x);
          text.setAttribute("y", y);
          text.setAttribute("text-anchor", "middle");
          text.setAttribute("dominant-baseline", "middle");
          text.setAttribute("font-size", "11");
          text.textContent = label;
          svg.appendChild(text);
        });
        // data polygon
        const dataPoints = scores.map((score, i) => {
          const angle = -Math.PI / 2 + (i * 2 * Math.PI) / labels.length;
          const r = maxR * (score / 100);
          return [center + r * Math.cos(angle), center + r * Math.sin(angle)];
        });
        const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
        polygon.setAttribute("points", dataPoints.map((p) => p.join(",")).join(" "));
        polygon.setAttribute("fill", "rgba(26, 128, 182, 0.25)");
        polygon.setAttribute("stroke", "#1a80b6");
        polygon.setAttribute("stroke-width", "2");
        svg.appendChild(polygon);
      }
      drawRadar("radarA", radarData.radarA.scores);
      drawRadar("radarB", radarData.radarB.scores);
    </script>
  </body>
</html>
