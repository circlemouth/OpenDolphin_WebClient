<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ - 05 ãƒãƒƒãƒãƒ»ã‚­ãƒ¥ãƒ¼ã¨ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†</title>
    <style>
      body {
        font-family: "Hiragino Sans", "Noto Sans JP", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.6;
        margin: 24px;
        background-color: #e9f0f2;
        color: #1f2a30;
      }
      .monitor-wrapper {
        max-width: 1180px;
        margin: 0 auto;
        padding: 32px;
        background: #ffffff;
        border: 1px solid #c4d3d7;
      }
      .monitor-header {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 20px;
      }
      .monitor-title {
        font-size: 26px;
        font-weight: 700;
        letter-spacing: 0.04em;
        color: #1f2a30;
      }
      .monitor-description {
        font-size: 14px;
        color: #3a4b53;
      }
      .scoreboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
        margin: 18px 0 26px;
      }
      .score-card {
        border: 1px solid #c4d3d7;
        background: #f4f8f9;
        padding: 14px 16px;
      }
      .score-card h2 {
        margin: 0 0 6px;
        font-size: 14px;
        font-weight: 600;
        color: #2c3a40;
      }
      .score-value {
        font-size: 20px;
        font-weight: 700;
        color: #1f2a30;
      }
      .score-sub {
        font-size: 12px;
        color: #516067;
      }
      table.monitor-report {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        background: #ffffff;
        border: 1px solid #c4d3d7;
      }
      col.timestamp-column {
        width: 180px;
      }
      col.agent-column {
        width: calc((100% - 180px) / 2);
      }
      th,
      td {
        border: 1px solid #c4d3d7;
        padding: 16px;
        vertical-align: top;
        background-color: #ffffff;
      }
      th {
        background: #d8e6e9;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        color: #2c3a40;
      }
      tbody tr:nth-child(even) td {
        background-color: #eef3f4;
      }
      details {
        display: block;
        margin: 0;
      }
      details summary {
        list-style: none;
      }
      details[open] summary {
        margin-bottom: 12px;
      }
      .details-toggle {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        font-weight: 500;
        font-size: 13px;
        color: #1f2a30;
        padding: 0;
        background: transparent;
        border: none;
      }
      .details-toggle::before {
        content: "â–¶";
        font-size: 10px;
        transition: transform 160ms ease;
        display: inline-block;
      }
      details[open] .details-toggle::before {
        transform: rotate(90deg);
      }
      .timestamp {
        font-weight: 600;
        color: #2c3a40;
        overflow-wrap: anywhere;
      }
      pre {
        white-space: pre-wrap;
        word-break: break-word;
        margin: 0;
        font-size: 12px;
        line-height: 1.55;
        color: #1f2a30;
        background: #f2f6f7;
        border: 1px solid #c4d3d7;
        padding: 16px;
      }
      .status-badge {
        display: inline-block;
        font-size: 10px;
        font-weight: 600;
        letter-spacing: 0.02em;
        padding: 1px 6px;
        background: #d8e6e9;
        border: 1px solid #b8c9cd;
        color: #1f2a30;
        white-space: nowrap;
        line-height: 1.3;
        vertical-align: top;
      }
      .status-badge--completed {
        background: #c3d4d8;
        border-color: #aabfc5;
      }
      .status-badge--planning {
        background: #fff4d9;
        border-color: #f5e8b8;
      }
      .agent-meta {
        display: block;
        margin-bottom: 8px;
        line-height: 1.5;
      }
      .agent-meta .status-badge {
        margin-right: 6px;
      }
      .agent-meta .agent-label {
        display: inline;
        font-size: 13px;
        color: #3a4b53;
      }
      .hex-chart {
        display: grid;
        grid-template-columns: 120px 1fr;
        gap: 12px;
        margin-bottom: 12px;
        align-items: center;
      }
      .hex-chart svg {
        width: 120px;
        height: 120px;
      }
      .metric-list {
        font-size: 12px;
        color: #2c3a40;
      }
      .metric-list div {
        margin-bottom: 4px;
      }
      .section-title {
        font-weight: 600;
        margin: 10px 0 6px;
        color: #2c3a40;
      }
      .pill {
        display: inline-block;
        padding: 2px 8px;
        font-size: 12px;
        border-radius: 999px;
        background: #e3edf0;
        border: 1px solid #cdd9dd;
        color: #2c3a40;
        margin-right: 6px;
      }
      .link-note {
        font-size: 12px;
        color: #4a5a61;
      }
    </style>
  </head>
  <body>
    <div class="monitor-wrapper">
      <header class="monitor-header">
        <h1 class="monitor-title">è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ: 05 ãƒãƒƒãƒãƒ»ã‚­ãƒ¥ãƒ¼ã¨ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†</h1>
        <p class="monitor-description">ã‚¿ã‚¹ã‚¯ID: task-1769112372657-cc9659 / æœŸé–“: 2026-01-29 09:00 - 2026-01-30 09:00 / å„ªå…ˆåº¦: medium / ç·Šæ€¥åº¦: medium</p>
        <p class="monitor-description">è©•ä¾¡åŸºæº–: å®Ÿç”¨æ€§ãƒ»ç·»å¯†æ€§ / å¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒ: task/task-1769112372657-cc9659 / RUN_ID: 20260122T201354Z</p>
      </header>

      <section>
        <div class="section-title">ã‚¿ã‚¹ã‚¯å†…å®¹ãƒ»ä»•äº‹ã®æ¦‚è¦</div>
        <p class="monitor-description">server-modernized ã®éåŒæœŸå‡¦ç†/ã‚­ãƒ¥ãƒ¼/ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã«ã¤ã„ã¦ã€å®Ÿè£…ä¸è¶³ãƒ»å†é€/ç ´æ£„ãƒ»å¾©æ—§ãƒ»ç›£è¦–è¦³ç‚¹ã®èª²é¡Œã‚’æ•´ç†ã—ã€é‹ç”¨å½±éŸ¿ã¾ã§æ˜ç¤ºã—ãŸæ£šå¸ã—ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã€‚</p>
      </section>

      <section class="scoreboard">
        <div class="score-card">
          <h2>gemini cli / task-1769112372657-cc9659</h2>
          <div class="score-value">ğŸ¥‡ 486 / 600</div>
          <div class="score-sub">ç·åˆã‚¹ã‚³ã‚¢: 85 / 100ï¼ˆãƒ¡ãƒ€ãƒ«: ğŸ¥‡ï¼‰</div>
        </div>
        <div class="score-card">
          <h2>æ¯”è¼ƒåŸºæº– / task-1769112372657-cc9659</h2>
          <div class="score-value">ğŸ¯ 540 / 600</div>
          <div class="score-sub">ç›®æ¨™æ°´æº–ï¼ˆå‚è€ƒï¼‰</div>
        </div>
      </section>

      <table class="monitor-report">
        <colgroup>
          <col class="timestamp-column" />
          <col class="agent-column" />
          <col class="agent-column" />
        </colgroup>
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>gemini cli / task-1769112372657-cc9659</th>
            <th>æ¯”è¼ƒåŸºæº– / task-1769112372657-cc9659</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="timestamp">2026-01-22 20:16 UTC</td>
            <td>
              <div class="agent-meta">
                <span class="status-badge status-badge--completed">å®Œäº†</span>
                <span class="agent-label">ãƒãƒƒãƒ/ã‚­ãƒ¥ãƒ¼/ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã®èª²é¡Œä¸€è¦§ã‚’æ•´ç†ã—ã€å„ªå…ˆåº¦ã¨å½±éŸ¿ã‚’æ˜ç¤ºã€‚</span>
              </div>
              <div class="hex-chart" data-values="86,84,80,78,82,76" data-labels="å®Ÿç”¨æ€§,ç·»å¯†æ€§,ç¶²ç¾…æ€§,æ ¹æ‹ æ˜ç¢ºæ€§,ãƒªã‚¹ã‚¯å¯è¦–åŒ–,å†ç¾æ€§"></div>
              <div class="metric-list">
                <div>å®Ÿç”¨æ€§ 86ç‚¹: å½±éŸ¿ã¨é‹ç”¨ãƒªã‚¹ã‚¯ãŒå…·ä½“çš„ã§ã€ç¾å ´åˆ¤æ–­ã«ä½¿ãˆã‚‹ã€‚</div>
                <div>ç·»å¯†æ€§ 84ç‚¹: ãƒ•ã‚¡ã‚¤ãƒ«/ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¾ã§è¸ã¿è¾¼ã‚“ã æŒ‡æ‘˜ãŒå¤šã„ã€‚</div>
                <div>ç¶²ç¾…æ€§ 80ç‚¹: ORCAã‚­ãƒ¥ãƒ¼/PHRã‚¸ãƒ§ãƒ–/SSEã‚’ç¶²ç¾…ã™ã‚‹ä¸€æ–¹ã€DB/é‹ç”¨SLAã®å…·ä½“å€¤ãŒæœªæç¤ºã€‚</div>
                <div>æ ¹æ‹ æ˜ç¢ºæ€§ 78ç‚¹: ã‚³ãƒ¼ãƒ‰å‚ç…§ã¯ã‚ã‚‹ãŒã€è¡Œç•ªå·ã‚„å®Ÿæ¸¬ãƒ­ã‚°ãŒæœªè¨˜è¼‰ã€‚</div>
                <div>ãƒªã‚¹ã‚¯å¯è¦–åŒ– 82ç‚¹: å½±éŸ¿ã¨å¤±æ•—ãƒ¢ãƒ¼ãƒ‰ãŒæ•´ç†ã•ã‚Œã¦ã„ã‚‹ã€‚</div>
                <div>å†ç¾æ€§ 76ç‚¹: æ¤œè¨¼æ‰‹é †ã‚„å†ç¾æ¡ä»¶ãŒæœªæ•´å‚™ã€‚</div>
              </div>
              <div class="section-title">æˆæœç‰©ãƒªãƒ³ã‚¯</div>
              <div class="link-note">
                worktree: /Users/Hayato/Documents/GitHub/OpenDolphin_WebClient/.worktrees/task-1769112372657-cc9659<br />
                <a href="file:///Users/Hayato/Documents/GitHub/OpenDolphin_WebClient/.worktrees/task-1769112372657-cc9659/docs/preprod/implementation-issue-inventory/server-jobs-queue.md">docs/preprod/implementation-issue-inventory/server-jobs-queue.md</a>
              </div>
              <div class="section-title">å¼·ã¿</div>
              <div class="monitor-description">èª²é¡Œä¸€è¦§ãŒP1/P2ã§æ•´ç†ã•ã‚Œã€é‹ç”¨å½±éŸ¿ãƒ»ç›£æŸ»å½±éŸ¿ãŒæ˜ç¢ºã€‚PHRã‚¸ãƒ§ãƒ–ãƒ»SSEãƒ»ORCAã‚­ãƒ¥ãƒ¼ã®ä¸‰é ˜åŸŸã‚’åŒä¸€ç²’åº¦ã§æ‰±ã£ã¦ã„ã‚‹ã€‚</div>
              <div class="section-title">æ”¹å–„ä½™åœ°</div>
              <div class="monitor-description">å®Ÿæ¸¬ãƒ­ã‚°/é‹ç”¨æ‰‹é †ã®å‚ç…§ãŒãªãã€å†ç¾æ€§ãŒé™å®šçš„ã€‚ç›£è¦–æŒ‡æ¨™ã«å…·ä½“é–¾å€¤ã‚„SLAãŒæ¬ ã‘ã‚‹ã€‚</div>
              <div class="section-title">ã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°</div>
              <details class="snapshot-details">
                <summary class="details-toggle">ãƒ­ã‚°è©³ç´°</summary>
be55991af (HEAD -&gt; task/task-1769112372657-cc9659) Add server jobs/queue issue inventory
1d511f420 (task/task-1769112506794-f37625, task/task-1769112389882-c856a1, task/task-1769112186986-aba21d, master) Merge branch 'task/task-1769107633106-25c7da'
f64586e35 Update tasks state
06c07efea Merge branch 'task/task-1769107216118-849c4d'
de1f2b59d Update Kamui task state
40e6c6d48 Merge branch 'task/task-1769107409728-8c1c6d'
2cca85f9d chore: update kamui state
cb9735f75 (task/task-1769107409728-8c1c6d) docs: add audit payload evidence
811132f22 docs: audit logging inventory final
58fb86100 (task/task-1769107633106-25c7da) Detail test coverage inventory
f056563b6 (task/task-1769107216118-849c4d) Add order bundle rollback log evidence
382d6cca8 Add transaction integrity evidence and findings
e56e01e79 Refine preprod test coverage gaps
6c6b29d07 docs: audit logging inventory evidence
14fbe82a3 Add test coverage inventory for preprod review
6b491073c docs: inventory server audit logging gaps
375891200 Add preprod data transaction integrity inventory
f49b16e0b (task/task-1769107662609-c9c43c, task/task-1769107426407-2f8858, task/task-1769107229983-ed1a71) Merge branch 'task/task-1769079834244-5a296d'
a2a1cfb1c chore: update task state
e5aa06811 (task/task-1769079834244-5a296d) Align data migration RUN_ID with prerequisites              </details>
              <div class="section-title">å·®åˆ†æ¦‚è¦</div>
              <details class="snapshot-details">
                <summary class="details-toggle">diff --stat</summary>
 .../server-jobs-queue.md                           | 65 ++++++++++++++++++++++
 1 file changed, 65 insertions(+)              </details>
              <details class="snapshot-details">
                <summary class="details-toggle">diff</summary>
diff --git a/docs/preprod/implementation-issue-inventory/server-jobs-queue.md b/docs/preprod/implementation-issue-inventory/server-jobs-queue.md
new file mode 100644
index 000000000..df19aac30
--- /dev/null
+++ b/docs/preprod/implementation-issue-inventory/server-jobs-queue.md
@@ -0,0 +1,65 @@
+# server-modernized ãƒãƒƒãƒ/ã‚­ãƒ¥ãƒ¼/ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç† æ£šå¸ã—
+
+- RUN_ID: 20260122T200749Z
+- å®Ÿæ–½æ—¥: 2026-01-22
+- å¯¾è±¡: server-modernizedï¼ˆ`server-modernized/src/main/java`ï¼‰
+- ç›®çš„: éåŒæœŸå‡¦ç†/ã‚­ãƒ¥ãƒ¼/ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã®ä¸è¶³ã‚’å¯è¦–åŒ–ã—ã€å†é€ãƒ»ç ´æ£„ãƒ»å¾©æ—§ãƒ»ç›£è¦–ã®å¼±ç‚¹ã‚’æ•´ç†ã™ã‚‹ã€‚
+- å‚ç…§: `docs/DEVELOPMENT_STATUS.md`, `src/charts_production_outpatient/integration/45_orca_queueã¨é€ä¿¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º.md`, `src/modernized_review/ãƒ¢ãƒ€ãƒŠã‚¤ã‚ºç‰ˆå®Ÿè£…ç¯„å›²æ•´ç†.md`
+- å‰æãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: `docs/preprod/implementation-issue-inventory/task-prerequisites-20260122.md`
+
+## å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
+- `docs/preprod/implementation-issue-inventory/task-prerequisites-20260122.md`
+- `src/charts_production_outpatient/integration/45_orca_queueã¨é€ä¿¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º.md`
+- `src/modernized_review/ãƒ¢ãƒ€ãƒŠã‚¤ã‚ºç‰ˆå®Ÿè£…ç¯„å›²æ•´ç†.md`
+- `src/validation/ORCAå®Ÿç’°å¢ƒé€£æºæ¤œè¨¼.md`
+- `server-modernized/src/main/java/open/dolphin/rest/OrcaQueueResource.java`
+- `server-modernized/src/main/java/open/dolphin/rest/AdminConfigResource.java`
+- `server-modernized/src/main/java/open/dolphin/orca/rest/OrcaClaimOutpatientResource.java`
+- `server-modernized/src/main/java/open/dolphin/rest/dto/outpatient/ClaimOutpatientResponse.java`
+- `server-modernized/src/main/java/open/dolphin/rest/ChartEventSseSupport.java`
+- `server-modernized/src/main/java/open/dolphin/session/ChartEventServiceBean.java`
+- `server-modernized/src/main/java/open/dolphin/adm20/rest/PHRResource.java`
+- `server-modernized/src/main/java/open/dolphin/adm20/export/PhrExportJobManager.java`
+- `server-modernized/src/main/java/open/dolphin/adm20/export/PhrExportJobWorker.java`
+- `server-modernized/src/main/java/open/dolphin/adm20/session/PHRAsyncJobServiceBean.java`
+- `common/src/main/java/open/dolphin/infomodel/PHRAsyncJob.java`
+
+## 1. ç¾çŠ¶ã®å¯¾å¿œç¯„å›²ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰
+
+### 1-1. ORCA é€ä¿¡ã‚­ãƒ¥ãƒ¼ APIï¼ˆUI é€£æºç”¨ï¼‰
+- `/api/orca/queue` ã¯ `runId/traceId` ã¨ `queue` é…åˆ—ã‚’è¿”å´ã—ã€`x-use-mock-orca-queue` ã¾ãŸã¯ Admin è¨­å®šã§ mock ã‚’åˆ‡æ›¿å¯èƒ½ã€‚
+- `retry=1` æŒ‡å®šæ™‚ã¯ `retryRequested/retryApplied/retryReason` ã‚’è¿”å´ï¼ˆãŸã ã— live ã§ã¯æœªå®Ÿè£…ï¼‰ã€‚
+
+### 1-2. PHR ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆéåŒæœŸã‚¸ãƒ§ãƒ–
+- `POST /20/adm/phr/export` ã§ `PHRAsyncJob` ã‚’ä½œæˆã—ã€ManagedExecutor ã§ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œã€‚
+- `GET /20/adm/phr/status/{jobId}` ã§çŠ¶æ…‹ç¢ºèªã€`DELETE /20/adm/phr/status/{jobId}` ã§ pending ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€‚
+- `PHRAsyncJob` ã« `progress/queuedAt/startedAt/finishedAt/heartbeatAt` ã‚’ä¿æŒã€‚
+
+### 1-3. ãƒãƒ£ãƒ¼ãƒˆã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ï¼ˆSSE/Long-pollï¼‰
+- `ChartEventServiceBean` ãŒ long-poll ã§é€šçŸ¥ã—ã€SSE ã¸ã‚‚ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã€‚
+- SSE å´ã¯ facility å˜ä½ã§æœ€æ–° 100 ä»¶ã®å±¥æ­´ã‚’ä¿æŒã—ã€gap æ¤œçŸ¥æ™‚ã« `chart-events.replay-gap` ã‚’é€ä¿¡ã€‚
+
+## 2. ãƒãƒƒãƒ/ã‚­ãƒ¥ãƒ¼/ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã®èª²é¡Œä¸€è¦§
+
+&gt; å„ªå…ˆåº¦ã¯ P0=ç·Šæ€¥, P1=é«˜, P2=ä¸­, P3=ä½
+
+| ID | åŒºåˆ† | å¯¾è±¡ | ç¾çŠ¶ | å·®åˆ†/èª²é¡Œ | å½±éŸ¿ | æ ¹æ‹ ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«/ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰ | å„ªå…ˆåº¦ |
+| --- | --- | --- | --- | --- | --- | --- | --- |
+| BQ-01 | ã‚­ãƒ¥ãƒ¼å®Ÿè£…ä¸è¶³ | ORCA é€ä¿¡ã‚­ãƒ¥ãƒ¼ `/api/orca/queue` | mock/ç©ºé…åˆ—ã®ã¿ã§ã€live å®Ÿè£…ãŒå­˜åœ¨ã—ãªã„ã€‚`x-orca-queue-mode=live` ã§ã‚‚ `queue=[]`ã€‚ | ORCA é€ä¿¡ã®å®Ÿã‚­ãƒ¥ãƒ¼çŠ¶æ…‹ï¼ˆå¾…ã¡/å‡¦ç†ä¸­/å¤±æ•—ï¼‰ãŒå–å¾—ã§ããšã€UI ã®åˆ¤æ–­ææ–™ãŒæ¬ è½ã™ã‚‹ã€‚ | é…ä¿¡é…å»¶ã‚„å¤±æ•—ã‚’ç¾å ´ãŒåˆ¤å®šã§ããšã€äºŒé‡é€ä¿¡/å†é€æ¼ã‚Œã®ãƒªã‚¹ã‚¯ãŒä¸ŠãŒã‚‹ã€‚ | `OrcaQueueResource`ï¼ˆmockQueue/ç©ºé…åˆ—ï¼‰, `AdminConfigResource`ï¼ˆuseMockOrcaQueueï¼‰, `src/charts_production_outpatient/integration/45_orca_queueã¨é€ä¿¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º.md` | P1 |
+| BQ-02 | å†é€/ç ´æ£„æœªå®Ÿè£… | ORCA ã‚­ãƒ¥ãƒ¼å†é€ (`retry=1`) / `DELETE /api/orca/queue` | `retry=1` ã¯ `retryApplied=false` ã§ `not_implemented` ã‚’è¿”ã™ã€‚DELETE ã¯å®Ÿä½“ã‚’å‰Šé™¤ã›ãšåŒã˜å¿œç­”ã‚’è¿”ã™ã€‚ | å†é€ãƒ»ç ´æ£„ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ©Ÿèƒ½ã›ãšã€æ‰‹å‹•å¾©æ—§ãŒå¿…è¦ã€‚ | å¤±æ•—ä¼ç¥¨ã®å¾©æ—§ãŒé…å»¶ã—ã€é‹ç”¨è² è·ãŒå¢—å¤§ã™ã‚‹ã€‚ | `OrcaQueueResource`ï¼ˆretryReason/not_implemented, DELETEãŒbuildQueueResponseå‘¼ã³å‡ºã—ï¼‰ | P1 |
+| BQ-03 | ã‚­ãƒ¥ãƒ¼/é€ä¿¡å±¥æ­´ã®æ°¸ç¶šåŒ–ä¸è¶³ | ORCA é€ä¿¡å±¥æ­´/queueEntries | `ClaimOutpatientResponse.queueEntries` ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒã€å®Ÿéš›ã«ã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ãªã„ã€‚ | é€ä¿¡å±¥æ­´ãƒ»å†é€å¯¾è±¡ã®ä¿ç®¡å…ˆãŒãªãã€è¿½è·¡ä¸èƒ½ã€‚ | ç›£æŸ»ãƒ»å•ã„åˆã‚ã›å¯¾å¿œã§ã€Œã©ã®é€ä¿¡ãŒå¤±æ•—ã—ãŸã‹ã€è¿½è·¡ã§ããªã„ã€‚ | `ClaimOutpatientResponse`ï¼ˆqueueEntrieså®šç¾©ï¼‰, `OrcaClaimOutpatientResource`ï¼ˆqueueEntriesæœªè¨­å®šï¼‰ | P2 |
+| BQ-04 | ã‚¸ãƒ§ãƒ–å¾©æ—§ä¸è¶³ | PHR ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆéåŒæœŸã‚¸ãƒ§ãƒ– | ManagedExecutor ã«æŠ•ã’ã‚‹ã ã‘ã§ã€å†èµ·å‹•å¾Œã®å†å®Ÿè¡Œ/å†ã‚­ãƒ¥ãƒ¼å‡¦ç†ãŒãªã„ã€‚`EXPIRED` çŠ¶æ…‹ã‚‚ä½¿ã‚ã‚Œãªã„ã€‚ | é€”ä¸­ã§åœæ­¢ã—ãŸã‚¸ãƒ§ãƒ–ãŒ `RUNNING` ã®ã¾ã¾æ®‹ç•™ã—ã€å¾©æ—§ã§ããªã„ã€‚ | ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã®æ¬ æãƒ»å†ä¾é ¼ãŒå¿…è¦ã«ãªã‚‹ã€‚ | `PhrExportJobManager`ï¼ˆexecutor.submitã®ã¿ï¼‰, `PHRAsyncJobServiceBean`ï¼ˆå†ã‚­ãƒ¥ãƒ¼å‡¦ç†ãªã—ï¼‰, `PHRAsyncJob`ï¼ˆEXPIREDæœªä½¿ç”¨ï¼‰ | P1 |
+| BQ-05 | ãƒªãƒˆãƒ©ã‚¤/å†ªç­‰æ€§ä¸è¶³ | PHR ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¸ãƒ§ãƒ– | `retryCount` ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒæ›´æ–°/æ´»ç”¨ãŒãªã„ã€‚å†é€ãƒãƒªã‚·ãƒ¼ã‚„ãƒãƒƒã‚¯ã‚ªãƒ•ãŒç„¡ãã€åŒä¸€ã‚¹ã‚³ãƒ¼ãƒ—ã®å†ªç­‰æ€§ã‚­ãƒ¼ã‚‚ç„¡ã—ã€‚ | å¤±æ•—æ™‚ã®è‡ªå‹•å†è©¦è¡ŒãŒã§ããšã€é‡è¤‡å®Ÿè¡Œã®é˜²æ­¢ã‚‚ãªã„ã€‚ | å¤±æ•—æ™‚ã®å¾©æ—§ãŒæ‰‹ä½œæ¥­ã«ãªã‚Šã€é‡è¤‡å‡ºåŠ›ãŒèµ·ãã‚‹ã€‚ | `PHRAsyncJob`ï¼ˆretryCountï¼‰, `PHRAsyncJobServiceBean`ï¼ˆæ›´æ–°ãªã—ï¼‰, `PhrExportJobManager`ï¼ˆå¸¸ã«æ–°è¦ä½œæˆï¼‰ | P2 |
+| BQ-06 | ç›£è¦–/ãƒ˜ãƒ«ã‚¹ä¸è¶³ | PHR ã‚¸ãƒ§ãƒ–ã®ç›£è¦– | `heartbeatAt` ã¯æ›´æ–°ã™ã‚‹ãŒã€ç›£è¦–/ã‚¢ãƒ©ãƒ¼ãƒˆ/ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¤å®šã‚’è¡Œã†ä»•çµ„ã¿ãŒãªã„ã€‚ | ã‚¹ã‚¿ãƒƒã‚¯ã—ãŸã‚¸ãƒ§ãƒ–æ¤œçŸ¥ãŒé…ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œé€²æ—ãŒæ­¢ã¾ã‚‹ã€çŠ¶æ…‹ãŒéœ²å‡ºã™ã‚‹ã€‚ | èª¿æŸ»ã«æ™‚é–“ãŒã‹ã‹ã‚Š SLA ã‚’ä¸‹ã’ã‚‹ã€‚ | `PHRAsyncJobServiceBean`ï¼ˆheartbeatæ›´æ–°ã®ã¿ï¼‰ | P2 |
+| BQ-07 | ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ã®æ°¸ç¶šåŒ–ä¸è¶³ | ChartEvent SSE / long-poll | SSE ã®å±¥æ­´ã¯ in-memoryï¼ˆæœ€å¤§ 100 ä»¶ï¼‰ã§ã€å†èµ·å‹•ã‚„é•·æœŸæ–­ã§å¤±ã‚ã‚Œã‚‹ã€‚gap æ™‚ã¯ reload æŒ‡ç¤ºã®ã¿ã€‚ | ã‚¤ãƒ™ãƒ³ãƒˆæ¬ æãŒèµ·ãã¦ã‚‚å¾©å…ƒã§ããšã€UI çŠ¶æ…‹ãŒä¸æ•´åˆã«ãªã‚‹ã€‚ | å—ä»˜/å¤–æ¥/ãƒãƒ£ãƒ¼ãƒˆçŠ¶æ…‹ã®åæ˜ æ¼ã‚ŒãŒç™ºç”Ÿã€‚ | `ChartEventSseSupport`ï¼ˆHISTORY_LIMIT=100, in-memory historyï¼‰, `ChartEventServiceBean`ï¼ˆAsyncContext ã®ã¿ï¼‰ | P2 |
+
+## 3. ç›£è¦–/é‹ç”¨ã§ä¸è¶³ã—ã¦ã„ã‚‹è¦³ç‚¹
+- ORCA é€ä¿¡ã‚­ãƒ¥ãƒ¼ã®ã€Œé…å»¶/å¤±æ•—/å†é€ä¸­ã€ã®å®šé‡ç›£è¦–æŒ‡æ¨™ãŒæœªå®šç¾©ã€‚
+- PHR ã‚¸ãƒ§ãƒ–ã®æ»ç•™ï¼ˆheartbeat åœæ­¢ï¼‰ã‚„å¤±æ•—ç‡ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒãªã„ã€‚
+- SSE/ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ã®æ¬ æç™ºç”Ÿç‡ã‚„ãƒªãƒ—ãƒ¬ã‚¤ gap ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒæœªæ•´å‚™ã€‚
+
+## 4. ç¢ºèªãƒã‚¤ãƒ³ãƒˆï¼ˆæ£šå¸ã—è¦³ç‚¹ï¼‰
+- `/api/orca/queue` ãŒ live ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿéš›ã®é€ä¿¡ã‚­ãƒ¥ãƒ¼ã‚’è¿”ã›ã‚‹ã‹ï¼ˆç¾çŠ¶ã¯ mock/ç©ºé…åˆ—ï¼‰ã€‚
+- `retry=1` ã¨ DELETE ã®å®Ÿé‹ç”¨æ‰‹é †ãŒå­˜åœ¨ã™ã‚‹ã‹ï¼ˆç¾çŠ¶ not_implementedï¼‰ã€‚
+- PHR ã‚¸ãƒ§ãƒ–ã® restart/å¾©æ—§ãƒãƒªã‚·ãƒ¼ï¼ˆRUNNING/PENDING ã®å†å®Ÿè¡Œï¼‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ã€‚
+- SSE ã‚¤ãƒ™ãƒ³ãƒˆæ¬ ææ™‚ã®å¾©æ—§æ–¹é‡ï¼ˆreload ä»¥å¤–ã®å†é€/è£œæ­£ï¼‰ãŒã‚ã‚‹ã‹ã€‚              </details>
            </td>
            <td>
              <div class="agent-meta">
                <span class="status-badge status-badge--planning">å‚è€ƒ</span>
                <span class="agent-label">æ¯”è¼ƒå¯¾è±¡ãŒå˜ç‹¬ã®ãŸã‚ã€ç›®æ¨™æ°´æº–ã‚’æç¤ºã€‚</span>
              </div>
              <div class="hex-chart" data-values="90,90,90,90,90,90" data-labels="å®Ÿç”¨æ€§,ç·»å¯†æ€§,ç¶²ç¾…æ€§,æ ¹æ‹ æ˜ç¢ºæ€§,ãƒªã‚¹ã‚¯å¯è¦–åŒ–,å†ç¾æ€§"></div>
              <div class="metric-list">
                <div>å®Ÿç”¨æ€§ 90ç‚¹: å…·ä½“çš„ãªé‹ç”¨æ‰‹é †ãƒ»æ”¹å–„æ¡ˆãŒä½µè¨˜ã•ã‚Œã‚‹ã€‚</div>
                <div>ç·»å¯†æ€§ 90ç‚¹: è¡Œç•ªå·ãƒ»å…·ä½“ã‚³ãƒ¼ãƒ‰ã¸ã®å‚ç…§ãŒæƒã†ã€‚</div>
                <div>ç¶²ç¾…æ€§ 90ç‚¹: ã‚­ãƒ¥ãƒ¼/ã‚¸ãƒ§ãƒ–/ã‚¤ãƒ™ãƒ³ãƒˆã«åŠ ãˆç›£è¦–SLA/DBãŒçµ±åˆã€‚</div>
                <div>æ ¹æ‹ æ˜ç¢ºæ€§ 90ç‚¹: å®Ÿæ¸¬ãƒ­ã‚°ã‚„å†ç¾æ‰‹é †ãŒä»˜ä¸ã•ã‚Œã‚‹ã€‚</div>
                <div>ãƒªã‚¹ã‚¯å¯è¦–åŒ– 90ç‚¹: å½±éŸ¿/é »åº¦/å›é¿ç­–ã¾ã§è¨˜è¼‰ã€‚</div>
                <div>å†ç¾æ€§ 90ç‚¹: ãƒ†ã‚¹ãƒˆæ‰‹é †ã‚„æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ãŒæ˜ç¢ºã€‚</div>
              </div>
              <div class="section-title">å‚™è€ƒ</div>
              <div class="monitor-description">ç¾çŠ¶ã®æˆæœç‰©ã«å¯¾ã™ã‚‹ç†æƒ³çš„ãªæ¯”è¼ƒåŸºæº–ã€‚è¿½åŠ æ¤œè¨¼ã‚„é‹ç”¨æ‰‹é †ã®è¨˜è¼‰ãŒã‚ã‚Œã°æº€ãŸã›ã‚‹ã€‚</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <script>
      const charts = document.querySelectorAll('.hex-chart');
      charts.forEach((chart) => {
        const values = (chart.dataset.values || '').split(',').map(v => Number(v.trim()) || 0);
        const labels = (chart.dataset.labels || '').split(',').map(v => v.trim());
        const size = 120;
        const center = size / 2;
        const maxRadius = 48;
        const angles = [-90, -30, 30, 90, 150, 210].map(a => (Math.PI / 180) * a);
        const points = values.map((value, i) => {
          const r = (value / 100) * maxRadius;
          const x = center + r * Math.cos(angles[i]);
          const y = center + r * Math.sin(angles[i]);
          return `${x.toFixed(1)},${y.toFixed(1)}`;
        }).join(' ');
        const outer = angles.map(angle => {
          const x = center + maxRadius * Math.cos(angle);
          const y = center + maxRadius * Math.sin(angle);
          return `${x.toFixed(1)},${y.toFixed(1)}`;
        }).join(' ');
        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('viewBox', `0 0 ${size} ${size}`);
        const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        polygon.setAttribute('points', outer);
        polygon.setAttribute('fill', '#f2f6f7');
        polygon.setAttribute('stroke', '#c4d3d7');
        polygon.setAttribute('stroke-width', '1');
        const dataPolygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        dataPolygon.setAttribute('points', points);
        dataPolygon.setAttribute('fill', '#5d7f8a');
        dataPolygon.setAttribute('fill-opacity', '0.35');
        dataPolygon.setAttribute('stroke', '#1f2a30');
        dataPolygon.setAttribute('stroke-width', '1');
        svg.appendChild(polygon);
        svg.appendChild(dataPolygon);
        chart.appendChild(svg);
        const list = document.createElement('div');
        list.className = 'metric-list';
        list.style.display = 'none';
        labels.forEach((label, i) => {
          const item = document.createElement('div');
          item.textContent = `${label} ${values[i]}ç‚¹`;
          list.appendChild(item);
        });
        chart.appendChild(list);
      });
    </script>
  </body>
</html>
