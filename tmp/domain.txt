# 繝峨Γ繧､繝ｳ JPQL 繝医Λ繝ｳ繧ｶ繧ｯ繧ｷ繝ｧ繝ｳ邯ｲ鄒・｡ｨ・・026-06-16・・

## 1. 蟇ｾ雎｡繧ｱ繝ｼ繧ｹ
- **Case ID**: `user_profile`・・hecklist #48 逶ｸ蠖難ｼ・
- **API**: `GET /user/doctor1`
- **繝倥ャ繝繝ｼ繝励Ο繝輔ぃ繧､繝ｫ**: `tmp/trace/user_profile.headers`・・X-Trace-Id: trace-user-profile-manual` 繧剃ｻ倅ｸ趣ｼ・
- **險ｼ霍｡**:
  - HTTP 繝ｬ繧ｹ繝昴Φ繧ｹ: `artifacts/parity-manual/user_profile_trace/{legacy,modern}/response.json`
  - SQL 繝ｭ繧ｰ: `artifacts/parity-manual/JPQL/legacy.log`, `artifacts/parity-manual/JPQL/modernized.log`
  - 蟾ｮ蛻・ `artifacts/parity-manual/JPQL/jpql.diff`

| 繝ｬ繧､繝､繝ｼ | Legacy JPQL/SQL | Modernized JPQL/SQL | 蛯呵・|
| --- | --- | --- | --- |
| UserServiceBean#getUser | `select ... from d_users usermodel0_ where usermodel0_.userId=?` | `select ... from d_users um1_0 where um1_0.userId=?` | 荳｡繧ｵ繝ｼ繝舌・縺ｨ繧ょ酔荳縺ｮ WHERE 蜿･縲ゅΔ繝繝翫う繧ｺ蛛ｴ縺ｯ遏ｭ縺・挨蜷・(`um1_0`) 繧剃ｽｿ逕ｨ縲・|
| FacilityModel 繝ｪ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ | `select ... from d_facility ... where id=?` | 蜷悟ｷｦ | 譁ｽ險ｭ諠・ｱ縺ｮ驕・ｻｶ繝ｭ繝ｼ繝峨′荳｡迺ｰ蠅・→繧・eager 縺ｮ縺溘ａ霑ｽ蜉繧ｯ繧ｨ繝ｪ縺檎匱逕溘・|
| RoleModel 繝ｪ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ | `select ... from d_roles ... where c_user=?` | 蜷悟ｷｦ | 逶｣譟ｻ逕ｨ騾斐・繝ｭ繝ｼ繝ｫ蜿ら・縲ゅΔ繝繝翫う繧ｺ蛛ｴ縺ｯ `roles` 竊・`r1_0` 縺ｸ alias 縺悟､峨ｏ繧九・縺ｿ縲・|

### 隕ｳ貂ｬ邨先棡
- JPQL 竊・SQL 螟画鋤邨先棡縺ｯ alias 譁・ｭ怜・莉･螟悶↓蟾ｮ逡ｰ縺ｪ縺励Ａhibernate.show_sql` 繧貞曙譁ｹ縺ｧ譛牙柑蛹悶＠縺溘％縺ｨ縺ｧ `scripts/jpql_trace_compare.sh` 縺ｫ繧医ｋ蟾ｮ蛻・｢ｺ隱阪′蜿ｯ閭ｽ縺ｫ縺ｪ縺｣縺溘・
- Legacy 蛛ｴ縺ｮ `LogFilter` 縺ｫ縺ｯ traceId 縺ｮ蝓九ａ霎ｼ縺ｿ縺檎┌縺上？TTP 繝ｭ繧ｰ縺ｨ SQL 繝ｭ繧ｰ縺ｮ遯∝粋縺ｫ縺ｯ `X-Trace-Id` 繝倥ャ繝繝ｼ繧貞挨騾疲而縺医※縺翫￥蠢・ｦ√′縺ゅｋ縲ゅΔ繝繝翫う繧ｺ蛛ｴ縺ｯ `traceId=<value>` 縺瑚・蜍輔Ο繧ｰ蜃ｺ蜉帙＆繧後ｋ縲・

### 谿玖ｪｲ鬘・/ 谺｡繧｢繧ｯ繧ｷ繝ｧ繝ｳ
1. Checklist #49縲・50, #73縲・74 縺ｫ蟇ｾ蠢懊☆繧・`KarteServiceBean`, `PatientServiceBean`, `PVTServiceBean` 遲峨・ JPQL 繧貞酔謇矩・〒謗｡蜿悶☆繧九ょｰ代↑縺上→繧・`/chart/WEB1001/summary`, `/chart-events`, `/pvt/*` 邉ｻ繧定ｿｽ蜉縺ｧ蜿ｩ縺上◆繧√√し繝ｳ繝励Ν繝・・繧ｿ謚募・縺悟ｿ・ｦ√・
2. `scripts/jpql_trace_compare.sh` 縺ｮ邨先棡繧・CI 縺九ｉ繧ょｮ溯｡後〒縺阪ｋ繧医≧縲∝ｯｾ雎｡繧ｱ繝ｼ繧ｹ荳隕ｧ・・SON or CSV・峨ｒ謨ｴ蛯吶☆繧九・
3. 迴ｾ迥ｶ縺ｮ繝ｭ繧ｰ縺ｯ ANSI 繧ｨ繧ｹ繧ｱ繝ｼ繝玲枚蟄励ｒ蜷ｫ繧縺溘ａ縲∝ｰ・擂逧・↓縺ｯ `docker logs` 縺九ｉ蜿門ｾ励☆繧矩圀縺ｫ `ansi2txt` 遲峨〒髯､蜴ｻ縺吶ｋ繝ｩ繝・ヱ繝ｼ繧定ｿｽ蜉縺吶ｋ縲・

## 2. Trace Harness・・hecklist #49/#73/#74・・

| Checklist | API | Session Bean | Trace Case | 迥ｶ諷・| 蛯呵・|
| --- | --- | --- | --- | --- | --- |
| #49 | `GET /dolphin/activity/{year,month,count}` | `SystemServiceBean` (`@SessionOperation`) | `trace_http_400` | 竢ｳ `d_users` 譛ｪ菴懈・縺ｮ縺溘ａ `LogFilter` 縺・401 縺ｧ邨ゆｺ・Ａrest_error_scenarios.manual.csv` 縺ｫ BadRequest 蜀咲樟謇矩・ｒ螳夂ｾｩ貂医∩縲・|
| #73 | `GET /touch/user/{userId,facilityId,password}` | `TouchUserServiceBean` (`IPhoneServiceBean` 邨檎罰) | `trace_http_401` | 竢ｳ 隱崎ｨｼ繝倥ャ繝繝ｼ谺關ｽ縺ｧ 401 繧定ｿ斐☆繝・せ繝医ＡPARITY_HEADER_FILE` 縺九ｉ `password` 陦後ｒ蜑企勁縺励※騾∽ｿ｡縺吶ｋ謇矩・ｒ README 縺ｫ霑ｽ險倥・|
| #74 | `GET /karte/pid/{patientPk,date}` | `KarteServiceBean` | `trace_http_500` | 竢ｳ `NumberFormatException` 縺ｧ 500 繧定ｿ斐＠縲～SessionOperationInterceptor` 竊・`SessionTraceManager` 縺ｾ縺ｧ縺ｮ繝ｭ繧ｰ繧貞叙蠕嶺ｺ亥ｮ壹・|
| Baseline | `GET /serverinfo/jamri` | 縺ｪ縺暦ｼ・EST 繝輔ぅ繝ｫ繧ｿ縺ｮ縺ｿ・・| `trace_http_200` | 笨・`artifacts/parity-manual/TRACEID_JMS/20251108T060500Z/trace_serverinfo_jamri/` 縺ｫ HTTP/繝倥ャ繝繝ｼ險ｼ霍｡繧剃ｿ晏ｭ倥・|

- 400/401/500 繧ｱ繝ｼ繧ｹ縺ｯ `ops/tests/api-smoke-test/rest_error_scenarios.manual.csv` 縺ｫ譛溷ｾ・せ繝・・繧ｿ繧ｹ縺ｨ謫堺ｽ懊ヮ繝ｼ繝医ｒ霑ｽ蜉縺励，LI 縺ｧ蜀咲樟縺ｧ縺阪ｋ繧医≧縺ｫ縺励◆縲・ 
- Trace ID 縺ｯ `test_config.manual.csv` 縺ｮ `trace-id` 蛻励↓險倩ｼ峨＠縺ｦ縺翫ｊ縲～trace-session.headers` 繧定､・｣ｽ縺励※ `X-Trace-Id` 繧剃ｸ頑嶌縺阪☆繧矩°逕ｨ縺ｨ縺励◆縲・ 
- Legacy 繧ｵ繝ｼ繝舌・縺ｯ `ops/legacy-server/docker/configure-wildfly.cli` 縺・`org.wildfly.extension.micrometer` 繧定ｦ∵ｱゅ☆繧九◆繧√ン繝ｫ繝我ｸ榊庄縲Ａartifacts/parity-manual/TRACEID_JMS/20251108T0526Z/legacy_build.log` 縺ｫ隧ｳ邏ｰ繧呈ｮ九＠縺滉ｸ翫〒縲｀odernized 蛛ｴ縺ｮ縺ｿ CLI 讀懆ｨｼ繧帝ｲ繧√ｋ縲・

## 3. 2025-11-09: Karte / Patient / Appo / Schedule

| Service / Endpoint | Legacy TX蠅・阜 | Modernized TX蠅・阜 | JPQL蟾ｮ蛻・Γ繝｢ | 繝ｪ繧ｹ繧ｯ / 蟇ｾ蠢懈婿驥・| 蜿ら・險ｼ霍｡ |
| --- | --- | --- | --- | --- | --- |
| `PatientServiceBean#getPatientById` (`GET /patient/id/0000001`) | `@Stateless`・・MT縲～@SessionOperation` 縺ｪ縺暦ｼ・| `@ApplicationScoped @Transactional @SessionOperation` | 荳｡迺ｰ蠅・→繧・`from PatientModel p where p.facilityId=? and p.patientId like ?`縲・odern 蛛ｴ縺ｮ縺ｿ `ESCAPE ''` 縺御ｻ倅ｸ弱・| facility `1.3.6.1.4.1.9414.72.103` 縺ｫ蟇ｾ縺吶ｋ謔｣閠・Ξ繧ｳ繝ｼ繝峨′蟄伜惠縺帙★ `NoResultException` 竊・500縲Ａdocs/web-client/operations/LOCAL_BACKEND_DOCKER.md` 縺ｮ `WEB1001` 繧ｷ繝ｼ繝峨ｒ `opendolphin_modern` 縺ｫ蜀肴兜蜈･ or Header 繧・`F001` 邉ｻ縺ｸ蛻・崛縺吶ｋ TODO縲・| `artifacts/parity-manual/JPQL/20251109T201157Z/PatientServiceBean/`・・raceId=`jpql-patient-20251109T201157Z`・・|
| `KarteServiceBean#getKarte(fid,pid,fromDate)` (`GET /karte/pid/0000001,2024-01-01`) | `@Stateless` | `@ApplicationScoped @Transactional @SessionOperation` | Legacy/Modern 縺ｨ繧・`d_patient` 蜿ら・繧ｯ繧ｨ繝ｪ縺ｮ縺ｿ・育ｵ先棡繧ｼ繝ｭ・峨・| Modern 蛛ｴ縺ｯ `KarteBeanConverter` 縺・`null` 繧呈桶縺医★ 400・・Not able to deserialize data provided`・峨ＡWEB1001` 縺ｪ縺ｩ 1.3 邉ｻ縺ｮ繧ｫ繝ｫ繝・兜蜈･縺ｨ `Converter` 縺ｮ null-safe 蛹悶ｒ TODO 縺ｫ霑ｽ險倥・| `artifacts/parity-manual/JPQL/20251109T201157Z/KarteServiceBean/`・・raceId=`jpql-karte-20251109T201157Z`・・|
| `ScheduleServiceBean#getPvt` (`GET /schedule/pvt/2025-11-09`) | `@Stateless` | `@ApplicationScoped @Transactional @SessionOperation` | Legacy 縺ｯ `select ... from d_patient_visit ... order by pvtDate` 繧貞ｮ溯｡後・odern 蛛ｴ縺ｯ JPQL 繝ｭ繧ｰ縺ｪ縺励・| Modern 縺ｧ縺ｯ `UnknownEntityException: PatientVisitModel` 竊・`SessionServiceException`縲Ａserver-modernized/src/main/resources/META-INF/persistence.xml` 縺ｫ `PatientVisitModel` 繧定ｿｽ蜉縺励：lyway seed 縺ｨ菴ｵ縺帙※讀懆ｨｼ繧貞・螳溯｡後☆繧九Ａrest_error_schedule_unknown_entity` 繧・`rest_error_scenarios.manual.csv` 縺ｸ霑ｽ蜉貂医∩縲・| `artifacts/parity-manual/JPQL/20251109T201157Z/ScheduleServiceBean/`・・raceId=`jpql-schedule-20251109T201157Z`・・|
| `AppoServiceBean#putAppointments` (`PUT /appo`) | `@Stateless` | `@ApplicationScoped @Transactional @SessionOperation` | Legacy 縺ｯ `SELECT d_appo ...` 竊・`DELETE d_appo` 縺ｮ 2 繧ｯ繧ｨ繝ｪ縲・odern 蛛ｴ縺ｯ JPQL 繝ｭ繧ｰ縺ｪ縺励・| Modern 縺ｧ縺ｯ `IllegalArgumentException: Unable to locate entity descriptor: AppointmentModel`縲Ａpersistence.xml` 縺ｸ `AppointmentModel` 繧堤匳骭ｲ縺励：lyway 縺ｧ `d_appo` 繝・・繝悶Ν・医∪縺溘・ `appointment_model` 莠呈鋤繝薙Η繝ｼ・峨ｒ逕ｨ諢上☆繧句ｿ・ｦ√≠繧翫Ａrest_error_appo_missing_entity` 繧堤匳骭ｲ縺励，LI 蜀咲樟謇矩・ｒ `ops/tests/api-smoke-test/payloads/appo_cancel_sample.json` 縺ｫ菫晏ｭ倥・| `artifacts/parity-manual/JPQL/20251109T201157Z/AppoServiceBean/`・・raceId=`jpql-appo-20251109T201157Z`・・|

- 縺吶∋縺ｦ縺ｮ繝ｪ繧ｯ繧ｨ繧ｹ繝医・ Legacy/Modernized 繧ｳ繝ｳ繝・リ蜀・〒 `curl` 繧貞ｮ溯｡後＠縲～X-Trace-Id` 繧・`jpql-<service>-20251109T201157Z` 蠖｢蠑上〒莉倅ｸ弱＠縺溘Ａscripts/jpql_trace_compare.sh` 縺ｮ豁｣隕丞喧邨先棡・・jpql.diff`・峨→ raw 繝ｭ繧ｰ繧貞推繧ｵ繝ｼ繝薙せ驟堺ｸ九↓菫晏ｭ俶ｸ医∩縲・
- `WEB1001` 邉ｻ縺ｮ繧ｫ繝ｫ繝・ｼ乗ぅ閠・ョ繝ｼ繧ｿ縺・modernized DB 縺ｫ蟄伜惠縺励↑縺・◆繧√～/chart/WEB1001/summary` 縺ｪ縺ｩ繧ｫ繝ｫ繝・判髱｢ API 縺ｯ蠑輔″邯壹″譛ｪ謗｡蜿悶ゅす繝ｼ繝画兜蜈･螳御ｺ・∪縺ｧ縺ｯ譛ｬ遽縺ｫ TODO 繧定ｨ倬鹸縺励～docs/web-client/operations/LOCAL_BACKEND_DOCKER.md#繝・せ繝域ぅ閠・ョ繝ｼ繧ｿ謚募・` 縺ｮ謇矩・〒 `opendolphin_modern` 蛛ｴ縺ｸ蜀肴ｵ√＠霎ｼ縺ｿ繧定｡後≧縲・
### 3.1 2025-11-10: 蜿門ｾ励Μ繝医Λ繧､迥ｶ豕・
- `ops/tools/send_parallel_request.sh --profile compose` 繧・`PARITY_OUTPUT_DIR=artifacts/parity-manual/JPQL/20251110T034844Z` 縺ｧ 4 繧ｱ繝ｼ繧ｹ・・atient/Karte/Schedule/Appo・牙・螳溯｡後＠縺溘′縲√・繧ｹ繝医↓ Docker Desktop・縦ompose 縺悟ｭ伜惠縺帙★ `curl: (7) Failed to connect to localhost port {8080,9080}`縲りｩｳ邏ｰ縺ｯ `artifacts/parity-manual/JPQL/20251110T034844Z/README.md` 縺ｨ `*_request.log` 繧貞盾辣ｧ縲・- HTTP 繝ｪ繧ｯ繧ｨ繧ｹ繝育藍霍｡縺ｮ縺ｿ逕滓・縺ｧ縺阪◆縺溘ａ `legacy.raw.log`・汁modern.raw.log`縲～d_audit_event` 謚懃ｲ九？ibernate SQL 繝ｭ繧ｰ縺ｯ譛ｪ譖ｴ譁ｰ縲ゅし繝ｼ繝舌・繧・`scripts/start_legacy_modernized.sh start --build` 縺ｧ襍ｷ蜍輔〒縺阪ｋ迺ｰ蠅・ｒ遒ｺ菫昴＠縺溘≧縺医〒譛ｬ遽縺ｮ trace 繧貞・蜿門ｾ励☆繧九・- 繧ｫ繝ｫ繝・ｳｻ API 縺ｮ螟ｱ謨励こ繝ｼ繧ｹ縺ｯ `ops/tests/api-smoke-test/rest_error_scenarios.manual.csv` 縺ｮ `rest_error_chart_summary_seed_gap` 縺ｫ險倬鹸縺励～chart_summary` 繧ｱ繝ｼ繧ｹ・・trace-chart-summary-manual`・峨°繧牙ｮ溯｡後・蜀肴､懆ｨｼ縺吶ｋ縲・
### 3.2 繝医Λ繝ｳ繧ｶ繧ｯ繧ｷ繝ｧ繝ｳ・繍PQL 蟾ｮ蛻・・繝医Μ繧ｯ繧ｹ

`server-modernized/src/main/resources/META-INF/persistence.xml` 縺ｯ `exclude-unlisted-classes=false` 縺ｫ縺励※縺・ｋ繧ゅ・縺ｮ `<class>` 隕∫ｴ繧・8 莉ｶ縺ｮ縺ｿ蛻玲嫌縺励仝ildFly 螻暮幕譎ゅ↓ `infomodel` JAR 繧定・蜍墓､懷・縺ｧ縺阪※縺・↑縺・らｵ先棡縺ｨ縺励※ `PatientVisitModel` 縺ｨ `AppointmentModel` 縺・`UnknownEntityException` 縺ｨ縺ｪ繧翫´egacy 縺ｧ縺ｯ謌仙粥縺励※縺・◆ JPQL 縺・Modernized 蛛ｴ縺ｧ隗｣驥医〒縺阪↑縺・ゅ＆繧峨↓ `@SessionOperation` 縺ｧ `SessionOperationInterceptor`・・SessionTraceManager` 邨檎罰縺ｧ `d_audit_event` 繧貞瑞縺榊・縺呻ｼ峨′霑ｽ蜉縺輔ｌ縺溘％縺ｨ縺ｧ縲∽ｾ句､悶・ `SessionServiceException` 縺ｨ縺励※繝ｩ繝・・縺輔ｌ HTTP 500 縺ｨ縺ｪ繧九ゆｸｻ隕√し繝ｼ繝薙せ縺ｮ繧ｳ繝ｼ繝牙ｷｮ蛻・ｒ莉･荳九↓謨ｴ逅・＠縺溘・
| 繧ｵ繝ｼ繝薙せ / API | Legacy TX蠅・阜 / Propagation | Modernized TX蠅・阜 / Propagation | JPQL / Fetch 蟾ｮ蛻・| persistence / 繝・・繧ｿ繧ｮ繝｣繝・・繝ｻTODO |
| --- | --- | --- | --- | --- |
| `PatientServiceBean#getPatientById`<br>`GET /patient/id/{pid}` | `@Named @Stateless`・・server/src/main/java/open/dolphin/session/PatientServiceBean.java`・峨〒 CMT `REQUIRED`縲ＡSessionOperation` 譛ｪ菴ｿ逕ｨ縺ｮ縺溘ａ `LogFilter` 繝ｭ繧ｰ縺ｮ縺ｿ縲・| `@ApplicationScoped @Transactional @SessionOperation`・・server-modernized/src/main/java/open/dolphin/session/PatientServiceBean.java`・峨ＡSessionOperationInterceptor` 縺・`SessionTraceManager` 繧定ｵｷ蜍輔＠縲∽ｾ句､悶ｒ `SessionServiceException` 縺ｫ蛹・・縲・| `QUERY_PATIENT_BY_FID_PID` 縺ｪ縺ｩ JPQL 縺ｯ Legacy 縺ｨ蜷御ｸ縺縺後｀odernized 縺ｯ `ChartEventServiceBean` 騾｣謳ｺ縺ｨ `setPvtDate` 縺ｧ `PatientVisitModel` 繧偵Ο繝ｼ繝峨☆繧九∪縺ｧ 1 繝医Λ繝ｳ繧ｶ繧ｯ繧ｷ繝ｧ繝ｳ縺ｧ菫晄戟縺吶ｋ險ｭ險医ＡfacilityId=1.3.6.1.4.1.9414.72.103` 縺ｮ繧ｷ繝ｼ繝画ｬ關ｽ縺ｫ繧医ｊ `NoResultException` 縺・500 縺ｨ縺励※陦ｨ髱｢蛹悶☆繧九・| `WEB1001`縲彖WEB1010` 縺ｮ謔｣閠・ｒ `docs/web-client/operations/LOCAL_BACKEND_DOCKER.md` 謇矩・〒 `opendolphin_modern` 縺ｸ蜀肴兜蜈･縺励～rest_error_chart_summary_seed_gap` / `patient` parity 繧ｱ繝ｼ繧ｹ縺ｧ `SessionTrace` 繧呈治蜿悶☆繧九・|
| `KarteServiceBean#getKarte(fid,pid,fromDate)`<br>`GET /karte/pid/{pid,date}` | `@Stateless`・・server/src/main/java/open/dolphin/session/KarteServiceBean.java`・・+ CMT縲・PQL 螟ｱ謨玲凾縺ｯ `NoResultException` 縺後◎縺ｮ縺ｾ縺ｾ 500/404 縺ｫ縺ｪ繧九・| `@ApplicationScoped @Transactional @SessionOperation`・・server-modernized/src/main/java/open/dolphin/session/KarteServiceBean.java`・峨〒 `MessagingGateway`・汁AttachmentStorageManager` 繧定ｿｽ蜉縲ゆｾ句､悶・ `SessionServiceException` 縺ｸ髮・ｴ・＆繧・`traceId` 縺ｨ邏蝉ｻ倥￥縲・| JPQL 譁・ｭ怜・縺ｯ蜈ｱ騾壹□縺後｀odernized 蛛ｴ縺ｯ `KarteBeanConverter` 縺・`null` 繧定ｨｱ螳ｹ縺励↑縺・◆繧∵ぅ閠・悴逋ｻ骭ｲ縺ｮ繧ｱ繝ｼ繧ｹ縺ｧ 400 (`Not able to deserialize data provided`) 縺瑚ｿ斐ｋ縲ＡQUERY_PATIENT_VISIT` 縺・`PatientVisitModel` 繧貞盾辣ｧ縺吶ｋ縺溘ａ persistence 譛ｪ逋ｻ骭ｲ縺縺ｨ `UnknownEntityException`・育樟迥ｶ縺ｯ謔｣閠・ョ繝ｼ繧ｿ谺關ｽ縺ｧ蛻ｰ驕斐○縺夲ｼ峨・| `persistence.xml` 縺ｫ `PatientVisitModel` 繧定ｿｽ蜉縺励～KarteBeanConverter` 繧・null-safe 縺ｫ縺吶ｋ縲Ａ/chart/WEB1001/summary` 縺ｯ `chart_summary` 繝・せ繝・+ `rest_error_chart_summary_seed_gap` 繧貞盾辣ｧ縺励※蜀榊ｮ溯｡後・|
| `ScheduleServiceBean#getPvt`<br>`GET /schedule/pvt/{date}` | `@Stateless`・・server/src/main/java/open/dolphin/session/ScheduleServiceBean.java`・峨・MT `REQUIRED` 縺ｧ `PatientVisitModel` 繧・eager 繝ｭ繝ｼ繝峨＠縺､縺､ JMS 騾｣謳ｺ (`ClaimSender`) 繧貞宛蠕｡縲・| `@ApplicationScoped @Transactional @SessionOperation`・・server-modernized/src/main/java/open/dolphin/session/ScheduleServiceBean.java`・・+ `MessagingGateway` / `ManagedScheduledExecutorService`縲・| JPQL・・QUERY_PVT_BY_FID_DATE`, `QUERY_DOCUMENT_BY_KARTEID_STARTDATE`・峨・蜷後§縺縺後｀odernized 縺ｧ縺ｯ Hibernate 縺・`PatientVisitModel` 繧定ｧ｣豎ｺ縺ｧ縺阪★ `org.hibernate.query.sqm.UnknownEntityException` 縺悟叉逋ｺ逕溘＠縲∫屮譟ｻ繝ｭ繧ｰ縺ｫ繧よｮ九ｉ縺ｪ縺・・| `persistence.xml` 縺ｫ `PatientVisitModel` 繧定ｿｽ蜉縺励：lyway 縺ｧ `d_patient_visit` 繧ｷ繝ｼ繝峨ｒ逕ｨ諢上Ａrest_error_schedule_unknown_entity` 縺ｮ蜀咲樟謇矩・ｒ `TRACE_PROPAGATION_CHECK.md` 縺ｫ繝ｪ繝ｳ繧ｯ縺励？ibernate SQL 縺檎匱轣ｫ縺吶ｋ縺薙→繧堤｢ｺ隱阪☆繧九・|
| `PVTServiceBean#getPvt` / `addPvt`<br>`GET /pvt/{did,...}` | `@Stateless`・・server/src/main/java/open/dolphin/session/PVTServiceBean.java`・峨〒 ORCA 繧ｭ繝･繝ｼ (`ClaimSender`) 縺ｨ蜷梧悄縲ＡAppointmentModel` 繧ょ酔荳繝医Λ繝ｳ繧ｶ繧ｯ繧ｷ繝ｧ繝ｳ蜀・〒隱ｭ縺ｿ譖ｸ縺阪☆繧九・| `@ApplicationScoped @Transactional @SessionOperation`・・server-modernized/src/main/java/open/dolphin/session/PVTServiceBean.java`・峨↓螟画峩縺励～ChartEventServiceBean`・汁ServletContextHolder` 縺ｸ萓晏ｭ倥・| 蜿嶺ｻ倡匳骭ｲ譎ゅ↓ `AppointmentModel`・汁PatientVisitModel` 繧・JPQL 縺ｧ隱ｭ縺ｿ霎ｼ繧薙〒 chart-event 繧堤ｵ・∩遶九※繧九・odernized 縺ｧ縺ｯ荳｡繧ｨ繝ｳ繝・ぅ繝・ぅ縺・persistence 縺九ｉ谺關ｽ縺励※縺・ｋ縺溘ａ `UnknownEntityException` 縺悟､夂匱縺・SSE push 縺ｾ縺ｧ蛻ｰ驕斐＠縺ｪ縺・・| `PatientVisitModel` 縺ｨ `AppointmentModel` 縺ｮ荳｡譁ｹ繧・persistence unit 縺ｫ霑ｽ蜉縺励～d_appo` / `d_patient_visit` 繧ｷ繝ｼ繝峨ｒ謨ｴ蛯吶Ａrest_error_chart_summary_seed_gap` 縺九ｉ繧ｫ繝ｫ繝・PVT 邉ｻ API 繧偵∪縺ｨ繧√※蜀肴､懆ｨｼ縺吶ｋ縲・|
| `AppoServiceBean#putAppointments`<br>`PUT /appo` | `@Stateless`・・server/src/main/java/open/dolphin/session/AppoServiceBean.java`・峨・MT 縺ｧ `AppointmentModel` 繧・`em.persist`/`merge`/`remove`縲・| `@ApplicationScoped @Transactional @SessionOperation`・・server-modernized/src/main/java/open/dolphin/session/AppoServiceBean.java`・峨・| JPQL 縺ｯ蜷御ｸ縺縺後｀odernized 縺ｧ縺ｯ `AppointmentModel` 縺・persistence unit 縺ｫ逋ｻ骭ｲ縺輔ｌ縺ｦ縺翫ｉ縺・`Unable to locate entity descriptor: AppointmentModel` 縺ｧ邨ゆｺ・・| `persistence.xml` 縺ｫ `AppointmentModel` 繧定ｿｽ蜉縺励～rest_error_appo_missing_entity`・・ops/tests/api-smoke-test/payloads/appo_cancel_sample.json`・峨〒蜀榊叙蠕励・|

