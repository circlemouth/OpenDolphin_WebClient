#!/usr/bin/env bash
set -euo pipefail
TARGET_CONTAINER="${VAULT_TARGET_CONTAINER:-opd-vault}"
IMAGE="${VAULT_CLI_IMAGE:-hashicorp/vault:1.15.5}"
VAULT_ADDR_INNER="${VAULT_ADDR:-http://127.0.0.1:8200}"
VAULT_TOKEN_INNER="${VAULT_TOKEN:-root}"
if ! docker ps --format '{{.Names}}' | grep -q "^${TARGET_CONTAINER}$"; then
  echo "vault CLI wrapper: target container ${TARGET_CONTAINER} is not running" >&2
  exit 1
fi
exec docker run --rm \
  --network "container:${TARGET_CONTAINER}" \
  -e VAULT_ADDR="${VAULT_ADDR_INNER}" \
  -e VAULT_TOKEN="${VAULT_TOKEN_INNER}" \
  "$IMAGE" vault "$@"
