#1 [internal] load local bake definitions
#1 reading from stdin 845B done
#1 DONE 0.0s

#2 [server-modernized-dev internal] load build definition from Dockerfile
#2 transferring dockerfile: 4.21kB done
#2 DONE 0.0s

#3 [server internal] load build definition from Dockerfile.legacy
#3 transferring dockerfile: 4.22kB done
#3 DONE 0.0s

#4 [server] resolve image config for docker-image://docker.io/docker/dockerfile:1.7
#4 DONE 0.7s

#5 [server] docker-image://docker.io/docker/dockerfile:1.7@sha256:a57df69d0ea827fb7266491f2813635de6f17269be881f696fbfdf2d83dda33e
#5 resolve docker.io/docker/dockerfile:1.7@sha256:a57df69d0ea827fb7266491f2813635de6f17269be881f696fbfdf2d83dda33e 0.0s done
#5 CACHED

#6 [server internal] load metadata for docker.io/library/maven:3.9.6-eclipse-temurin-17
#6 ...

#7 [server internal] load metadata for docker.io/jboss/wildfly:10.1.0.Final
#7 DONE 0.6s

#8 [server-modernized-dev internal] load metadata for quay.io/wildfly/wildfly:33.0.2.Final-jdk17
#8 DONE 0.6s

#6 [server internal] load metadata for docker.io/library/maven:3.9.6-eclipse-temurin-17
#6 DONE 0.6s

#9 [server-modernized-dev internal] load .dockerignore
#9 transferring context: 125B done
#9 DONE 0.0s

#10 [server internal] load .dockerignore
#10 transferring context: 125B done
#10 DONE 0.0s

#11 [server stage-1  1/12] FROM docker.io/jboss/wildfly:10.1.0.Final@sha256:455b5f3b2ec9cd206e879b776fa854e09c1a0f534362de57c858906561c4128d
#11 resolve docker.io/jboss/wildfly:10.1.0.Final@sha256:455b5f3b2ec9cd206e879b776fa854e09c1a0f534362de57c858906561c4128d done
#11 DONE 0.0s

#12 [server-modernized-dev build  1/19] FROM docker.io/library/maven:3.9.6-eclipse-temurin-17@sha256:29a1658b1f3078e07c2b17f7b519b45eb47f65d9628e887eac45a8c5c8f939d4
#12 resolve docker.io/library/maven:3.9.6-eclipse-temurin-17@sha256:29a1658b1f3078e07c2b17f7b519b45eb47f65d9628e887eac45a8c5c8f939d4 done
#12 DONE 0.0s

#13 [server-modernized-dev stage-1  1/11] FROM quay.io/wildfly/wildfly:33.0.2.Final-jdk17@sha256:72d2a8a60c5422d0f929bfaf329c9fcf5df26d402ff8bb8b10297ff4f714c33a
#13 resolve quay.io/wildfly/wildfly:33.0.2.Final-jdk17@sha256:72d2a8a60c5422d0f929bfaf329c9fcf5df26d402ff8bb8b10297ff4f714c33a 0.0s done
#13 DONE 0.0s

#14 [server-modernized-dev internal] load build context
#14 transferring context: 63.38kB 0.0s done
#14 DONE 0.0s

#15 [server internal] load build context
#15 transferring context: 160.86kB 0.1s done
#15 DONE 0.1s

#16 [server stage-1  6/12] COPY ops/shared/docker/custom.properties /opt/jboss/wildfly/custom.properties
#16 CACHED

#17 [server stage-1  9/12] RUN chmod +x /opt/jboss/bootstrap.sh
#17 CACHED

#18 [server build 16/19] RUN cat <<'JAVA' > /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#18 CACHED

#19 [server build  9/19] COPY ops/shared/docker/settings.xml /tmp/maven-settings.xml
#19 CACHED

#20 [server build 14/19] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=javax.jms:javax.jms-api:2.0.1
#20 CACHED

#21 [server stage-1 10/12] RUN mkdir -p /opt/jboss/tmp/WEB-INF/lib &&     mv /opt/jboss/string-clob-type-compat.jar /opt/jboss/tmp/WEB-INF/lib/ &&     mv /opt/jboss/javax-jms-api.jar /opt/jboss/tmp/WEB-INF/lib/ &&     cd /opt/jboss/tmp &&     jar uf /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war -C /opt/jboss/tmp WEB-INF &&     rm -rf /opt/jboss/tmp
#21 CACHED

#22 [server build  6/19] COPY server ./server
#22 CACHED

#23 [server stage-1  3/12] COPY --from=build /root/.m2/repository/org/postgresql/postgresql/*/postgresql-*.jar /opt/jboss/postgresql-driver.jar
#23 CACHED

#24 [server stage-1  8/12] COPY ops/shared/docker/bootstrap.sh /opt/jboss/bootstrap.sh
#24 CACHED

#25 [server build  7/19] COPY client ./client
#25 CACHED

#26 [server build 18/19] RUN jar cf /tmp/hbcompat/string-clob-type-compat.jar -C /tmp/hbcompat/classes .
#26 CACHED

#27 [server build 15/19] RUN mkdir -p /tmp/hbcompat/src/org/hibernate/type /tmp/hbcompat/classes
#27 CACHED

#28 [server build  8/19] COPY ext_lib ./ext_lib
#28 CACHED

#29 [server build 10/19] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/iTextAsian.jar -DgroupId=opendolphin -DartifactId=itext-font -Dversion=1.0 -Dpackaging=jar
#29 CACHED

#30 [server build  5/19] COPY common ./common
#30 CACHED

#31 [server build 11/19] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/AppleJavaExtensions.jar -DgroupId=com.apple -DartifactId=AppleJavaExtensions -Dversion=1.6 -Dpackaging=jar
#31 CACHED

#32 [server stage-1 11/12] RUN /opt/jboss/wildfly/bin/jboss-cli.sh --file=/opt/jboss/configure-wildfly.cli &&     rm -f /opt/jboss/configure-wildfly.cli
#32 CACHED

#33 [server stage-1  5/12] COPY --from=build /root/.m2/repository/javax/jms/javax.jms-api/2.0.1/javax.jms-api-2.0.1.jar /opt/jboss/javax-jms-api.jar
#33 CACHED

#34 [server build  4/19] RUN sed '/<module>server-modernized<\/module>/d' pom.xml > pom.server-classic.xml
#34 CACHED

#35 [server build  3/19] COPY pom.xml ./
#35 CACHED

#36 [server build 12/19] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.postgresql:postgresql:42.7.3
#36 CACHED

#37 [server stage-1  7/12] COPY tmp/legacy-compose/configure-wildfly.cli /opt/jboss/configure-wildfly.cli
#37 CACHED

#38 [server stage-1  4/12] COPY --from=build /tmp/hbcompat/string-clob-type-compat.jar /opt/jboss/string-clob-type-compat.jar
#38 CACHED

#39 [server stage-1  2/12] COPY --from=build /workspace/server/target/opendolphin-server.war /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war
#39 CACHED

#40 [server build 19/19] RUN mvn -f pom.server-classic.xml -s /tmp/maven-settings.xml -B -pl server -am -DskipTests package &&     mv server/target/opendolphin-server-*.war server/target/opendolphin-server.war
#40 CACHED

#41 [server build 17/19] RUN javac -cp /root/.m2/repository/org/hibernate/hibernate-core/5.0.10.Final/hibernate-core-5.0.10.Final.jar -d /tmp/hbcompat/classes /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#41 CACHED

#42 [server build 13/19] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.hibernate:hibernate-core:5.0.10.Final
#42 CACHED

#43 [server stage-1 12/12] RUN chown -R jboss:0 /opt/jboss/wildfly /opt/jboss/bootstrap.sh /opt/jboss/postgresql-driver.jar
#43 CACHED

#44 [server-modernized-dev stage-1  7/11] COPY ops/shared/docker/bootstrap.sh /opt/jboss/bootstrap.sh
#44 CACHED

#45 [server-modernized-dev build 12/17] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.hibernate:hibernate-core:5.0.10.Final
#45 CACHED

#46 [server-modernized-dev build  8/17] COPY ops/shared/docker/settings.xml /tmp/maven-settings.xml
#46 CACHED

#47 [server-modernized-dev build 11/17] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.postgresql:postgresql:42.7.3
#47 CACHED

#48 [server-modernized-dev build 15/17] RUN javac -cp /root/.m2/repository/org/hibernate/hibernate-core/5.0.10.Final/hibernate-core-5.0.10.Final.jar -d /tmp/hbcompat/classes /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#48 CACHED

#49 [server-modernized-dev stage-1 10/11] RUN /opt/jboss/wildfly/bin/jboss-cli.sh --file=/opt/jboss/configure-wildfly.cli &&     rm -f /opt/jboss/configure-wildfly.cli
#49 CACHED

#50 [server-modernized-dev stage-1  8/11] RUN chmod +x /opt/jboss/bootstrap.sh
#50 CACHED

#51 [server-modernized-dev build  5/17] COPY common ./common
#51 CACHED

#52 [server-modernized-dev stage-1  6/11] COPY ops/modernized-server/docker/configure-wildfly.cli /opt/jboss/configure-wildfly.cli
#52 CACHED

#53 [server-modernized-dev build 17/17] RUN mvn -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B -pl server-modernized -am -DskipTests package &&     mv server-modernized/target/opendolphin-server-*.war server-modernized/target/opendolphin-server.war
#53 CACHED

#54 [server-modernized-dev build  2/19] WORKDIR /workspace
#54 CACHED

#55 [server-modernized-dev build  7/17] COPY ext_lib ./ext_lib
#55 CACHED

#56 [server-modernized-dev build  6/17] COPY server-modernized ./server-modernized
#56 CACHED

#57 [server-modernized-dev stage-1  3/11] COPY --from=build /root/.m2/repository/org/postgresql/postgresql/*/postgresql-*.jar /opt/jboss/postgresql-driver.jar
#57 CACHED

#58 [server-modernized-dev stage-1  9/11] RUN mkdir -p /opt/jboss/tmp/WEB-INF/lib &&     mv /opt/jboss/string-clob-type-compat.jar /opt/jboss/tmp/WEB-INF/lib/ &&     cd /opt/jboss/tmp &&     jar uf /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war -C /opt/jboss/tmp WEB-INF &&     rm -rf /opt/jboss/tmp
#58 CACHED

#59 [server-modernized-dev stage-1  2/11] COPY --from=build /workspace/server-modernized/target/opendolphin-server.war /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war
#59 CACHED

#60 [server-modernized-dev build 14/17] RUN cat <<'JAVA' > /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#60 CACHED

#61 [server-modernized-dev build 13/17] RUN mkdir -p /tmp/hbcompat/src/org/hibernate/type /tmp/hbcompat/classes
#61 CACHED

#62 [server-modernized-dev build 10/17] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/AppleJavaExtensions.jar -DgroupId=com.apple -DartifactId=AppleJavaExtensions -Dversion=1.6 -Dpackaging=jar
#62 CACHED

#63 [server-modernized-dev build 16/17] RUN jar cf /tmp/hbcompat/string-clob-type-compat.jar -C /tmp/hbcompat/classes .
#63 CACHED

#64 [server-modernized-dev build  9/17] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/iTextAsian.jar -DgroupId=opendolphin -DartifactId=itext-font -Dversion=1.0 -Dpackaging=jar
#64 CACHED

#65 [server-modernized-dev build  4/17] RUN grep -v '<module>server</module>' pom.xml | grep -v '<module>client</module>' > pom.server-modernized.xml
#65 CACHED

#66 [server-modernized-dev build  3/17] COPY pom.xml ./
#66 CACHED

#67 [server-modernized-dev stage-1  4/11] COPY --from=build /tmp/hbcompat/string-clob-type-compat.jar /opt/jboss/string-clob-type-compat.jar
#67 CACHED

#68 [server-modernized-dev stage-1  5/11] COPY ops/shared/docker/custom.properties /opt/jboss/wildfly/custom.properties
#68 CACHED

#69 [server-modernized-dev stage-1 11/11] RUN chown -R jboss:0 /opt/jboss/wildfly /opt/jboss/bootstrap.sh /opt/jboss/postgresql-driver.jar
#69 CACHED

#70 [server] exporting to image
#70 exporting layers done
#70 exporting manifest sha256:51d19b2d7f0d67ea6318e5a8ab4fda015a78b7750abdf3f893b7e587a8b4fe53 done
#70 exporting config sha256:5b31ec5321e157f317fe991a61944caa6ca54f069fbccbb8f752f9fc4523aff7 done
#70 exporting attestation manifest sha256:3aa50901644af4342832ece3528927da51a0369b55a1cd6e6a4ce18e8b651f4b 0.0s done
#70 exporting manifest list sha256:88e63bb9d759545680319e62ab510208dc59a6b31e5252c8b4289b10b17f4408 done
#70 naming to docker.io/library/legacy-vs-modern-server:latest done
#70 unpacking to docker.io/library/legacy-vs-modern-server:latest done
#70 DONE 0.1s

#71 [server-modernized-dev] exporting to image
#71 exporting layers done
#71 exporting manifest sha256:f0751eb7e4c3664197ea040ae54428f44d0994dbeb8fd27352a709ce622d75c6 done
#71 exporting config sha256:20517bda1897144853948bd471296e1a0739711c7eeb0dd7731e62cbad0b0802 0.0s done
#71 exporting attestation manifest sha256:bd355a15e00b073ed332c7486bda78b269167532660189a3de814e661fbe2cf5 0.0s done
#71 exporting manifest list sha256:035f5ff6c9832aaa6c50a9986283d460caa6d259d4edb3ecd367255b6f1c6b6a done
#71 naming to docker.io/library/legacy-vs-modern-server-modernized-dev:latest done
#71 unpacking to docker.io/library/legacy-vs-modern-server-modernized-dev:latest done
#71 DONE 0.1s

#72 [server] resolving provenance for metadata file
#72 DONE 0.0s

#73 [server-modernized-dev] resolving provenance for metadata file
#73 DONE 0.0s
 server  Built
 server-modernized-dev  Built
 Container opendolphin-postgres-modernized  Creating
 Container opendolphin-postgres  Creating
 Container opendolphin-postgres  Created
 Container opendolphin-server  Creating
 Container opendolphin-postgres-modernized  Created
 Container opendolphin-server-modernized-dev  Creating
 server The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested 
 Container opendolphin-server  Created
 Container opendolphin-server-modernized-dev  Created
 Container opendolphin-postgres  Starting
 Container opendolphin-postgres-modernized  Starting
 Container opendolphin-postgres-modernized  Started
 Container opendolphin-postgres-modernized  Waiting
 Container opendolphin-postgres  Started
 Container opendolphin-postgres  Waiting
 Container opendolphin-postgres-modernized  Healthy
 Container opendolphin-server-modernized-dev  Starting
 Container opendolphin-postgres  Healthy
 Container opendolphin-server  Starting
 Container opendolphin-server-modernized-dev  Started
 Container opendolphin-server  Started
