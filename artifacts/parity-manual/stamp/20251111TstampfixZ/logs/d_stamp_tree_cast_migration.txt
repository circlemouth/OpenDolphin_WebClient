# Applied on 2025-11-12 (JST)
# Step 1: revert treeBytes column back to OID for both Legacy and Modern DBs
ALTER TABLE d_stamp_tree ALTER COLUMN treebytes SET DATA TYPE oid USING lo_from_bytea(0, treebytes);

# Step 2: register helper cast so Hibernate bytea bindings can write into OID columns
CREATE OR REPLACE FUNCTION bytea_to_oid(bytea) RETURNS oid AS $$
  SELECT lo_from_bytea(0, $1);
$$ LANGUAGE sql STRICT;
DROP CAST IF EXISTS (bytea AS oid);
CREATE CAST (bytea AS oid) WITH FUNCTION bytea_to_oid(bytea) AS IMPLICIT;
