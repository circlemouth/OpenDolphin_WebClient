#1 [internal] load local bake definitions
#1 reading from stdin 845B done
#1 DONE 0.0s

#2 [server internal] load build definition from Dockerfile.legacy
#2 transferring dockerfile: 4.79kB done
#2 DONE 0.0s

#3 [server-modernized-dev internal] load build definition from Dockerfile
#3 transferring dockerfile: 5.29kB done
#3 DONE 0.0s

#4 [server] resolve image config for docker-image://docker.io/docker/dockerfile:1.7
#4 ...

#5 [auth] docker/dockerfile:pull token for registry-1.docker.io
#5 DONE 0.0s

#4 [server] resolve image config for docker-image://docker.io/docker/dockerfile:1.7
#4 DONE 1.9s

#6 [server] docker-image://docker.io/docker/dockerfile:1.7@sha256:a57df69d0ea827fb7266491f2813635de6f17269be881f696fbfdf2d83dda33e
#6 resolve docker.io/docker/dockerfile:1.7@sha256:a57df69d0ea827fb7266491f2813635de6f17269be881f696fbfdf2d83dda33e 0.0s done
#6 CACHED

#7 [server-modernized-dev internal] load metadata for quay.io/wildfly/wildfly:33.0.2.Final-jdk17
#7 ...

#8 [auth] library/maven:pull token for registry-1.docker.io
#8 DONE 0.0s

#9 [auth] jboss/wildfly:pull token for registry-1.docker.io
#9 DONE 0.0s

#7 [server-modernized-dev internal] load metadata for quay.io/wildfly/wildfly:33.0.2.Final-jdk17
#7 DONE 0.8s

#10 [server internal] load metadata for docker.io/library/maven:3.9.6-eclipse-temurin-17
#10 DONE 1.0s

#11 [server internal] load metadata for docker.io/jboss/wildfly:10.1.0.Final
#11 DONE 1.0s

#12 [server-modernized-dev internal] load .dockerignore
#12 transferring context: 133B done
#12 DONE 0.0s

#13 [server internal] load .dockerignore
#13 transferring context: 133B done
#13 DONE 0.0s

#14 [server internal] load build context
#14 DONE 0.0s

#15 [server stage-1  1/15] FROM docker.io/jboss/wildfly:10.1.0.Final@sha256:455b5f3b2ec9cd206e879b776fa854e09c1a0f534362de57c858906561c4128d
#15 resolve docker.io/jboss/wildfly:10.1.0.Final@sha256:455b5f3b2ec9cd206e879b776fa854e09c1a0f534362de57c858906561c4128d done
#15 DONE 0.0s

#16 [server-modernized-dev stage-1  1/17] FROM quay.io/wildfly/wildfly:33.0.2.Final-jdk17@sha256:72d2a8a60c5422d0f929bfaf329c9fcf5df26d402ff8bb8b10297ff4f714c33a
#16 resolve quay.io/wildfly/wildfly:33.0.2.Final-jdk17@sha256:72d2a8a60c5422d0f929bfaf329c9fcf5df26d402ff8bb8b10297ff4f714c33a 0.0s done
#16 DONE 0.0s

#17 [server-modernized-dev build  1/18] FROM docker.io/library/maven:3.9.6-eclipse-temurin-17@sha256:29a1658b1f3078e07c2b17f7b519b45eb47f65d9628e887eac45a8c5c8f939d4
#17 resolve docker.io/library/maven:3.9.6-eclipse-temurin-17@sha256:29a1658b1f3078e07c2b17f7b519b45eb47f65d9628e887eac45a8c5c8f939d4 0.0s done
#17 DONE 0.0s

#18 [server-modernized-dev internal] load build context
#18 ...

#14 [server internal] load build context
#14 transferring context: 10.62MB 0.8s done
#14 DONE 0.8s

#18 [server-modernized-dev internal] load build context
#18 transferring context: 3.27MB 0.9s done
#18 DONE 0.9s

#19 [server build 16/20] RUN mkdir -p /tmp/hbcompat/src/org/hibernate/type /tmp/hbcompat/classes
#19 CACHED

#20 [server stage-1  2/15] RUN mkdir -p /usr/share/fonts/opendolphin
#20 CACHED

#21 [server stage-1  4/15] RUN chmod 644 /usr/share/fonts/opendolphin/NotoSansCJKjp-Regular.otf
#21 CACHED

#22 [server build 17/20] RUN cat <<'JAVA' > /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#22 CACHED

#23 [server stage-1  8/15] COPY --from=build /root/.m2/repository/javax/jms/javax.jms-api/2.0.1/javax.jms-api-2.0.1.jar /opt/jboss/javax-jms-api.jar
#23 CACHED

#24 [server build  6/20] COPY reporting ./reporting
#24 CACHED

#25 [server stage-1  3/15] COPY ops/assets/fonts/NotoSansCJKjp-Regular.otf /usr/share/fonts/opendolphin/NotoSansCJKjp-Regular.otf
#25 CACHED

#26 [server build  7/20] COPY server ./server
#26 CACHED

#27 [server build  2/18] WORKDIR /workspace
#27 CACHED

#28 [server stage-1 10/15] COPY tmp/legacy-compose/configure-wildfly.cli /opt/jboss/configure-wildfly.cli
#28 CACHED

#29 [server stage-1 13/15] RUN mkdir -p /opt/jboss/tmp/WEB-INF/lib &&     mv /opt/jboss/string-clob-type-compat.jar /opt/jboss/tmp/WEB-INF/lib/ &&     mv /opt/jboss/javax-jms-api.jar /opt/jboss/tmp/WEB-INF/lib/ &&     cd /opt/jboss/tmp &&     jar uf /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war -C /opt/jboss/tmp WEB-INF &&     rm -rf /opt/jboss/tmp
#29 CACHED

#30 [server build  5/20] COPY common ./common
#30 CACHED

#31 [server build 12/20] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/AppleJavaExtensions.jar -DgroupId=com.apple -DartifactId=AppleJavaExtensions -Dversion=1.6 -Dpackaging=jar
#31 CACHED

#32 [server build  9/20] COPY ext_lib ./ext_lib
#32 CACHED

#33 [server build 10/20] COPY ops/shared/docker/settings.xml /tmp/maven-settings.xml
#33 CACHED

#34 [server stage-1 11/15] COPY ops/shared/docker/bootstrap.sh /opt/jboss/bootstrap.sh
#34 CACHED

#35 [server build 18/20] RUN javac -cp /root/.m2/repository/org/hibernate/hibernate-core/5.0.10.Final/hibernate-core-5.0.10.Final.jar -d /tmp/hbcompat/classes /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#35 CACHED

#36 [server stage-1  9/15] COPY ops/shared/docker/custom.properties /opt/jboss/wildfly/custom.properties
#36 CACHED

#37 [server build 15/20] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=javax.jms:javax.jms-api:2.0.1
#37 CACHED

#38 [server build  8/20] COPY client ./client
#38 CACHED

#39 [server build 11/20] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/iTextAsian.jar -DgroupId=opendolphin -DartifactId=itext-font -Dversion=1.0 -Dpackaging=jar
#39 CACHED

#40 [server build 13/20] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.postgresql:postgresql:42.7.3
#40 CACHED

#41 [server build 19/20] RUN jar cf /tmp/hbcompat/string-clob-type-compat.jar -C /tmp/hbcompat/classes .
#41 CACHED

#42 [server stage-1  7/15] COPY --from=build /tmp/hbcompat/string-clob-type-compat.jar /opt/jboss/string-clob-type-compat.jar
#42 CACHED

#43 [server stage-1 14/15] RUN /opt/jboss/wildfly/bin/jboss-cli.sh --file=/opt/jboss/configure-wildfly.cli &&     rm -f /opt/jboss/configure-wildfly.cli
#43 CACHED

#44 [server build  3/20] COPY pom.xml ./
#44 CACHED

#45 [server stage-1 12/15] RUN chmod +x /opt/jboss/bootstrap.sh
#45 CACHED

#46 [server stage-1  6/15] COPY --from=build /root/.m2/repository/org/postgresql/postgresql/*/postgresql-*.jar /opt/jboss/postgresql-driver.jar
#46 CACHED

#47 [server stage-1  5/15] COPY --from=build /workspace/server/target/opendolphin-server.war /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war
#47 CACHED

#48 [server build 20/20] RUN set -eux;     mvn -f pom.server-classic.xml -s /tmp/maven-settings.xml -B -pl server -am -Plegacy-wildfly10 -DskipTests -Dmaven.test.skip=true package;     WAR_DIR=server/target;     WAR_FILE="${WAR_DIR}/opendolphin-server.war";     if [ ! -f "${WAR_FILE}" ]; then         FIRST_WAR=$(ls "${WAR_DIR}"/*.war | head -n 1);         mv "${FIRST_WAR}" "${WAR_FILE}";     fi
#48 CACHED

#49 [server build  4/20] RUN sed '/<module>server-modernized<\/module>/d' pom.xml > pom.server-classic.xml
#49 CACHED

#50 [server build 14/20] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.hibernate:hibernate-core:5.0.10.Final
#50 CACHED

#51 [server stage-1 15/15] RUN chown -R jboss:0 /opt/jboss/wildfly /opt/jboss/bootstrap.sh /opt/jboss/postgresql-driver.jar
#51 CACHED

#52 [server-modernized-dev build 14/18] RUN mkdir -p /tmp/hbcompat/src/org/hibernate/type /tmp/hbcompat/classes
#52 CACHED

#53 [server-modernized-dev build 12/18] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.postgresql:postgresql:42.7.3
#53 CACHED

#54 [server-modernized-dev build 18/18] RUN set -eux;     mvn -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B -pl server-modernized -am -DskipTests package;     WAR_DIR=server-modernized/target;     WAR_FILE="${WAR_DIR}/opendolphin-server.war";     if [ ! -f "${WAR_FILE}" ]; then         FIRST_WAR=$(ls "${WAR_DIR}"/*.war | head -n 1);         mv "${FIRST_WAR}" "${WAR_FILE}";     fi
#54 CACHED

#55 [server-modernized-dev build 16/18] RUN javac -cp /root/.m2/repository/org/hibernate/hibernate-core/5.0.10.Final/hibernate-core-5.0.10.Final.jar -d /tmp/hbcompat/classes /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#55 CACHED

#56 [server-modernized-dev stage-1 11/17] COPY ops/modernized-server/docker/configure-wildfly.cli /opt/jboss/configure-wildfly.cli
#56 CACHED

#57 [server-modernized-dev build  4/18] RUN grep -v '<module>server</module>' pom.xml | grep -v '<module>client</module>' > pom.server-modernized.xml
#57 CACHED

#58 [server-modernized-dev build 17/18] RUN jar cf /tmp/hbcompat/string-clob-type-compat.jar -C /tmp/hbcompat/classes .
#58 CACHED

#59 [server-modernized-dev stage-1  8/17] RUN mkdir -p /opt/jboss/config
#59 CACHED

#60 [server-modernized-dev build  8/18] COPY ext_lib ./ext_lib
#60 CACHED

#61 [server-modernized-dev build 11/18] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/AppleJavaExtensions.jar -DgroupId=com.apple -DartifactId=AppleJavaExtensions -Dversion=1.6 -Dpackaging=jar
#61 CACHED

#62 [server-modernized-dev build  9/18] COPY ops/shared/docker/settings.xml /tmp/maven-settings.xml
#62 CACHED

#63 [server-modernized-dev stage-1  9/17] COPY server-modernized/config/attachment-storage.sample.yaml /opt/jboss/config/attachment-storage.yaml
#63 CACHED

#64 [server-modernized-dev stage-1 15/17] RUN mkdir -p /opt/jboss/tmp/WEB-INF/lib &&     mv /opt/jboss/string-clob-type-compat.jar /opt/jboss/tmp/WEB-INF/lib/ &&     cd /opt/jboss/tmp &&     jar uf /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war -C /opt/jboss/tmp WEB-INF &&     rm -rf /opt/jboss/tmp
#64 CACHED

#65 [server-modernized-dev stage-1 14/17] RUN cat <<'EOF' >> /opt/jboss/wildfly/standalone/configuration/logging.properties
#65 CACHED

#66 [server-modernized-dev build  3/18] COPY pom.xml ./
#66 CACHED

#67 [server-modernized-dev stage-1 12/17] COPY ops/shared/docker/bootstrap.sh /opt/jboss/bootstrap.sh
#67 CACHED

#68 [server-modernized-dev build 10/18] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/iTextAsian.jar -DgroupId=opendolphin -DartifactId=itext-font -Dversion=1.0 -Dpackaging=jar
#68 CACHED

#69 [server-modernized-dev build 15/18] RUN cat <<'JAVA' > /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#69 CACHED

#70 [server-modernized-dev stage-1  2/17] RUN mkdir -p /usr/share/fonts/opendolphin
#70 CACHED

#71 [server-modernized-dev stage-1  7/17] COPY --from=build /tmp/hbcompat/string-clob-type-compat.jar /opt/jboss/string-clob-type-compat.jar
#71 CACHED

#72 [server-modernized-dev build  5/18] COPY common ./common
#72 CACHED

#27 [server-modernized-dev build  2/18] WORKDIR /workspace
#27 CACHED

#73 [server-modernized-dev stage-1  6/17] COPY --from=build /root/.m2/repository/org/postgresql/postgresql/*/postgresql-*.jar /opt/jboss/postgresql-driver.jar
#73 CACHED

#74 [server-modernized-dev stage-1 10/17] COPY ops/shared/docker/custom.properties /opt/jboss/wildfly/custom.properties
#74 CACHED

#75 [server-modernized-dev build  6/18] COPY reporting ./reporting
#75 CACHED

#76 [server-modernized-dev stage-1  4/17] RUN chmod 644 /usr/share/fonts/opendolphin/NotoSansCJKjp-Regular.otf
#76 CACHED

#77 [server-modernized-dev build  7/18] COPY server-modernized ./server-modernized
#77 CACHED

#78 [server-modernized-dev build 13/18] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.hibernate:hibernate-core:5.0.10.Final
#78 CACHED

#79 [server-modernized-dev stage-1 13/17] RUN chmod +x /opt/jboss/bootstrap.sh
#79 CACHED

#80 [server-modernized-dev stage-1 16/17] RUN /opt/jboss/wildfly/bin/jboss-cli.sh --file=/opt/jboss/configure-wildfly.cli &&     rm -f /opt/jboss/configure-wildfly.cli &&     rm -rf /opt/jboss/wildfly/standalone/configuration/standalone_xml_history
#80 CACHED

#81 [server-modernized-dev stage-1  3/17] COPY ops/assets/fonts/NotoSansCJKjp-Regular.otf /usr/share/fonts/opendolphin/NotoSansCJKjp-Regular.otf
#81 CACHED

#82 [server-modernized-dev stage-1  5/17] COPY --from=build /workspace/server-modernized/target/opendolphin-server.war /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war
#82 CACHED

#83 [server-modernized-dev stage-1 17/17] RUN chown -R jboss:0 /opt/jboss/wildfly /opt/jboss/bootstrap.sh /opt/jboss/postgresql-driver.jar
#83 CACHED

#84 [server-modernized-dev] exporting to image
#84 exporting layers 0.0s done
#84 exporting manifest sha256:ee431df99a44ac28b77b36d230f35d5b88dcdfef4958b5b93b390291d1413ae3 0.0s done
#84 exporting config sha256:d630689009c74e80bf9c267036ac94fcb6feb2d14a4f8162ef0701768b0129a9 done
#84 exporting attestation manifest sha256:5dda4f04445c36a7d82d35424b80b084df6ec79b9a97eb43e24776a6700a93b8
#84 exporting attestation manifest sha256:5dda4f04445c36a7d82d35424b80b084df6ec79b9a97eb43e24776a6700a93b8 0.0s done
#84 exporting manifest list sha256:336e8d960ae40c519ee69ddf8ac1180e5dd3273d2ab1158a812602a1cb4fb608 0.0s done
#84 naming to docker.io/library/legacy-vs-modern-server-modernized-dev:latest done
#84 unpacking to docker.io/library/legacy-vs-modern-server-modernized-dev:latest 0.0s done
#84 DONE 0.2s

#85 [server] exporting to image
#85 exporting layers 0.0s done
#85 exporting manifest sha256:405eb6574037a23762deb3c4668d01d969c22f549cdcea96e89fbd7b68c4e558 done
#85 exporting config sha256:73536cea90da8897d6dbe87d7cd42badddb6a45af6b8159151bc2da85352634e done
#85 exporting attestation manifest sha256:3ddb8ea3603a7c192d0096a97161a5fb4fb3777f4837fdb8729b138f8f7757c3 0.0s done
#85 exporting manifest list sha256:b8dc976c7b121ee9f544af10a602cb1008a24671cfa1be772828c7728752b41a done
#85 naming to docker.io/library/legacy-vs-modern-server:latest done
#85 unpacking to docker.io/library/legacy-vs-modern-server:latest 0.0s done
#85 DONE 0.1s

#86 [server] resolving provenance for metadata file
#86 DONE 0.0s

#87 [server-modernized-dev] resolving provenance for metadata file
#87 DONE 0.0s
