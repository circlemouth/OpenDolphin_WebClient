#1 [internal] load local bake definitions
#1 reading from stdin 845B done
#1 DONE 0.0s

#2 [server-modernized-dev internal] load build definition from Dockerfile
#2 transferring dockerfile: 5.10kB done
#2 DONE 0.0s

#3 [server internal] load build definition from Dockerfile.legacy
#3 transferring dockerfile: 4.59kB done
#3 DONE 0.0s

#4 [server] resolve image config for docker-image://docker.io/docker/dockerfile:1.7
#4 DONE 0.8s

#5 [server-modernized-dev] docker-image://docker.io/docker/dockerfile:1.7@sha256:a57df69d0ea827fb7266491f2813635de6f17269be881f696fbfdf2d83dda33e
#5 resolve docker.io/docker/dockerfile:1.7@sha256:a57df69d0ea827fb7266491f2813635de6f17269be881f696fbfdf2d83dda33e 0.0s done
#5 CACHED

#6 [server internal] load metadata for docker.io/library/maven:3.9.6-eclipse-temurin-17
#6 ...

#7 [server internal] load metadata for docker.io/jboss/wildfly:10.1.0.Final
#7 DONE 0.6s

#6 [server-modernized-dev internal] load metadata for docker.io/library/maven:3.9.6-eclipse-temurin-17
#6 DONE 0.6s

#8 [server internal] load .dockerignore
#8 transferring context: 133B done
#8 DONE 0.0s

#9 [server-modernized-dev internal] load metadata for quay.io/wildfly/wildfly:33.0.2.Final-jdk17
#9 DONE 0.8s

#10 [server-modernized-dev internal] load .dockerignore
#10 transferring context: 133B 0.0s done
#10 DONE 0.0s

#11 [server stage-1  1/15] FROM docker.io/jboss/wildfly:10.1.0.Final@sha256:455b5f3b2ec9cd206e879b776fa854e09c1a0f534362de57c858906561c4128d
#11 resolve docker.io/jboss/wildfly:10.1.0.Final@sha256:455b5f3b2ec9cd206e879b776fa854e09c1a0f534362de57c858906561c4128d 0.0s done
#11 DONE 0.0s

#12 [server-modernized-dev build  1/20] FROM docker.io/library/maven:3.9.6-eclipse-temurin-17@sha256:29a1658b1f3078e07c2b17f7b519b45eb47f65d9628e887eac45a8c5c8f939d4
#12 resolve docker.io/library/maven:3.9.6-eclipse-temurin-17@sha256:29a1658b1f3078e07c2b17f7b519b45eb47f65d9628e887eac45a8c5c8f939d4 0.0s done
#12 DONE 0.0s

#13 [server-modernized-dev internal] load build context
#13 ...

#14 [server-modernized-dev stage-1  1/17] FROM quay.io/wildfly/wildfly:33.0.2.Final-jdk17@sha256:72d2a8a60c5422d0f929bfaf329c9fcf5df26d402ff8bb8b10297ff4f714c33a
#14 resolve quay.io/wildfly/wildfly:33.0.2.Final-jdk17@sha256:72d2a8a60c5422d0f929bfaf329c9fcf5df26d402ff8bb8b10297ff4f714c33a 0.0s done
#14 DONE 0.0s

#15 [server internal] load build context
#15 transferring context: 196.52kB 0.1s done
#15 DONE 0.1s

#13 [server-modernized-dev internal] load build context
#13 transferring context: 3.11MB 0.2s done
#13 DONE 0.2s

#16 [server build  9/20] COPY ext_lib ./ext_lib
#16 CACHED

#17 [server build  4/20] RUN sed '/<module>server-modernized<\/module>/d' pom.xml > pom.server-classic.xml
#17 CACHED

#18 [server build 11/20] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/iTextAsian.jar -DgroupId=opendolphin -DartifactId=itext-font -Dversion=1.0 -Dpackaging=jar
#18 CACHED

#19 [server stage-1 11/15] COPY ops/shared/docker/bootstrap.sh /opt/jboss/bootstrap.sh
#19 CACHED

#20 [server stage-1 14/15] RUN /opt/jboss/wildfly/bin/jboss-cli.sh --file=/opt/jboss/configure-wildfly.cli &&     rm -f /opt/jboss/configure-wildfly.cli
#20 CACHED

#21 [server stage-1 13/15] RUN mkdir -p /opt/jboss/tmp/WEB-INF/lib &&     mv /opt/jboss/string-clob-type-compat.jar /opt/jboss/tmp/WEB-INF/lib/ &&     mv /opt/jboss/javax-jms-api.jar /opt/jboss/tmp/WEB-INF/lib/ &&     cd /opt/jboss/tmp &&     jar uf /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war -C /opt/jboss/tmp WEB-INF &&     rm -rf /opt/jboss/tmp
#21 CACHED

#22 [server stage-1  8/15] COPY --from=build /root/.m2/repository/javax/jms/javax.jms-api/2.0.1/javax.jms-api-2.0.1.jar /opt/jboss/javax-jms-api.jar
#22 CACHED

#23 [server build 20/20] RUN mvn -f pom.server-classic.xml -s /tmp/maven-settings.xml -B -pl server -am -Plegacy-wildfly10 -DskipTests -Dmaven.test.skip=true package &&     mv server/target/opendolphin-server-*.war server/target/opendolphin-server.war
#23 CACHED

#24 [server stage-1  6/15] COPY --from=build /root/.m2/repository/org/postgresql/postgresql/*/postgresql-*.jar /opt/jboss/postgresql-driver.jar
#24 CACHED

#25 [server build 12/20] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/AppleJavaExtensions.jar -DgroupId=com.apple -DartifactId=AppleJavaExtensions -Dversion=1.6 -Dpackaging=jar
#25 CACHED

#26 [server build 10/20] COPY ops/shared/docker/settings.xml /tmp/maven-settings.xml
#26 CACHED

#27 [server build 17/20] RUN cat <<'JAVA' > /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#27 CACHED

#28 [server stage-1  3/15] COPY ops/assets/fonts/NotoSansCJKjp-Regular.otf /usr/share/fonts/opendolphin/NotoSansCJKjp-Regular.otf
#28 CACHED

#29 [server stage-1  7/15] COPY --from=build /tmp/hbcompat/string-clob-type-compat.jar /opt/jboss/string-clob-type-compat.jar
#29 CACHED

#30 [server build 18/20] RUN javac -cp /root/.m2/repository/org/hibernate/hibernate-core/5.0.10.Final/hibernate-core-5.0.10.Final.jar -d /tmp/hbcompat/classes /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#30 CACHED

#31 [server stage-1 12/15] RUN chmod +x /opt/jboss/bootstrap.sh
#31 CACHED

#32 [server stage-1  9/15] COPY ops/shared/docker/custom.properties /opt/jboss/wildfly/custom.properties
#32 CACHED

#33 [server build 14/20] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.hibernate:hibernate-core:5.0.10.Final
#33 CACHED

#34 [server build  8/20] COPY client ./client
#34 CACHED

#35 [server build  3/20] COPY pom.xml ./
#35 CACHED

#36 [server build 13/20] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.postgresql:postgresql:42.7.3
#36 CACHED

#37 [server build 16/20] RUN mkdir -p /tmp/hbcompat/src/org/hibernate/type /tmp/hbcompat/classes
#37 CACHED

#38 [server build  7/20] COPY server ./server
#38 CACHED

#39 [server build 15/20] RUN mvn -N -f pom.server-classic.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=javax.jms:javax.jms-api:2.0.1
#39 CACHED

#40 [server stage-1 10/15] COPY tmp/legacy-compose/configure-wildfly.cli /opt/jboss/configure-wildfly.cli
#40 CACHED

#41 [server build  2/20] WORKDIR /workspace
#41 CACHED

#42 [server build  6/20] COPY reporting ./reporting
#42 CACHED

#43 [server stage-1  5/15] COPY --from=build /workspace/server/target/opendolphin-server.war /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war
#43 CACHED

#44 [server stage-1  4/15] RUN chmod 644 /usr/share/fonts/opendolphin/NotoSansCJKjp-Regular.otf
#44 CACHED

#45 [server stage-1  2/15] RUN mkdir -p /usr/share/fonts/opendolphin
#45 CACHED

#46 [server build 19/20] RUN jar cf /tmp/hbcompat/string-clob-type-compat.jar -C /tmp/hbcompat/classes .
#46 CACHED

#47 [server build  5/20] COPY common ./common
#47 CACHED

#48 [server stage-1 15/15] RUN chown -R jboss:0 /opt/jboss/wildfly /opt/jboss/bootstrap.sh /opt/jboss/postgresql-driver.jar
#48 CACHED

#49 [server] exporting to image
#49 exporting layers 0.0s done
#49 exporting manifest sha256:7a230e08b05e27eb9a76133fcbff93f92aef29769e15c0df74e9eb28e0e32ce5 done
#49 exporting config sha256:47ae185111abeca36efc37600209e280ecbc5d111381e1eb2762854a3d2788f5 done
#49 exporting attestation manifest sha256:449968656616e5c68cb1fd4a49784f3cf1124152614e329233bb246106483b97
#49 ...

#50 [server-modernized-dev build 13/18] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.hibernate:hibernate-core:5.0.10.Final
#50 CACHED

#51 [server-modernized-dev build  5/18] COPY common ./common
#51 CACHED

#52 [server-modernized-dev build  9/18] COPY ops/shared/docker/settings.xml /tmp/maven-settings.xml
#52 CACHED

#53 [server-modernized-dev stage-1  4/17] RUN chmod 644 /usr/share/fonts/opendolphin/NotoSansCJKjp-Regular.otf
#53 CACHED

#54 [server-modernized-dev stage-1  8/17] RUN mkdir -p /opt/jboss/config
#54 CACHED

#55 [server-modernized-dev stage-1 15/17] RUN mkdir -p /opt/jboss/tmp/WEB-INF/lib &&     mv /opt/jboss/string-clob-type-compat.jar /opt/jboss/tmp/WEB-INF/lib/ &&     cd /opt/jboss/tmp &&     jar uf /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war -C /opt/jboss/tmp WEB-INF &&     rm -rf /opt/jboss/tmp
#55 CACHED

#56 [server-modernized-dev build 12/18] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B dependency:get -Dartifact=org.postgresql:postgresql:42.7.3
#56 CACHED

#57 [server-modernized-dev stage-1 11/17] COPY ops/modernized-server/docker/configure-wildfly.cli /opt/jboss/configure-wildfly.cli
#57 CACHED

#58 [server-modernized-dev stage-1  9/17] COPY server-modernized/config/attachment-storage.sample.yaml /opt/jboss/config/attachment-storage.yaml
#58 CACHED

#59 [server-modernized-dev build  6/18] COPY reporting ./reporting
#59 CACHED

#60 [server-modernized-dev build  8/18] COPY ext_lib ./ext_lib
#60 CACHED

#61 [server-modernized-dev build 18/18] RUN mvn -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B -pl server-modernized -am -DskipTests package &&     mv server-modernized/target/opendolphin-server-*.war server-modernized/target/opendolphin-server.war
#61 CACHED

#62 [server-modernized-dev build  3/18] COPY pom.xml ./
#62 CACHED

#63 [server-modernized-dev stage-1  2/17] RUN mkdir -p /usr/share/fonts/opendolphin
#63 CACHED

#64 [server-modernized-dev build 11/18] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/AppleJavaExtensions.jar -DgroupId=com.apple -DartifactId=AppleJavaExtensions -Dversion=1.6 -Dpackaging=jar
#64 CACHED

#65 [server-modernized-dev stage-1  6/17] COPY --from=build /root/.m2/repository/org/postgresql/postgresql/*/postgresql-*.jar /opt/jboss/postgresql-driver.jar
#65 CACHED

#66 [server-modernized-dev stage-1 10/17] COPY ops/shared/docker/custom.properties /opt/jboss/wildfly/custom.properties
#66 CACHED

#67 [server-modernized-dev stage-1 13/17] RUN chmod +x /opt/jboss/bootstrap.sh
#67 CACHED

#41 [server-modernized-dev build  2/20] WORKDIR /workspace
#41 CACHED

#68 [server-modernized-dev build 14/18] RUN mkdir -p /tmp/hbcompat/src/org/hibernate/type /tmp/hbcompat/classes
#68 CACHED

#69 [server-modernized-dev build 17/18] RUN jar cf /tmp/hbcompat/string-clob-type-compat.jar -C /tmp/hbcompat/classes .
#69 CACHED

#70 [server-modernized-dev stage-1  3/17] COPY ops/assets/fonts/NotoSansCJKjp-Regular.otf /usr/share/fonts/opendolphin/NotoSansCJKjp-Regular.otf
#70 CACHED

#71 [server-modernized-dev build 16/18] RUN javac -cp /root/.m2/repository/org/hibernate/hibernate-core/5.0.10.Final/hibernate-core-5.0.10.Final.jar -d /tmp/hbcompat/classes /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#71 CACHED

#72 [server-modernized-dev stage-1  7/17] COPY --from=build /tmp/hbcompat/string-clob-type-compat.jar /opt/jboss/string-clob-type-compat.jar
#72 CACHED

#73 [server-modernized-dev stage-1 16/17] RUN /opt/jboss/wildfly/bin/jboss-cli.sh --file=/opt/jboss/configure-wildfly.cli &&     rm -f /opt/jboss/configure-wildfly.cli &&     rm -rf /opt/jboss/wildfly/standalone/configuration/standalone_xml_history
#73 CACHED

#74 [server-modernized-dev stage-1 12/17] COPY ops/shared/docker/bootstrap.sh /opt/jboss/bootstrap.sh
#74 CACHED

#75 [server-modernized-dev stage-1  5/17] COPY --from=build /workspace/server-modernized/target/opendolphin-server.war /opt/jboss/wildfly/standalone/deployments/opendolphin-server.war
#75 CACHED

#76 [server-modernized-dev stage-1 14/17] RUN cat <<'EOF' >> /opt/jboss/wildfly/standalone/configuration/logging.properties
#76 CACHED

#77 [server-modernized-dev build  7/18] COPY server-modernized ./server-modernized
#77 CACHED

#78 [server-modernized-dev build 10/18] RUN mvn -N -f pom.server-modernized.xml -s /tmp/maven-settings.xml -B install:install-file -Dfile=ext_lib/iTextAsian.jar -DgroupId=opendolphin -DartifactId=itext-font -Dversion=1.0 -Dpackaging=jar
#78 CACHED

#79 [server-modernized-dev build  4/18] RUN grep -v '<module>server</module>' pom.xml | grep -v '<module>client</module>' > pom.server-modernized.xml
#79 CACHED

#80 [server-modernized-dev build 15/18] RUN cat <<'JAVA' > /tmp/hbcompat/src/org/hibernate/type/StringClobType.java
#80 CACHED

#49 [server] exporting to image
#49 exporting attestation manifest sha256:449968656616e5c68cb1fd4a49784f3cf1124152614e329233bb246106483b97 0.0s done
#49 exporting manifest list sha256:23480d04c8454de026d4d35036633f0b0dbdaad86c2a9a2e4d16e9cc06091be3 0.0s done
#49 naming to docker.io/library/legacy-vs-modern-server:latest done
#49 unpacking to docker.io/library/legacy-vs-modern-server:latest 0.0s done
#49 DONE 0.2s

#81 [server-modernized-dev stage-1 17/17] RUN chown -R jboss:0 /opt/jboss/wildfly /opt/jboss/bootstrap.sh /opt/jboss/postgresql-driver.jar
#81 CACHED

#82 [server-modernized-dev] exporting to image
#82 exporting layers 0.0s done
#82 exporting manifest sha256:41e9f11da4542f3d58892e9648b63ed5ee2ec15ce7dcea928b5a1d2d9fa63977 done
#82 exporting config sha256:49261d516824f21dd153a27447664498996f116dba649a2df527aae83e131aba done
#82 exporting attestation manifest sha256:74190d6db649c8293599a68e19f1f96e62934d10133050008d83a078f3df5a15 0.0s done
#82 exporting manifest list sha256:ab8549ef1da47dfab38a48a864deac5474e8aa39b122c40aee2bdf7feeaeca6d
#82 exporting manifest list sha256:ab8549ef1da47dfab38a48a864deac5474e8aa39b122c40aee2bdf7feeaeca6d 0.0s done
#82 naming to docker.io/library/legacy-vs-modern-server-modernized-dev:latest done
#82 unpacking to docker.io/library/legacy-vs-modern-server-modernized-dev:latest 0.1s done
#82 DONE 0.3s

#83 [server] resolving provenance for metadata file
#83 DONE 0.0s

#84 [server-modernized-dev] resolving provenance for metadata file
#84 DONE 0.0s
