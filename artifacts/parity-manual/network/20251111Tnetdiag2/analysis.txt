RUN_ID=20251111Tnetdiag2
日時: 2025-11-11T22:30Z 前後

1. 取得ログ一覧
- pf_rules_9080.txt: sudo パスワード未入手のため pfctl -sr 実行不可メモのみ。
- lo0_9080.pcap: sudo 権限不足で tcpdump 開始不可 (lo0_9080_pcap_error.txt / tcpdump_notes.txt に記録)。
- host_curl_9080_ipv6pref/log, host_curl_9080_ipv4.log: ホスト→localhost:9080 がいずれも 15 秒タイムアウト。
- ncat_19080.log / ncat_curl_19080.log: ncat で 19080→9080 中継しても同じくタイムアウト。ncat 側は接続確立のみ記録。
- docker_backend.log: log stream 取得結果はヘッダのみで、port-forward 失敗を示す行は出力されず。
- docker_backend_curl.log: 上記 curl (IPv4) の詳細ログ。
- docker_exec_curl.log: コンテナ内から localhost:8080 へは 401 応答で即時成功。

2. 観測まとめ
- Docker port-forward は LISTEN し接続確立までは到達するが、応答がホストへ戻らず 15 秒でタイムアウトする現象は IPv4/IPv6 で共通。
- 中継(ncat)でも改善せず、Docker Desktop の port-forward 層より先（コンテナ内8080）での応答は健全。
- pf/lo0 のパケットキャプチャが未取得のため、SYN/ACK の欠落地点は断定できない。

3. 仮説
- com.docker.backend の port-forward テーブルが壊れており、コンテナ→ホストへの戻りトラフィックが転送されていない。(log stream にエラーが出ないケース)
- macOS pf や他のホスト FW/VPN が 9080 リッスンソケットに対する OUTBOUND/INBOUND を遮断している可能性（証跡未取得）。

4. 推奨次アクション
- sudo 権限を取得し、pfctl/tcpdump で lo0 上の SYN/ACK, HTTP Data を可視化して欠損箇所を特定。
- Docker Desktop CLI で port-forward 設定の flush → 再設定 (例: `com.docker.backend` の vpnkit ルール再構築) を試験。
- 代替ポート（例: 19080 など 9000 系）へ map を追加し、port-forward 層バグかを比較。
- VPN/Firewall/EPP の 9080 フィルタ有無を IT/Ops に確認し、必要であれば例外追加。
