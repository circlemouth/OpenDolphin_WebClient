# 20251204T093820Z Charts/Patients UX Notes

1. DocumentTimeline・OrderConsole・Patients の missingMaster バナーは `docs/web-client/ux/charts-claim-ui-policy.md §10` と `docs/web-client/ux/reception-schedule-ui-policy.md §5` のトーンを一致させ、各バナーに `data-run-id` + `role=alert` を持たせて Reception へ carry over することを念頭に書き出した。
2. ORCA から受け取る `cacheHit`/`missingMaster`/`dataSourceTransition` は `OrderConsole` の `FilterBadge`/`DataSourceBanner` と `Patients` ヘッダーにそのまま伝播し、`cacheHit=true` では Info 系の緑バッジ、`missingMaster=true` では Warning 系の琥珀または Error 系の赤バナーを表示し、`Patients` では tooltips で `cacheHit`/`missingMaster`/`dataSourceTransition` を補足する。
3. Stage 観測項目
   - Stage/Preview を `VITE_DISABLE_MSW=1` + `VITE_DEV_PROXY_TARGET=http://100.102.17.40:8000/openDolphin/resources` で立ち上げ、DocumentTimeline が ORCA `Queue` 追加 → `missingMaster=true` を得たタイミングを取得。`dataSourceTransition` が `snapshot→server` になった直後の `aria-live` 値とバナー色をスクリーンショット/ログに残す。
   - OrderConsole の `FilterBadge` と OrcaSummary の `DataSourceBanner` で `data-run-id`・`dataSourceTransition`・`missingMaster` を観測し、`aria-atomic=false` で二重読み上げが抑止されていること、`cacheHit` が `false→true` になると Patients のトーンが緑/青に切り替わることを確認する。
   - Patients 画面では `missingMaster` バナー（`Warning/aria-live=polite`）・`cacheHit` 緑ラベル・`dataSourceTransition=server` の理由（`retry`/`fallback`）を同時に表示し、Reception へ戻った際に `data-run-id` でバナーが上書きされる循環を検証する。
   - ORCA JSON（`/resources/api/orca/master/*`）を採取し、`cacheHit`/`missingMaster`/`dataSourceTransition` の変化を 3 回以上追記、`artifacts/webclient/ux-notes/20251204T093820Z-charts-design.md` 本文や Stage log にタイムスタンプと結果を付ける。
   - Stage log には `dataSourceTransition` from→to/reason と `cacheHit` 最終値、`missingMaster` 発生時刻を記録し、Playwright/a11y 実装時に使えるスクリーンショットパスをまとめる。
4. 次に回すポイント: DocumentTimeline で `missingMaster` → `dataSourceTransition=server` の波形を再現できたら、Playwright の `aria-live` warning シナリオと ORCA metadata の `audit.logUiState` 連携をレビューに追加する。
