diff --git a/server-modernized/src/main/java/open/dolphin/security/audit/AuditTrailService.java b/server-modernized/src/main/java/open/dolphin/security/audit/AuditTrailService.java
index 0f22b4d5..49fefb6f 100644
--- a/server-modernized/src/main/java/open/dolphin/security/audit/AuditTrailService.java
+++ b/server-modernized/src/main/java/open/dolphin/security/audit/AuditTrailService.java
@@ -1,30 +1,30 @@
-package open.dolphin.security.audit;
-
-import com.fasterxml.jackson.core.JsonProcessingException;
-import com.fasterxml.jackson.databind.ObjectMapper;
-import jakarta.ejb.Stateless;
-import jakarta.persistence.EntityManager;
-import jakarta.persistence.LockModeType;
-import jakarta.persistence.PersistenceContext;
-import java.nio.charset.StandardCharsets;
-import java.security.MessageDigest;
-import java.security.NoSuchAlgorithmException;
-import java.time.Instant;
-import java.util.HexFormat;
-import java.util.Map;
-import open.dolphin.infomodel.AuditEvent;
-
-/**
- * 改ざん検知付きの監査ログを記録するサービス。
- */
-@Stateless
-public class AuditTrailService {
-
-    @PersistenceContext
-    private EntityManager em;
-
-    private final ObjectMapper objectMapper = new ObjectMapper();
-
+package open.dolphin.security.audit;
+
+import com.fasterxml.jackson.core.JsonProcessingException;
+import com.fasterxml.jackson.databind.ObjectMapper;
+import jakarta.ejb.Stateless;
+import jakarta.persistence.EntityManager;
+import jakarta.persistence.PersistenceContext;
+import java.nio.charset.StandardCharsets;
+import java.security.MessageDigest;
+import java.security.NoSuchAlgorithmException;
+import java.time.Instant;
+import java.util.HexFormat;
+import java.util.Map;
+import open.dolphin.audit.AuditEventEnvelope;
+import open.dolphin.infomodel.AuditEvent;
+
+/**
+ * 改ざん検知付きの監査ログを記録するサービス。
+ */
+@Stateless
+public class AuditTrailService implements open.dolphin.audit.AuditTrailService {
+
+    @PersistenceContext
+    private EntityManager em;
+
+    private final ObjectMapper objectMapper = new ObjectMapper();
+
     public AuditEvent record(AuditEventPayload payload) {
         Instant now = Instant.now();
         String previousHash = em.createQuery("select a.eventHash from AuditEvent a order by a.eventTime desc", String.class)
@@ -52,12 +52,36 @@ public class AuditTrailService {
         event.setPreviousHash(previousHash);
         event.setEventHash(hash(previousHash + payloadHash + now.toEpochMilli() + safe(payload.getActorId())));
 
-        em.persist(event);
-        return event;
-    }
-
-    private String serializePayload(Map<String, Object> details) {
-        if (details == null || details.isEmpty()) {
+        em.persist(event);
+        return event;
+    }
+
+    @Override
+    public AuditEventEnvelope write(AuditEventEnvelope envelope) {
+        AuditEventPayload payload = new AuditEventPayload();
+        payload.setAction(envelope.getAction());
+        payload.setResource(envelope.getResource());
+        payload.setActorId(envelope.getActorId());
+        payload.setActorDisplayName(envelope.getActorDisplayName());
+        payload.setActorRole(envelope.getActorRole());
+        payload.setPatientId(envelope.getPatientId());
+        payload.setRequestId(determineRequestId(envelope));
+        payload.setIpAddress(envelope.getIpAddress());
+        payload.setUserAgent(envelope.getUserAgent());
+        payload.setDetails(envelope.getDetails());
+        record(payload);
+        return envelope;
+    }
+
+    private String determineRequestId(AuditEventEnvelope envelope) {
+        if (envelope.getRequestId() != null && !envelope.getRequestId().isBlank()) {
+            return envelope.getRequestId();
+        }
+        return envelope.getTraceId();
+    }
+
+    private String serializePayload(Map<String, Object> details) {
+        if (details == null || details.isEmpty()) {
             return "{}";
         }
         try {
diff --git a/server-modernized/src/main/java/open/dolphin/session/AppoServiceBean.java b/server-modernized/src/main/java/open/dolphin/session/AppoServiceBean.java
index b55605f9..291e9d88 100644
--- a/server-modernized/src/main/java/open/dolphin/session/AppoServiceBean.java
+++ b/server-modernized/src/main/java/open/dolphin/session/AppoServiceBean.java
@@ -1,14 +1,19 @@
 package open.dolphin.session;
 
-import java.util.ArrayList;
-import java.util.List;
-import jakarta.enterprise.context.ApplicationScoped;
-import jakarta.inject.Named;
-import jakarta.persistence.EntityManager;
-import jakarta.persistence.PersistenceContext;
-import jakarta.transaction.Transactional;
-import open.dolphin.session.framework.SessionOperation;
-import open.dolphin.infomodel.AppointmentModel;
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+import jakarta.enterprise.context.ApplicationScoped;
+import jakarta.inject.Inject;
+import jakarta.inject.Named;
+import jakarta.persistence.EntityManager;
+import jakarta.persistence.PersistenceContext;
+import jakarta.transaction.Transactional;
+import open.dolphin.audit.AuditEventEnvelope;
+import open.dolphin.audit.AuditTrailService;
+import open.dolphin.infomodel.AppointmentModel;
+import open.dolphin.session.framework.SessionOperation;
 
 /**
  *
@@ -25,38 +30,71 @@ public class AppoServiceBean {
     private static final String FROM_DATE = "fromDate";
     private static final String TO_DATE = "toDate";
 
-    @PersistenceContext
-    private EntityManager em;
-
-
-    public int putAppointments(List<AppointmentModel> list) {
-
-        int cnt = 0;
-
-        for (AppointmentModel model : list) {
-
-            int state = model.getState();
-            String appoName = model.getName();
-
-            if (state == AppointmentModel.TT_NEW) {
-                // 新規予約
-                 em.persist(model);
-                cnt++;
-
-            } else if (state == AppointmentModel.TT_REPLACE && appoName != null) {
-                // 変更された予約
-                em.merge(model);
-                cnt++;
-
-            } else if (state == AppointmentModel.TT_REPLACE && appoName == null) {
-                // 取り消された予約
-                AppointmentModel target = (AppointmentModel)em.find(AppointmentModel.class, model.getId());
-                em.remove(target);
-                cnt++;
-            }
-        }
-        return cnt;
-    }
+    @PersistenceContext
+    private EntityManager em;
+
+    @Inject
+    private AuditTrailService auditTrailService;
+
+    public int putAppointments(List<AppointmentModel> list) {
+
+        List<AppointmentModel> appointments = list == null ? List.of() : list;
+        Map<String, Object> auditDetails = new HashMap<>();
+        auditDetails.put("requestedCount", appointments.size());
+
+        int cnt = 0;
+        int created = 0;
+        int updated = 0;
+        int deleted = 0;
+
+        try {
+            for (AppointmentModel model : appointments) {
+
+                int state = model.getState();
+                String appoName = model.getName();
+
+                if (state == AppointmentModel.TT_NEW) {
+                    // 新規予約
+                    em.persist(model);
+                    cnt++;
+                    created++;
+
+                } else if (state == AppointmentModel.TT_REPLACE && appoName != null) {
+                    // 変更された予約
+                    em.merge(model);
+                    cnt++;
+                    updated++;
+
+                } else if (state == AppointmentModel.TT_REPLACE && appoName == null) {
+                    // 取り消された予約
+                    AppointmentModel target = (AppointmentModel)em.find(AppointmentModel.class, model.getId());
+                    em.remove(target);
+                    cnt++;
+                    deleted++;
+                }
+            }
+        } catch (RuntimeException ex) {
+            auditDetails.put("createdCount", created);
+            auditDetails.put("updatedCount", updated);
+            auditDetails.put("deletedCount", deleted);
+            auditDetails.put("appliedCount", cnt);
+            auditTrailService.write(AuditEventEnvelope.builder("APPOINTMENT_MUTATION", "AppointmentModel")
+                    .details(auditDetails)
+                    .failure(ex)
+                    .build());
+            throw ex;
+        }
+
+        auditDetails.put("createdCount", created);
+        auditDetails.put("updatedCount", updated);
+        auditDetails.put("deletedCount", deleted);
+        auditDetails.put("appliedCount", cnt);
+        auditTrailService.write(AuditEventEnvelope.builder("APPOINTMENT_MUTATION", "AppointmentModel")
+                .details(auditDetails)
+                .build());
+
+        return cnt;
+    }
 
     /**
      * 予約を検索する。
diff --git a/server-modernized/src/main/java/open/dolphin/session/ScheduleServiceBean.java b/server-modernized/src/main/java/open/dolphin/session/ScheduleServiceBean.java
index 4a98836a..cda1b5ee 100644
--- a/server-modernized/src/main/java/open/dolphin/session/ScheduleServiceBean.java
+++ b/server-modernized/src/main/java/open/dolphin/session/ScheduleServiceBean.java
@@ -7,27 +7,31 @@ import java.text.SimpleDateFormat;
 import java.util.ArrayList;
 import java.util.Collection;
 import java.util.Date;
-import java.util.Iterator;
-import java.util.List;
-import java.util.UUID;
-import jakarta.annotation.Resource;
-import jakarta.enterprise.concurrent.ManagedScheduledExecutorService;
-import jakarta.enterprise.context.ApplicationScoped;
-import jakarta.inject.Inject;
-import jakarta.inject.Named;
+import java.util.HashMap;
+import java.util.Iterator;
+import java.util.List;
+import java.util.Map;
+import java.util.UUID;
+import jakarta.annotation.Resource;
+import jakarta.enterprise.concurrent.ManagedScheduledExecutorService;
+import jakarta.enterprise.context.ApplicationScoped;
+import jakarta.inject.Inject;
+import jakarta.inject.Named;
 import jakarta.jms.Connection;
 import jakarta.jms.ConnectionFactory;
 import jakarta.jms.JMSException;
 import jakarta.jms.MessageProducer;
 import jakarta.jms.ObjectMessage;
 //import jakarta.jms.QueueSession;
-import jakarta.jms.Session;
-import jakarta.persistence.EntityManager;
-import jakarta.persistence.PersistenceContext;
-import jakarta.transaction.Transactional;
-import open.dolphin.infomodel.AttachmentModel;
-import open.dolphin.infomodel.DocumentModel;
-import open.dolphin.infomodel.HealthInsuranceModel;
+import jakarta.jms.Session;
+import jakarta.persistence.EntityManager;
+import jakarta.persistence.PersistenceContext;
+import jakarta.transaction.Transactional;
+import open.dolphin.audit.AuditEventEnvelope;
+import open.dolphin.audit.AuditTrailService;
+import open.dolphin.infomodel.AttachmentModel;
+import open.dolphin.infomodel.DocumentModel;
+import open.dolphin.infomodel.HealthInsuranceModel;
 import open.dolphin.infomodel.IInfoModel;
 import open.dolphin.infomodel.KarteBean;
 import open.dolphin.infomodel.ModuleModel;
@@ -92,11 +96,14 @@ public class ScheduleServiceBean {
     @PersistenceContext
     private EntityManager em;
 
-    @Inject
-    private MessagingGateway messagingGateway;
-
-    @Resource(lookup = ConcurrencyResourceNames.DEFAULT_SCHEDULER)
-    private ManagedScheduledExecutorService scheduler;
+    @Inject
+    private MessagingGateway messagingGateway;
+
+    @Inject
+    private AuditTrailService auditTrailService;
+
+    @Resource(lookup = ConcurrencyResourceNames.DEFAULT_SCHEDULER)
+    private ManagedScheduledExecutorService scheduler;
     
 //s.oh^ 2014/02/21 Claim送信方法の変更
     //@Resource(mappedName = "java:/JmsXA")
@@ -106,68 +113,85 @@ public class ScheduleServiceBean {
     //private jakarta.jms.Queue queue;
 //s.oh$
     
-    public List<PatientVisitModel> getPvt(String fid, String did, String unassigned, String date) {
-        
-        List<PatientVisitModel> result;
-        
-        if (did==null && unassigned==null) {
-            result = (List<PatientVisitModel>) em.createQuery(QUERY_PVT_BY_FID_DATE)
-                                  .setParameter("fid", fid)
-                                  .setParameter("date", date+"%")
-                                  .getResultList();
-        } else {
-            result = (List<PatientVisitModel>) em.createQuery(QUERY_PVT_BY_FID_DID_DATE)
-                                  .setParameter("fid", fid)
-                                  .setParameter("did", did)
-                                  .setParameter("unassigned", unassigned)
-                                  .setParameter("date", date+"%")
-                                  .getResultList();
-        }
-
-        int len = result.size();
-
-        if (len == 0) {
-            return result;
-        }
-        
-        // Dateへ変換
-        Date startDate = dateFromString(date);
-
-        // 来院情報と患者は ManyToOne の関係である
-        for (int i = 0; i < len; i++) {
-            
-            PatientVisitModel pvt = result.get(i);
-            PatientModel patient = pvt.getPatientModel();
-
-            // 患者の健康保険を取得する
-            List<HealthInsuranceModel> insurances = (List<HealthInsuranceModel>)em.createQuery(QUERY_INSURANCE_BY_PATIENT_ID)
-            .setParameter("id", patient.getId()).getResultList();
-            patient.setHealthInsurances(insurances);
-            
-            List<KarteBean> kartes = em.createQuery(QUERY_KARTE)
-                                  .setParameter("patientPk", patient.getId())
-                                  .getResultList();
-            KarteBean karte = kartes.get(0);
-            
-            // この日のカルテが存在するか
-            List<DocumentModel> list = (List<DocumentModel>)em.createQuery(QUERY_DOCUMENT_BY_KARTEID_STARTDATE)
-                                                 .setParameter("karteId", karte.getId())
-                                                 .setParameter("started", startDate)
-                                                 .getResultList();
-            if (list!=null && !list.isEmpty()) {
-                pvt.setLastDocDate(startDate);
-            }
-        }
-
-        return result;
-    }
+    public List<PatientVisitModel> getPvt(String fid, String did, String unassigned, String date) {
+        
+        Map<String, Object> auditDetails = new HashMap<>();
+        auditDetails.put("facilityId", fid);
+        auditDetails.put("doctorId", did);
+        auditDetails.put("unassignedDoctor", unassigned);
+        auditDetails.put("date", date);
+
+        try {
+            List<PatientVisitModel> result;
+
+            if (did==null && unassigned==null) {
+                result = (List<PatientVisitModel>) em.createQuery(QUERY_PVT_BY_FID_DATE)
+                                      .setParameter("fid", fid)
+                                      .setParameter("date", date+"%")
+                                      .getResultList();
+            } else {
+                result = (List<PatientVisitModel>) em.createQuery(QUERY_PVT_BY_FID_DID_DATE)
+                                      .setParameter("fid", fid)
+                                      .setParameter("did", did)
+                                      .setParameter("unassigned", unassigned)
+                                      .setParameter("date", date+"%")
+                                      .getResultList();
+            }
+
+            int len = result.size();
+
+            if (len != 0) {
+                // Dateへ変換
+                Date startDate = dateFromString(date);
+
+                // 来院情報と患者は ManyToOne の関係である
+                for (int i = 0; i < len; i++) {
+
+                    PatientVisitModel pvt = result.get(i);
+                    PatientModel patient = pvt.getPatientModel();
+
+                    // 患者の健康保険を取得する
+                    List<HealthInsuranceModel> insurances = (List<HealthInsuranceModel>)em.createQuery(QUERY_INSURANCE_BY_PATIENT_ID)
+                    .setParameter("id", patient.getId()).getResultList();
+                    patient.setHealthInsurances(insurances);
+                    
+                    List<KarteBean> kartes = em.createQuery(QUERY_KARTE)
+                                          .setParameter("patientPk", patient.getId())
+                                          .getResultList();
+                    KarteBean karte = kartes.get(0);
+                    
+                    // この日のカルテが存在するか
+                    List<DocumentModel> list = (List<DocumentModel>)em.createQuery(QUERY_DOCUMENT_BY_KARTEID_STARTDATE)
+                                                         .setParameter("karteId", karte.getId())
+                                                         .setParameter("started", startDate)
+                                                         .getResultList();
+                    if (list!=null && !list.isEmpty()) {
+                        pvt.setLastDocDate(startDate);
+                    }
+                }
+            }
+
+            auditDetails.put("resultCount", len);
+            writeScheduleAudit("SCHEDULE_FETCH", auditDetails, null);
+            return result;
+        } catch (RuntimeException ex) {
+            writeScheduleAudit("SCHEDULE_FETCH", auditDetails, ex);
+            throw ex;
+        }
+    }
     
-    public int makeScheduleAndSend(long pvtPK, long userPK, Date startDate, boolean send) {
-        
-        try {
-            // 受付情報を取得する
-            PatientVisitModel pvt = (PatientVisitModel)em.find(PatientVisitModel.class, pvtPK);
-            PatientModel patient = pvt.getPatientModel();
+    public int makeScheduleAndSend(long pvtPK, long userPK, Date startDate, boolean send) {
+        
+        Map<String, Object> auditDetails = new HashMap<>();
+        auditDetails.put("pvtPk", pvtPK);
+        auditDetails.put("userPk", userPK);
+        auditDetails.put("sendClaim", send);
+        auditDetails.put("startDate", startDate);
+
+        try {
+            // 受付情報を取得する
+            PatientVisitModel pvt = (PatientVisitModel)em.find(PatientVisitModel.class, pvtPK);
+            PatientModel patient = pvt.getPatientModel();
 
             // 患者の健康保険を取得する
             List<HealthInsuranceModel> insurances = (List<HealthInsuranceModel>)em.createQuery(QUERY_INSURANCE_BY_PATIENT_ID)
@@ -363,49 +387,68 @@ public class ScheduleServiceBean {
             em.persist(schedule);
             
             // CLAIM送信
-            if (send) {
-                schedule.toDetuch();
-                dispatchClaimAsync(schedule);
-            }
-            
-            return 1;
-            
-        } catch (Exception e) {
-            e.printStackTrace(System.err);
-        }
-        
-        return 0;
-    }
-    
-    public int removePvt(long pvtPK, long ptPK, Date startDate) {
-        // 受付咲くジョン
-        PatientVisitModel exist = (PatientVisitModel)em.find(PatientVisitModel.class, new Long(pvtPK));
-        em.remove(exist);
-        
-        // 患者のカルテを取得する
-        List<KarteBean> kartes = em.createQuery(QUERY_KARTE)
-                              .setParameter("patientPk", ptPK)
-                              .getResultList();
-        KarteBean karte = kartes.get(0);
-        
-        // 当日のドキュメントを検索
-        List<DocumentModel> list = (List<DocumentModel>)em.createQuery(QUERY_DOCUMENT_BY_KARTEID_STARTDATE)
-                                                 .setParameter("karteId", karte.getId())
-                                                 .setParameter("started", startDate)
-                                                 .getResultList();
-        if (list.isEmpty()) {
-            return 1;
-        }
-        
-        // それを削除
-        int cnt=1;
-        for (DocumentModel d : list) {
-            List<String> l = deleteDocument(d.getId());
-            cnt+=l.size();
-        }
-        
-        return cnt;
-    }
+            if (send) {
+                schedule.toDetuch();
+                dispatchClaimAsync(schedule);
+            }
+            
+            auditDetails.put("karteId", karte.getId());
+            auditDetails.put("documentId", schedule.getId());
+            auditDetails.put("patientId", patient.getId());
+            writeScheduleAudit("SCHEDULE_CREATE", auditDetails, null);
+            return 1;
+            
+        } catch (Exception e) {
+            writeScheduleAudit("SCHEDULE_CREATE", auditDetails, e);
+            LOGGER.error("Failed to create schedule entry", e);
+            e.printStackTrace(System.err);
+        }
+        
+        return 0;
+    }
+    
+    public int removePvt(long pvtPK, long ptPK, Date startDate) {
+        Map<String, Object> auditDetails = new HashMap<>();
+        auditDetails.put("pvtPk", pvtPK);
+        auditDetails.put("patientPk", ptPK);
+        auditDetails.put("startDate", startDate);
+
+        try {
+            // 受付咲くジョン
+            PatientVisitModel exist = (PatientVisitModel)em.find(PatientVisitModel.class, new Long(pvtPK));
+            em.remove(exist);
+            
+            // 患者のカルテを取得する
+            List<KarteBean> kartes = em.createQuery(QUERY_KARTE)
+                                  .setParameter("patientPk", ptPK)
+                                  .getResultList();
+            KarteBean karte = kartes.get(0);
+            
+            // 当日のドキュメントを検索
+            List<DocumentModel> list = (List<DocumentModel>)em.createQuery(QUERY_DOCUMENT_BY_KARTEID_STARTDATE)
+                                                     .setParameter("karteId", karte.getId())
+                                                     .setParameter("started", startDate)
+                                                     .getResultList();
+            if (list.isEmpty()) {
+                auditDetails.put("deletedDocuments", 0);
+                writeScheduleAudit("SCHEDULE_DELETE", auditDetails, null);
+                return 1;
+            }
+            
+            // それを削除
+            int cnt=1;
+            for (DocumentModel d : list) {
+                List<String> l = deleteDocument(d.getId());
+                cnt+=l.size();
+            }
+            auditDetails.put("deletedDocuments", cnt);
+            writeScheduleAudit("SCHEDULE_DELETE", auditDetails, null);
+            return cnt;
+        } catch (RuntimeException ex) {
+            writeScheduleAudit("SCHEDULE_DELETE", auditDetails, ex);
+            throw ex;
+        }
+    }
 
     private void dispatchClaimAsync(DocumentModel document) {
         Runnable task = () -> messagingGateway.dispatchClaim(document);
@@ -503,12 +546,24 @@ public class ScheduleServiceBean {
         return list;
     }
     
-    private Date dateFromString(String str) {
-        try {
-            SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
-            return sdf.parse(str);
-        } catch (Exception e) {           
-        }
-        return null;
-    }
-}
+    private Date dateFromString(String str) {
+        try {
+            SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
+            return sdf.parse(str);
+        } catch (Exception e) {           
+        }
+        return null;
+    }
+
+    private void writeScheduleAudit(String action, Map<String, Object> details, Throwable error) {
+        if (auditTrailService == null) {
+            return;
+        }
+        AuditEventEnvelope.Builder builder = AuditEventEnvelope.builder(action, "ScheduleServiceBean")
+                .details(details);
+        if (error != null) {
+            builder.failure(error);
+        }
+        auditTrailService.write(builder.build());
+    }
+}
