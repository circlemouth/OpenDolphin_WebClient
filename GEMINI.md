# AGENTS GUIDE

## ⚠️ 最重要: 遂行責任 (Critical: Responsibility to Complete)
**割り当てられたタスクは、可能な限り自律的に完遂せよ。**
- 「方法を提案して終了」ではなく、「実装し、テストし、動作確認まで完了した状態」で報告すること。
- ユーザーの手を煩わせない。必要な調査、修正、再試行は自律的に行え。
- **中途半端な作業報告は禁止。**

## 1. プロジェクト基本ルール
- **目的**: Webクライアントとモダナイズ版サーバー(`server-modernized`)の本番品質連携。
- **使用言語**: 最終返答は必ず **日本語**。
- **禁止事項**:
  - `server/` (Legacyサーバー) の変更禁止 (参照のみ)。
  - Pythonスクリプトの実行禁止 (明示指示がない限り)。
  - 許可なき `worktree` 以外の場所での作業（指示された場合、適切なworktreeを作成・移動せよ）。

## 2. 開発・ドキュメントルール
- **正本ドキュメント**: 現行状況は `docs/DEVELOPMENT_STATUS.md` のみが正本。
  - `Phase2` と名のつくドキュメントは全て **過去の遺物(Legacy/Archive)** である。参照してもよいが、現行ルールとして従ってはならない。
- **現行ハブ**: `docs/web-client/CURRENT.md` / `docs/server-modernization/README.md` を入口とする。
- **文字コード**: 日本語を含むファイルは **UTF-8 (BOMなし)** で保存。
- **RUN_ID**: 作業開始時に `YYYYMMDDThhmmssZ` を採番し、ログや報告で使用する。

## 3. 環境・インフラ
- **起動**: `WEB_CLIENT_MODE=npm ./setup-modernized-env.sh` を使用。
  - ログイン情報は同スクリプト内の記載に従うこと。
- **ORCA連携**: 実環境(ORCA)への接続は機微情報を含むため、`docs/server-modernization/operations/ORCA_CERTIFICATION_ONLY.md` の手順を厳守し、ログを残すこと（Phase2 版は Legacy 参照のみ）。

## 4. ワーキングフロー (作業手順)
1. **理解**: 指示内容と `docs/DEVELOPMENT_STATUS.md` を確認。
2. **実装**: `client` (Legacy) や `server` (Legacy) を参照しつつ、Web用コードまたは `server-modernized` を実装。
3. **検証**: ローカルで起動確認。エラーが出たら自律的に修正。
4. **Git操作**:
   - `worktree` 作業時は、報告前に必ずコミットを行うこと。
   - `main` ブランチへのマージ指示時は、現在の作業ディレクトリの内容をマージすること。
5. **報告**:
   - `【ワーカー報告】` ヘッダーを使用。
   - 実施内容、結果、残課題、更新したドキュメントを明記。
   - "Done" の定義を満たしてから報告せよ。

## 5. マネージャー・ワーカー間連絡 (AI Agent間連携)
- **マネージャー**: 指示は具体的かつ、ワーカーが迷わず完遂できる情報を含めよ。`【ワーカー指示】` を使用。
  - 並列可能なタスクは適切に振り分け、各ワーカーに十分な情報(プロンプト)を与えよ。
- **ワーカー**: 指示された範囲を逸脱せず、しかし範囲内の障害は独力で排除せよ。`【ワーカー報告】` を使用。

## 6. Dockerコンテナ運用ルール
- **worktree作業時（並列作業前提）**:
  - 各worktree専用のコンテナを作成・使用すること（コンテナ名に worktree 名やブランチ名を含める等で識別可能にする）。
  - **他のworktree由来のコンテナは操作禁止**（停止・削除・再起動等）。
  - 自身のworktree用コンテナのみ自律的に作成・起動・再構築してよい。
- **masterブランチ上での作業時**:
  - 単独作業が前提のため、上記制限は適用しない。既存コンテナの操作も許可。

---
**「ユーザーは君の成功を待っている。言い訳ではなく、成果を届けよ。」**
