#!/usr/bin/env bash
# CLI で Legacy/Modernized 並列キャプチャを行う際の URL/ログ出力先テンプレート。
# `source ops/tools/send_parallel_request.profile.env.sample` の形で読み込むことを想定する。

MODERNIZED_TARGET_PROFILE="${MODERNIZED_TARGET_PROFILE:-compose}"

case "${MODERNIZED_TARGET_PROFILE}" in
  compose)
    export PROJECT_NAME="${PROJECT_NAME:-legacy-vs-modern}"
    export BASE_URL_LEGACY="${BASE_URL_LEGACY:-http://localhost:8080/openDolphin/resources}"
    export BASE_URL_MODERN="${BASE_URL_MODERN:-http://localhost:9080/openDolphin/resources}"
    export PARITY_OUTPUT_DIR="${PARITY_OUTPUT_DIR:-artifacts/parity-manual}"
    ;;
  modernized-dev)
    export PROJECT_NAME="${PROJECT_NAME:-legacy-vs-modern}"
    export BASE_URL_LEGACY="${BASE_URL_LEGACY:-http://opendolphin-server:8080/openDolphin/resources}"
    export BASE_URL_MODERN="${BASE_URL_MODERN:-http://opendolphin-server-modernized-dev:8080/openDolphin/resources}"
    export PARITY_OUTPUT_DIR="${PARITY_OUTPUT_DIR:-artifacts/parity-manual}"
    ;;
  legacy-only)
    export PROJECT_NAME="${PROJECT_NAME:-legacy-vs-modern}"
    export BASE_URL_LEGACY="${BASE_URL_LEGACY:-http://localhost:8080/openDolphin/resources}"
    export BASE_URL_MODERN="${BASE_URL_MODERN:-http://localhost:9080/openDolphin/resources}"
    export PARITY_OUTPUT_DIR="${PARITY_OUTPUT_DIR:-artifacts/parity-manual/legacy-only}"
    ;;
  remote-dev)
    if [[ -z "${MODERNIZED_REMOTE_BASE_URL:-}" ]]; then
      echo "[MODERNIZED_TARGET_PROFILE=remote-dev] MODERNIZED_REMOTE_BASE_URL を指定してください (例: https://dev.example.com/openDolphin/resources)" >&2
      return 1 2>/dev/null || exit 1
    fi
    export BASE_URL_LEGACY="${BASE_URL_LEGACY:-http://localhost:8080/openDolphin/resources}"
    export BASE_URL_MODERN="${MODERNIZED_REMOTE_BASE_URL}"
    export PARITY_OUTPUT_DIR="${PARITY_OUTPUT_DIR:-artifacts/parity-manual/remote-dev}"
    ;;
  custom)
    : "${BASE_URL_LEGACY:?BASE_URL_LEGACY を指定してください}"
    : "${BASE_URL_MODERN:?BASE_URL_MODERN を指定してください}"
    export PARITY_OUTPUT_DIR="${PARITY_OUTPUT_DIR:-artifacts/parity-manual/custom}"
    ;;
  *)
    echo "未知の MODERNIZED_TARGET_PROFILE: ${MODERNIZED_TARGET_PROFILE}" >&2
    return 1 2>/dev/null || exit 1
    ;;
esac

export PARITY_HEADER_FILE="${PARITY_HEADER_FILE:-}"
export PARITY_BODY_FILE="${PARITY_BODY_FILE:-}"
