id,method,path,headers_profile,payload_template,expected_status,notes,trace-id
rest_error_bad_request,GET,"/dolphin/activity/2025,04",ops/tests/api-smoke-test/headers/trace-session.headers,,400,"Checklist #49: year/month のみ指定で BadRequest を発生させ、SessionTraceManager→AuditTrail までのログを TRACE_PROPAGATION_CHECK.md に追記。RUN_ID=20251110T133000Z で trace_http_400 を再取得済み（Legacy=500 / Modern=400, 証跡: `artifacts/parity-manual/TRACEID_JMS/20251110T133000Z/trace_http_400/`）。`d_audit_event_id_seq` の再採番で AuditTrail ID が衝突し Modernized も 500 になる既知バグがあるため README/Runbook に警告を残している。",trace-http-400
rest_error_unauthorized,GET,"/touch/user/doctor1,1.3.6.1.4.1.9414.72.103,dolphin",ops/tests/api-smoke-test/headers/trace-session.headers,,401,"Checklist #73: `PARITY_HEADER_FILE` から password 行を削除した状態で送信し、TouchUserServiceBean→TouchErrorMapper による 401 を採取",trace-http-401
rest_error_internal,GET,"/karte/pid/INVALID,%5Bdate%5D",ops/tests/api-smoke-test/headers/trace-session.headers,,500,"Checklist #74: KarteServiceBean の `NumberFormatException` を SessionOperationInterceptor 経由で 500 として記録し、JPQL/JMS ログを `artifacts/parity-manual/TRACEID_JMS/20251110T133000Z/trace_http_500/` へ保存（Legacy=200 / Modern=400, `KarteBeanConverter` null 非対応）。`d_audit_event_id_seq` の再採番タイミングで AuditTrail ID 衝突が再現して Modernized も 500 を返す既知バグに注意を払う。",trace-http-500
rest_error_schedule_unknown_entity,GET,/schedule/pvt/2025-11-09,ops/tests/api-smoke-test/headers/trace-session.headers,,200,"[Resolved 2025-11-09 → Reverified 2025-11-10] Legacy/Modernized とも HTTP 200。最新 Run (`artifacts/parity-manual/JPQL/20251110T122417Z/ScheduleServiceBean/`) では Modern 側が `{\"list\":null}` のままなので `TODO(remoteUser=anonymous)` を維持し、Elytron/JACC 修正後に再取得する。",trace-schedule-jpql
rest_error_appo_missing_entity,PUT,/appo,ops/tests/api-smoke-test/headers/trace-session.headers,ops/tests/api-smoke-test/payloads/appo_cancel_sample.json,200,"[Resolved 2025-11-10] reseed (`/tmp/reseed_appo.sql`) 後に `Content-Type: application/json` を付与すれば Legacy/Modernized とも 200（削除件数=1）。証跡は `artifacts/parity-manual/JPQL/20251110T122417Z/AppoServiceBean/`。TODO: reseed 手順を Runbook 化し、`d_audit_event`/JMS を採取。",trace-appo-jpql
rest_error_chart_summary_seed_gap,GET,/chart/WEB1001/summary,ops/tests/api-smoke-test/headers/legacy-default.headers,,500,"chart_summary ケース: `jpql-karte-20251110T122417Z` でも Modern 側の `KarteBeanConverter` が null を処理できず 400 のまま。TODO(WEB1001 seed gap + null-safe Converter): `artifacts/parity-manual/JPQL/20251110T122417Z/KarteServiceBean/README.md` の手順で reseed しつつ Converter 修正を待つ。",trace-chart-summary-manual
rest_error_letter_fk,PUT,/odletter/letter,tmp/parity-headers/letter_20251110TnewZ.headers,tmp/parity-letter/letter_put_payload.json,500,"テンプレ: `PARITY_HEADER_FILE=tmp/parity-headers/letter_${RUN_ID}.headers`（`password: 632080fabdb968f9ac4f31fb55104648`, `Content-Type: application/json`, `X-Trace-Id: parity-letter-${RUN_ID}`）と `PARITY_BODY_FILE=tmp/parity-letter/letter_put_payload.json` で送信。期待=Legacy 200 / Modern 500（`fk_d_letter_module_karte`）。証跡は `artifacts/parity-manual/letter/${RUN_ID}/` へ保存し、`d_karte.id` を揃えるまで再取得待ち。",parity-letter-20251110TnewZ
rest_error_lab_empty,GET,"/lab/module/WEB1001,0,5",tmp/parity-headers/lab_20251110TnewZ.headers,,200,"RUN_ID=20251110TnewZ（`artifacts/parity-manual/lab/${RUN_ID}/`）。`NLabResource` が `fidPid=getFidPid(remoteUser,pid)` を生成して `NLabServiceBean#getLaboTest` へ渡す実装（`server-modernized/src/main/java/open/dolphin/rest/NLabResource.java`, `server-modernized/src/main/java/open/dolphin/session/NLabServiceBean.java`）に対し、`ops/db/local-baseline/local_synthetic_seed.sql` の `d_nlabo_module` / `d_nlabo_item` シードは `patientId='WEB1001'` のままなので 0 件となり `NLaboModuleListConverter#getList`（`common/src/main/java/open/dolphin/converter/NLaboModuleListConverter.java`）が `null` を返して `{"list":null}` になる。`fid:pid` 形式へ再シードしつつ DTO を空配列 (`[]`) 返却に直した後、Audit/JMS 付きで再取得する。**仕様更新:** `/lab/module` は空結果でも `{"list":[]}` を返すことを Phase2 Lab 再シードタスクに明記（実装は後続）。",parity-lab-20251110TnewZ
rest_error_stamp_data_exception,PUT,/stamp/tree,tmp/parity-headers/stamp_20251110TnewZ.headers,tmp/parity-letter/stamp_tree_payload.json,500,"RUN_ID=20251110TnewZ（`artifacts/parity-manual/stamp/${RUN_ID}/`）。再現条件: (1) `tmp/parity-letter/stamp_tree_payload.json` を固定値（`id=9`,`versionNumber=0`,`treeBytes=PHN0...`）のまま `ops/tools/send_parallel_request.sh --profile compose PUT /stamp/tree` で送信する、(2) DB 上の `d_stamp_tree.versionNumber` は reseed で `>=2`、(3) Flyway V0225 の `treeBytes BYTEA` を残したまま Hibernate 6 `@Lob byte[]` を使用する。このとき Legacy は `StampServiceBean#getNextVersion` が version 不一致を検出して `First Commit Win Exception` を投げ、Modern 側は `Bad value for type long … treeBytes`（bytea ↔ OID ミスマッチ）で 500 になる。想定修正後期待値: `StampTreeModel`/`PublishedTreeModel` に `@JdbcTypeCode(SqlTypes.BINARY)` を付与して bytea と整合させ、PUT 直前に `GET /stamp/tree/{userPk}` の `personalTree.versionNumber`/`id` を payload へ反映する運用（Runbook §3.2）を徹底した場合、Legacy=200（version+1 応答）/Modern=200（treeBytes 正常永続化）となる。",parity-stamp-20251110TnewZ
