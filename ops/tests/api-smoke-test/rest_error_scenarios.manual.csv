id,method,path,headers_profile,payload_template,expected_status,notes,trace-id,letter_lab_audit_status
rest_error_bad_request,GET,"/dolphin/activity/2025,04",ops/tests/api-smoke-test/headers/trace-session.headers,,400,"Headers=tmp/rest-error-headers/trace_http_400_20251115TresterrexZ1.headers（`X-Trace-Id: trace-http-400-20251115TresterrexZ1`）。Expect=Legacy/Modern 400 かつ JSON ボディ `{"error":"invalid_activity_param","status":400,"traceId":...}` で `requestParam` が付与されることを確認する。`PARITY_OUTPUT_DIR=artifacts/parity-manual/rest-errors/20251115TresterrexZ1` で `send_parallel_request.sh --profile compose GET /dolphin/activity/2025,04 rest_error_bad_request` を実行し、`logs/send_parallel_request.log` と HTTP 差分を同階層へ保存する。",trace-http-400-20251115TresterrexZ1,
rest_error_unauthorized,GET,"/touch/user/doctor1,1.3.6.1.4.1.9414.72.103,dolphin",ops/tests/api-smoke-test/headers/trace-session.headers,,401,"Headers=tmp/rest-error-headers/trace_http_401_20251115TresterrexZ1.headers（password 行を削除し、`X-Trace-Id: trace-http-401-20251115TresterrexZ1` を付与）。Expect=Legacy/Modern 401 かつ JSON ボディ `error=unauthorized`、`details.reason=authentication_failed`、`WWW-Authenticate` ヘッダー維持。Evidence=artifacts/parity-manual/rest-errors/20251115TresterrexZ1/rest_error_unauthorized/{legacy,modern}/ を参照し、LogFilter WARN が traceId 付きで出力されることをログに追記する。",trace-http-401-20251115TresterrexZ1,
rest_error_internal,GET,"/karte/pid/INVALID,%5Bdate%5D",ops/tests/api-smoke-test/headers/trace-session.headers,,500,"Headers=tmp/rest-error-headers/trace_http_500_20251115TresterrexZ1.headers（`X-Trace-Id: trace-http-500-20251115TresterrexZ1`）。Expect=Legacy/Modern 500 かつ JSON ボディ `error=karte_lookup_failed`（Facility 判定後の Null 例外を 500 へ正規化）で `context=pid_lookup` が含まれる。`send_parallel_request.sh --profile compose GET /karte/pid/INVALID,%5Bdate%5D rest_error_internal` で CLI を再取得し、`artifacts/parity-manual/rest-errors/20251115TresterrexZ1/rest_error_internal/` にヘッダー/ボディと meta を格納する。",trace-http-500-20251115TresterrexZ1,
rest_error_schedule_unknown_entity,GET,/schedule/pvt/2025-11-09,ops/tests/api-smoke-test/headers/trace-session.headers,,200,"Headers=ops/tests/api-smoke-test/headers/trace-session.headers（`X-Trace-Id: trace-schedule-jpql`）; Expect=Legacy/Modern 200（現状 Modern JSON=`{\"list\":null}` → `remoteUser=anonymous` TODO）; Evidence=artifacts/parity-manual/JPQL/20251110T122417Z/ScheduleServiceBean/; Elytron/JACC 修正後に `d_audit_event` 採取を追加。",trace-schedule-jpql,
rest_audit_schedule_trace,GET,/schedule/pvt/2025-11-09,tmp/parity-headers/schedule_<RUN_ID>.headers,,200,"Headers=tmp/parity-headers/schedule_<RUN_ID>.headers（RUN_ID テンプレ=`20251115TappoSchedPlanZ`, `X-Trace-Id: trace-audit-schedule-<RUN_ID>`）; Expect=Legacy/Modern 200 かつ `d_audit_event` に `SCHEDULE_FETCH` が `actor_id`・`request_id`・`patient_id` 付きで追加される。JMS enqueue は発生しないため `logs/jms_dolphinQueue_read-resource{,_legacy}.{before,after}.txt` で `messages-added` が変化しないことを証跡化。Evidence=artifacts/parity-manual/schedule/<RUN_ID>/ 以下に HTTP/headers/Audit/JMS を保存。",trace-audit-schedule-20251115TappoSchedPlanZ,
rest_error_appo_missing_entity,PUT,/appo,ops/tests/api-smoke-test/headers/trace-session.headers,ops/tests/api-smoke-test/payloads/appo_cancel_sample.json,200,"Headers=ops/tests/api-smoke-test/headers/trace-session.headers（`X-Trace-Id: trace-appo-jpql`）; Payload=ops/tests/api-smoke-test/payloads/appo_cancel_sample.json; Expect=Legacy/Modern 200（reseeding 済み）; Evidence=artifacts/parity-manual/JPQL/20251110T122417Z/AppoServiceBean/; TODO: `d_audit_event` / JMS ログを揃えたら README へリンク。",trace-appo-jpql,
rest_audit_appo_trace,PUT,/appo,tmp/parity-headers/appo_<RUN_ID>.headers,ops/tests/api-smoke-test/payloads/appo_cancel_sample.json,200,"Headers=tmp/parity-headers/appo_<RUN_ID>.headers（RUN_ID=`20251115TappoSchedPlanZ`, `X-Trace-Id: trace-audit-appo-<RUN_ID>`）; Payload=ops/tests/api-smoke-test/payloads/appo_cancel_sample.json。実行前に `tmp/reseed_appo.sql` を Legacy/Modern DB へ適用して `id=8001` を復元する。Expect=Legacy/Modern 200 + `d_audit_event` に `APPOINTMENT_MUTATION` success/failure が `actor_id`・`request_id`・`patient_id` 付きで残り、Modern JMS は `messages-added` が 1 増分（例: 4L→5L）する。`logs/jms_dolphinQueue_read-resource{,_legacy}.{before,after}.txt` と `logs/d_audit_event_{legacy,modern}.tsv` を `artifacts/parity-manual/appo/<RUN_ID>/` に保存し、差分を README へ記録する。",trace-audit-appo-20251115TappoSchedPlanZ,
rest_audit_appo_zero_mutation_todo,PUT,/appo,tmp/parity-headers/appo_<RUN_ID>.headers,ops/tests/api-smoke-test/payloads/appo_cancel_sample.json,200,"TODO: 0 件適用時でも `AuditTrailService.write` が `requestedCount>0 / appliedCount=0` を残せるか検証する。`ops/tests/api-smoke-test/payloads/appo_cancel_sample.json` から既存予約を削除済みにして再投入し、APPOINTMENT_MUTATION failure/success の両ログが `d_audit_event` に記録されること、JMS が +0/+0 であることを `artifacts/parity-manual/appo_zero_mutation/<RUN_ID>/` へ証跡化する。Tx 分離が完了するまで Pending。",trace-audit-appo-zero-mutation,
rest_error_chart_summary_seed_gap,GET,/chart/WEB1001/summary,ops/tests/api-smoke-test/headers/legacy-default.headers,,500,"Headers=ops/tests/api-smoke-test/headers/legacy-default.headers（`X-Trace-Id: trace-chart-summary-manual`）; Expect=Legacy/Modern 200 を目標（現状 Legacy=200 / Modern=400: `KarteBeanConverter` null + WEB1001 seed gap）; Evidence=artifacts/parity-manual/JPQL/20251110T122417Z/KarteServiceBean/; TODO: `ops/db/local-baseline/local_synthetic_seed.sql` 再投入 + Converter null-safe 化。",trace-chart-summary-manual,
rest_error_letter_fk,PUT,/odletter/letter,tmp/parity-headers/letter_20251111T091717Z.headers,tmp/parity-letter/letter_put_payload.json,200,"Headers=tmp/parity-headers/letter_<RUN_ID>.headers（最新: letter_20251111T091717Z.headers, TraceId=parity-letter-<RUN_ID>）; Payload=tmp/parity-letter/letter_put_payload.json。RUN_ID=`20251111TrestfixZ` では Legacy=200（戻り値 18）/Modern=200（戻り値 -38）で応答し、HTTP・meta・headers は `artifacts/parity-manual/letter/20251111TrestfixZ/rest_error_letter_fk/{legacy,modern}/` に保存済み。`logs/d_audit_event_letter.tsv` / `logs/d_audit_event_latest.tsv` は Legacy/Modern とも対象行 0 件、`logs/jms_dolphinQueue_read-resource.txt` も `message-count=0L`, `messages-added=0L` を維持。`reset_d_audit_event_seq.sql` の成果物は `artifacts/parity-manual/db/20251111TrestfixZ/{legacy,modern}/audit_event_{backup.csv,status_log.txt,validation_log.txt}` で参照。Evidence=artifacts/parity-manual/letter/20251111TrestfixZ/。",parity-letter-20251111T091717Z,"TODO (Audit/JMS 未取得)"
rest_error_letter_audit,PUT,/odletter/letter,tmp/parity-headers/letter_<RUN_ID>.headers,tmp/parity-letter/letter_put_payload.json,200,"Headers=tmp/parity-headers/letter_<RUN_ID>.headers（RUN_ID テンプレ=`20251115TletterAuditZ1`, `X-Trace-Id: trace-letter-audit-<RUN_ID>`）; Payload=tmp/parity-letter/letter_put_payload.json。Expect=Legacy 200（ID=18）/Modern 200（ID=-38） + Modern `d_audit_event` に `LETTER_CREATE`/`LETTER_UPDATE` が TraceId=`trace-letter-audit-<RUN_ID>` で追加され、`logs/jms_dolphinQueue_read-resource.{before,after}.txt` で Modern `messages-added` が 0L→1L へ増分する。Evidence=artifacts/parity-manual/letter/<RUN_ID>/ に HTTP/headers/meta/`logs/d_audit_event_letter_{legacy,modern}.tsv`/JMS/CLI ログを集約。Legacy 側は Audit/JMS 0 行のまま既知事象として README に記載。",trace-letter-audit-<RUN_ID>,"DONE (RUN_ID=20251115TletterAuditZ1)"
rest_error_lab_empty,GET,"/lab/module/WEB1001,0,5",tmp/parity-headers/lab_20251111T091717Z.headers,,200,"Headers=tmp/parity-headers/lab_<RUN_ID>.headers; RUN_ID=`20251111TrestfixZ` では Legacy/Modern とも 200 で `response.json` は `{\"list\":[]}`。HTTP/ログは `artifacts/parity-manual/lab/20251111TrestfixZ/` に集約し、`logs/d_audit_event_lab.tsv` / `logs/d_audit_event_latest.tsv` は TraceId 行 0 件のまま、`logs/jms_dolphinQueue_read-resource.txt` も 0L→0L を確認。Audit バックアップは `artifacts/parity-manual/db/20251111TrestfixZ/{legacy,modern}/audit_event_*` を参照。Evidence=artifacts/parity-manual/lab/20251111TrestfixZ/。",parity-lab-20251111T091717Z,"TODO (Audit/JMS 未取得)"
rest_error_lab_audit,GET,"/lab/module/WEB1001,0,5",tmp/parity-headers/lab_<RUN_ID>.headers,,200,"Headers=tmp/parity-headers/lab_<RUN_ID>.headers（RUN_ID テンプレ=`20251115TlabAuditZ1`, `X-Trace-Id: trace-lab-audit-<RUN_ID>`）。Expect=Modern 200 かつ `d_audit_event` に `LAB_TEST_READ` が `patientId`/`labCode`/`resultCount`（0 件でも記録）付きで追加され、`logs/jms_dolphinQueue_read-resource.{before,after}.txt` で Modern `messages-added` が 1L→2L へ増分する。Legacy はシード未投入時 404 のため Evidence 側に理由と再取得条件を追記。証跡=artifacts/parity-manual/lab/<RUN_ID>/（HTTP/headers/meta + `logs/d_audit_event_lab_{legacy,modern}.tsv` + JMS + `send_parallel_request.log`）。",trace-lab-audit-<RUN_ID>,"DONE (RUN_ID=20251115TlabAuditZ1)"
rest_error_stamp_data_exception,PUT,/stamp/tree,tmp/parity-headers/stamp_20251111TstampfixZ3.headers,tmp/parity-letter/stamp_tree_payload.json,"200 (legacy) / 200 (modern)","Headers=tmp/parity-headers/stamp_<RUN_ID>.headers（最新: stamp_20251111TstampfixZ3.headers, TraceId=parity-stamp-<RUN_ID>）。RUN_ID=`20251111TstampfixZ3` は helper コンテナ（`--network legacy-vs-modern_default`）から `BASE_URL_{LEGACY,MODERN}=http://opendolphin-{server,server-modernized-dev}:8080/openDolphin/resources` で実施し、`stamp_tree_payload.json` を GET `/stamp/tree/9001` の最新版（versionNumber=11）へ同期してから投入。Legacy/Modern とも 200 応答で、HTTP/headers/meta は `artifacts/parity-manual/stamp/20251111TstampfixZ3/{stamp_tree_user9001,PUT_stamp_tree,rest_error_stamp_data_exception}/` に保存済み。DB 側は `ops/db/local-baseline/stamp_tree_oid_cast.sql` と `CREATE TABLE d_subscribed_tree (...)` をモダナイズ DB へ反映し、`logs/d_stamp_tree_cast_migration.txt` と `logs/d_subscribed_tree_migration.txt` に手順を追記。Audit/JMS 証跡は `logs/d_audit_event_stamp_{legacy,modern}.tsv`（TraceId=parity-stamp-20251111TstampfixZ3）と `logs/jms_dolphinQueue_read-resource.txt`（`messages-added=4L`, `message-count=0L`）で確認できる。",parity-stamp-20251111TstampfixZ3,
rest_error_stamp_tree_public,GET,"/stamp/tree/9001/public",tmp/parity-headers/stamp_tree_public_<RUN_ID>.headers,,"200 (legacy) / 200 (modern)","Prereq: Legacy/Modern DB へ `ops/db/local-baseline/stamp_public_seed.sql` を適用し、`PublishedTree` publishType in ('9001','9002','global') が揃っていることを確認。Headers=tmp/parity-headers/stamp_tree_public_<RUN_ID>.headers（TraceId=`parity-stamp-tree-public-<RUN_ID>`）。Expect: Legacy/Modern 200 + JSON (`PublishedTreeListConverter` format)。Audit: `d_audit_event` に `STAMP_TREE_PUBLIC_GET` が 1 行以上追加され、`artifacts/parity-manual/stamp/20251113TstampPublicPlanZ1/logs/d_audit_event_stamp_public_{legacy,modern}.tsv` へ保存。JMS: `jms_dolphinQueue_read-resource{,_legacy}.{before,after}.txt` で messages-added 差分 0 を記録（read-only）。20251111TstampfixZ4 の 404 証跡は `artifacts/parity-manual/stamp/20251111TstampfixZ4/stamp_tree_public/` に保持し、実装完了後は RUN_ID=`20251113TstampPublicPlanZ1` で差し替える。2025-11-12 に Legacy/Modern へ seed 再適用（Modern=DDL 追加含む）＋ `seed_stamp_public_{legacy,modern}.log` を作成し、同 RUN_ID 用ヘッダーも `tmp/parity-headers/stamp_tree_public_20251113TstampPublicPlanZ1.headers` で準備済み。",parity-stamp-tree-public-<RUN_ID>,
rest_error_stamp_tree_shared,GET,"/stamp/tree/9001/shared",tmp/parity-headers/stamp_tree_shared_<RUN_ID>.headers,,"200 (legacy) / 200 (modern) → TODO: 実装後 RUN_ID=20251113TstampPublicPlanZ1 で証跡採取","Headers=tmp/parity-headers/stamp_tree_shared_<RUN_ID>.headers（テンプレ: `_TEMPLATE.headers`）。RUN_ID=`20251111TstampfixZ5` の HTTP/headers は `artifacts/parity-manual/stamp/20251111TstampfixZ5/stamp_tree_shared/{legacy,modern}/` に保存。Legacy は共有カタログを `/stamp/subscribed/tree`（POST/DELETE、レスポンス=購読 ID 列）で管理していたため Appendix A.5 に沿った再設計が必要。UI 切替 or REST alias が完了したら RUN_ID=`20251113TstampPublicPlanZ1` で 200/200 + Audit/JMS を取得し、`logs/d_audit_event_stamp_shared_{legacy,modern}.tsv` に TraceId を残す。2025-11-12 時点で `seed_stamp_public_{legacy,modern}.log`（artifacts/parity-manual/stamp/20251113TstampPublicPlanZ1/logs/）と `tmp/parity-headers/stamp_tree_shared_20251113TstampPublicPlanZ1.headers` を用意済み。",parity-stamp-tree-shared-<RUN_ID>,
rest_error_stamp_tree_published,GET,"/stamp/tree/9001/published",tmp/parity-headers/stamp_tree_published_<RUN_ID>.headers,,"200 (legacy) / 200 (modern) → TODO: 実装後 RUN_ID=20251113TstampPublicPlanZ1 で証跡採取","Headers=tmp/parity-headers/stamp_tree_published_<RUN_ID>.headers。RUN_ID=`20251111TstampfixZ6` の結果・ログは `artifacts/parity-manual/stamp/20251111TstampfixZ6/stamp_tree_published/{legacy,modern}/` へ保存済み。`/stamp/published/tree` が正式 GET ルートであることを Appendix A.5 に統合済みなので、UI/REST いずれかの改修後に 200/200 を再取得し、`logs/d_audit_event_stamp_published_{legacy,modern}.tsv` と `logs/jms_dolphinQueue_read-resource{,_legacy}.txt` を RUN_ID=`20251113TstampPublicPlanZ1` で差し替える。2025-11-12 に公開系 seed とヘッダー（`tmp/parity-headers/stamp_tree_published_20251113TstampPublicPlanZ1.headers`）を更新し、RUN_ID=`20251113TstampPublicPlanZ1` 用の artifacts ルート／ログを共通化済み。",parity-stamp-tree-published-<RUN_ID>,
rest_error_claim_send,PUT,/20/adm/eht/sendClaim,tmp/claim-tests/claim_<RUN_ID>.headers,tmp/claim-tests/send_claim_success_<RUN_ID>.json,"200 (legacy) / 200 (modern)","Headers/BODY=tmp/claim-tests/claim_<RUN_ID>.headers + send_claim_success_<RUN_ID>.json（テンプレは `tmp/claim-tests/claim_TEMPLATE.headers` / `send_claim_success.json`）。RUN_ID=`20251111TclaimfixZ3` は helper コンテナ（`--network legacy-vs-modern_default`）経由で実行し、ホスト↔9080 復旧までは helper 運用を継続。事前に `ops/db/local-baseline/reset_d_audit_event_seq_batch.sql` を Legacy/Modern 両 Postgres へ適用し、`artifacts/parity-manual/db/20251111TclaimfixZ3/{legacy,modern}/audit_event_*` を保存。HTTP/JMS/Audit 証跡は `artifacts/parity-manual/TRACEID_JMS/20251111TclaimfixZ3/claim_send/`（response/meta/headers/logs）と `logs/d_audit_event_claim.tsv` へ格納し、TraceId 差分は `scripts/diff_d_audit_event_claim.sh 20251111TclaimfixZ3 20251111TclaimfixZ2` の結果を同階層 README に貼り付ける。",trace-jms-20251111TclaimfixZ3,
