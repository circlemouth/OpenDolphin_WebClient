# 認証/権限ギャップ実装計画

- RUN_ID: `20260103T093344Z`
- 対象: BKL-003/004/016（施設/ユーザ選択・切替、権限境界運用）
- 優先度: P0

## 実装箇所（web-client）
- `web-client/src/features/login/FacilityLoginEntry.tsx`
- `web-client/src/features/login/FacilityLoginResolver.tsx`
- `web-client/src/AppRouter.tsx`
- `web-client/src/routes/facilityRoutes.ts`

## server-modernized 連携
- 認証/ユーザ切替 API の契約確定
- 監査イベント（login/role-switch/denied）の送出

## 進め方（ワーカー向け）
1. 施設/ユーザ選択 UI とルーティング（入口）を確定。
2. 施設/ユーザ切替の安全なフロー（ログアウト→再ログイン）を設計。
3. 権限境界で拒否された場合の理由表示を追加。
4. auditEvent に `runId` `screenId` `action` を記録。

## 完了条件（DoD）
- 施設/ユーザ切替時に権限境界が明示される。
- 拒否理由が UI に表示され、監査ログに記録される。
- runId がログイン/切替イベントに付与される。

## テスト/証跡
- ログイン/切替/拒否の UI 画面キャプチャ
- auditEvent 出力ログ

## 参照
- `src/implementation_planning/未実装項目の画面割当と実装箇所整理.md`
