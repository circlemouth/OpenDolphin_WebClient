# 配信キュー監視と再送導線

- RUN_ID: 20251228T092829Z
- 期間: 2025-12-28T09:28:29Z - 2025-12-28T09:31:13Z
- ステータス: done
- 進捗: 100
- YAML ID: src/webclient_productionization/administration/51_配信キュー監視と再送導線.md
- 参照ガント: .kamui/apps/webclient-productionization-plan-20251226.yaml

## 進捗記入ルール
- 担当者は作業開始時に RUN_ID/期間/ステータス/進捗 を更新する。
- 実施ログに日付・作業内容・成果物（コミット/証跡パス）・検証結果・残課題を追記する。
- 進捗更新時は docs/DEVELOPMENT_STATUS.md の懸念点有無も確認し、必要ならここに反映する。

## 進捗メモ（担当者が更新）
- 担当者: codex
- 更新日: 2025-12-28
- 根拠: キュー警告判定を共通ロジックへ統合し、ブロードキャストの queueStatus 追加と監査ログの要約を強化。
- 次アクション: なし


## 目的
- 配信キューの遅延検知閾値と warning バナーを設定し、未配信/失敗を可視化する。
- 再送/破棄の結果を監査ログへ反映し、Reception/Charts へ通知する。

## 受け入れ基準 / Done
- 配信キューの遅延判定閾値が UI とログで明示され、warning バナーが表示される。
- 再送/破棄の成功/失敗が監査ログに記録される。
- キュー操作の結果が Reception/Charts にブロードキャストされる。

## 実施ログ
- 2025-12-28: 遅延閾値の明示、再送/破棄の監査ログ結果付与、Reception/Charts へのキュー操作ブロードキャスト通知を追加（RUN_ID: 20251228T084546Z）。
  - 変更: `web-client/src/features/administration/AdministrationPage.tsx` / `web-client/src/features/shared/AdminBroadcastBanner.tsx` / `web-client/src/libs/admin/broadcast.ts` / `web-client/src/features/outpatient/orcaQueueStatus.ts` / `web-client/src/features/shared/__tests__/AdminBroadcastBanner.test.tsx`
  - テスト: `npm --prefix web-client run test -- AdminBroadcastBanner` / `npm --prefix web-client run typecheck`
- 2025-12-28: キュー警告判定を共通ロジックへ統合し、ブロードキャスト queueStatus/監査ログ要約を拡充（RUN_ID: 20251228T092829Z）。
  - 変更: `web-client/src/features/administration/AdministrationPage.tsx` / `web-client/src/features/outpatient/orcaQueueStatus.ts` / `web-client/src/libs/admin/broadcast.ts` / `web-client/src/features/shared/AdminBroadcastBanner.tsx` / `web-client/src/features/shared/__tests__/AdminBroadcastBanner.test.tsx`
  - テスト: `npm --prefix web-client run test -- AdminBroadcastBanner` / `npm --prefix web-client run typecheck`
