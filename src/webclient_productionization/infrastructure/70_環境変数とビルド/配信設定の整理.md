# 配信設定の整理

- RUN_ID: 20251228T201000Z
- 期間: 2025-12-28 20:10 - 2025-12-28 20:45 UTC
- ステータス: done
- 進捗: 100
- YAML ID: src/webclient_productionization/infrastructure/70_環境変数とビルド/配信設定の整理.md
- 参照ガント: .kamui/apps/webclient-productionization-plan-20251226.yaml

## 進捗記入ルール
- 担当者は作業開始時に RUN_ID/期間/ステータス/進捗 を更新する。
- 実施ログに日付・作業内容・成果物（コミット/証跡パス）・検証結果・残課題を追記する。
- 進捗更新時は docs/DEVELOPMENT_STATUS.md の懸念点有無も確認し、必要ならここに反映する。

## 進捗メモ（担当者が更新）
- 担当者: codex
- 更新日: 2025-12-28
- 根拠: env テンプレ/README を同一オリジン `/api` 前提で統一し、MSW 無効化と API 参照・プロキシ挙動をコードで再確認。
- 次アクション: Stage/Prod の実値は運用側で設定し、実接続の動作確認は別 RUN_ID で証跡保存する。

## 目的
- 本番/ステージの環境変数テンプレートを分離し、ビルド/配信時の前提（プロキシ、証明書、CORS）を明文化する。
- MSW 無効化時の API 直接接続パスを確認し、本番向けのビルド設定を確定する。

## 受け入れ基準 / Done
- `.env.stage.example` / `.env.prod.example` のテンプレートが追加され、Stage/Prod で必要な変数が整理されている。
- `web-client/README.md` に本番/ステージの環境分離、MSW 無効化時の接続パス、CORS/証明書/プロキシ前提が明記されている。
- MSW 無効化時の直接接続パス（`VITE_API_BASE_URL`/`/api`）と dev/preview プロキシ経路がコードで確認できる。

## 実施ログ
- 2025-12-28: 環境変数テンプレートと配信前提の統一・根拠強化を実施。
  - 作業内容:
    - `.env.sample` / `.env.stage.example` / `.env.prod.example` を **同一オリジン `/api` 前提** で統一。
    - README に MSW 無効化時の接続パス（既定 `/api`）と本番/Stage の CORS/証明書/プロキシ前提を簡潔に整理。
    - コード参照根拠（MSW 判定 / API ベース / Vite プロキシ仕様）を明文化。
  - 成果物:
    - `web-client/.env.sample`
    - `web-client/.env.stage.example`
    - `web-client/.env.prod.example`
    - `web-client/README.md`
  - 検証結果（コード確認）:
    - MSW 無効化判定: `web-client/src/main.tsx` で `VITE_DISABLE_MSW !== '1'` の場合のみ MSW 登録。
    - API 直結パス: `web-client/src/LoginScreen.tsx` が `VITE_API_BASE_URL ?? '/api'` を利用。
    - dev/preview プロキシ: `web-client/vite.config.ts` で `/api` は rewrite で先頭を除去し、`/api01rv2` `/orca21` `/orca12` は書き換えなしで `VITE_DEV_PROXY_TARGET` に中継。
  - 残課題:
    - Stage/Prod の実環境値（API/CORS/証明書）での疎通検証は別 RUN_ID で実施し証跡を保存する。
