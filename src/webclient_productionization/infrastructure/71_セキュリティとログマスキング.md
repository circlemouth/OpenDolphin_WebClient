# セキュリティとログマスキング

- RUN_ID: 20251228T214214Z
- 期間: 2025-12-28 21:42 UTC - 2025-12-28 21:50 UTC
- ステータス: completed
- 進捗: 100
- YAML ID: src/webclient_productionization/infrastructure/71_セキュリティとログマスキング.md
- 参照ガント: .kamui/apps/webclient-productionization-plan-20251226.yaml

## 進捗記入ルール
- 担当者は作業開始時に RUN_ID/期間/ステータス/進捗 を更新する。
- 実施ログに日付・作業内容・成果物（コミット/証跡パス）・検証結果・残課題を追記する。
- 進捗更新時は docs/DEVELOPMENT_STATUS.md の懸念点有無も確認し、必要ならここに反映する。

## 進捗メモ（担当者が更新）
- 担当者: CodexCLI
- 更新日: 2025-12-28
- 根拠: telemetry 露出のマスキング拡張と 419/440 セッション切れ対応、監査ログ露出テストを追加。
- 次アクション: 追加要望があれば UI 表示範囲のマスキングを再調整。


## 目的
- フロントエンドの監査ログ/コンソール露出に含まれる機微情報をマスキングし、出力ルールを明示する。
- 401/403 応答時にセッション切れを統一処理し、安全なログアウトと再ログイン導線を整える。

## 受け入れ基準 / Done
- 監査ログの console / window 露出がマスキング済みで、RUN_ID/操作情報は保持されている。
- 401/403 を検知した場合にセッション切れ通知が発火し、ログアウト後に再ログイン案内が表示される。
- ログイン処理では誤ってセッション切れ通知が発火しない。
- 実装の変更点・検証結果が実施ログに記録されている。

## 実施ログ
- 2025-12-28: 監査ログのマスキングルールとセッション切れ通知を実装。`web-client/src/libs/logging/mask.ts` で機微キーを赤塗りし、`auditLogger` の console/window 露出をマスク。`httpClient` に 401/403 検知 + `sessionExpiry` 通知を追加し、`AppRouter` で安全ログアウト/監査記録/ログイン画面通知を統一。Login は `suppressSessionExpiry` で誤通知を抑止。コミット: cbe1dbcbb
- 2025-12-28: telemetry の console/window 露出をマスク化し、マスキング対象キーを拡張。セッション切れ対象に 419/440 を追加し、403 の権限不足文言を明確化。`__AUDIT_*` がマスク済みであることをテスト追加。テスト: `NPM_CONFIG_CACHE=./tmp/npm-cache npm --prefix web-client test src/features/charts/__tests__/auditTelemetryRunId.test.ts src/features/charts/__tests__/soapNoteAudit.test.tsx src/features/charts/__tests__/chartsPrintAudit.test.ts`（結果: PASS）。コミット: dc793f077
