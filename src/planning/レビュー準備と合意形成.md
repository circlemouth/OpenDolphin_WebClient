# レビュー準備と合意形成（webclient non chart gap audit plan）

- RUN_ID: `20251230T204518Z`
- 期間: 2026-01-03 09:00 〜 2026-01-04 09:00 (JST)
- 優先度: medium / 緊急度: medium
- エージェント: cursor cli
- YAML ID: `src/planning/レビュー準備と合意形成.md`

## 目的
チームレビューに向けた確認観点を整理し、追加検討項目の合意形成に必要な材料を揃える。

## 参照ドキュメント
- `docs/DEVELOPMENT_STATUS.md`
- `src/discovery/対象範囲と成果物定義.md`
- `src/gap_analysis/機能ギャップ抽出.md`
- `src/gap_analysis/追加検討項目の優先度付け.md`
- `src/webclient_productionization/01_現状実装棚卸しとギャップ整理.md`
- `src/planning/依存関係と影響範囲整理.md`

## レビュー観点リスト

### 1. スコープ/目的の一致
- 非 Charts 領域の監査強化で「何を守るか/何を証明するか」が明文化されているか。
- 追加検討項目 (BKL-001〜020) が目的に紐づき、優先度が妥当か。
- 既存実装で達成済みの範囲と、未達成の範囲が誤解なく分離できているか。

### 2. 業務フローの整合性
- 受付・患者・管理・送信/印刷の業務フローにおける例外パターンが漏れなく定義されているか。
- 施設/ユーザ切替や権限拒否の再ログイン導線が業務的に成立するか。

### 3. 監査要件の妥当性
- 監査イベントの粒度 (operation/action/metadata) が十分かつ過剰でないか。
- runId/traceId/dataSource/screen など必須メタの統一が実運用に耐えるか。
- 監査検索 UI の想定ユースケース (いつ/誰が/何を) が明確か。

### 4. UI/UX と誤操作防止
- 監査/警告/状態バナーの表示条件が一貫し、ユーザの判断材料として十分か。
- Patients/Reception/Administration の追加 UI が既存導線を阻害しないか。
- 重要操作の二重確認・ガードの説明が利用者に伝わるか。

### 5. API/連携仕様
- ORCA 連携の成功/失敗/遅延時の返却仕様が明文化されているか。
- 配信/印刷/診療終了の API で監査メタが必ず返るか。
- server-modernized 側のバリデーションと UI 制御が整合するか。

### 6. 運用・保守性
- 配信の即時/遅延/ロールバック判断の基準があるか。
- 例外一覧や監査検索の運用責任者・対応手順が明確か。
- 監査ログの保管期間/検索範囲/負荷対策が想定されているか。

### 7. テスト/検証計画
- E2E/統合テストで優先検証すべきシナリオが定義されているか。
- ORCA 実機検証の段取りと証跡取得が可能か。
- 監査イベントの観測 (runId 追跡) が再現可能か。

## 追加検討項目の説明資料

### 背景
- 非 Charts 領域の監査要件と運用要件が強化されつつあり、現行 UI と API の間にギャップが存在する。
- 監査メタの統一と運用フローが未確定なため、レビュー時に合意形成が必要。

### 追加検討項目の概要
- **権限/切替系 (BKL-002/003/004/016)**: 施設/ユーザ切替と権限境界の運用を整理し、UI と API の enforce を一致させる。
- **監査基盤 (BKL-013/014/018/019/020)**: 監査イベントの共通スキーマと検索 UI を整備し、監査証跡を追跡可能にする。
- **配信/運用基盤 (BKL-001/009/012)**: 配信状態や反映タイミングの説明責任を担保する。
- **業務完結性 (BKL-005/006/007/008)**: 送信/印刷/ORCA 反映の成功・失敗を可視化し、復旧導線を用意する。
- **UI 拡張 (BKL-010/011/015/017)**: Reception/Patients/Charts の安全表示や例外表示を拡張する。

### 合意形成で決めるべき事項
- 監査イベントの必須メタと保存/検索方針。
- 配信/印刷/送信の成功/失敗判定とユーザー通知の境界。
- 施設/ユーザ切替の業務フローと権限拒否時の再ログイン導線。
- 例外一覧で扱うケース定義 (未承認/送信失敗/遅延など)。

### 期待効果
- 監査ログと UI のズレを解消し、監査/運用の説明責任を担保する。
- 追加実装の優先順位を合意し、後工程の手戻りを減らす。

### リスク/未決事項
- ORCA 実機検証のスケジュール確保と証跡取得が未確定。
- 監査ログの粒度増加による性能影響の評価が必要。
- 監査検索 UI の要件確定が遅れると関連項目の実装が停滞する可能性がある。

## レビュー会の進め方 (提案)
- 目的/スコープ → 追加検討項目の優先度 → 監査/運用の合意点 → テスト計画の順で確認する。
- 合意事項と未決事項はその場で区分し、未決は担当/期限を明記する。
