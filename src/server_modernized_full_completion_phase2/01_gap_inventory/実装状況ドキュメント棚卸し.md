# 実装状況ドキュメント棚卸し（RUN_ID=20251219T063753Z）

対象期間: 2025-12-19 21:00 - 2025-12-20 21:00

## 目的
- `JAKARTA_EE10_GAP_LIST.md` / `MODERNIZED_SERVER_GAP_TRACKER_20251116T210500Z.md` / `ORCA_API_STATUS.md` を突合し、未実装・部分実装・証跡未取得を整理する。
- 追加でタスク化すべき事項を明文化し、次のワーカー指示へ繋ぐ。

## 参照ソース
- `docs/server-modernization/phase2/foundation/JAKARTA_EE10_GAP_LIST.md`
- `docs/server-modernization/phase2/notes/MODERNIZED_SERVER_GAP_TRACKER_20251116T210500Z.md`
- `docs/server-modernization/phase2/operations/ORCA_API_STATUS.md`

## 棚卸しサマリ
- Jakarta EE 10 移行の基盤ギャップ（設定/セキュリティ/CLI/計測/ビルド）に未実装が残存。
- ORCA 連携は「設計済み・未実装」「実装済み・証跡未取得」が混在。
- `ORCA_API_STATUS.md` の追跡対象が限定的で、未記載 API が多数存在する。

## 追記（RUN_ID=20251219T133053Z）
- ORCA-03 `/orca/tensu/shinku` のレスポンス拡充（`taniname` / `ykzkbn` / `yakkakjncd`）を対応済みとして反映。

## 未実装（実装着手が必要）
| ID | 項目 | 根拠ソース | 現状 | 必要対応 |
| --- | --- | --- | --- | --- |
| JKT-01 | `web.xml`/`beans.xml` の Jakarta EE 10 スキーマ化 | JAKARTA_EE10_GAP_LIST | スキーマが `java.sun.com` のまま | `jakarta.ee/xml/ns/jakartaee` へ更新、`_6_0.xsd`/`beans_4_0.xsd` に合わせる |
| JKT-02 | Micrometer への移行（Metrics Subsystem） | JAKARTA_EE10_GAP_LIST | MicroProfile Metrics 前提が残存 | `RequestMetricsFilter`/`DatasourceMetricsRegistrar` の Micrometer 化と `configure-wildfly.cli` 更新 |
| JKT-03 | JMS キュー/接続ファクトリの WildFly 33 CLI 定義 | JAKARTA_EE10_GAP_LIST | CLI 未定義 | `messaging-activemq` へ `java:/queue/dolphin` 等を登録 |
| JKT-04 | Elytron/Jakarta Security への認証移行 | JAKARTA_EE10_GAP_LIST | ヘッダ独自認証の温存 | Elytron HTTP 認証 or Bearer に再設計 |
| JKT-05 | 2FA 暗号キーの Secrets 管理 | JAKARTA_EE10_GAP_LIST | 開発用固定キーのフォールバック | 環境変数必須化 + Vault 等への移行 |
| KRT-01 | PUT `/karte/document` 実装 | MODERNIZED_SERVER_GAP_TRACKER | 未実装 | `KarteResource`/`KarteServiceBean` へ更新 API を追加 |
| KRT-02 | `SafetySummary` 系 API 実装 | MODERNIZED_SERVER_GAP_TRACKER | 未実装 | Legacy 実装を Jakarta 化しエンドポイント追加 |
| KRT-03 | `GET /karte/image/{id}` の `@PathParam` 修正 | MODERNIZED_SERVER_GAP_TRACKER | 未実装 | `@PathParam("id")` へ修正 |
| KRT-04 | 添付ストレージの二重アップロード解消 | MODERNIZED_SERVER_GAP_TRACKER | 未実装 | `AttachmentStorageManager` 呼び出しの単一化 |
| ORCA-01 | `/orca/inputset` WHERE 句修正 | MODERNIZED_SERVER_GAP_TRACKER | 未実装 | `hospnum` フィルタを括弧で明示 |
| ORCA-02 | `/orca/stamp/{setCd,name}` に `date` 追加 | MODERNIZED_SERVER_GAP_TRACKER | 未実装 | パラメータ拡張と有効期間チェック |
| ORCA-03 | `/orca/tensu/shinku` の返却項目不足 | MODERNIZED_SERVER_GAP_TRACKER | 対応済み | `taniname` / `ykzkbn` / `yakkakjncd` を含む列構成で整合 |
| ORCA-05 | 薬剤/特材/検査分類など大型マスタ REST | MODERNIZED_SERVER_GAP_TRACKER | 未実装 | 新規 REST + DTO/監査/ベンチ対応 |
| ORCA-06 | 保険者/住所マスタ REST | MODERNIZED_SERVER_GAP_TRACKER | 未実装 | 新規 REST + DTO/監査/ベンチ対応 |
| ORCA-07 | ORCA DB 接続の DataSource 化 | MODERNIZED_SERVER_GAP_TRACKER | 未実装 | JNDI DataSource + Secrets 注入へ移行 |
| ORCA-08 | 電子点数表 REST | MODERNIZED_SERVER_GAP_TRACKER | 未実装 | 新規 REST + DTO/監査/ベンチ対応 |
| AUD-02 | 4xx/5xx で Trace-ID を AuditTrail へ伝播 | MODERNIZED_SERVER_GAP_TRACKER | 未実装 | `LogFilter` 改修後の証跡取得 |
| JKT-06 | HTTPS 常時化/Forwarded ヘッダ検証 | JAKARTA_EE10_GAP_LIST | 未整理 | 証明書設定と reverse proxy 前提の整理 |

## 部分実装（追加対応が必要）
| ID | 項目 | 根拠ソース | 現状 | 追加対応 |
| --- | --- | --- | --- | --- |
| JKT-07 | Jakarta JSON-P/JSON-B 依存の明示 | JAKARTA_EE10_GAP_LIST | 要確認（依存未確定） | 依存追加の要否を確認し BOM に反映 |
| JKT-08 | `ManagedExecutorService` の JNDI 名整合 | JAKARTA_EE10_GAP_LIST | CLI 定義未確認 | `ee-concurrency` 定義と重複スケジュール監視 |
| MSG-01 | JMS 実装（送信） | MODERNIZED_SERVER_GAP_TRACKER | 実装完了 | WildFly 33 上の ACK 受信証跡を取得 |
| EXT-01 | PHR REST 実測 | MODERNIZED_SERVER_GAP_TRACKER | 実装済 + Trial未実測 | ORMaster 復旧後に 200 証跡を取得 |
| EXT-02 | 予約/受付ラッパー Trial 実測 | MODERNIZED_SERVER_GAP_TRACKER | 実装済 + Trial未実測 | Trial 200 証跡と `ORCA_API_STATUS` 更新 |
| EXT-03 | 紹介状/MML API 実測 | MODERNIZED_SERVER_GAP_TRACKER | Runbook 整備済 | Legacy/Modernized diff 証跡を取得 |

## 証跡未取得（実装はあるが証跡がない）
| ID | 対象 | 根拠ソース | 未取得の証跡 |
| --- | --- | --- | --- |
| ORCA-API-01 | `/api01rv2/acceptlstv2` 以外の ORCA API | ORCA_API_STATUS | `ORCA_API_STATUS.md` に記載なし（対象不足） |
| ORCA-API-02 | `/orca21/medicalmodv2/outpatient` | ORCA_API_STATUS | 最新実測は別ログのみ、ステータス表に未反映 |
| ORCA-API-03 | `/orca12/patientmodv2/outpatient` | ORCA_API_STATUS | ステータス表未記載 |
| ORCA-API-04 | PHR/予約/紹介状 API | MODERNIZED_SERVER_GAP_TRACKER | Trial/ORMaster 実測の 200 証跡未取得 |
| JMS-ACK-01 | JMS 送信 ACK 受信 | JAKARTA_EE10_GAP_LIST / MODERNIZED_SERVER_GAP_TRACKER | `operations/logs/<RUN_ID>-jms-orca-ack.md` 未作成 |

## タスク化（次アクション案）
### 1) Jakarta EE 10 / WildFly 33 基盤
- JKT-01: `web.xml`/`beans.xml` の Jakarta スキーマ更新（証跡: 更新 diff + ビルド）
- JKT-02: Micrometer 移行 + `configure-wildfly.cli` 更新（証跡: Metrics 動作ログ）
- JKT-03/JKT-08: JMS/Executor の CLI 定義確定（証跡: WildFly CLI 出力 + 起動ログ）
- JKT-04/JKT-05/JKT-06: セキュリティ/HTTPS 整備（証跡: 設計・設定 diff + 接続テスト）

### 2) カルテ/添付系 API
- KRT-01〜04 を実装し、`karte-clinical-review-*` へ結果を追記（証跡: 200 応答 + 監査ログ）

### 3) ORCA マスタ/点数系
- ORCA-01〜03 の SQL/DTO 修正（証跡: SQL 修正ログ + 200 応答）
- ORCA-05/06/07/08 の新規 REST 実装（証跡: OpenAPI 更新 + 契約テスト + 監査ログ）

### 4) ORCA API 状態テーブルの拡張
- `ORCA_API_STATUS.md` に未記載 API を追加し、実測結果の 200/40x を記録
- PHR/予約/紹介状/マスタ API は Trial/ORMaster の再実測完了後に更新

### 5) 証跡取得
- JMS ACK 受信ログ（`operations/logs/<RUN_ID>-jms-orca-ack.md`）
- Trial/ORMaster の CRUD 実測ログ（`operations/logs/<RUN_ID>-*.md` + `artifacts/orca-connectivity/`）

## DOC_STATUS / README 反映
- `docs/web-client/planning/phase2/DOC_STATUS.md` に本棚卸しの RUN_ID と成果物を追記する。
- `docs/web-client/README.md` の最新更新サマリと Active 一覧へ反映する。
