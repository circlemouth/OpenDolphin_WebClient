# 10 現状 UI 棚卸し

RUN_ID: 20260110T231203Z

## 参照
- `docs/DEVELOPMENT_STATUS.md`
- `docs/web-client/ux/charts-compact-layout-proposal-20260110.md`
- `web-client/src/features/charts/pages/ChartsPage.tsx`
- `web-client/src/features/charts/styles.ts`

---

## 1. charts-patient-header / charts-clinical-bar / charts-safety の重複情報整理

### 重複フィールド一覧

| 情報 | charts-patient-header | charts-clinical-bar | charts-safety |
| --- | --- | --- | --- |
| 患者名 | `patientDisplay.name` | - | `patientDisplay.name` |
| 患者カナ | `patientDisplay.kana` | - | - |
| 性別 | `patientDisplay.sex` | - | `patientDisplay.sex` |
| 年齢 | `patientDisplay.age` | - | `patientDisplay.age` |
| 患者番号/ID | `patientId` | - | `patientDisplay.patientId` |
| 受付番号/ID | `receptionId` | - | `patientDisplay.receptionId` |
| 予約番号/ID | `appointmentId` | - | `patientDisplay.appointmentId` |
| 生年月日 | `patientDisplay.birthDate` | - | `patientDisplay.birthDateIso` / `patientDisplay.birthDateEra` |
| 診療日 | - | `patientDisplay.visitDate` | - |
| 診療時刻 | - | `patientDisplay.appointmentTime` | - |
| 受付/予約/患者ID関連 | ○ | - | ○ |

### 各カードの表示範囲 / 役割

- `charts-patient-header` (患者ヘッダ)
  - 表示: 氏名/カナ/性別年齢/生年月日/患者ID/受付ID/予約ID/電話/メモ。
  - 目的: 患者識別 + 受付/予約の識別 + メモ情報。
- `charts-clinical-bar` (診療バー)
  - 表示: 診療ステータス、診療科、担当者、保険/自費、診療日+時間、承認/ロック。
  - 目的: 診療ステータス/担当/認可状態の即時把握。
- `charts-safety` (安全表示)
  - 表示: 患者名/年齢/患者ID/受付ID/予約ID/生年月日(ISO+和暦)/性別/年齢/RUN_ID/missingMaster。
  - 目的: 安全識別情報を冗長に明示 + missingMaster 等の安全警告。

### 重複の要点
- 患者基本情報（氏名/性別/年齢/生年月日）が `charts-patient-header` と `charts-safety` で二重表示。
- ID 系（患者ID/受付ID/予約ID）が `charts-patient-header` と `charts-safety` で二重表示。
- 診療日/時間は `charts-clinical-bar` のみ。

---

## 2. charts-workbench__body と 右固定メニューの DOM 構造

### DOM 構成図（ChartsPage）

```
<section .charts-workbench>
  <div .charts-workbench__sticky>
    <div .charts-card#charts-patient-header>
      <div .charts-patient-header>...</div>
    </div>
    <div .charts-card#charts-clinical-bar>
      <div .charts-clinical-bar>...</div>
    </div>
    <div .charts-card#charts-safety-display>
      <div .charts-safety>...</div>
    </div>
  </div>

  <div .charts-workbench__body>
    <div .charts-workbench__column--left>
      <div .charts-card#charts-patients-tab>
        <PatientsTab />
      </div>
      <div .charts-card>AuthServiceControls (debug時のみ)</div>
    </div>

    <div .charts-workbench__column--center>
      <div .charts-card#charts-soap-note>
        <SoapNotePanel />
      </div>
      <div .charts-card#charts-document-timeline>
        <DocumentTimeline />
      </div>
      <div .charts-card>
        <MedicalOutpatientRecordPanel />
      </div>
    </div>

    <div .charts-workbench__column--right>
      <div .charts-card#charts-orca-summary>
        <OrcaSummary />
      </div>
      <div .charts-card#charts-telemetry>TelemetryFunnelPanel (debug時のみ)</div>
    </div>

    <aside .charts-workbench__side>
      <div .charts-side-menu>
        <div .charts-side-menu__header>右固定メニュー</div>
        <p .charts-side-menu__desc>説明</p>
        <button>病名編集</button>
        <button>処方編集</button>
        <button>オーダー編集</button>
        <button>検査オーダー</button>
        <button>文書作成</button>
        <button>画像/スキャン</button>
        <button>右パネルを開く</button>

        <div .charts-side-panel#charts-side-panel>
          <div .charts-side-panel__header>
            <h3>アクション別タイトル</h3>
            <button>閉じる</button>
          </div>
          <div .charts-side-panel__content>
            - 病名編集: <DiagnosisEditPanel />
            - 処方編集/オーダー編集: <OrderBundleEditPanel />
            - 文書作成: <DocumentCreatePanel />
          </div>
          <p .charts-side-panel__message>補助説明</p>
          <div .charts-side-panel__actions>
            - 診療操作へ移動 / タイムラインへ移動 / ORCAサマリへ移動
          </div>
        </div>
      </div>
    </aside>
  </div>
</section>
```

### レイアウト定義（styles.ts）
- `.charts-workbench__sticky`: 3カラムの固定ヘッダ領域（sticky top 1rem）。
- `.charts-workbench__body`: 4カラム grid（左/中央/右/右固定）。
  - `grid-template-columns: minmax(280px, 0.95fr) minmax(420px, 1.6fr) minmax(300px, 1.05fr) minmax(220px, 0.8fr)`
- `.charts-workbench__side`: 右固定メニュー（sticky top 1.25rem）。

---

## 3. 既存カード / バー一覧

### charts-card 一覧

| 位置 | ID / 種別 | 内容 |
| --- | --- | --- |
| ヘッダ直下 | `charts-card` | 管理配信の適用メタ（deliveryAppliedMeta）|
| ヘッダ直下 | `charts-card--actions` | `ChartsActionBar`（診療操作/送信/承認/ロック）|
| sticky | `charts-patient-header` | 患者ヘッダ（患者情報 + メモ）|
| sticky | `charts-clinical-bar` | 診療情報バー（診療ステータス/担当/保険/診療日/承認・ロック）|
| sticky | `charts-safety-display` | 安全表示（患者識別/ID/生年月日/sex/age/RUN_ID/missingMaster）|
| 左列 | `charts-patients-tab` | `PatientsTab`（患者履歴/受付切替）|
| 左列 | `charts-card` | `AuthServiceControls`（debug時のみ）|
| 中列 | `charts-soap-note` | `SoapNotePanel`（SOAP記載）|
| 中列 | `charts-document-timeline` | `DocumentTimeline`（タイムライン/オーダー履歴/キュー）|
| 中列 | `charts-card` | `MedicalOutpatientRecordPanel`（診療録サマリ）|
| 右列 | `charts-orca-summary` | `OrcaSummary`（ORCAサマリ）|
| 右列 | `charts-telemetry` | `TelemetryFunnelPanel`（debug時のみ）|

### バー/メニュー一覧

| 名称 | 実体 | 補足 |
| --- | --- | --- |
| 患者ヘッダ | `.charts-patient-header` | `charts-patient-header` カード内。
| 診療バー | `.charts-clinical-bar` | `charts-clinical-bar` カード内。
| 安全表示 | `.charts-safety` | `charts-safety-display` カード内。
| 右固定メニュー | `.charts-side-menu` | `charts-workbench__side` 直下。
| 右固定パネル | `.charts-side-panel` | `aria-controls="charts-side-panel"` で開閉。

---

## 4. 所見（重複/統合の候補）
- 患者識別情報は `charts-patient-header` と `charts-safety` で重複。安全表示は安全識別に必要な要素だけ残し、ヘッダ側へ統合余地あり。
- ID 系（患者/受付/予約）は 2 か所に重複。SummaryBar へ集約すると可読性向上。
- 診療ステータス/承認/ロックは `charts-clinical-bar` のみで、統合時も中段に残すべき。

