# 12 3カラム化影響調査（RUN_ID=20260110T235927Z）

## 目的
- Charts 画面を 4カラム → 3カラムへ再編した際の **崩れ/隠れ/導線欠落** を事前に洗い出す。
- `DockedUtilityPanel`（右固定メニューのドッキング化）開閉で **主要導線・ボタンが隠れない** ことを保証する。

## 参照
- `docs/DEVELOPMENT_STATUS.md`
- `docs/web-client/ux/charts-compact-layout-proposal-20260110.md`
- `web-client/src/features/charts/pages/ChartsPage.tsx`
- `web-client/src/features/charts/styles.ts`

---

## 影響範囲（4カラム → 3カラム）

### 1. レイアウト骨格（ChartsPage）
- `charts-workbench__body` が **4カラム定義**（left/center/right/side）で固定化されている。
  - `grid-template-columns: minmax(280px, 0.95fr) minmax(420px, 1.6fr) minmax(300px, 1.05fr) minmax(220px, 0.8fr)`
- `charts-workbench__side`（右固定メニュー）が **grid第4列**を専有。
- 3カラム化では `charts-workbench__side` の **配置・占有幅の再設計**が必要（DockedUtilityPanel化）。

### 2. 上段（sticky）3分割
- `charts-workbench__sticky` は 3カラム固定（患者ヘッダ/診療バー/安全表示）。
- 3カラム化で横幅が増減した場合、
  - `charts-patient-header__meta` / `charts-clinical-bar` / `charts-safety__meta` の **自動折返し**が増える。

### 3. 各カラム内コンテンツの最小幅依存
- 左列 `PatientsTab` の `patients-tab__body` は **2カラム内訳**で最小幅 240/260px を要求。
- 中列 `DocumentTimeline` の `document-timeline__content` は **2カラム内訳**。
- 右列 `OrcaSummary` の `orca-summary__details` は **min 220px ×2列**。
- 3カラム化で **各カラム幅が縮む場合**、内部2分割が詰まり、要素の縦積み化/折返しが増える。

### 4. レスポンシブ切替点
- 既存は `max-width: 1280px` で **2カラム化**、`max-width: 920px` で **1カラム化**。
- 3カラム化後は **新しいブレイクポイント設計**が必要。
  - 3カラム維持の閾値と、DockedUtilityPanel の扱い（折り畳み/下部配置）を決める必要がある。

---

## DockedUtilityPanel 開閉の導線/ボタン影響

### 現在の導線（右固定メニュー）
- 操作導線ボタン
  - 病名編集 / 処方編集 / オーダー編集 / 検査オーダー / 文書作成 / 画像/スキャン
  - 「右パネルを開く」
- 右パネル内（`charts-side-panel`）の導線
  - 「診療操作へ移動」→ `charts-actionbar`
  - 「タイムラインへ移動」→ `charts-document-timeline`
  - 「ORCAサマリへ移動」→ `charts-orca-summary`

### ドッキング化で発生しうる隠れ
- DockedUtilityPanel が **右カラムに重なる**場合
  - `OrcaSummary` / `TelemetryFunnelPanel` が **視認/操作不能**になる可能性。
- Panel が **中央列まで被る**場合
  - `DocumentTimeline` / `MedicalOutpatientRecordPanel` の **CTAや入力**が隠れる可能性。
- Panel が **左列まで被る**場合
  - `PatientsTab` の行選択・履歴フィルタが **押下不能**になる可能性。

---

## 影響範囲とガード条件のチェックリスト

### レイアウト / 3カラム化
- [ ] `charts-workbench__body` のカラム構成が **left/center/right の3列**で安定する。
- [ ] `charts-workbench__side` を **DockedUtilityPanel として再配置**しても grid 崩れが起きない。
- [ ] 1440px / 1280px / 1024px / 900px で **overflow・重なり・横スクロールが発生しない**。
- [ ] `charts-workbench__sticky` の 3分割が **1行に収まる**。収まらない場合は **折返し許容のガード**を明文化。

### 左列（PatientsTab）
- [ ] `patients-tab__body` の 2分割が **縦積み/折返し時も情報欠落がない**。
- [ ] フィルタ/タブ/履歴行の **クリック領域が DockedUtilityPanel に隠れない**。

### 中列（SOAP + DocumentTimeline + MedicalRecord）
- [ ] `DocumentTimeline` の 2分割が **縦積みになっても操作/CTAが見切れない**。
- [ ] `SoapNotePanel` と `DocumentTimeline` の **主要ボタンが DockedUtilityPanel に隠れない**。
- [ ] `MedicalOutpatientRecordPanel` が **右列へ移動/縮小した場合も要点が読める**。

### 右列（OrcaSummary + Telemetry）
- [ ] `OrcaSummary` の 2分割が **縦積みになっても内容が欠落しない**。
- [ ] `TelemetryFunnelPanel`（表示時）が **DockedUtilityPanel に隠れない**。

### DockedUtilityPanel（右固定メニューのドッキング化）
- [ ] Panel を **閉じた状態**で、主要カラム（左/中/右）がフル幅で可視。
- [ ] Panel を **開いた状態**で、
  - [ ] `charts-actionbar` への導線が **視認/操作可能**。
  - [ ] `charts-document-timeline` への導線が **視認/操作可能**。
  - [ ] `charts-orca-summary` への導線が **視認/操作可能**。
- [ ] Panel が開いても **aria-controls / aria-expanded の整合**が崩れない。
- [ ] Panel の閉ボタンが **常に視認可能**で、フォーカスが逃げない。

### ブレイクポイント / 端末幅
- [ ] 1280px 以下では **3カラム → 2カラムの切替点**が適切。
- [ ] 920px 以下では **1カラム化 + DockedUtilityPanel を下部配置**しても導線が保たれる。
- [ ] 右ドッキングが **小画面でスクロールを阻害しない**。

---

## 補足メモ
- 3カラム化は **DockedUtilityPanel の「占有型」か「オーバーレイ型」か**で影響が変わる。
- 既存は4カラムで `charts-workbench__side` が固定列を持つため、
  **DockedUtilityPanel を浮かせる設計**の場合は `position` と `z-index` の再設計が必須。

