# エンドポイントマトリクス再生成（Factcheck）

## 対象
- Legacy OpenAPI: `docs/server-modernization/server-api-inventory.yaml`
- Modernized インベントリ: `docs/server-modernization/MODERNIZED_REST_API_INVENTORY.md`
- パリティ表: `docs/server-modernization/phase2/domains/API_PARITY_MATRIX.md`
- 参照数値: `docs/server-modernization/phase2/operations/MODERNIZED_API_DOCUMENTATION_GUIDE.md`（Legacy/Archive 扱い）

## 実行コマンド（抜粋）
- Legacy 件数: `rg -c '^\s{4}(get|post|put|delete|patch|options|head):' docs/server-modernization/server-api-inventory.yaml`
- Inventory 件数: `rg -c '^\|\s*(GET|POST|PUT|DELETE|PATCH|OPTIONS|HEAD)\s*\|' docs/server-modernization/MODERNIZED_REST_API_INVENTORY.md`
- パリティ表詳細: `rg -c '^\|.*\|\s*\[x\]\s*\|' docs/server-modernization/phase2/domains/API_PARITY_MATRIX.md`
- モダナイズのみ表: `awk ... '## モダナイズ版のみ' ... | rg -c '^\|'`
- Inventory vs パリティの突合: method+path 抽出 → `{...}` 正規化 → `comm`

## 件数結果
- Legacy 総数: **256**（OpenAPI 定義の HTTP メソッド数）
- MODERNIZED_REST_API_INVENTORY 掲載数: **152**（表の HTTP 行数）
- API_PARITY_MATRIX 詳細表の `[x]` 行数: **207**
- API_PARITY_MATRIX 詳細表の `[ ]` 行数: **49**
- API_PARITY_MATRIX「モダナイズのみ」表の行数: **6**（ヘッダー除外）

## 参照数値との不整合
- `API_PARITY_MATRIX.md` の集計サマリ:
  - 記載: Legacy 256 / Modernized 221 / 1:1 202 / Legacy-only 54 / Modern-only 8
  - 実測: Legacy 256 / `[x]` 207 / `[ ]` 49 / Modern-only 6
  - つまり **集計サマリの数値が現行表と一致しない**（202⇔207、54⇔49、8⇔6、Modernized 221⇔213）。
- `MODERNIZED_API_DOCUMENTATION_GUIDE.md` でも Modernized=221 を前提としているため、**参照値は現行表と整合しない**。

## MODERNIZED_REST_API_INVENTORY 差分整理
パリティ表（`[x]` 行）と Inventory を、`{}` 正規化で突合した結果:
- 重複（双方に存在）: **138**
- パリティ表のみ: **69**
- Inventory のみ: **14**

### パリティ表のみ（例・抜粋）
- `/20/adm/*`（Admission / EHT 系）
- `/10/adm/jtouch/*`（JsonTouch 系）
- `/pvt2/{}`（PVTResource2）
- `/20/adm/eht/*`（EHTResource）

→ **Admission/EHT/JsonTouch/PVT2 系が Inventory に未掲載**。

### Inventory のみ（全件）
- `/mml/claim/conn`
- `/mml/interaction`
- `/mml/module/{}`
- `/mml/serverinfo`
- `/mml/stamp/{}`
- `/mml/stampTree/{}`
- `/orca/master/address?zip=`
- `/orca/master/generic-class?keyword=&effective=&page=&size=`
- `/orca/master/generic-price?srycd=&effective=`
- `/orca/master/hokenja?pref=&keyword=&effective=`
- `/orca/master/kensa-sort?keyword=&effective=`
- `/orca/master/material?keyword=&effective=`
- `/orca/master/youhou?keyword=&effective=`
- `/orca/tensu/etensu?keyword=&category=&asOf=&tensuVersion=&page=&pageSize=`

→ **ORCA master/tensu の新規 API がパリティ表に未反映**。

## 結論（ファクトチェック）
- **Legacy 256 は正しい**（OpenAPI 定義のメソッド数に一致）。
- **Modernized 221 は不整合**。
  - パリティ詳細表の現行値から算出すると **213 (= 207 + 6)** が妥当。
  - MODERNIZED_REST_API_INVENTORY は「完了 API のみ」前提のため **152** と乖離。
- **パリティ表の集計サマリは更新漏れ**。
- **MODERNIZED_REST_API_INVENTORY は Admission/EHT/JsonTouch/PVT2 が抜け、
  一方で ORCA master/tensu がパリティ表未反映**。

## 次アクション候補（指示待ち）
- `API_PARITY_MATRIX.md` の集計サマリと Modernized-only 表を現行値へ再集計。
- `MODERNIZED_REST_API_INVENTORY.md` へ Admission/EHT/JsonTouch/PVT2 の掲載可否を判断。
- ORCA master/tensu の新規 API を `API_PARITY_MATRIX.md` の Modernized-only へ追記。

