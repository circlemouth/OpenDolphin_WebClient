# 開発ドキュメント棚卸

- RUN_ID: `20251230T173726Z`
- 期間: 2025-12-31 09:00 - 2026-01-01 09:00 (JST)
- 優先度: high / 緊急度: high
- YAML ID: `src/documentation/開発ドキュメント棚卸.md`

## 目的
- 現行ドキュメント（docs/web-client、README、運用手順）から機能要件と画面一覧を抽出する。
- `docs/DEVELOPMENT_STATUS.md` を単一参照とし、Legacy/Archive は参照専用で扱う。

## 参照順（正本）
1. `docs/DEVELOPMENT_STATUS.md`
2. `AGENTS.md` / `GEMINI.md`
3. `web-client/README.md` と `setup-modernized-env.sh`
4. `docs/web-client/`（`planning/phase2/` は Legacy/Archive）
5. `docs/server-modernization/`（`phase2/` は Legacy/Archive）

---

## ドキュメント索引

### 1. ルート/ハブ
- `docs/DEVELOPMENT_STATUS.md`
  - 現行ステータスと参照優先順の単一ソース。Phase2 ドキュメントは Legacy/Archive と明記。
- `README.md`
  - リポジトリ全体の位置付け、ハブリンク、Legacy 対象の宣言。

### 2. Web クライアント基盤
- `web-client/README.md`
  - Vite/React の起動、MSW/実 API 切替、Stage/Prod の環境分離、DocumentTimeline 確認ポイント。

### 3. Web クライアント設計・UX（現行）
- `docs/web-client/architecture/future-web-client-design.md`
  - 次期 Web クライアントの画面構成（Login/Reception/Charts/Patients/Administration/Outpatient Mock）と横断仕様。
- `docs/web-client/architecture/web-client-api-mapping.md`
  - 外来 API のマッピング、`resolveMasterSource`/`dataSourceTransition` と監査メタの要件。
- `docs/web-client/ux/reception-schedule-ui-policy.md`
  - Reception 画面の UI/UX ポリシー（一覧構成、フィルタ、右ペイン、アラート/ARIA）。
- `docs/web-client/ux/charts-claim-ui-policy.md`
  - Charts/Claim 画面の UI/UX ポリシー（2ペイン構成、SOAP、病名/オーダー、遷移・権限）。
- `docs/web-client/ux/patients-admin-ui-policy.md`
  - Patients/Administration の UI/UX ポリシー（編集導線、権限、配信/監査）。
- `docs/web-client/ux/config-toggle-design.md`
  - Administration 配信/ORCA キュー検証フラグ設計。
- `docs/web-client/ux/admin-delivery-validation.md`
  - 配信タイミング検証の観測・ログ取得・権限制御の確認手順。
- `docs/web-client/ux/playwright-scenarios.md`
  - Reception→Charts→Patients→Administration の横断シナリオ、tone/ARIA/監査の検証前提。
- `docs/web-client/ux/ux-documentation-plan.md`
  - UX 草稿の状態、検証観点、次ステップ（Playwright/QA）整理。

### 4. Web クライアント運用・検証ログ
- `docs/web-client/operations/debugging-outpatient-bugs.md`
  - 外来 API のデバッグ記録、再現手順、観測ポイント。
- `docs/web-client/operations/logs/20251230T081550Z-webclient-facility-prefix-09.md`
  - 施設 ID 補完フローの動作確認ログ。

### 5. 運用手順（共通）
- `setup-modernized-env.sh`
  - モダナイズ版サーバー + Web クライアント起動手順（npm/docker 切替、ORCA 接続情報読み込み）。
- `docs/operations/ORCA_LOCAL_GIT_MANAGEMENT.md`
  - ORCA 証明書をローカルで管理する手順（pre-push hook/`.gitignore`）。

### 6. Legacy/Archive（参照専用）
- `docs/web-client/README.md`（Phase2 Legacy/Archive 宣言あり）
- `docs/web-client/planning/phase2/*`
- `docs/server-modernization/phase2/*`

---

## 画面別の要求機能一覧

### 共通/横断（全画面）
- RUN_ID をログイン成功時に発行し、API ヘッダー/telemetry/監査ログ/`data-run-id` へ透過。
- `tone`/`missingMaster`/`cacheHit`/`dataSourceTransition` を画面横断で carry over。
- バナー/主要操作に `role=status|alert` と `aria-live` を付与（Error/Warning=assertive、Info=polite）。
- `auditEvent`/`audit.logUiState` に `runId` と業務キー（facilityId/patientId/appointmentId 等）を記録。
- 主要操作は telemetry funnel（`resolve_master` → `charts_orchestration`）に記録。
- 権限ガード（role/system_admin 等）を UI/API で整合、非活性/理由表示を必須化。

### Login
- 施設ID/ユーザーID/パスワード/クライアント UUID の入力と検証。
- MD5 ハッシュ化による認証、成功時に `runId` 発行。
- 成功/失敗メッセージを `role=status` で表示（`aria-live=polite`）。

### グローバルナビゲーション/共通シェル
- トップバー: ブランド/施設/ユーザー/RUN_ID/ログアウト。
- 左ナビ: Reception/Charts/Patients/Administration/Outpatient Mock、権限不足は disabled + ツールチップ。
- 通知スタック/トーストを最大3件で管理、Esc で閉じる。

### Reception（受付一覧）
- 受付/予約/在宅・訪問の上部タブ（位置固定）。
- クイック操作（患者登録/当日受付）と例外導線（未承認一覧）。
- 患者検索（診察券番号/生年月日/氏名/カナ）と業務フィルタ（診療科/種別/担当医）。
- 状態別リスト（外来受付/会計待ち/会計済み）+ 件数/折りたたみ/空表示。
- 一覧列: 受付No/受付内容/受付時間/状態/氏名/診察券番号/担当医/患者位置/コメント。
- 行操作: クリックで右パネル、メニューで修正/取消/会計完了/送信再送。
- 右パネル: 基本情報/直近診療/処方・検査概要/患者メモ。
- 例外一覧: エラー原因/再送可否/次アクションの明示。
- 自動更新 30 秒 + 手動更新（監査ログに `manualRefresh` を記録）。
- バナーの `tone`/`aria-live` を Charts と統一、`data-run-id` を付与。

### Charts（カルテ/外来作業台）
- ヘッダー: 患者基本情報/受付情報/注意フラグ/保険・自費トグル/更新/閉じる。
- アクション: 診療開始/診療終了/下書き/署名・送信（ORCA）/再送/診療終了解除。
- 2ペイン標準構成（左=病名/履歴、右=SOAP 入力）。
- 病名パネル: 主/疑い/開始/転帰/保険区分、期間フィルタ/追加導線。
- 履歴パネル: 過去カルテ/処方歴/サマリー/定期診療、検索と診療科フィルタ。
- 引き継ぎコピー（Do 相当）: 下書き扱い、コピー範囲を明示、監査ログへ記録。
- SOAP 入力: Free/S/O/A/P セクション、Shift+Enter で登録、保存状態表示。
- タブ構成: 診療録/病名/オーダー/結果・履歴/画像/DICOM/文書/サマリ。
- ORCA キュー/送信状態: `missingMaster`/`fallbackUsed`/`dataSourceTransition` の表示。
- 自動更新 30 秒 + 手動更新、`aria-atomic=false` で二重読み上げ抑制。
- 権限ガード（医師/看護/受付/管理者）で操作可否と理由を提示。

### Patients（患者管理）
- Reception からの deep link で編集画面へ遷移。
- 患者検索/新患登録/保険編集/患者メモ編集の CRUD。
- 監査ログビューの統合、編集結果のトースト表示（`aria-live`）。
- Reception へ戻る導線（タブ/フィルタ/保険モードの復元）。
- 権限不足時は閲覧フォールバック + 監査ログに拒否理由。

### Administration（設定）
- 左メニュー + 右側に検索/一覧/編集の共通レイアウト。
- role=system_admin のみ編集可（非活性/非表示/エラーメッセージを統一）。
- 管理対象: 施設/診療科/ユーザー/権限/ステータス/テンプレ/セット/自費メニュー/ORCA・DICOM 設定/セキュリティ/監査/表示カスタム。
- 設定配信: 即時/再読込/再ログインの反映条件を明示し、遅延時のバナーと再取得導線を提供。
- 配信キュー: 未配信バンドルの一覧、再送/破棄ボタン、遅延警告。
- システム通知: メンテナンス/更新/重要通知を対象別に表示。

### Outpatient Mock（デモ/QA）
- `missingMaster`/`cacheHit`/`dataSourceTransition` のフラグ切替。
- MSW シナリオ選択、`VITE_DISABLE_MSW=1` 時の警告表示。
- telemetry `resolve_master` 発火と `data-run-id` 表示の確認導線。

---

## API/監査・テレメトリの要件（画面横断）
- 外来 API: `/api01rv2/claim/outpatient/*`、`/api01rv2/appointment/outpatient/*`、`/orca21/medicalmodv2/outpatient`、`/orca12/patientmodv2/outpatient`。
- 監査メタ: `runId/dataSource/cacheHit/missingMaster/fallbackUsed/dataSourceTransition/fetchedAt/recordsReturned` を `auditEvent.details` に保持。
- UI バナーは `missingMaster`/`fallbackUsed`/`dataSourceTransition` の更新を即時に反映。
- `resolveMasterSource` の遷移（mock→snapshot→server→fallback）を telemetry とバナーで観測可能にする。

---

## Legacy/Archive の取り扱い
- `docs/web-client/planning/phase2/*` と `docs/server-modernization/phase2/*` は参照専用。
- 現行仕様の判断は必ず `docs/DEVELOPMENT_STATUS.md` を単一ソースとする。
