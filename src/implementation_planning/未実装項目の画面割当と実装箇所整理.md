# 未実装項目の画面割当と実装箇所整理

- RUN_ID: `20260103T094110Z`
- 目的: 追加検討項目（BKL-001〜020）を画面/実装箇所に割当て、実装タスクの粒度を固定する。
- 前提: `src/gap_analysis/機能ギャップ抽出.md` / `src/gap_analysis/追加検討項目の優先度付け.md` / `src/reporting/調査結果レポート作成.md`

## 進め方（ワーカー向け）
1. 追加検討項目（BKL）を「画面/機能」へ割当てる。
2. `web-client/src/features/*` の実装箇所（ページ/コンポーネント/共有モジュール）を一次特定する。
3. server-modernized 側で参照する API を暫定紐付けする。
4. 不明点は TODO として残し、次タスク（連携整理）へ引き渡す。

## 画面・実装箇所の割当（確定版）
| Backlog ID | 画面 | 実装箇所（web-client） | 主なサーバ連携候補 |
| --- | --- | --- | --- |
| BKL-001/002/009/012 | Administration/配信 | `web-client/src/features/administration/AdministrationPage.tsx` / `web-client/src/features/administration/api.ts` / `web-client/src/features/shared/*` | `/api/admin/config` `/api/admin/delivery` / 監査 API |
| BKL-003/004/016 | Login/共通権限 | `web-client/src/features/login/*` / `web-client/src/AppRouter.tsx` / `web-client/src/routes/facilityRoutes.ts` | 認証/ユーザ切替 API / 監査 API |
| BKL-006/010/011/013 | Reception | `web-client/src/features/reception/pages/ReceptionPage.tsx` / `web-client/src/features/reception/api.ts` / `web-client/src/features/reception/components/*` | `/api01rv2/appointment/outpatient/*` `/api01rv2/claim/outpatient` / 監査 API |
| BKL-007/014/015 | Patients | `web-client/src/features/patients/PatientsPage.tsx` / `web-client/src/features/patients/api.ts` | `/orca12/patientmodv2/outpatient` / 監査 API |
| BKL-005/008/017/018 | Charts（非カルテ領域） | `web-client/src/features/charts/*`（`print/` `DocumentTimeline.tsx` ほか） | `/orca21/medicalmodv2/outpatient` `/api01rv2/claim/outpatient` / 監査 API |
| BKL-019/020 | 共通 | `web-client/src/libs/observability/*` / `web-client/src/libs/audit/*` / `web-client/src/features/shared/*` | 監査 API / runId 伝播 |

## 画面別の実装担当リスト（タスク粒度確定）
| 画面 | 対象 Backlog | 責務メモ |
| --- | --- | --- |
| Administration/配信 | BKL-001/002/009/012 | 管理メニュー/配信運用の状態可視化、system_admin ガード、配信証跡の提示。 |
| Login/共通権限 | BKL-003/004/016 | 施設/ユーザ選択、切替フロー、権限境界のガードと拒否理由表示。 |
| Reception | BKL-006/010/011/013 | 例外一覧・右ペイン情報整理・一覧列拡張、受付監査検索。 |
| Patients | BKL-007/014/015 | ORCA 反映状態の警告/履歴、患者監査履歴ビュー、未紐付/警告強調。 |
| Charts（非カルテ） | BKL-005/008/017/018 | 診療終了/送信の結果反映、印刷実処理/復旧、患者安全ヘッダ、ドキュメント履歴。 |
| 共通 | BKL-019/020 | data-run-id/aria-live の統一、RUN_ID コピー/通知/ナビバッジ。 |

## web-client 実装配置表（主要ファイル/コンポーネント単位）
| Backlog ID | 主ファイル | 補助ファイル/関連コンポーネント |
| --- | --- | --- |
| BKL-001 | `web-client/src/features/administration/AdministrationPage.tsx` | `web-client/src/features/administration/api.ts` `web-client/src/features/administration/administration.css` |
| BKL-002 | `web-client/src/features/administration/AdministrationPage.tsx` | `web-client/src/AppRouter.tsx` `web-client/src/routes/facilityRoutes.ts` |
| BKL-009 | `web-client/src/features/administration/AdministrationPage.tsx` | `web-client/src/features/administration/*`（配信ステータス: 新規コンポーネント追加想定） |
| BKL-012 | `web-client/src/features/administration/AdministrationPage.tsx` | `web-client/src/features/administration/api.ts` `web-client/src/libs/observability/observability.ts` |
| BKL-003 | `web-client/src/features/login/FacilityLoginEntry.tsx` | `web-client/src/features/login/loginRouteState.ts` `web-client/src/AppRouter.tsx` |
| BKL-004 | `web-client/src/features/login/FacilityLoginResolver.tsx` | `web-client/src/routes/facilityRoutes.ts` `web-client/src/features/login/recentFacilityStore.ts` |
| BKL-016 | `web-client/src/AppRouter.tsx` | `web-client/src/routes/facilityRoutes.ts` `web-client/src/features/login/FacilityLoginResolver.tsx` |
| BKL-006 | `web-client/src/features/reception/pages/ReceptionPage.tsx` | `web-client/src/features/reception/components/*`（例外一覧: 新規追加想定） |
| BKL-010 | `web-client/src/features/reception/pages/ReceptionPage.tsx` | `web-client/src/features/reception/components/*`（右ペイン整理: 既存/新規併用） |
| BKL-011 | `web-client/src/features/reception/pages/ReceptionPage.tsx` | `web-client/src/features/reception/components/*`（一覧列拡張: 新規列定義追加） |
| BKL-013 | `web-client/src/features/reception/pages/ReceptionPage.tsx` | `web-client/src/features/reception/components/*`（監査検索: 新規追加想定） |
| BKL-007 | `web-client/src/features/patients/PatientsPage.tsx` | `web-client/src/features/patients/PatientFormErrorAlert.tsx`（表示差し替え/拡張） |
| BKL-014 | `web-client/src/features/patients/PatientsPage.tsx` | `web-client/src/features/patients/*`（監査履歴ビュー: 新規追加想定） |
| BKL-015 | `web-client/src/features/patients/PatientsPage.tsx` | `web-client/src/features/patients/*`（警告強調: 新規 UI 追加） |
| BKL-005 | `web-client/src/features/charts/pages/ChartsPage.tsx` | `web-client/src/features/charts/api.ts` `web-client/src/features/charts/ChartsActionBar.tsx` |
| BKL-008 | `web-client/src/features/charts/print/*` | `web-client/src/features/charts/pages/ChartsDocumentPrintPage.tsx` `web-client/src/features/charts/pages/ChartsOutpatientPrintPage.tsx` |
| BKL-017 | `web-client/src/features/charts/pages/ChartsPage.tsx` | `web-client/src/features/charts/*`（患者安全ヘッダ: 新規追加想定） |
| BKL-018 | `web-client/src/features/charts/DocumentTimeline.tsx` | `web-client/src/features/charts/*`（履歴フィルタ/検索: 新規追加想定） |
| BKL-019 | `web-client/src/libs/runId.ts` | `web-client/src/libs/observability/observability.ts` `web-client/src/libs/audit/*` |
| BKL-020 | `web-client/src/features/shared/*` | `web-client/src/features/shared/AdminBroadcastBanner.tsx`（通知 UI を拡張想定） |

## サーバ連携 API 仮割当リスト
| Backlog ID | API（暫定） | 備考 |
| --- | --- | --- |
| BKL-001/009/012 | `/api/admin/config` `/api/admin/delivery` | 配信メタ/環境ラベル/証跡確認。 |
| BKL-002/016 | 監査 API | system_admin ガード/拒否理由の監査記録。 |
| BKL-003/004 | 認証/ユーザ切替 API | 施設/ユーザ選択・再ログイン導線。 |
| BKL-005 | `/api01rv2/claim/outpatient` | 診療送信/結果反映（受付・会計連携）。 |
| BKL-006/010/011/013 | `/api01rv2/appointment/outpatient/*` | 受付一覧/例外一覧/監査検索の前提。 |
| BKL-007/014/015 | `/orca12/patientmodv2/outpatient` | ORCA 反映状態/警告/履歴。 |
| BKL-008/018 | `/orca21/medicalmodv2/outpatient` | 印刷/ドキュメント履歴のソース。 |
| BKL-019/020 | 監査 API | runId/aria-live の共通化/通知。 |

## 作業チェックリスト
- [ ] 画面単位の責務境界を明記（Reception/Patients/Charts/Admin/Login）。
- [ ] 画面内の「ページ/コンポーネント/共有」の切り分けを一次確定。
- [ ] サーバ連携候補の API を暫定紐付けし、未確定項目は TODO として残す。
- [ ] 監査/通知/観測メタ（runId 等）の影響範囲をマークする。

## TODO（空欄埋め用）
- [ ] Reception の「例外一覧」UI の所在（既存/新規）
- [ ] Patients の「ORCA反映状態」表示の UI 部品設計
- [ ] Administration の「配信タイミング」文言定義
- [ ] 共通の data-run-id 付与方針の統一箇所

## 成果物
- 画面別の実装担当リスト
- web-client 実装配置表（主要ファイル/コンポーネント単位）
- サーバ連携 API の仮割当

## 参照
- `src/reporting/調査結果レポート作成.md`
- `src/gap_analysis/追加検討項目の優先度付け.md`
