# モダナイズ版サーバー連携整理

- RUN_ID: `20260103T093344Z`
- 目的: 非カルテ領域の未実装項目を server-modernized の契約として整理し、UI/サーバの責務境界を確定する。
- 前提: `src/implementation_planning/未実装項目の画面割当と実装箇所整理.md`

## 連携対象 API（暫定）
- Reception/例外一覧・キュー状態
  - `/api01rv2/appointment/outpatient/*`
  - `/api01rv2/claim/outpatient`
- Patients/反映状態
  - `/orca12/patientmodv2/outpatient`
- Charts/送信・印刷
  - `/orca21/medicalmodv2/outpatient`
  - `/api01rv2/claim/outpatient`
- Administration/配信
  - `/api/admin/config`
  - `/api/admin/delivery`
- 共通監査
  - `auditEvent` 永続化/検索 API

## server-modernized 側の調査ポイント
- REST ルートの実装場所（例）
  - `server-modernized/src/main/java/open/*/rest/*`
- 監査イベントの永続化経路
  - 既存の `auditEvent` テーブル/サービスに接続できるか
- レスポンスに含める観測メタ
  - `runId` `dataSource` `cacheHit` `missingMaster` `fallbackUsed` `dataSourceTransition`

## 接続方針（ワーカー向け）
1. web-client 側の API 呼び出しを `fetchWithResolver` へ統一。
2. `dataSourceTransition/cacheHit/runId` を UI と auditEvent に透過。
3. server-modernized 側に不足する REST ルートを追加。
4. UI の例外表示（ToneBanner/例外一覧）を API レスポンスに同期。

## 監査メタの統一（最低限）
- 必須: `runId`, `screenId`, `action`, `outcome`, `timestamp`
- 推奨: `patientId`, `appointmentId`, `dataSource`, `cacheHit`, `missingMaster`, `fallbackUsed`

## 成果物
- 接続対象 API 一覧（URL/契約/監査メタ）
- server-modernized 側の追加/修正ポイント整理
- UI 側の API 置換/追加実装チェックリスト

## 参照
- `web-client/src/features/reception/api.ts`
- `web-client/src/features/patients/api.ts`
- `web-client/src/features/charts/api.ts`
- `server-modernized/src/main/java/open/*/rest/*`
