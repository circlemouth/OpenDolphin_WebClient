# 01 マスタ提供範囲と経路統一

- 期間: 2026-01-26 09:00 - 2026-01-28 09:00 / 優先度: high / 緊急度: high
- 対象IC: IC-19 / IC-23
- RUN_ID: 20260125T005218Z
- YAML ID: `src/orca_preprod_issue_catalog_resolution_20260123/03_orca_master/01_マスタ提供範囲と経路統一.md`
- 前提ドキュメント:
  - `docs/preprod/implementation-issue-inventory/issue-catalog.md`
  - `docs/web-client/architecture/web-client-api-mapping.md`
  - `src/server_modernized_gap_20251221/02_orca08_etensu/ORCA-08_ETENSU_API連携.md`

## 目的
- ORCA マスタの提供範囲を明示し、未提供起因の `missingMaster` 発火を最小化する。
- `/orca/master` 経路を正規化し、`/api/orca/master`・`/orca/tensu/etensu` の経路不一致を解消する。

## 実装内容
- server-modernized:
  - `/api/orca/master/etensu` を `/orca/tensu/etensu` と同等の応答で提供。
  - `/orca/master/etensu` を正規経路として追加（`/orca/tensu/etensu` は互換経路として維持）。
- Web クライアント:
  - 点数/部位マスタ検索の参照経路を `/orca/master/etensu` に統一。
  - MSW ハンドラを `/orca/master/etensu` に対応（旧 `/orca/tensu/etensu` も維持）。

## 提供マスタ一覧（正規経路）

| 区分 | 正規経路 | 互換経路 | 主なクエリ | 備考 |
| --- | --- | --- | --- | --- |
| ORCA-05 薬効分類 | `/orca/master/generic-class` | `/api/orca/master/generic-class` | `keyword` `effective` `page` `size` | 検索系 (list) |
| ORCA-05 最低薬価 | `/orca/master/generic-price` | `/api/orca/master/generic-price` | `srycd` `effective` | 単一取得 (lookup) |
| ORCA-05 用法 | `/orca/master/youhou` | `/api/orca/master/youhou` | `keyword` `effective` | 検索系 (list) |
| ORCA-05 特材 | `/orca/master/material` | `/api/orca/master/material` | `keyword` `effective` | 検索系 (list) |
| ORCA-05 検査区分 | `/orca/master/kensa-sort` | `/api/orca/master/kensa-sort` | `keyword` `effective` | 検索系 (list) |
| ORCA-06 保険者 | `/orca/master/hokenja` | `/api/orca/master/hokenja` | `pref` `keyword` `effective` `page` `size` | 検索系 (list) |
| ORCA-06 住所 | `/orca/master/address` | `/api/orca/master/address` | `zip` `effective` | 単一取得 (lookup) |
| ORCA-08 電子点数表 | `/orca/master/etensu` | `/api/orca/master/etensu`, `/orca/tensu/etensu` | `keyword` `category` `asOf` `tensuVersion` `page` `size` | `/orca/tensu/etensu` を互換経路として維持 |

## 実装箇所
- `server-modernized/src/main/java/open/orca/rest/OrcaMasterResource.java`
- `web-client/src/features/charts/orderMasterSearchApi.ts`
- `web-client/src/mocks/handlers/orcaMaster.ts`
- `tests/charts/e2e-bodypart-search.spec.ts`

## 検証
- `mvn -pl server-modernized -Dtest=OrcaMasterResourceTest test`
  - 結果: PASS（警告: 既存の deprecation/LogManager 警告あり）

## 完了条件
- `missingMaster` が経路不一致によって不要に発火しない。
- `/orca/master/etensu` / `/api/orca/master/etensu` が 200 応答で取得できる。
