# 01 マスタ提供範囲と経路統一

- 期間: 2026-01-26 09:00 - 2026-01-28 09:00 / 優先度: high / 緊急度: high
- 対象IC: IC-19 / IC-23
- RUN_ID: 20260125T012205Z
- YAML ID: `src/orca_preprod_issue_catalog_resolution_20260123/03_orca_master/01_マスタ提供範囲と経路統一.md`
- 前提ドキュメント:
  - `docs/preprod/implementation-issue-inventory/issue-catalog-resolution-prerequisites-20260123.md`
  - `docs/preprod/implementation-issue-inventory/issue-catalog.md`
  - `docs/web-client/architecture/web-client-api-mapping.md`
  - `src/server_modernized_gap_20251221/02_orca08_etensu/ORCA-08_ETENSU_API連携.md`

## 目的
- ORCA マスタの提供範囲を明示し、未提供起因の `missingMaster` 発火を最小化する。
- `/orca/master` 経路を正規化し、`/api/orca/master`・`/orca/tensu/etensu` の経路不一致を解消する。

## 実装内容
- server-modernized:
  - `/orca/master/etensu` を正規経路として提供。
  - `/api/orca/master/etensu` と `/orca/tensu/etensu` は **301 リダイレクト** で `/orca/master/etensu` に統一。
- Web クライアント:
  - 点数/部位マスタ検索の参照経路を `/orca/master/etensu` に統一。
  - MSW ハンドラを `/orca/master/etensu` に対応（旧 `/orca/tensu/etensu` も維持）。

## 仕様確認メモ
- `issue-catalog.md` の IC-23 に「経路統一/リダイレクト」の記載があるため、互換経路は 301 で正規経路へ統一する方針を採用。

## 未提供マスタ再調査
- `docs/web-client/architecture/web-client-api-mapping.md` と IC-19/IC-23 を照合した結果、経路不一致は ETENSU のみ。
- ORCA-05/06 の各マスタは server-modernized 実装済みであり、追加実装は不要と判断。

## 提供マスタ一覧（正規経路）

| 区分 | 正規経路 | 互換経路 | 主なクエリ | 備考 |
| --- | --- | --- | --- | --- |
| ORCA-05 薬効分類 | `/orca/master/generic-class` | `/api/orca/master/generic-class` | `keyword` `effective` `page` `size` | 検索系 (list) |
| ORCA-05 最低薬価 | `/orca/master/generic-price` | `/api/orca/master/generic-price` | `srycd` `effective` | 単一取得 (lookup) |
| ORCA-05 用法 | `/orca/master/youhou` | `/api/orca/master/youhou` | `keyword` `effective` | 検索系 (list) |
| ORCA-05 特材 | `/orca/master/material` | `/api/orca/master/material` | `keyword` `effective` | 検索系 (list) |
| ORCA-05 検査区分 | `/orca/master/kensa-sort` | `/api/orca/master/kensa-sort` | `keyword` `effective` | 検索系 (list) |
| ORCA-06 保険者 | `/orca/master/hokenja` | `/api/orca/master/hokenja` | `pref` `keyword` `effective` `page` `size` | 検索系 (list) |
| ORCA-06 住所 | `/orca/master/address` | `/api/orca/master/address` | `zip` `effective` | 単一取得 (lookup) |
| ORCA-08 電子点数表 | `/orca/master/etensu` | `/api/orca/master/etensu`, `/orca/tensu/etensu` | `keyword` `category` `asOf` `tensuVersion` `page` `size` | 互換経路は 301 で正規経路へ統一 |

## 実装箇所
- `server-modernized/src/main/java/open/orca/rest/OrcaMasterResource.java`
- `server-modernized/src/main/java/open/orca/rest/OrcaResource.java`
- `web-client/src/features/charts/orderMasterSearchApi.ts`
- `web-client/src/mocks/handlers/orcaMaster.ts`
- `tests/charts/e2e-bodypart-search.spec.ts`

## 検証
- `mvn -pl server-modernized -Dtest=OrcaMasterResourceTest test`
  - 結果: PASS（警告: 既存の deprecation/LogManager 警告あり）
- フロント側テスト: 未実施（`setup-modernized-env.sh` による起動が必要なため、別途実施予定）

## 完了条件
- `missingMaster` が経路不一致によって不要に発火しない。
- `/orca/master/etensu` が 200 応答、`/api/orca/master/etensu`・`/orca/tensu/etensu` が 301 で統一される。
