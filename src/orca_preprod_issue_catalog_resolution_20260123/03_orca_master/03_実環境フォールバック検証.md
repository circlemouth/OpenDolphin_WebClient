# 03 実環境フォールバック検証

- RUN_ID: 20260126T000218Z
- 作業日: 2026-01-26
- YAML ID: src/orca_preprod_issue_catalog_resolution_20260123/03_orca_master/03_実環境フォールバック検証.md
- 対象IC: IC-24
- 前提ドキュメント:
  - docs/preprod/implementation-issue-inventory/issue-catalog-resolution-prerequisites-20260123.md

## 実ORCA接続方針（本ガント統一）
- 実ORCA検証は `docker/orca/jma-receipt-docker` のローカル WebORCA を使用する。
- 接続先: `http://localhost:8000/`
- 認証: Basic `ormaster` / `change_me`（証明書認証なし）
- コンテナ未起動時はサブモジュールで `docker compose up -d` を実行する。

## 実施内容
### 実環境（ローカル WebORCA）での missingMaster/fallbackUsed 表示確認
- **認証前提**: LogFilter が header 認証を無効化しているため、
  `Authorization: Basic` + `X-Facility-Id` を必須条件として実行した。
- **Basic 認証**: `dolphindev:1cc2f4c06fd32d0a6e2fa33f6e1c9164`（MD5）
- **Facility**: `X-Facility-Id=1.3.6.1.4.1.9414.10.1`

### 検証 1: 正常系（missingMaster=false / fallbackUsed=false）
- リクエスト: `/openDolphin/resources/api/orca/master/generic-class?keyword=1`
- 結果: HTTP 200
- 応答: `meta.missingMaster=false` / `meta.fallbackUsed=false` を確認
- 証跡: `artifacts/orca-preprod/20260126T000218Z/generic_class_basic_md5_http.txt`

### 検証 2: フォールバック系（missingMaster=true / fallbackUsed=true）
- リクエスト: `/openDolphin/resources/api/orca/master/generic-price?srycd=123456789`
  - 9 桁数値で未収載扱いとなるコードを使用
- 結果: HTTP 200
- 応答: `meta.missingMaster=true` / `meta.fallbackUsed=true` を確認
- 証跡: `artifacts/orca-preprod/20260126T000218Z/generic_price_missing_md5_http.txt`

## 再現条件メモ
- ORCA コンテナはサブモジュール由来（master 更新済み、他設定は未整備の可能性あり）。
- `server-modernized` は ORCA DB に接続できる状態で起動（ORCA_DB_* を設定）。
- LogFilter により `userName/password` ヘッダのみでは 401 となるため、
  **Basic + Facility ヘッダ必須**。

## 完了条件との対応
- 実環境（ローカル WebORCA）で `missingMaster/fallbackUsed` が **正常系/フォールバック系**ともに
  応答へ反映されることを確認し、証跡を保存した。
