# 04_証跡保存フォーマット統一

- RUN_ID: 20260124T131923Z
- 作業日: 2026-01-24
- 期間: 2026-01-24 09:00 - 2026-01-25 09:00
- 優先度: medium
- 緊急度: high
- YAML ID: src/orca_preprod_issue_catalog_resolution_20260123/09_test_data_validation/04_証跡保存フォーマット統一.md
- 対象IC: IC-66
- 作業ディレクトリ: /Users/Hayato/Documents/GitHub/OpenDolphin_WebClient/.worktrees/task-1769260682066-9f3e59
- 前提ドキュメント:
  - docs/preprod/implementation-issue-inventory/issue-catalog-resolution-prerequisites-20260123.md
  - src/validation/E2E_統合テスト実施.md
  - docs/DEVELOPMENT_STATUS.md

## 目的
- runId ベースの証跡保存ルールを統一し、検索コストを最小化する。
- 証跡の保存先・命名規約を明文化し、E2E/疎通/運用ログを横断的に追跡可能にする。

## 命名規約（標準）
### RUN_ID
- フォーマット: `YYYYMMDDThhmmssZ`（UTC）。
- 1 回の検証/実行/再現につき 1 RUN_ID を採番する。

### 保存先ルール（runId ディレクトリ統一）
- ルートは `artifacts/`。
- runId ごとにディレクトリを作成し、証跡を集約する。

```
artifacts/<domain>/<scenario>/<RUN_ID>/
```

- `<domain>` は対象領域（例: `validation`, `orca-connectivity`, `webclient`, `preprod`）。
- `<scenario>` は検証目的/シナリオ（例: `e2e`, `api-health`, `db-init`, `xml-proxy`）。
- `<RUN_ID>` 直下に `README.md` と証跡種別フォルダを配置する。

### 推奨サブディレクトリ
- `README.md`: 実行条件/結果/要点まとめ（必須）。
- `logs/`: テキスト/JSON/TSV ログ。
- `screenshots/`: 画面証跡。
- `httpdump/`: request/response/headers/status。
- `payloads/`: 送信 XML/JSON。
- `traces/`: traceId や performance trace。

### ファイル命名ルール
- `kebab-case` を基本とし、用途が判別できる短いスラッグを付与する。
- 例: `charts-send-guard.png`, `audit-events.json`, `system01dailyv2/response.json`。

## 例（標準フォーマット）
```
artifacts/validation/e2e/20260124T131923Z/README.md
artifacts/validation/e2e/20260124T131923Z/logs/audit-events.json
artifacts/validation/e2e/20260124T131923Z/screenshots/charts-send-guard.png
artifacts/orca-connectivity/20260124T131923Z/httpdump/system01dailyv2/response.json
artifacts/preprod/api-health/20260124T131923Z/logs/api-health.log
```

## 互換ルール（既存運用との整合）
- 既存の `logs/` / `screenshots/` 配下で RUN_ID プレフィックスを付ける運用は **互換運用** として残す。
- 新規作成の証跡は **runId ディレクトリ方式** を標準とする。
- 移行時は `find artifacts -name "<RUN_ID>*"` で収集し、runId ディレクトリへ集約する。

## マスキング
- 認証情報・証明書パス・患者情報などの機微情報は `<MASKED>` で伏せる。

## 完了条件チェック
- runId ディレクトリ方式の命名規約が明文化されている。
- `artifacts/<domain>/<scenario>/<RUN_ID>/` を採用する運用指針が用意されている。

## 更新ファイル
- src/orca_preprod_issue_catalog_resolution_20260123/09_test_data_validation/04_証跡保存フォーマット統一.md
