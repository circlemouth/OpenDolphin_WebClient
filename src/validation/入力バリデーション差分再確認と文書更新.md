# 入力バリデーション差分再確認と文書更新

## 目的
既存の差分メモ（diagnosisName 空文字チェック/エラーメッセージ伝播）について、現行コードの実装状況を再確認し、差分が解消されているかを明確化する。

## 実施情報
- RUN_ID: 20260105T055445Z
- 実施日: 2026-01-05
- 実施方法: コードレビュー（再検証ログの取得なし）

## 確認対象
- server-modernized
  - `server-modernized/src/main/java/open/dolphin/rest/orca/OrcaDiseaseResource.java`
  - `server-modernized/src/main/java/open/dolphin/rest/orca/OrcaOrderBundleResource.java`
  - `server-modernized/src/test/java/open/dolphin/rest/orca/OrcaDiseaseResourceTest.java`
- web-client
  - `web-client/src/features/charts/diseaseApi.ts`
  - `web-client/src/features/charts/orderBundleApi.ts`
  - `web-client/src/features/charts/DiagnosisEditPanel.tsx`
  - `web-client/src/features/charts/OrderBundleEditPanel.tsx`

## 再確認結果
### 病名（/orca/disease）
- `diagnosisName` の空文字/未指定は create/update で 400 `invalid_request` に統一されている。
  - `field=diagnosisName` / `message=diagnosisName is required` を返却。
  - delete は `diagnosisName` 空文字でも許容（更新/削除で挙動が分離）。
- バリデーション拒否時の監査イベントは `ORCA_DISEASE_MUTATION` に `validationError=true` と `field=diagnosisName` を含めて記録される。
- 既存メモの「diagnosisName 空文字は server 側未実装」は **現行コードでは解消** している。

### 処方/オーダー束（/orca/order/bundles）
- 必須/値チェック（patientId/operations/operation/entity/documentId）は現行実装でも 400 で統一されている。
- 差分メモに記載した挙動から変更はない（現行の期待通り）。

### メッセージ伝播（web-client）
- disease/order bundle の API は `message` を優先し、無い場合に `apiResultMessage` をフォールバックする実装。
- UI（DiagnosisEditPanel / OrderBundleEditPanel）は `result.message` を利用し、バリデーションエラー文言が表示可能。
- 既存メモの「apiResultMessage のみ参照で文言が露出しない」は **現行コードでは解消** している。

## 差分結論
- 主要差分（diagnosisName 空文字チェック / メッセージ伝播）は **解消済み**。
- 追加の仕様差分は確認されず、再検証ログの取得は不要と判断。

## 再検証ログ
- コード確認のみのため、追加のログ取得なし。
- 実機ログが必要な場合は `src/validation/入力バリデーション妥当性確認.md` のログ一式に追記する。
