# 51 アクセシビリティ自動検査と手動監査（RUN_ID=`20251217T212939Z`）

## ゴール
- Charts 外来シェル（ActionBar / ToneBanner）の aria-live・role・フォーカス順で重大な a11y 違反をゼロにする。
- スクリーンリーダー利用者に「操作不能理由（missingMaster/fallback/lock）」と Tone を確実に伝える。
- 結果を回帰テストに組み込み、今後の UI 変更で逸脱しないようにする。

## 自動検査（axe）
- 手段: Vitest + `axe` (`vitest-axe`) を用いたコンポーネント単体スキャン。
- テストファイル: `web-client/src/features/charts/__tests__/chartsAccessibility.test.tsx`
- コマンド: `cd web-client && npm test`
- カバー範囲:
  - `ChartsActionBar` missingMaster=true（送信ブロック時の `aria-describedby` / `role=note` / `aria-live=assertive`）
  - `ChartsActionBar` 通常状態（ボタンのフォーカス順を userEvent.tab() で検証）
  - `ToneBanner` warning トーン（`role=alert` / `aria-live=assertive` / data-run-id）
- 結果: 3 シナリオすべて axe 重大違反 0 件。

## 手動監査メモ
- キーボード操作: ボタンは視覚順（終了→送信→印刷→ドラフト→キャンセル）でフォーカス遷移。ロック解除ボタンは disabled でタブ停止しない。
- 操作不能理由: missingMaster/fallback 時は `ORCA 送信` が `aria-disabled=true` + `aria-describedby=charts-actions-blocked`。ガード文言（role="note" / aria-live="assertive"）にブロック理由を明記。
- ToneBanner: role="alert" で tonePrefix + 本文 + patientId/receptionId などを 1 文で連結。警告/エラーは `aria-live=assertive`。

## 残リスクとフォローアップ
- 実ブラウザ + スクリーンリーダー（VoiceOver/NVDA）で `/charts` 画面を通し確認する際は本 RUN_ID を使用し、Toast と ToneBanner が同時に発火した場合の読み上げ競合有無を確認する。
- Page 全体の axe スキャン（MSW でチャートデータを埋めた状態）を Playwright に組み込むタスクを追加する。
- missingMaster/fallback が OFF に戻った際の runId carry-over と aria-live 競合を回帰テストへ拡張する（次版で userEvent + axe をページスコープに広げる）。

## 証跡
- ログ: `docs/web-client/planning/phase2/logs/20251217T212939Z-charts-a11y.md`
- テスト: `web-client/src/features/charts/__tests__/chartsAccessibility.test.tsx`
