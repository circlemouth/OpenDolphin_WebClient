# module_json テストとビルド検証

- RUN_ID: `20251214T084510Z`
- 期間: 2025-12-20 09:00 〜 2025-12-21 09:00 (JST) / 優先度: medium / 緊急度: medium / エージェント: gemini cli
- YAML ID: `src/modernization/module_json/テストとビルド検証.md`

## 目的
- module_json モダナイズの JSON 保存/復元が正常経路で動くことを単体レベルで確認する。
- モダナイズ環境のビルドが通ることを Maven コンパイルで検証する。
- ローカル msw/modernized 環境で smoke を試行し、現状の到達点と課題を記録する。

## 参照チェーン
1. `AGENTS.md`
2. `docs/web-client/README.md`
3. `docs/server-modernization/phase2/INDEX.md`
4. `docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md`
5. `src/modernization/module_json/キックオフ_RUN_ID採番.md`
6. 本ドキュメント

## 実施内容
- ModuleJsonConverter の beanJson 正常系をカバーする JUnit4 テストを追加（`common/src/test/java/open/dolphin/infomodel/ModuleJsonConverterTest.java`）。Map payload を JSON 化し `decode` で元データを復元できることを確認。
- `mvn -pl common test` を実行し、converter 含む単体テストが成功することを確認。
- `mvn -pl server-modernized -am -DskipTests compile` を実行し、モダナイズ版サーバーまでのコンパイルが通ることを確認。
- Vite dev サーバー（msw ON, `npm --prefix web-client run dev -- --host --port 4173 --strictPort`）を立ち上げ、`RUN_ID=20251214T084510Z npm run e2e:smoke -- --reporter=line --workers=1 --timeout=60000` を試行。

## 結果
- 単体テスト/コンパイル: いずれも成功。新規テストで beanJson 経路の JSON 保存・復元が正常に動作することを確認。
- smoke: Playwright 実行時にランタイムエラー `Cannot assign to read only property '__REACT_DEVTOOLS_GLOBAL_HOOK__' of object '#<Window>'` が発生し失敗（MSW stub までは動作ログを取得）。アーティファクト: `test-results/tests-e2e-orca-master-brid-bc038-dge-ORCA-master-audit-smoke/{test-failed-1.png,trace.zip}`。

## フォローアップ
- smoke 失敗は React DevTools hook への書き込みが原因。フィクスチャ初期化で hook を柔軟に扱うか、dev サーバー設定を見直す必要あり。次回 RUN で再試行する。
- 本 RUN_ID を `docs/web-client/planning/phase2/DOC_STATUS.md` 備考に追記し、証跡ログを更新する。
