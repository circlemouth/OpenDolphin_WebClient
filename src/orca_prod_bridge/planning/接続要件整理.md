# 接続要件整理（RUN_ID=20251210T061133Z）
- 対象期間: 2025-12-10 09:00 - 2025-12-11 09:00（JST）
- 目的: WebORCA 本番（ORCAcertification 配下の証明書を用いる経路）の接続要件を棚卸しし、必要な証跡ポイントと参照ドキュメントを明示する。

## 参照元
- `AGENTS.md` / `docs/web-client/README.md` / `docs/server-modernization/phase2/INDEX.md` / `docs/managerdocs/PHASE2_MANAGER_ASSIGNMENT_OVERVIEW.md`
- `docs/managerdocs/PHASE2_ORCA_CONNECTIVITY_MANAGER_CHECKLIST.md`
- `docs/server-modernization/phase2/operations/ORCA_CONNECTIVITY_VALIDATION.md`
- `ORCAcertification/README_PASSPHRASE.md`
- `docs/web-client/planning/phase2/DOC_STATUS.md` （#46 行に ORCA_CERTIFICATION_ONLY.md が Active として登録）

## ORCAcertification 配下の利用範囲と禁止事項
- 含まれるもの: `103867__JP_u00001294_client3948.p12`（PKCS#12）、パスフレーズ・Basic 認証情報が記載されたテキスト。いずれも `.gitignore` 済みでリポジトリ外秘。
- 利用目的: WebORCA 本番 (`https://weborca.cloud.orcamo.jp`) への疎通確認や API 実行。`ORCAcertification/README_PASSPHRASE.md` の手順で `ORCA_PROD_CERT*` / `ORCA_PROD_BASIC*` を環境変数に読み込み、`curl --cert-type P12 ... "${API_PATH}"` で実行する。
- 禁止事項/ガード:
  - 証明書・認証情報の平文コピーや権限緩和（600 未満）を行わない。作業後は `unset ORCA_PROD_*` を必須とする。
  - `ORCAcertification/` 配下の値をドキュメント・ログに生で記載しない（`<MASKED>` で記録）。
  - `curl --cert-type P12` を伴う実行は RUN_ID を採番し、後述の証跡配置へ保存した上でログ化する。無採番での試行は禁止。
  - `ORCA_CERTIFICATION_ONLY.md` が現行ルールとされているが、リポジトリにファイルが存在しないため内容不明。復旧または指示確認が必要。

## RUN_ID 記録ポイント
- 発行例（今回）: `RUN_ID=20251210T061133Z`
- 保存先（実行時に作成）:
  - `docs/server-modernization/phase2/operations/logs/<RUN_ID>-orca-prod-bridge.md`（実施記録・判断）
  - `artifacts/orca-connectivity/<RUN_ID>/`（`httpdump/`, `trace/`, `data-check/` など; 証跡は PHI をマスク）
  - `docs/web-client/planning/phase2/DOC_STATUS.md` #46 行の備考に RUN_ID/証跡パスを追記
- サーバー設定変更を伴う場合は `ops/shared/docker/custom.properties` 等の差分と `/serverinfo/claim/conn` 結果を同 RUN_ID 配下へ保存する。

## webORCA 本番接続のゴール・入出力・ログ位置
- ゴール: Web クライアントまたは CLI から WebORCA 本番（ORCAcertification）と疎通し、必要 API の HTTP 成功・`Api_Result` を確認して証跡化する。Mac-dev や Trial への接続は行わない。
- 必要入力:
  - 証明書: `ORCAcertification/103867__JP_u00001294_client3948.p12` とパスフレーズ（環境変数化）。
  - Basic: ORCAMO ID / API キー（環境変数化）。
  - エンドポイント例: `https://weborca.cloud.orcamo.jp/api/api01rv2/acceptlstv2?class=01` など。API パスは実施計画に応じて指定。
  - サーバー設定: `claim.host=weborca.cloud.orcamo.jp`, `claim.send.port=443`, `claim.scheme=https`, `claim.conn=server`, `claim.send.encoding=MS932`（モダナイズ版側に反映する場合のみ）。
- 期待出力/保存:
  - HTTP ヘッダー・レスポンス（PHI を `jq` 等で除去または `<MASKED>`）。
  - `--trace-ascii` の通信ログ。
  - 実行コマンド（認証値はマスク）、使用した payload、実行環境情報。
  - 既存例: `artifacts/orca-connectivity/20251113TorcaProdCertZ1/weborca-prod/acceptlstv2.{headers,json}`（参照のみ）。

## 参照チェーンと更新対象ドキュメント
- 参照チェーン（作業前確認順）: `AGENTS.md` → `docs/web-client/README.md` → `docs/server-modernization/phase2/INDEX.md` → `docs/managerdocs/PHASE2_MANAGER_ASSIGNMENT_OVERVIEW.md` → `docs/managerdocs/PHASE2_ORCA_CONNECTIVITY_MANAGER_CHECKLIST.md`
- 更新対象:
  - 本ファイル（計画）と、実行時の `docs/server-modernization/phase2/operations/logs/<RUN_ID>-...`
  - `docs/web-client/planning/phase2/DOC_STATUS.md` #46 行（RUN_ID/証跡パス追記）
  - 必要に応じて `PHASE2_ORCA_CONNECTIVITY_MANAGER_CHECKLIST.md` のチェック項目更新

## 未解決/要フォロー
- `docs/server-modernization/phase2/operations/ORCA_CERTIFICATION_ONLY.md` および `docs/server-modernization/phase2/operations/logs/20251203T134014Z-orcacertification-only.md` がリポジトリ上に存在せず、現行ポリシー詳細が確認できない。復旧依頼または最新ポリシーの明示が必要。
- WebORCA 本番向け cURL 実行を行う場合、外部ネットワーク可否と証跡保存パスの承認を事前に取る。RUN_ID 未設定のまま実行しない。
