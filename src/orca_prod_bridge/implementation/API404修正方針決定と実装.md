# API404 修正方針決定と実装（RUN_ID=20251210T234513Z）
- 対象期間: 2025-12-14 09:00 - 12-16 09:00 JST
- 参照チェーン: AGENTS.md → docs/web-client/README.md → docs/server-modernization/phase2/INDEX.md → docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md
- 証跡: `docs/server-modernization/phase2/operations/logs/20251210T234513Z-api404-fix.md`

## 背景
- `/api01rv2/acceptlstv2` への POST が server-modernized で 404 になる。原因は REST リソース未登録および `scripts/orca_prod_bridge.sh` デフォルトパスが `/api/api01rv2/...` と二重 `api` だったこと。
- 既存ログ（RUN_ID=`20251210T135943Z` など）で 401/404 が混在し、ルーティング欠落による 404 を優先解消する必要があった。

## 決定方針
1. server-modernized に acceptlstv2 スタブを追加し、`/api01rv2/acceptlstv2` と誤経路 `/api/api01rv2/acceptlstv2` の両方を 200 応答へ吸収する。
2. webORCA ブリッジスクリプトのデフォルト API パスを `/api01rv2/acceptlstv2?class=01` へ訂正し、二重 `api` をデフォルトから排除する。
3. Audit/trace を最小限保持（X-Run-Id ヘッダー + SessionAuditDispatcher）し、将来の本番中継へ発展させる際の足がかりとする。

## 実装サマリ
- 新リソース `OrcaAcceptanceListResource`（RUN_ID=`20251210T234513Z`）を追加し、RESTEasy 登録。スタブ payload は `orca/stub/05_acceptlstv2_response.sample.xml`（Api_Result=0000）を返却。
- `OrcaEndpoint` に ACCEPTANCE_LIST を追加し、スタブ読み出しを共通化。
- `scripts/orca_prod_bridge.sh` のデフォルト API パスと help 表示を `/api01rv2/acceptlstv2?class=01` に修正。
- 互換ルートと Audit を検証する単体テスト `OrcaAcceptanceListResourceTest` を追加。

## 確認結果
- `mvn -pl server-modernized -DskipTests compile` でコンパイル通過。
- `OrcaAcceptanceListResourceTest` にて `/api01rv2/acceptlstv2` / `/api/api01rv2/acceptlstv2` の両ルートが 200/`application/xml` を返し、Audit に runId・traceId・requestId を記録することを確認。

## 残課題
- 現時点ではスタブのみ。本番 ORCA への pass-through を行う場合は `OrcaTransport` の実装追加と証跡ポリシー更新が必要。
- acceptlstv2 以外の ORCA 生 API も必要になれば同様のルーティング整備が必要。優先度は今後の接続要件に応じて決定。
