# 接続スクリプト実装（RUN_ID=20251210T115327Z）
- 期間: 2025-12-12 09:00 - 2025-12-14 09:00 JST / YAML ID: `src/orca_prod_bridge/implementation/接続スクリプト実装.md`
- 目的: webORCA 本番（ORCAcertification）向けの接続スクリプトを実装し、RUN_ID 付きで証跡/log を自動生成する。接続先が本番以外の場合はフェイルセーフで中断させる。
- 参照チェーン: AGENTS.md → docs/web-client/README.md → docs/server-modernization/phase2/INDEX.md → docs/managerdocs/PHASE2_MANAGER_ASSIGNMENT_OVERVIEW.md → docs/managerdocs/PHASE2_ORCA_CONNECTIVITY_MANAGER_CHECKLIST.md

## 成果物
- `scripts/orca_prod_bridge.sh`
  - RUN_ID 必須（env or `--run-id`、`^[0-9]{8}T[0-9]{6}Z$` 検証）。
  - 認証情報は環境変数必須 (`ORCA_PROD_CERT_PATH/ORCA_PROD_CERT_PASS/ORCA_PROD_BASIC_USER/ORCA_PROD_BASIC_KEY`)。値は `<MASKED>` で存在チェックのみ。
  - デフォルト接続先 `https://weborca.cloud.orcamo.jp:443` から外れる場合は `--force-target <host>` 指定がない限り abort。確認プロンプトは `--yes` でスキップ可。
  - `umask 077` で `docs/server-modernization/phase2/operations/logs/<RUN_ID>-orca-prod-bridge.md` テンプレと `artifacts/orca-connectivity/<RUN_ID>/{httpdump,trace,data-check}/` を自動生成し、curl 証跡の出力先を固定。
  - オプション: `--api-path`（デフォルト `/api/api01rv2/acceptlstv2?class=01`）、`--method`（デフォルト POST）、`--payload <file>`、`--dry-run`、`--yes`。
- 実装ログ: `docs/server-modernization/phase2/operations/logs/20251210T115327Z-orca-prod-bridge.md`（構文チェックのみ、接続試行なし）。

## 実装メモ
- 実行時の確認出力に認証値は含めず、存在フラグのみ表示。curl コマンドは `--cert-type P12 --cert "<PATH>:<MASKED>" -u "<MASKED>:<MASKED>"` で構成し、PHI を含むレスポンスは `data-check/` 直下に保存する前提で別途マスクが必要。
- `ORCA_CERTIFICATION_ONLY.md` が欠損しているため、接続運用ルールの参照は別途復旧された最新ファイルを前提とする。
- 実行前に `RUN_ID` の統一と `unset ORCA_PROD_*`（実行後）を周知すること。`bash -n scripts/orca_prod_bridge.sh` で構文検証済み、接続試行は未実施。

## 使い方例（安全確認用）
```bash
# dry-run でログ/証跡ディレクトリのみ生成（curl 実行なし）
RUN_ID=20251210T115327Z \
ORCA_PROD_CERT_PATH=/path/to/ORCAcertification/103867__JP_u00001294_client3948.p12 \
ORCA_PROD_CERT_PASS=****** \
ORCA_PROD_BASIC_USER=****** \
ORCA_PROD_BASIC_KEY=****** \
./scripts/orca_prod_bridge.sh --api-path "/api/api01rv2/acceptlstv2?class=01" --dry-run
```
