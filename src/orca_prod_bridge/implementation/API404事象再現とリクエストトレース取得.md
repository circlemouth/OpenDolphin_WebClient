# API404事象再現とリクエストトレース取得（RUN_ID=20251210T135943Z）
- 期間: 2025-12-13 09:00 - 2025-12-14 09:00 JST（本稿は 2025-12-10 の事前再現ログ）
- 参照チェーン: `AGENTS.md` → `docs/web-client/README.md` → `docs/server-modernization/phase2/INDEX.md` → `docs/managerdocs/PHASE2_MANAGER_ASSIGNMENT_OVERVIEW.md` → `docs/managerdocs/PHASE2_ORCA_CONNECTIVITY_MANAGER_CHECKLIST.md`
- 証跡: `docs/server-modernization/phase2/operations/logs/20251210T135943Z-api404-trace.md`（本 RUN のまとめ）、`docs/server-modernization/phase2/operations/logs/20251210T135943Z-*.log` 一式

## 目的
server-modernized を Phase2 標準手順で起動した上で、`/api01rv2/acceptlstv2?class=01` に対する 404 再発条件とリクエストトレースを採取する。Vite 開発プロキシ経由での到達経路とアプリログを突合し、12/13-12/14 本番接続ウィンドウ前に事象を固定化する。

## 実施概要（2025-12-10 事前再現）
1. `WEB_CLIENT_MODE=npm VITE_DISABLE_MSW=1 VITE_DEV_PROXY_TARGET=http://localhost:9080/openDolphin/resources` で `./setup-modernized-env.sh` を実行。Vite dev log 出力先を `docs/server-modernization/phase2/operations/logs/20251210T135943Z-vite-dev.log` に設定。
2. Vite dev サーバー経由で `/api01rv2/acceptlstv2?class=01` へ POST を 2 回送信。  
   - 認証ヘッダー無: 401（traceId=`083c5eb8-ff67-4f1b-a37b-39ed3cc3518c`）。  
   - 認証ヘッダー有（`userName/password/clientUUID/X-Facility-Id` は `<MASKED_*>` 保存）: 404（`x-trace-id=00e60f7d-3a59-4de1-8a5b-66893a9616c4`）。ボディ空。
3. `server.log` / `server-access.log` に 401→REST_UNAUTHORIZED_GUARD と 404→REST_ERROR_RESPONSE の JMS 監査出力を確認。外部 ORCA への通信は発生していない。
4. 証跡を operations/logs 配下に保存し、マスクを適用。終了後 `docker compose ... down` と dev server 停止を実施。

## 主要証跡
- `docs/server-modernization/phase2/operations/logs/20251210T135943Z-api404-trace.md`（概要・コマンド・観測結果）
- `docs/server-modernization/phase2/operations/logs/20251210T135943Z-vite-dev.log`（Vite dev サーバー出力）
- `docs/server-modernization/phase2/operations/logs/20251210T135943Z-curl-trace.txt` / `...-request-headers.txt` / `...-response.txt`（401 ケース）
- `docs/server-modernization/phase2/operations/logs/20251210T135943Z-curl-auth-trace.txt` / `...-request-auth-headers.txt` / `...-response-auth.txt`（404 ケース、ヘッダー値マスク済み）
- `docs/server-modernization/phase2/operations/logs/20251210T135943Z-server.log` / `...-server-access.log`（アプリ・アクセスログ抜粋）
- `docs/server-modernization/phase2/operations/logs/20251210T135943Z-env.txt`（実行時の主要環境変数）

## 今後の対応（12/13-12/14 ウィンドウ内）
- 同 RUN_ID を継続し、webORCA 本番接続時も同エンドポイントで 404/401/405 のどれが再現するかを突合。`ORCA_CERTIFICATION_ONLY.md` のポリシーに従い、本番資格情報は `<MASKED>` で記録する。
- `web.xml` の `resteasy.resources` などリソース登録漏れを確認し、解消策が判明した場合は server-modernized 側の修正ログを同 RUN_ID で追記する。
- DOC_STATUS 備考および manager checklist へ本 RUN_ID と証跡パスを反映する。
