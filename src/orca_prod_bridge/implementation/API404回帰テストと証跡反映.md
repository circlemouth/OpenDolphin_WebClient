# API404 回帰テストと証跡反映（RUN_ID=20251211T000937Z）
- 期間: 2025-12-15 09:00 - 2025-12-16 09:00 JST
- 参照チェーン: AGENTS.md → docs/web-client/README.md → docs/server-modernization/phase2/INDEX.md → docs/managerdocs/PHASE2_MANAGER_ASSIGNMENT_OVERVIEW.md → docs/managerdocs/PHASE2_ORCA_CONNECTIVITY_MANAGER_CHECKLIST.md
- 証跡: `docs/server-modernization/phase2/operations/logs/20251211T000937Z-api404-regression.md`

## 目的
`/api01rv2/acceptlstv2` 404 修正後の server-modernized を再起動し、ORCA_CONNECTIVITY_VALIDATION / ORCA_API_STATUS に沿って 200 応答を確認する。結果を DOC_STATUS と証跡ログへ反映し、次の Web クライアント連携確認タスクへ引き継ぐ。

## 実施結果（2025-12-11 事前実行）
- setup-modernized-env.sh（WEB_CLIENT_MODE=docker）でモダナイズ版サーバーを起動。旧イメージのままでは 404 が再現したため、`docker compose ... build server-modernized-dev` で最新 WAR を再配置。
- 再ビルド後、以下 2 ルートがともに **HTTP 200 / X-Run-Id=20251210T234513Z** を返却、スタブ XML（Api_Result=0000）を確認。外部 ORCA には未接続。  
  - `POST /openDolphin/resources/api01rv2/acceptlstv2?class=01`  
  - `POST /openDolphin/resources/api/api01rv2/acceptlstv2?class=01`
- 認証ヘッダーは `userName=1.3.6.1.4.1.9414.10.1:dolphindev` / `password=MD5(dolphindev)` / `clientUUID=devclient` / `X-Facility-Id=1.3.6.1.4.1.9414.10.1` を使用。

## 次ステップ（12/15-12/16 実施窓）
1) 同 RUN_ID で server-modernized を再起動（古いコンテナが残っていないか確認）。  
2) 上記 2 ルートを再実行し、200 維持を確認。必要に応じて ORCA_CERTIFICATION_ONLY.md に従い外部接続を追加実施。  
3) `operations/logs/20251211T000937Z-api404-regression.md` に追記し、`ORCA_API_STATUS.md` と `DOC_STATUS.md` の RUN_ID 行へ「API404 解消」を反映。  
4) 失敗時は旧イメージ起動・WAR 未更新を最優先で除外し、HTTP ステータス/traceId を証跡へ記録してエスカレーションする。

## リスク・留意点
- 旧イメージが起動すると 404 が再発するため、`docker compose build` 後のコンテナを確実に再起動すること。
- 本番 ORCA へ接続する場合は PKCS#12 / Basic 情報をマスクし、`operations/logs/<RUN_ID>-*.md` と `artifacts/orca-connectivity/<RUN_ID>/` へ証跡を保存する。Python スクリプトの実行は禁止。
