# バリデーション・スキーマ整備（predeploy readiness）

- RUN_ID: `20251220T173000Z`
- 期間: 2025-12-25 09:00 - 2025-12-26 09:00 (JST)
- 優先度: high / 緊急度: medium
- YAML ID: `src/predeploy_readiness/02_feature_implementation/バリデーション・スキーマ整備.md`

## 目的
- API の入力/出力スキーマ整合性を確保し、バリデーションエラーの判定を一貫させる。
- バリデーションエラーの共通フォーマットを定義し、UI/監査ログ/運用ログで同じ判断軸を持てるようにする。

## 参照ソース（現行タスクの根拠）
- `docs/DEVELOPMENT_STATUS.md`

## 対応内容
- REST エラーレスポンスへ `code` を追加し、`error` と同値のコードを常時返す。
- 400/422 で `validationError=true` を既定で付与し、入力エラー判定を共通化する。
- ORCA Master 系のエラーレスポンスに `correlationId` を追加し、traceId と整合させる。
- ORCA wrapper 系のバリデーションエラーで `field` と `validationError` を明示する。
- Stamp API の入力エラーにも `validationError` を付与し、共通形式へ寄せる。

## 変更ファイル
- `server-modernized/src/main/java/open/dolphin/rest/AbstractResource.java`
- `server-modernized/src/main/java/open/dolphin/rest/orca/AbstractOrcaRestResource.java`
- `server-modernized/src/main/java/open/orca/rest/OrcaMasterResource.java`
- `server-modernized/src/main/java/open/dolphin/rest/StampResource.java`

## 留意点
- Phase2 ドキュメントは Legacy/Archive のため更新しない。
- ORCA 実環境接続や Stage/Preview 検証は本タスクでは未実施。
