# エラーハンドリング・リトライ整備（predeploy readiness）

- RUN_ID: `20251220T182500Z`
- 期間: 2025-12-26 09:00 - 2025-12-27 09:00 (JST)
- 優先度: medium / 緊急度: medium
- YAML ID: `src/predeploy_readiness/02_feature_implementation/エラーハンドリング・リトライ整備.md`

## 目的
- サーバー側の統一エラーハンドリングと再試行戦略を確立する。
- 既存クライアント（Charts 規約・Reception 等）の期待値と整合させる。

## 対応内容
- REST 例外の統一マッピングを追加し、JSON エラー形式を **全例外で標準化**。
- 5xx / タイムアウト / 上流断のケースは `retryable=true` を付与し、UI 側の再試行判断と整合させる。
- ORCA wrapper 由来の例外を `502 Bad Gateway` に正規化し、`orca_gateway_error` を返却する。
- 既存の `WebApplicationException` は、JSON エラーを持つ場合はそのまま返し、**非 JSON 応答時のみ**共通形式に変換する。

## 変更ファイル
- `server-modernized/src/main/java/open/dolphin/rest/RestExceptionMapper.java`
- `src/predeploy_readiness/02_feature_implementation/エラーハンドリング・リトライ整備.md`（本ドキュメント）

## 期待されるレスポンス例（共通）
- `error` / `code` / `message` / `status` / `traceId` を共通で返す。
- `retryable=true` は 408 / 429 / 500 / 502 / 503 / 504 のみ付与。

## 留意点
- Phase2 ドキュメントは Legacy/Archive のため更新しない。
- ORCA 実環境接続や Stage/Preview 検証は本タスクでは未実施。
