# 15 改修前提ドキュメント整備

RUN_ID: 20251229T084852Z

## 目的
- 差分判定後の Web 改修タスク（P0/P1/P2）に必要な前提情報を一箇所に集約し、実装前の認識ズレを防ぐ。

## 参照（正本）
- docs/DEVELOPMENT_STATUS.md
- src/order_input_gap_analysis/09_差分マトリクス統合.md
- src/order_input_gap_analysis/12_差分判定_修正区分.md

## 改修対象の判断基準（要約）
- UI/入力補助/操作フロー起因の差分は Web クライアント改修対象。
- 既存の server-modernized API がある場合はサーバー改修不要。
- readOnly/missingMaster/fallbackUsed など Web の安全ガードは優位性として維持。

## Web 改修の前提条件
- Web の保存フローは `/orca/order/bundles` を継続利用する。
- マスタ検索・部位検索・用法検索などは server-modernized のマスタ API を利用する前提で UI を設計する。
- 監査ログの `runId`/`screen`/`operationPhase` の付与は既存規約に合わせる。
- 既存の編集ブロック条件（readOnly/missingMaster/fallbackUsed）は維持したまま UI を追加する。

## 既存 API 参照メモ（server-modernized）
- `/orca/master/*` 系（用法/材料/点数/検査ソートなど）を前提に入力補助を設計する。
- `/orca/order/bundles` の create/update/delete を継続利用する。
- スタンプ生成は `/stamp/{param}` が存在するが、Web UI 実装方針の決定が必要。

## 改修タスク別の前提整理（P0/P1/P2）

### P0
- 16_P0改修_必須判定バリデーション.md
  - 必須項目定義（entity 別）と UI メッセージの統一ルールを先に確定する。
  - readOnly/missingMaster/fallbackUsed の判定順序を整理する。
- 17_P0改修_マスタ検索UI.md
  - `/orca/master/*` の検索スキーマ（検索条件・戻り形式・表示項目）を確認する。
  - 検索結果テーブルのカラム/選択反映の仕様を整理する。
- 18_P0改修_展開導線.md
  - 展開/展開継続の「カルテ反映定義」を合意し、保存との差分を明文化する。
  - operationPhase の命名規約を整理する。
- 19_P0改修_スタンプ導線.md
  - `/stamp/*` の利用可否（認可/保存形式/対象データ）を確認する。
  - スタンプ保存 UI の必須項目（名称/分類/対象）を定義する。
- 20_P0改修_文書作成フォーム.md
  - 文書作成 API の有無と必須項目の定義を確認する。
  - P0 で対象とする文書種別（紹介状/診断書/返信書）の要件を整理する。

### P1
- 21_P1改修_DnD行操作.md
  - 既存テーブル構造と DnD ライブラリ選定を整理する。
  - 全クリア/行削除の確認導線と監査ログ方針を決める。
- 22_P1改修_注射放射線コメント材料.md
  - 注射「手技料なし」フラグの payload 有無を確認する。
  - 放射線部位/材料/コメントコードのマスタ API を確認する。
- 23_P1改修_文書テンプレ印刷.md
  - 文書テンプレ取得/印刷 API の有無と仕様を確認する。
  - 印刷/プレビュー導線の監査ログ方針を整理する。

### P2
- 24_P2改修_リハビリ予約連携.md
  - 予約/スケジュール API の有無と利用可否を確認する。
  - 実装不可時の代替運用（手入力/別システム）の文言を整理する。

## 非対象（今回の改修に含めない）
- 旧来版のカルテ展開処理を完全再現するサーバー拡張。
- ORCA 実環境での接続検証（別手順で実施）。
- Legacy `client/` および `server/` への変更。

## 改修タスク化の入力テンプレ（P0/P1/P2共通）
- 対象画面/機能:
- 旧来版の挙動（差分要約）:
- Web 目標挙動（実装範囲）:
- 依存 API/データ:
- 監査/ログ要件:
- ブロッカー:
- テスト観点:
