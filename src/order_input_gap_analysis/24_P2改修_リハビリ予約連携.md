# 24 P2 改修：リハビリ予約/スケジュール連携

RUN_ID: 20251229T081044Z

- 目的: リハビリ予約/スケジュール連携 UI の可否を判断し、代替運用を整理する。
- 対象: リハビリオーダー入力（Charts 右パネル）。

## 調査結果
- Web クライアントのリハビリオーダー入力は generalOrder の汎用フォームのみで、予約/スケジュールを操作する UI は存在しない。
  - 参照: src/order_input_gap_analysis/07_WEB_リハビリオーダー入力調査.md
  - 参照: web-client/src/features/charts/OrderBundleEditPanel.tsx
- 予約/スケジュール専用のルート・画面は Web クライアントに未実装（ナビゲーションに予約/スケジュール項目がない）。
  - 参照: web-client/src/AppRouter.tsx
  - 参照: src/orca_prod_bridge/implementation/WEBクライアント連携確認.md
- 予約一覧（参照専用）は `/orca/appointments/list/*` を用いて Reception/Charts で取得しているが、登録/変更 API は UI に紐づいていない。
  - 参照: web-client/src/features/reception/api.ts
  - 参照: web-client/src/features/charts/pages/ChartsPage.tsx
- server-modernized には legacy 互換の `/schedule/pvt`・`/appo` や ORCA 予約 API ラッパーが記載されているが、Web クライアントから利用する実装・実測は未確定。
  - 参照: docs/server-modernization/MODERNIZED_REST_API_INVENTORY.md
  - 参照: src/server_modernized_gap_20251221/06_server_ops_required/Webクライアント_MSW無効化検証.md

## 実装可否の判断
- **現行 Web クライアントではリハビリ予約/スケジュール連携は実装不可**。
  - 理由: 予約/スケジュールの UI が存在しない、予約登録/変更 API の Web クライアント実装が存在しない。
  - 補足: 予約一覧取得 API はあるが、リハビリオーダー入力パネルとは独立しており連携されていない。

## 代替運用（必須）
- 予約登録・変更は **Reception 画面（予約タブ）** もしくは既存の予約システム/ORCA 側で実施する。
- リハビリオーダー入力では以下を **手入力運用** とする。
  - メモ欄に「希望日時 / 担当者 / 部位」などを記載。
  - 必要に応じて項目名に部位・指示を追記する。
- 予約変更が必要な場合は、Charts から Reception へ遷移して予約操作を行う（予約導線がない環境では別システムに委譲）。

## UI 誘導文言（案）
- 「リハビリ予約はこの画面から連携できません。予約の登録・変更は受付画面の『予約』タブ（または既存の予約システム）で実施し、必要に応じてメモ欄へ希望日時・担当者・部位を記載してください。」

## 監査ログ方針
- 代替運用中は、**リハビリオーダーの保存/更新/削除**の監査ログのみを残す（既存の /orca/order/bundles 監査に統合）。
- 将来の予約連携実装時は以下を追加で記録する方針。
  - appointmentId / patientId / 操作種別（create/update/cancel）/ runId / screen=charts
  - 予約変更は Reception 画面の監査イベントとも整合させる。

## 依存/前提（server-modernized タスク候補）
- 予約登録/変更 API の提供可否（ORCA 予約 API ラッパーの実運用接続とレスポンス確定）。
- `/orca/appointments/list/*` の本番実装可否と Web での導線整備。
- 予約/スケジュール UI を Charts 右パネルに組み込む場合の設計・権限制御・監査イベント定義。

## テスト
- リハビリオーダー入力パネルに誘導文言を表示した場合の UI 表示確認。
- 代替運用としてメモ欄入力→保存→監査ログに期待メタが残ることを確認。
