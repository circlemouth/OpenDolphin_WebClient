# 03 旧来版：リハビリオーダー入力調査

RUN_ID: 20251228T220026Z

## 参照コード
- client/src/main/java/open/dolphin/stampbox/StampBoxResource_ja.java
- client/src/main/java/open/dolphin/order/ClaimResource_ja.java
- client/src/main/java/open/dolphin/order/BaseView.java
- client/src/main/java/open/dolphin/order/resources/BaseView_ja.properties
- client/src/main/java/open/dolphin/order/BaseEditor.java
- client/src/main/java/open/dolphin/order/resources/BaseEditor_ja.properties
- client/src/main/java/open/dolphin/order/AbstractStampEditor.java
- client/src/main/java/open/dolphin/impl/schedule/PatientScheduleImpl.java
- client/src/main/java/open/dolphin/impl/schedule/PatientScheduleView.java

## 旧来版リハビリオーダーの位置づけ
- スタンプボックスの「その他」タブ（otherOrder / 診区=800）に含まれる。
- ClaimResource に「その他（リハビリ）(800)」「リハビリ（発生日等）(810)」が定義されるが、専用エディタは存在しない。
- 入力 UI は BaseEditor/BaseView の共通オーダー入力（その他オーダー）を使用する。

## 入力欄・選択 UI の整理
- セットテーブル: コード/診療内容/数量/単位。ドラッグ&ドロップで並べ替え。
- マスター検索: 検索テキスト + RT + 部分一致 + 検索結果テーブル。
- 回数: 回数コンボ（1-10）。BundleDolphin の bundleNumber に保存。
- 部位: マスター検索で slot=部位（SLOT_BUI）項目を選択してセットテーブルに追加（専用部位ピッカーはなし）。
- コメント/指示: コメントコード（81/83/85/86）の行は診療内容セルが編集可能。コメント欄として自由記述できる。
- 期間: 専用入力欄なし（必要ならコメント行の自由記述で代替）。
- 担当者: 専用入力欄なし。

## 予約/スケジュールとの連携
- リハビリオーダー入力 UI（BaseEditor）自体は予約/スケジュール機能と直接連携しない。
- 予約/予定カルテは schedule モジュール側で扱い、オーダー入力とは別画面。

## 必須条件（入力有効化）
- セットテーブルに 1 件以上の項目が存在すること（その他オーダーは item が 1 件でもあれば OK）。
- 条件を満たすと「展開」「展開継続」が有効化される。

## 保存/取消の挙動
- 展開: VALUE_PROP を送出して editor を dispose。
- 展開継続: VALUE_PROP を送出してセットをクリア。
- クリア: セットテーブルをクリアしてスタンプ名を初期化。
- 取消: 専用ボタンなし（閉じる/遷移で破棄）。

## 差分表テンプレート反映（旧来版・リハビリ）

| 項目名 | 入力方式 | 必須条件 | 保存挙動 | コード参照 |
| --- | --- | --- | --- | --- |
| リハビリ（その他）タブ | スタンプボックスで「その他」タブ選択 | なし | 対応エディタへ切替 | client/src/main/java/open/dolphin/stampbox/StampBoxResource_ja.java |
| リハビリ項目（診療内容） | マスター検索→結果選択でセットテーブルに追加（DnD並べ替え） | 1 件以上で有効 | ClaimItem として BundleDolphin に保存 | client/src/main/java/open/dolphin/order/BaseEditor.java |
| 部位 | マスター検索で slot=部位（SLOT_BUI）項目を選択して追加 | 任意 | ClaimConst.BUI の ClaimItem として保存 | client/src/main/java/open/dolphin/order/AbstractStampEditor.java / client/src/main/java/open/dolphin/order/ClaimResource_ja.java |
| 数量 | セットテーブルの数量セル編集 | 任意 | ClaimItem.number に保存 | client/src/main/java/open/dolphin/order/BaseEditor.java |
| 回数 | 回数コンボ（1-10） | 任意（未指定時は既定値） | BundleDolphin.bundleNumber に保存 | client/src/main/java/open/dolphin/order/BaseView.java / client/src/main/java/open/dolphin/order/BaseEditor.java |
| 指示/コメント | コメントコード（81/83/85/86）の診療内容セル編集 | 任意 | ClaimItem.name を編集 | client/src/main/java/open/dolphin/order/AbstractStampEditor.java / client/src/main/java/open/dolphin/order/BaseEditor.java |
| 期間 | 専用入力欄なし（コメント行で代替） | なし | 専用フィールドなし | client/src/main/java/open/dolphin/order/BaseView.java / client/src/main/java/open/dolphin/order/BaseEditor.java |
| 担当者 | 専用入力欄なし | なし | 専用フィールドなし | client/src/main/java/open/dolphin/order/BaseView.java / client/src/main/java/open/dolphin/order/BaseEditor.java |
| 保存（展開） | 「展開」ボタン | セットテーブル有効時 | VALUE_PROP 送出→編集終了 | client/src/main/java/open/dolphin/order/BaseEditor.java |
| 保存（展開継続） | 「展開継続」ボタン | セットテーブル有効時 | VALUE_PROP 送出→クリア | client/src/main/java/open/dolphin/order/BaseEditor.java |
| クリア | 「クリア」ボタン | なし | セットテーブルクリア | client/src/main/java/open/dolphin/order/BaseEditor.java |
| 行削除 | 「削除」ボタン | 行選択時のみ | 対象行を削除 | client/src/main/java/open/dolphin/order/BaseEditor.java |

