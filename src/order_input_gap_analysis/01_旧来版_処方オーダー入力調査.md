# 01 旧来版：処方オーダー入力調査

RUN_ID: 20251228T212041Z

## 参照
- docs/DEVELOPMENT_STATUS.md
- client/src/main/java/open/dolphin/order/EditorSetPanel.java
- client/src/main/java/open/dolphin/order/AbstractStampEditor.java
- client/src/main/java/open/dolphin/order/RpEditor.java
- client/src/main/java/open/dolphin/order/RpView.java
- client/src/main/java/open/dolphin/order/InjectionEditor.java
- client/src/main/java/open/dolphin/order/InjectionView.java
- client/src/main/java/open/dolphin/order/RadEditor.java
- client/src/main/java/open/dolphin/order/RadView.java
- client/src/main/java/open/dolphin/order/BaseEditor.java
- client/src/main/java/open/dolphin/order/BaseView.java
- client/src/main/java/open/dolphin/order/resources/RpView_ja.properties
- client/src/main/java/open/dolphin/order/resources/BaseView_ja.properties
- client/src/main/java/open/dolphin/order/resources/InjectionView_ja.properties
- client/src/main/java/open/dolphin/order/resources/RadView_ja.properties
- client/src/main/java/open/dolphin/order/resources/RpEditor_ja.properties
- client/src/main/java/open/dolphin/order/resources/BaseEditor_ja.properties
- client/src/main/java/open/dolphin/order/resources/InjectionEditor_ja.properties
- client/src/main/java/open/dolphin/order/resources/RadEditor_ja.properties

## 旧来版（client）処方オーダー入力の画面・入力欄・選択肢・操作

### 1) スタンプボックス + エディタ共通（EditorSetPanel / AbstractStampEditor）
- 画面構成
  - 左: スタンプツリー
  - 中央: エディタ（処方/注射/処置/検査/指示/放射線 等）
  - 右: ボタン（右矢印=新規保存/置換、左矢印=取り込み、検査系の入れ替え）
- 操作フロー
  - タブ切替 → 対応エディタ表示（検索欄フォーカス）
  - 左矢印「取り込み」: スタンプツリーから選択したスタンプをエディタへ取り込み
  - 右矢印「新規保存」: エディタ値をスタンプとして保存
  - 右矢印「置換」: 取り込んだスタンプを上書き
  - 検体/生体/細菌検査は右矢印で entity 入れ替え保存（6001/6002）
- ショートカット/操作
  - スタンプツリーで葉ノード選択時のみ「取り込み」有効
  - 右矢印の有効/無効はエディタの必須条件（validData）に連動
- 参照
  - エディタ切替/取り込み/保存: client/src/main/java/open/dolphin/order/EditorSetPanel.java
  - 検索タイプ/エディタ共通条件: client/src/main/java/open/dolphin/order/AbstractStampEditor.java

### 2) 処方（内服/外用/頓用/臨時）: RpEditor / RpView
- 入力欄
  - セットテーブル（コード/診療内容/数量/単位/空欄/日数・回数）
  - セット名
  - 院内/院外（ラジオ）
  - 頓用/臨時（チェック・相互排他）
  - 検索テキスト
  - RT（リアルタイム検索）
  - 部分一致
  - 用法検索コンボ（用法選択/内服1回/2回/3回/4回/点眼等/塗布等/頓用等/吸入等/全て）
  - 件数（検索結果件数）
  - 結果テーブル（選択で項目追加）
  - チェック表示（薬剤/用法）
- 重要な選択肢/挙動
  - セットテーブルの順序は Drag & Drop で入れ替え可能
  - セット名は空の場合デフォルト名（処方名）に補正
  - 用法は1件のみ許容（ADMIN コード1件）
  - 頓用と臨時は排他（片方をONにするともう片方はOFF）
  - 院内/院外は Project.RP_OUT 設定へ保存
  - 日数/回数は「用法」行のみ編集可（bundleNumber）
- 必須条件
  - 薬剤またはその他が1件以上
  - 用法がちょうど1件
- 操作フロー（保存/取消/中止/再開）
  - 展開: OK ボタンでカルテへ展開しエディタ終了
  - 展開継続: OK継続ボタンでカルテへ展開後、エディタ内容をクリアして継続
  - 取消/中止/再開: RpEditor 内には該当操作UIなし（削除/クリアで代替）
- ショートカット/操作
  - 検索欄 Enter で検索実行
  - RT ON で入力中リアルタイム検索
  - 検索結果テーブルは行選択で即追加
- 参照
  - UI: client/src/main/java/open/dolphin/order/RpView.java
  - ラベル/ツールチップ: client/src/main/java/open/dolphin/order/resources/RpView_ja.properties
  - テーブル列/編集可能条件/必須条件: client/src/main/java/open/dolphin/order/RpEditor.java
  - セットテーブル列定義: client/src/main/java/open/dolphin/order/resources/RpEditor_ja.properties
  - モーダル/サブダイアログ: なし（検索結果はテーブル表示）

### 3) 注射: InjectionEditor / InjectionView
- 入力欄
  - セットテーブル（コード/診療内容/数量/単位）
  - セット名
  - 回数（1〜10）
  - 手技料なし（表示のみ、通常は無効）
  - 検索テキスト
  - RT / 部分一致
  - 件数（検索結果件数）
  - 結果テーブル
  - チェック表示（診療行為）
- 重要な選択肢/挙動
  - 手技料なしは既存スタンプ読み込み時のみ表示（編集不可）
  - 手技料なしが ON かつ注射区分の場合、classCode を「手技なし」コードへ変更して保存
- 必須条件
  - 手技料なし or 334 コードの場合: その他が1件以上
  - それ以外: 手技が1件以上 かつ その他が1件以上
- 操作フロー（保存/取消/中止/再開）
  - 展開/展開継続は処方と同様
  - 取消/中止/再開: InjectionEditor 内には該当操作UIなし（削除/クリアで代替）
- ショートカット/操作
  - 検索欄 Enter で検索実行
  - RT ON で入力中リアルタイム検索
  - 検索結果テーブルは行選択で即追加
- 参照
  - UI: client/src/main/java/open/dolphin/order/InjectionView.java
  - ラベル/ツールチップ: client/src/main/java/open/dolphin/order/resources/InjectionView_ja.properties
  - 必須条件/手技料なし判定: client/src/main/java/open/dolphin/order/InjectionEditor.java
  - セットテーブル列定義: client/src/main/java/open/dolphin/order/resources/InjectionEditor_ja.properties
  - モーダル/サブダイアログ: なし（検索結果はテーブル表示）

### 4) 放射線/画像: RadEditor / RadView
- 入力欄
  - セットテーブル（コード/診療内容/数量/単位）
  - セット名
  - 回数（1〜10）
  - 部位検索ボタン（部位コード 002 の一覧取得）
  - 検索テキスト
  - RT / 部分一致
  - 件数（検索結果件数）
  - 結果テーブル
  - チェック表示（診療行為/部位）
- 重要な選択肢/挙動
  - 部位ボタンで部位コード一覧を取得（検索結果テーブルへ表示）
  - セットテーブルの部位コードは先頭に挿入
- 必須条件
  - 診療行為 or 部位 or その他が1件以上
- 操作フロー（保存/取消/中止/再開）
  - 展開/展開継続は処方と同様
  - 取消/中止/再開: RadEditor 内には該当操作UIなし（削除/クリアで代替）
- ショートカット/操作
  - 検索欄 Enter で検索実行
  - RT ON で入力中リアルタイム検索
  - 検索結果テーブルは行選択で即追加
- 参照
  - UI: client/src/main/java/open/dolphin/order/RadView.java
  - ラベル/ツールチップ: client/src/main/java/open/dolphin/order/resources/RadView_ja.properties
  - 必須条件/部位検索: client/src/main/java/open/dolphin/order/RadEditor.java
  - セットテーブル列定義: client/src/main/java/open/dolphin/order/resources/RadEditor_ja.properties
  - モーダル/サブダイアログ: なし（検索結果はテーブル表示）

### 5) その他オーダー（処置/検査/指示/汎用/手術/診断料/リハビリ系）: BaseEditor / BaseView
- 対象
  - 処置（ENTITY_TREATMENT）/手術（ENTITY_SURGERY_ORDER）
  - 検体検査（ENTITY_LABO_TEST）/生体検査（ENTITY_PHYSIOLOGY_ORDER）/細菌検査（ENTITY_BACTERIA_ORDER）
  - 指導・在宅（ENTITY_INSTRACTION_CHARGE_ORDER）
  - 汎用（ENTITY_GENERAL_ORDER）
  - その他（ENTITY_OTHER_ORDER、リハビリ系コード含む）
- 入力欄
  - セットテーブル（コード/診療内容/数量/単位）
  - セット名
  - 回数（1〜10）
  - 検索テキスト
  - RT / 部分一致
  - 件数（検索結果件数）
  - 結果テーブル
  - チェック表示（診療行為）
- 重要な選択肢/挙動
  - セットテーブルの順序は Drag & Drop で入れ替え可能
  - セット名は空の場合デフォルト名に補正
- 必須条件
  - 診療行為 or その他が1件以上
  - ENTITY_LABO_TEST かつ order.labtest.send 設定時はその他のみでも可
  - ENTITY_OTHER_ORDER はその他のみでも可
- 操作フロー（保存/取消/中止/再開）
  - 展開/展開継続は処方と同様
  - 取消/中止/再開: BaseEditor 内には該当操作UIなし（削除/クリアで代替）
- ショートカット/操作
  - 検索欄 Enter で検索実行
  - RT ON で入力中リアルタイム検索
  - 検索結果テーブルは行選択で即追加
- 参照
  - UI: client/src/main/java/open/dolphin/order/BaseView.java
  - ラベル/ツールチップ: client/src/main/java/open/dolphin/order/resources/BaseView_ja.properties
  - 必須条件: client/src/main/java/open/dolphin/order/BaseEditor.java
  - セットテーブル列定義: client/src/main/java/open/dolphin/order/resources/BaseEditor_ja.properties
  - モーダル/サブダイアログ: なし（検索結果はテーブル表示）

## 差分表テンプレート記入（旧来版）

| 項目名 | 入力方式 | 必須条件 | 保存挙動 | コード参照 |
| --- | --- | --- | --- | --- |
| 共通: セットテーブル順序変更 | Drag & Drop | - | テーブル並び替え | client/src/main/java/open/dolphin/order/BaseView.java / RpView.java / InjectionView.java / RadView.java |
| 共通: セットテーブル数量編集 | セル編集（クリック） | - | 数量/単位更新 | client/src/main/java/open/dolphin/order/BaseEditor.java / RpEditor.java / InjectionEditor.java / RadEditor.java |
| 共通: 検索テキスト | テキスト入力 | - | Enter/RTで検索 | client/src/main/java/open/dolphin/order/BaseEditor.java / RpEditor.java / InjectionEditor.java / RadEditor.java |
| 共通: RT検索 | チェック | - | 入力中に検索 | client/src/main/java/open/dolphin/order/BaseEditor.java / RpEditor.java / InjectionEditor.java / RadEditor.java |
| 共通: 部分一致 | チェック | - | 部分一致検索 | client/src/main/java/open/dolphin/order/BaseEditor.java / RpEditor.java / InjectionEditor.java / RadEditor.java |
| 共通: 検索結果テーブル | 行選択 | - | 選択で項目追加 | client/src/main/java/open/dolphin/order/BaseEditor.java / RpEditor.java / InjectionEditor.java / RadEditor.java |
| 共通: 件数 | テキスト表示 | - | 検索結果数表示 | client/src/main/java/open/dolphin/order/BaseView.java / RpView.java / InjectionView.java / RadView.java |
| 共通: セット名 | テキスト入力 | 空欄時はデフォルト名 | スタンプ名に反映 | client/src/main/java/open/dolphin/order/BaseEditor.java / RpEditor.java / InjectionEditor.java / RadEditor.java |
| 共通: 展開 | ボタン | 必須条件を満たす | VALUE_PROP → 編集終了 | client/src/main/java/open/dolphin/order/BaseEditor.java / RpEditor.java / InjectionEditor.java / RadEditor.java |
| 共通: 展開継続 | ボタン | 必須条件を満たす | VALUE_PROP → クリア継続 | client/src/main/java/open/dolphin/order/BaseEditor.java / RpEditor.java / InjectionEditor.java / RadEditor.java |
| 共通: 削除 | ボタン | 選択行あり | 行削除 | client/src/main/java/open/dolphin/order/BaseEditor.java / RpEditor.java / InjectionEditor.java / RadEditor.java |
| 共通: クリア | ボタン | - | セット内容クリア | client/src/main/java/open/dolphin/order/BaseEditor.java / RpEditor.java / InjectionEditor.java / RadEditor.java |
| 処方: 薬剤/用法チェック | 表示 | 薬剤>0 / 用法=1 | validData に反映 | client/src/main/java/open/dolphin/order/RpEditor.java |
| 処方: 院内/院外 | ラジオ | - | Project.RP_OUT 更新 | client/src/main/java/open/dolphin/order/RpEditor.java |
| 処方: 頓用 | チェック | - | 臨時と排他 | client/src/main/java/open/dolphin/order/RpEditor.java |
| 処方: 臨時 | チェック | - | 頓用と排他 | client/src/main/java/open/dolphin/order/RpEditor.java |
| 処方: 用法検索 | セレクト | - | 用法マスタ取得 | client/src/main/java/open/dolphin/order/RpEditor.java |
| 処方: 日数/回数 | セル編集 | 用法行のみ編集可 | bundleNumber 更新 | client/src/main/java/open/dolphin/order/RpEditor.java |
| 注射: 回数 | セレクト | - | bundleNumber 更新 | client/src/main/java/open/dolphin/order/InjectionEditor.java |
| 注射: 手技料なし | チェック（表示） | - | 手技なしコードへ置換 | client/src/main/java/open/dolphin/order/InjectionEditor.java |
| 放射線: 回数 | セレクト | - | bundleNumber 更新 | client/src/main/java/open/dolphin/order/RadEditor.java |
| 放射線: 部位検索 | ボタン | - | 部位コード一覧取得 | client/src/main/java/open/dolphin/order/RadEditor.java |
| 放射線: 部位チェック | 表示 | 部位>0 | validData に反映 | client/src/main/java/open/dolphin/order/RadEditor.java |
| その他: 回数 | セレクト | - | bundleNumber 更新 | client/src/main/java/open/dolphin/order/BaseEditor.java |
| スタンプ保存: 新規保存 | ボタン | validData | エディタ値を保存 | client/src/main/java/open/dolphin/order/EditorSetPanel.java |
| スタンプ保存: 置換 | ボタン | validData + 取り込み済み | スタンプ上書き | client/src/main/java/open/dolphin/order/EditorSetPanel.java |
| スタンプ保存: 取り込み | ボタン | スタンプ選択 | スタンプをエディタへ取り込み | client/src/main/java/open/dolphin/order/EditorSetPanel.java |

## 取消/中止/再開の扱い（旧来版）
- 処方/注射/放射線/その他エディタ内に「中止」「再開」専用の操作はなし。
- 取消相当は「クリア」「削除」で代替。
- 中止/再開に関する表示語は ClaimResource に定義があるが、処方エディタ内のボタン操作には登場しない。
  - 参照: client/src/main/java/open/dolphin/order/ClaimResource_ja.java
  - モーダル/サブダイアログ: なし（取り込み/保存はバックグラウンド処理で警告表示のみ）
