# 14 Web修正タスク化（P1/P2）

RUN_ID: 20251229T070028Z

## 目的
- 12_差分判定_修正区分.md に基づき、P1/P2 の Web 改修項目をタスク化して実装準備を完了する。
- API 不足が判明した場合のみ server-modernized の別タスクを起票する。

## 参照
- docs/DEVELOPMENT_STATUS.md
- src/order_input_gap_analysis/10_ドキュメント化とレビュー.md
- src/order_input_gap_analysis/12_差分判定_修正区分.md
- src/order_input_gap_analysis/15_改修前提ドキュメント整備.md

## 前提判定（P1/P2）
- P1/P2 は Web クライアント改修対象。server-modernized の変更は不要（API 不足が判明した場合のみ別起票）。
- readOnly/missingMaster/fallbackUsed の安全ガードは維持したまま UI を追加する。

## 実装順序（優先）
1. P0 影響が強い補助 UI から先行: DnD 並べ替え / 全クリア / 行削除補助 / コメントコード / 材料 UI
2. P1 追加: 注射「手技料なし」/ 放射線部位検索・部位チェック表示 / 文書テンプレ差し込み・文書別印刷導線
3. P2: リハビリ予約/スケジュール連携 UI の可否検討 + 代替運用案を明記

## タスク化（P1）

### 1) OrderBundleEditPanel: DnD 並べ替え / 全クリア / 行削除補助
- 対象画面/機能: Charts 右パネル `OrderBundleEditPanel`
- 旧来版の挙動（差分要約）: BaseEditor テーブルで DnD 並べ替え、全クリア、行削除の補助 UI がある。
- Web 目標挙動（実装範囲）:
  - 行ドラッグで並び替え可能にする。
  - 「全クリア」操作を追加し、確認導線を付与する。
  - 行削除は対象行に明示アクションを追加（既存削除 UI があれば補助導線を追加）。
- 依存 API/データ: なし（フロントの orderBundle 編集のみ）
- 監査/ログ要件: 既存の edit 操作ログ形式に追従（runId/screen/operationPhase を保持）。
- ブロッカー: 既存テーブル UI の構造次第で DnD ライブラリ選定が必要。
- テスト観点:
  - DnD 後の保存順序が /orca/order/bundles に反映されること。
  - 全クリア操作が readOnly/missingMaster/fallbackUsed 時は無効化されること。

### 2) 注射「手技料なし」専用 UI
- 対象画面/機能: `OrderBundleEditPanel` の注射オーダー編集
- 旧来版の挙動（差分要約）: InjectionEditor に「手技料なし」チェックがある。
- Web 目標挙動（実装範囲）: 注射バンドル編集時に「手技料なし」フラグ入力 UI を追加。
- 依存 API/データ: /orca/order/bundles の payload に該当フラグが存在するか確認（不足時は別起票）。
- 監査/ログ要件: 変更時は既存の edit 操作ログに含める。
- ブロッカー: 既存データモデルにフラグがない場合の扱い。
- テスト観点: フラグの保存/再表示、readOnly 状態の入力制御。

### 3) 放射線: 部位検索 / 部位チェック表示
- 対象画面/機能: `OrderBundleEditPanel` の放射線オーダー編集
- 旧来版の挙動（差分要約）: 部位検索ボタン + 部位チェック表示がある。
- Web 目標挙動（実装範囲）:
  - 部位マスタ検索の UI を追加（検索→選択→セット）。
  - 部位チェック表示（必須/未入力の可視化）を追加。
- 依存 API/データ: /orca/master/bodypart など部位マスタ API を利用（不足時は別起票）。
- 監査/ログ要件: 変更時の edit ログに部位を含める。
- ブロッカー: 部位マスタ API の仕様確認。
- テスト観点: 検索結果選択で部位がセットされること、未入力時のチェック表示。

### 4) コメントコード行編集
- 対象画面/機能: `OrderBundleEditPanel`（処置/検査/指示/リハビリ共通）
- 旧来版の挙動（差分要約）: コメントコード行を選択・編集できる。
- Web 目標挙動（実装範囲）:
  - コメントコード行の追加/編集 UI を提供。
  - 行種別を明確化し、通常行と混在しない編集導線を用意。
- 依存 API/データ: コメントコードのマスタ/コード体系の確認（必要なら別起票）。
- 監査/ログ要件: コメントコードの変更内容を edit ログに含める。
- ブロッカー: コメントコードのモデル定義が Web 側に不足。
- テスト観点: コメントコード行の保存/再表示、通常行との混在表示。

### 5) 材料（SLOT_ZAIRYO）追加 UI
- 対象画面/機能: `OrderBundleEditPanel`（処置/検査/指示）
- 旧来版の挙動（差分要約）: 材料マスタ検索から追加可能。
- Web 目標挙動（実装範囲）: 材料追加専用 UI を追加（検索→選択→追加）。
- 依存 API/データ: /orca/master/material など材料マスタ API（不足時は別起票）。
- 監査/ログ要件: 材料追加/削除を edit ログに含める。
- ブロッカー: 材料の bundle slot (SLOT_ZAIRYO) の既存モデル適用。
- テスト観点: 材料行の追加/削除/保存反映、readOnly 状態でのガード。

### 6) 文書: ODT テンプレ差し込み / 文書別印刷導線
- 対象画面/機能: Charts 文書作成導線
- 旧来版の挙動（差分要約）: 文書テンプレ選択、文書種別ごとの印刷が可能。
- Web 目標挙動（実装範囲）:
  - ODT テンプレ選択（差し込み）導線を追加。
  - 文書別印刷/プレビュー出力の導線を整理（外来サマリ以外の文書を対象）。
- 依存 API/データ: 文書テンプレ取得/出力 API の有無を確認（不足時は別起票）。
- 監査/ログ要件: 文書出力の操作ログを追加（既存印刷ログに準拠）。
- ブロッカー: テンプレ管理/印刷 API の仕様未確定。
- テスト観点: テンプレ選択→生成→印刷の一連導線、権限/ガード条件。

## タスク化（P2）

### 7) リハビリ予約/スケジュール連携 UI の可否検討 + 代替運用明記
- 対象画面/機能: リハビリオーダー入力（Charts 右パネル）
- 旧来版の挙動（差分要約）: スケジュール画面で予約連携が可能。
- Web 目標挙動（実装範囲）:
  - 予約/スケジュール連携 UI の実装可否を調査し、実装方針を決定。
  - 実装不可の場合は代替運用（手入力 / 別システム運用）を明記。
- 依存 API/データ: 予約/スケジュール API の有無（なければ別起票）。
- 監査/ログ要件: 予約連携を実装する場合は操作ログ方針を定義。
- ブロッカー: 予約/スケジュールのシステム連携仕様が未確定。
- テスト観点: 連携 UI の成否、代替運用時の入力誘導文言。

## 補足
- 本タスクは P1/P2 のタスク化のみ。P0 実装の詳細は別ファイルに委譲。
- API 不足が判明した場合のみ server-modernized の別タスクを起票する。
