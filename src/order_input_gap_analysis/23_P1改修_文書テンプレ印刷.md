# 23 P1 改修：文書テンプレ差し込み/文書別印刷導線

RUN_ID: 20251229T081044Z

- 目的: ODT テンプレ差し込みと文書別印刷導線を追加する。
- 対象: Charts 文書作成導線。
- 実装観点:
  - テンプレ選択 UI を追加し、文書別に印刷/プレビュー導線を整理。
  - 出力操作の監査ログを既存印刷ログに準拠して追加。
- 依存/前提: 文書テンプレ API/出力 API の仕様確認（不足時は server-modernized タスク起票）。
- テスト: テンプレ選択→生成→印刷の導線、権限/ガード条件。

## server-modernized タスク起票 TODO（仕様未確定）
### 文書テンプレ API（取得）
- 想定: `GET /documents/templates?type=<documentType>`（仮）
- 必須リクエスト項目:
  - documentType（referral/certificate/reply）
  - runId / traceId（監査紐付け）
- 必須レスポンス項目:
  - runId
  - templates[]: templateId / documentType / label / description / defaults / version / updatedAt
  - cacheHit / dataSourceTransition / missingMaster / fallbackUsed

### 文書出力 API（生成/印刷/PDF）
- 想定: `POST /documents/output`（仮）
- 必須リクエスト項目:
  - runId / traceId
  - patientId / documentId
  - templateId / documentType / documentTitle / documentIssuedAt
  - outputMode（print/pdf）
  - actor / facilityId
- 必須レスポンス項目:
  - runId / requestId
  - status（queued/completed/failed）
  - errorMessage（failed 時）
  - previewUrl or fileId（PDF 保存時の取得手段）

### 備考
- UI 側は `web-client/src/features/charts/documentTemplates.ts` の API 型を暫定定義済み。
- 仕様確定後に API 呼び出し実装へ差し替えること。
