# 09 差分マトリクス統合

RUN_ID: 20251229T062814Z

## 参照
- docs/DEVELOPMENT_STATUS.md
- src/order_input_gap_analysis/01_旧来版_処方オーダー入力調査.md
- src/order_input_gap_analysis/02_旧来版_文書オーダー入力調査.md
- src/order_input_gap_analysis/03_旧来版_リハビリオーダー入力調査.md
- src/order_input_gap_analysis/04_旧来版_処置検査指示オーダー入力調査.md
- src/order_input_gap_analysis/05_WEB_処方オーダー入力調査.md
- src/order_input_gap_analysis/06_WEB_文書オーダー入力調査.md
- src/order_input_gap_analysis/07_WEB_リハビリオーダー入力調査.md
- src/order_input_gap_analysis/08_WEB_処置検査指示オーダー入力調査.md

## 対象
- 対象画面: 旧来版クライアント（client）/ Web クライアント（web-client）
- 対象機能: 処方・文書・リハビリ・処置/検査/指示オーダー入力
- 対象期間: 2026-01-01 09:00 〜 2026-01-03 09:00

## 優先度定義（実装漏れ候補）
- P0: 旧来版で必須業務フローとして成立しており、Web で欠落すると主要業務に影響
- P1: 品質/安全性/効率に直結するが、暫定運用で代替可能
- P2: 便利機能/補助機能レベル
- ー: 差分なし/仕様差と判断

## 差分マトリクス（統合）

### A. 共通オーダー入力（処方/処置/検査/指示/リハビリで共通）
| カテゴリ | 項目 | 旧来版 | Web | 入力方式比較 | 保存フロー比較 | 差異原因候補 | 実装漏れ優先度 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 入口 | オーダー入力の入口 | スタンプボックス + エディタ | 右固定メニュー → 右パネル | 旧来: タブ切替 / Web: メニュー起点 | 旧来: 展開/展開継続 / Web: API保存 | UI 体系の刷新（スタンプ/カルテ展開中心→API中心） | ー |
| 入力補助 | マスタ検索（RT/部分一致/件数） | あり | なし | 旧来: 検索/結果選択 / Web: 手入力 | 旧来: セット追加 / Web: items 直接入力 | マスタAPI未統合・入力UI未実装 | P0 |
| 入力補助 | 検索結果テーブル | あり（行選択で追加） | なし | 旧来: 選択で追加 / Web: 手入力 | 旧来: セット行追加 / Web: items配列 | 同上 | P0 |
| 入力補助 | ドラッグ&ドロップ並べ替え | あり | なし | 旧来: DnD / Web: 並べ替えUIなし | 旧来: 並び替え反映 / Web: 送信順のみ | UI省略 | P1 |
| 編集操作 | 行削除/クリア | あり（削除/クリア） | 行削除のみ（全クリアなし） | 旧来: 行削除/全クリア / Web: 行削除 | 旧来: セット初期化 / Web: フォームリセットのみ | 旧来の一括操作未実装 | P1 |
| スタンプ | スタンプ保存（新規/置換） | あり | なし | 旧来: 矢印ボタン / Web: UIなし | 旧来: スタンプ保存 / Web: なし | スタンプ箱機能がWeb未実装 | P0 |
| スタンプ | スタンプ取り込み | あり | なし | 旧来: 左矢印 / Web: UIなし | 旧来: 既存スタンプ取込 / Web: なし | 同上 | P0 |
| 履歴/複製 | オーダ履歴コピー | あり | なし | 旧来: 右クリック/Ctrl+C / Web: UIなし | 旧来: クリップボード / Web: なし | 履歴UI未実装 | P2 |
| 履歴/複製 | スタンプコピー/ペースト | あり | なし | 旧来: 右クリック / Web: UIなし | 旧来: スタンプ複製 / Web: なし | スタンプ箱機能未実装 | P2 |
| 入力ブロック | readOnly/missingMaster/fallbackUsed | なし | あり | 旧来: 画面ブロックなし / Web: 一括ブロック | 保存不能条件がWeb側で追加 | 安全性/整合性担保 | ー |
| 保存 | 展開/展開継続 | あり | なし | 旧来: ボタン操作 / Web: なし | 旧来: カルテへ展開 / Web: /orca/order/bundles 保存 | カルテ展開フロー未実装 | P0 |
| 保存 | /orca/order/bundles API | なし | あり | 旧来: なし / Web: API保存 | Web専用フロー | Web設計方針 | ー |
| 患者状態 | patientId 未選択時メッセージ | なし | あり | Webのみ表示 | 保存ブロック | Webの安全ガード | ー |

### B. 処方オーダー（Rp）
| カテゴリ | 項目 | 旧来版 | Web | 入力方式比較 | 保存フロー比較 | 差異原因候補 | 実装漏れ優先度 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 必須判定 | 薬剤/用法必須 | 薬剤/その他≥1 かつ 用法=1 | なし（RP名のみ必須） | 旧来: バリデーションあり / Web: なし | 旧来: validData 連動 / Web: 送信許可 | バリデーション未実装 | P0 |
| 入力補助 | 用法検索・用法フィルタ | あり | なし | 旧来: マスタ選択 / Web: テキスト入力 | 旧来: ADMINコード / Web: admin文字列 | マスタ連携未実装 | P0 |
| 入力補助 | 院内/院外・頓用/臨時 | あり | なし | 旧来: ラジオ/チェック / Web: UIなし | 旧来: Project設定更新 / Web: 送信項目なし | UI/データ項目未実装 | P1 |
| 入力補助 | 日数/回数（用法行のみ） | あり | なし | 旧来: テーブルセル編集 / Web: 回数のみ手入力 | 旧来: bundleNumber / Web: bundleNumberのみ | 詳細入力UI未実装 | P1 |
| 入力項目 | RP名 | あり（空欄はデフォルト補正） | あり（必須） | 旧来: テキスト入力 / Web: テキスト入力 | 旧来: スタンプ名 / Web: bundleName | 補正ロジック差 | P1 |
| 入力項目 | 薬剤/材料行 | あり（検索追加） | あり（手入力） | 旧来: 検索選択 / Web: 直接入力 | 旧来: ClaimItem / Web: items[] | マスタ連携未実装 | P0 |
| 操作 | 展開/展開継続 | あり | なし | 旧来: ボタン / Web: なし | 旧来: カルテ展開 / Web: API保存 | カルテ展開未実装 | P0 |

### C. 注射/放射線/処置/検査/指示（BaseEditor/RadEditor）
| カテゴリ | 項目 | 旧来版 | Web | 入力方式比較 | 保存フロー比較 | 差異原因候補 | 実装漏れ優先度 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 注射 | 手技料なし | あり（表示/保存条件） | なし | 旧来: チェック / Web: UIなし | 旧来: classCode置換 / Web: 送信なし | 注射専用UI未実装 | P1 |
| 放射線 | 部位検索ボタン | あり | なし | 旧来: ボタン検索 / Web: UIなし | 旧来: 部位コード追加 / Web: 手入力のみ | 部位マスタ未実装 | P1 |
| 放射線 | 部位チェック表示 | あり | なし | 旧来: 自動表示 / Web: UIなし | 旧来: validData連動 / Web: なし | バリデーション未実装 | P1 |
| 処置/検査/指示 | コメントコード編集 | あり | なし | 旧来: コメントコード行のみ編集 / Web: テキスト行のみ | 旧来: ClaimItem.name / Web: items[].name | コメントコード概念未実装 | P1 |
| 処置/検査/指示 | 材料（SLOT_ZAIRYO） | あり | なし | 旧来: マスタ検索で追加 / Web: UIなし | 旧来: ClaimItem / Web: 手入力のみ | マスタ連携未実装 | P1 |
| 共通 | 必須判定（診療行為/部位/その他） | あり | なし | 旧来: entity別必須 / Web: なし | 旧来: validData / Web: 送信許可 | バリデーション未実装 | P0 |
| 共通 | 回数 | あり（コンボ） | あり（手入力） | 旧来: 選択式 / Web: テキスト | 旧来: bundleNumber / Web: bundleNumber | UI形式差 | ー |
| 共通 | 実施日入力 | なし | なし | 入力欄なし | なし | 仕様差なし | ー |

### D. リハビリ（その他/一般オーダー）
| カテゴリ | 項目 | 旧来版 | Web | 入力方式比較 | 保存フロー比較 | 差異原因候補 | 実装漏れ優先度 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 入口 | リハビリ専用UI | なし（その他タブ内） | なし（generalOrder） | 旧来: その他タブ / Web: オーダー編集 | 旧来: カルテ展開 / Web: API保存 | UI統合方針 | ー |
| 入力補助 | 部位入力 | マスタ検索（slot=部位） | なし | 旧来: マスタ選択 / Web: 手入力 | 旧来: ClaimItem / Web: items[].name | マスタ連携未実装 | P1 |
| 入力補助 | 指示/コメント | コメントコード行編集 | メモ欄のみ | 旧来: コメントコード / Web: memo | 保存先が異なる | コメントコード未実装 | P1 |
| 期間 | 終了日入力 | なし | なし | 旧来: なし / Web: なし | なし | 仕様差なし | ー |
| 連携 | 予約/スケジュール | 別画面で対応 | なし | 旧来: scheduleモジュール / Web: UIなし | 連携なし | スケジュール機能未実装 | P2 |

### E. 文書オーダー
| カテゴリ | 項目 | 旧来版 | Web | 入力方式比較 | 保存フロー比較 | 差異原因候補 | 実装漏れ優先度 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 文書作成 | 新規文書作成メニュー | あり | なし | 旧来: プラグイン/テンプレ選択 / Web: UIなし | 旧来: 文書エディタ起動 / Web: なし | 文書作成UI未実装 | P0 |
| 文書作成 | ODT差し込みテンプレ | あり | なし | 旧来: .odt 選択 / Web: UIなし | 旧来: ファイル生成 / Web: なし | テンプレ連携未実装 | P1 |
| 文書入力 | 紹介状/診断書/返信書フォーム | あり | なし | 旧来: テキスト入力 / Web: UIなし | 旧来: PDF作成/印刷 / Web: なし | 文書フォーム未実装 | P0 |
| 文書登録 | 右固定メニュー「文書登録」 | なし | あり（導線のみ） | Web: メッセージのみ | 保存なし | placeholder UI | ー |
| 文書出力 | 印刷/プレビュー | あり（PDF/フォーム） | あり（外来サマリのみ） | 旧来: ダイアログ選択 / Web: プレビュー→ブラウザ印刷 | 旧来: PDF保存 / Web: window.print | 文書種別の限定（デモ） | P1 |
| 文書種別 | 多種文書（紹介状/診断書/返信書） | あり | なし | 旧来: 文書別 UI / Web: 外来サマリのみ | 保存フロー自体未実装 | 文書実装未着手 | P0 |

## 入力方法と保存フローの比較（原因候補まとめ）
- 旧来版は「スタンプ/エディタ → カルテ展開」を中心とし、マスタ検索・スタンプ保存・展開継続などの操作が業務フローに組み込まれている。
- Web は「右パネルのフォーム → /orca/order/bundles API」中心で、入力補助（検索/選択/テンプレ）やスタンプ機能が未実装。
- Web 側の readOnly/missingMaster/fallbackUsed ガードは、マスタ同期や安全性確保のための追加制御であり、旧来版の UI には存在しない。
- 文書領域は Web 側がデモ（外来サマリ印刷）に留まり、旧来版の文書テンプレ/フォーム/印刷フローとの差が大きい。

## 実装漏れの可能性が高い項目（優先度順）
- P0: マスタ検索/結果選択/用法選択の UI（処方/処置/検査/指示/リハビリ共通）
- P0: 旧来版の必須判定（処方の用法必須、entity別必須条件）
- P0: 展開/展開継続/スタンプ保存・取り込み（カルテ展開系フロー）
- P0: 文書作成メニュー/文書フォーム（紹介状/診断書/返信書）
- P0: 処方の薬剤/材料行（検索追加）
- P0: 文書種別（紹介状/診断書/返信書）
- P1: 注射「手技料なし」・放射線部位検索などの専用UI
- P1: ドラッグ&ドロップ並べ替え/一括クリアなどの操作補助
- P1: 文書テンプレ（ODT）差し込み/多種文書の印刷出力
- P1: RP名の空欄補正（補正ロジック差）
- P2: 履歴コピー/スタンプ複製/スケジュール連携 UI
