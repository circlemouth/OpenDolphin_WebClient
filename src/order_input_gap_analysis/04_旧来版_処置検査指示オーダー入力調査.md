# 04 旧来版：処置/検査/指示オーダー入力調査

RUN_ID: 20251228T220946Z

## 参照
- client/src/main/java/open/dolphin/order/BaseEditor.java
- client/src/main/java/open/dolphin/order/BaseView.java
- client/src/main/java/open/dolphin/order/resources/BaseView_ja.properties
- client/src/main/java/open/dolphin/order/resources/BaseEditor_ja.properties
- client/src/main/java/open/dolphin/order/RadEditor.java
- client/src/main/java/open/dolphin/order/RadView.java
- client/src/main/java/open/dolphin/order/resources/RadView_ja.properties
- client/src/main/java/open/dolphin/order/resources/RadEditor_ja.properties
- client/src/main/java/open/dolphin/order/AbstractStampEditor.java
- client/src/main/java/open/dolphin/order/EditorSetPanel.java
- client/src/main/java/open/dolphin/stampbox/StampTreePopupAdapter.java
- client/src/main/java/open/dolphin/impl/care/OrderHistoryPanel.java

## 対象範囲
- 旧来版クライアント（client）の処置/検査/指示オーダー入力 UI。
- BaseEditor 系: 処置(treatment) / 検体検査(laboTest) / 生体検査(physiologyOrder) / 細菌検査(bacteriaOrder) / 指導・在宅(instractionChargeOrder) / 手術(surgery) / その他(otherOrder) など。
- 放射線は RadEditor を別扱い（部位検索ボタンあり）。

## 入力欄と入力方法の整理（旧来版）

### 1) 共通: BaseEditor 系（処置/検査/指示/手術/その他）
- セットテーブル（コード/診療内容/数量/単位）
  - 点数マスタ検索で追加（検索結果行を選択 → セットに1行追加）。
  - 数量はテーブルの「数量」列を直接編集（セル編集、Enter で次セルへ移動）。
  - コメントは「診療内容」列を編集（コメントコード 81/83/85/86 のみ編集可）。
  - コメントコード 82 は数量編集不可。
- スタンプ名
  - スタンプ名入力欄で直接編集。
  - 手技(SYUGI)を追加した場合、空欄なら手技名を自動補完。
- 回数（numberCombo）
  - バンドル回数をドロップダウンで指定。
- 検索テキスト
  - Enter 実行／RT チェック時は入力中にリアルタイム検索。
- RT（リアルタイム検索）
  - チェックで入力中の自動検索を有効化。
- 部分一致
  - チェックで部分一致検索を有効化。
- 件数
  - 検索結果件数を表示（表示のみ）。
- 診療行為チェック
  - セット内に診療行為がある場合に自動チェック（表示のみ）。

### 2) 放射線（RadEditor）
- セットテーブル（コード/診療内容/数量/単位）
  - BaseEditor と同様に追加/編集。
- スタンプ名／回数／検索テキスト／RT／部分一致／件数
  - BaseEditor と同様。
- 部位検索ボタン
  - 「部位」ボタン押下で部位マスタ（コード 002 系）を検索結果へ表示。
- 部位チェック
  - セットに部位がある場合に自動チェック（表示のみ）。
- 診療行為チェック
  - セットに診療行為がある場合に自動チェック（表示のみ）。

### 3) 材料／部位／コメントの入力方法
- 材料
  - 点数マスタ検索で「材料（SLOT_ZAIRYO）」を追加。
  - 追加時に数量の既定値が設定される。
- 部位
  - 放射線は「部位」ボタンで部位マスタ（コード 002 系）を検索して追加。
  - BaseEditor 系は部位専用ボタンなし（マスタ検索経由で追加する前提）。
- コメント
  - コメントコード 81/83/85/86 は「診療内容」列を直接編集してコメント入力。
  - コメントコード 82 は固定コメントで数量編集不可。

### 4) 実施日
- BaseEditor/RadEditor の画面構成に日付入力欄は存在しない（オーダ入力 UI では実施日を直接指定しない）。

## セット/パネル入力の操作手順（旧来版）
1. スタンプボックスで対象タブ（処置/検査/指示/放射線など）を選択。
2. エディタパネル（BaseEditor/RadEditor）で検索 → 項目をセットテーブルへ追加。
3. 必要に応じて数量・コメント・順序を編集。
4. スタンプ名・回数を入力。
5. 「展開」または「展開継続」でカルテに展開。
6. スタンプボックスへ保存する場合は右矢印ボタンで「新規/置換」を実行。
7. 既存スタンプをセットテーブルへ取り込む場合は左矢印（インポート）で読み込み。

## 複数行編集の操作
- セットテーブルは単一行選択だが、複数行の追加・編集が可能。
- 行の追加: 検索結果テーブルから行を選択すると1行ずつ追加。
- 行の並び替え: セットテーブル内で Drag & Drop。
- 行の削除: 選択行を「削除」ボタンで削除。
- 行のクリア: 「クリア」でセット全体を初期化。

## 履歴コピー（参考）
- オーダ履歴パネルでは履歴行を Ctrl/Cmd+C または右クリックでコピー可能。
  - クリップボードへテキストとしてコピー（履歴内容の参照用途）。
- スタンプツリーでも右クリックでコピー/ペーストが可能（同一 entity のスタンプを複製）。

## 差分表テンプレート反映（旧来版: 処置/検査/指示/放射線）

| 項目名 | 入力方式 | 必須条件 | 保存挙動 | コード参照 |
| --- | --- | --- | --- | --- |
| BaseEditor: セットテーブル（コード/診療内容/数量/単位） | 検索結果行の選択で追加、数量はセル編集 | 診療行為またはその他が1件以上（entity 条件あり） | 「展開/展開継続」でカルテへ展開 | client/src/main/java/open/dolphin/order/BaseEditor.java, client/src/main/java/open/dolphin/order/resources/BaseEditor_ja.properties |
| BaseEditor: コメント入力（診療内容列） | コメントコード行の診療内容セルを直接編集 | コメントコード 81/83/85/86 のみ編集可 | セット内の行として保存 | client/src/main/java/open/dolphin/order/AbstractStampEditor.java, client/src/main/java/open/dolphin/order/BaseEditor.java |
| BaseEditor: 数量 | セットテーブルの数量セル編集 | コメントコード 82 は編集不可 | セット内の数量として保存 | client/src/main/java/open/dolphin/order/BaseEditor.java |
| BaseEditor: スタンプ名 | テキスト入力 | 空欄時は手技名を補完 | スタンプ名として保存 | client/src/main/java/open/dolphin/order/BaseEditor.java, client/src/main/java/open/dolphin/order/BaseView.java |
| BaseEditor: 回数（bundle 回数） | ドロップダウン選択 | 任意 | バンドル回数として保存 | client/src/main/java/open/dolphin/order/BaseEditor.java, client/src/main/java/open/dolphin/order/BaseView.java |
| BaseEditor: 検索テキスト/RT/部分一致 | テキスト入力 + チェックボックス | RT 有効時は入力中検索 | 検索結果テーブルへ反映 | client/src/main/java/open/dolphin/order/BaseEditor.java, client/src/main/java/open/dolphin/order/BaseView.java |
| BaseEditor: 件数表示 | 表示のみ | - | 検索結果件数を表示 | client/src/main/java/open/dolphin/order/BaseEditor.java, client/src/main/java/open/dolphin/order/BaseView.java |
| RadEditor: セットテーブル（コード/診療内容/数量/単位） | 検索結果行の選択で追加、数量はセル編集 | 診療行為/部位/その他が1件以上 | 「展開/展開継続」でカルテへ展開 | client/src/main/java/open/dolphin/order/RadEditor.java, client/src/main/java/open/dolphin/order/resources/RadEditor_ja.properties |
| RadEditor: 部位検索ボタン | ボタン押下で部位コードを検索 | - | 検索結果テーブルへ反映 | client/src/main/java/open/dolphin/order/RadEditor.java, client/src/main/java/open/dolphin/order/RadView.java |
| RadEditor: 部位チェック/診療行為チェック | 表示のみ | - | セット内の有無を表示 | client/src/main/java/open/dolphin/order/RadEditor.java, client/src/main/java/open/dolphin/order/RadView.java |
| 材料（SLOT_ZAIRYO） | 点数マスタ検索で追加 | - | セット内に材料行として保存 | client/src/main/java/open/dolphin/order/AbstractStampEditor.java |
| コメント（コード 81/83/85/86） | 診療内容セルの編集 | コメントコード限定 | セット内行に保持 | client/src/main/java/open/dolphin/order/AbstractStampEditor.java |
| 実施日 | 入力欄なし | - | UI では指定不可 | client/src/main/java/open/dolphin/order/BaseView.java, client/src/main/java/open/dolphin/order/RadView.java |
| スタンプ保存（新規/置換） | 右矢印ボタン | - | スタンプボックスへ保存 | client/src/main/java/open/dolphin/order/EditorSetPanel.java |
| スタンプ取り込み（インポート） | 左矢印ボタン | - | スタンプボックスからセットへ取込 | client/src/main/java/open/dolphin/order/EditorSetPanel.java |
| スタンプツリーのコピー/ペースト | 右クリックメニュー | entity 一致が必要 | スタンプを複製 | client/src/main/java/open/dolphin/stampbox/StampTreePopupAdapter.java |
| オーダ履歴コピー | Ctrl/Cmd+C または右クリック | 選択行が必要 | クリップボードへテキストコピー | client/src/main/java/open/dolphin/impl/care/OrderHistoryPanel.java |
