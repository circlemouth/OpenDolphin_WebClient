# 04C2.5 モダナイズサーバー API ギャップ実装（RUN_ID=20251212T090000Z）

- 対象期間: 2025-12-12 09:00 - 2025-12-13 18:00 JST（計画）
- 優先度: High / 緊急度: Medium
- 参照チェーン: `AGENTS.md` → `docs/web-client/README.md` → `docs/server-modernization/phase2/INDEX.md` → `docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md` → 本ファイル
- 依存: 04C2 WEB クライアント API 統合実装（完了）、04C3 WEB クライアント API 接続検証（進行中）
- 背景: 04C3 で `/api01rv2/claim/outpatient/mock` と `/orca21/medicalmodv2/outpatient` が 404 のため UI/telemetry 検証がブロック。モダナイズサーバー側の不足エンドポイントを実装し、外来 UX の end-to-end 接続を成立させる。

## 1. 目的
- 404 となっている外来 API を server-modernized に追加し、レスポンス shape が `docs/web-client/architecture/web-client-api-mapping.md` と一致する状態を作る。
- `auditEvent`・`cacheHit`・`missingMaster`・`resolveMasterSource` を既存外来 API と同じフィールド名で返し、Web クライアントの tone/telemetry がローカル接続で確認できるようにする。
- 実装と検証の証跡を RUN_ID 単位で残し、DOC_STATUS および manager checklist に反映する。

## 2. スコープ
- 対象エンドポイント: `/api01rv2/claim/outpatient/mock`, `/orca21/medicalmodv2/outpatient`（外来のみ）
- 対応範囲: server-modernized 側のルート/コントローラ/fixture 追加、MSW/mock の整合、ローカル接続でのレスポンス確認。
- 非スコープ: ORCA 本番/Stage への直結、Legacy `server/` 配下の修正、入院 API 実装。

## 3. 前提・参照
- RUN_ID=`20251212T090000Z` を DOC_STATUS・証跡ログ・artifacts で統一する。
- 証跡パス: `docs/server-modernization/phase2/operations/logs/20251212T090000Z-api-gap-fix.md` を新設し、作業メモ・結果を集約。
- 参照ドキュメント: `docs/server-modernization/phase2/foundation/`、`docs/web-client/architecture/web-client-api-mapping.md`、`docs/web-client/ux/reception-schedule-ui-policy.md`。

## 4. 作業項目
1. 現行 server-modernized で外来 claim/medicalmodv2 のルート・コントローラ有無を確認し、追加が必要なファイル/階層を特定する（再起動禁止の制約に留意）。
2. `/api01rv2/claim/outpatient/mock` と `/orca21/medicalmodv2/outpatient` を追加実装し、レスポンスに `auditEvent`・`cacheHit`・`missingMaster`・`resolveMasterSource` を含める。MSW/mock フィクスチャも同一 shape に合わせる。
3. ローカル接続（VITE_DISABLE_MSW=1）で Reception→Charts→Patients を再走し、404 解消と tone/telemetry の整合を確認。必要に応じて curl でレスポンスも取得。
4. 証跡整理: 実装ログ・curl/console 結果を `docs/server-modernization/phase2/operations/logs/20251212T090000Z-api-gap-fix.md` に記録し、artifacts/webclient/e2e/20251212T090000Z-api-gap/ に HAR・スクリーンショットを保存。
5. DOC_STATUS の Web クライアント UX/Features 行と `PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md` に RUN_ID・ログパスを追記し、04C3 ドキュメントへ結果リンクを追加。

## 5. 成果物
- `docs/server-modernization/phase2/operations/logs/20251212T090000Z-api-gap-fix.md`（作業・検証ログ）
- `artifacts/webclient/e2e/20251212T090000Z-api-gap/`（スクリーンショット・HAR・telemetry メモ）
- 更新ドキュメント: `docs/web-client/planning/phase2/DOC_STATUS.md`、`src/outpatient_ux_modernization/04C3_WEBクライアントAPI接続検証.md`（404 解消結果を追記）、`docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md`

## 6. リスクと対応
- server-modernized の構成により再起動が必要になる場合: 直ちにマネージャーへエスカレーションし、再起動禁止ルールに従い別タスクへ切り出す。
- ORCA 実環境への誤接続リスク: `ORCA_CERTIFICATION_ONLY.md` の手順を遵守し、接続設定変更は行わない。
- レスポンス shape の不整合: `web-client-api-mapping.md` と突合し、差分はログに明記してクライアント側の一時ワークアラウンドを検討。

## 7. 進行管理（初期ステータス）
- ステータス: 未着手 / 進捗 0%
- 次アクション: 手順 1 の現状調査を実施し、必要ファイルとリスタート要否を洗い出す。
- ワーカー報告テンプレ: `【ワーカー報告】RUN_ID=20251212T090000Z / 実施内容 / 証跡パス / DOC_STATUS 行` を用いる。
