# -----------------------------
# OpenDolphin Docker Compose 環境変数サンプル
# 必要に応じて `.env` を作成し、値を上書きしてください。
# -----------------------------

# PostgreSQL
POSTGRES_DB=opendolphin
POSTGRES_USER=opendolphin
POSTGRES_PASSWORD=opendolphin
# ↑ 開発用途のデフォルト。運用環境では 16 文字以上・Vault 管理の強度パスワードを必ず設定する。未変更のまま本番へ投入すると DB 接続が拒否される。
POSTGRES_PORT=5432
POSTGRES_HOST_AUTH_METHOD=md5
POSTGRES_INITDB_ARGS="--auth-host=md5 --auth-local=trust"

# WildFly ポート
APP_HTTP_PORT=8080
APP_ADMIN_PORT=9990

# WildFly Maven プラグイン (任意設定)
WILDFLY_HOSTNAME=localhost
WILDFLY_PORT=9990
WILDFLY_SERVER_ID=wildfly-management

# 2FA（TOTP/FIDO2）用 AES キー
FACTOR2_AES_KEY_B64=
# ↑ 未設定で server-modernized を起動すると Jakarta EE デプロイ初期化が失敗し、WildFly が停止する。dev compose ではダミー値が供給されるが、本番では 32-byte ランダムキーを Base64 した値を必須設定。

# Elytron 移行用: ヘッダ認証フォールバックの有効/無効
LOGFILTER_HEADER_AUTH_ENABLED=true
# ↑ `ops/tools/logfilter_toggle.sh` でも更新可能。false にするとヘッダベース認証を拒否する。

# 外部サービス (Plivo SMS)
PLIVO_AUTH_ID=
PLIVO_AUTH_TOKEN=
PLIVO_SOURCE_NUMBER=
# ↑ いずれも Secrets 管理対象。本番で未設定のまま SMS 送信を呼び出すと 401/403 エラーになる。テスト環境では空のままで問題ない。
PLIVO_BASE_URL=https://api.plivo.com/v1/
PLIVO_ENVIRONMENT=production
PLIVO_LOG_LEVEL=NONE
PLIVO_LOG_MESSAGE_CONTENT=false
PLIVO_DEFAULT_COUNTRY=+81

# Docker Compose プロファイル
# モダナイズ版サーバーを試す場合は、`docker compose --profile modernized up -d server-modernized` を実行する。

# 添付ファイル保存モード / S3 モック
MODERNIZED_STORAGE_MODE=database
ATTACHMENT_STORAGE_CONFIG_PATH=/opt/jboss/config/attachment-storage.yaml

# MinIO (S3 互換) 設定。dev 用デフォルトのため本番では必ず Secrets で上書きすること。
MINIO_API_PORT=9000
MINIO_CONSOLE_PORT=9001
MINIO_ROOT_USER=opendolphin
MINIO_ROOT_PASSWORD=opendolphin-secret

# 添付ファイル用 S3 エンドポイント／資格情報
ATTACHMENT_S3_ENDPOINT=http://minio:9000
ATTACHMENT_S3_ACCESS_KEY=opendolphin
ATTACHMENT_S3_SECRET_KEY=opendolphin-secret
ATTACHMENT_S3_BUCKET=opendolphin-attachments
ATTACHMENT_S3_REGION=ap-northeast-1
ATTACHMENT_S3_BASE_PATH=clinics/${FACILITY_ID}
ATTACHMENT_S3_FORCE_PATH_STYLE=true
ATTACHMENT_S3_SERVER_SIDE_ENCRYPTION=AES256
ATTACHMENT_S3_KMS_KEY_ID=
ATTACHMENT_S3_MULTIPART_THRESHOLD_MB=64
