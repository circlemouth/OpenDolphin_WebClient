# ドキュメント棚卸しステータス（Phase 2）

Web クライアントおよびサーバーモダナイズで参照する資料を「すぐ使うものだけを見える化」するための台帳。月次の Phase2 定例（毎月第1火曜）で更新し、更新後は `docs/web-client/README.md` の該当セクションにリンクを追記する。Legacy サーバー／旧クライアントは参照専用アーカイブであり、差分検証のためにのみ起動を許可する方針で、モダナイズ版サーバー × 新 Web クライアント連携に直接関係する資料を Active 優先とする。

## Phase2 ガバナンス必読チェーン

> **Phase2 ガバナンス必読チェーン / 接続・RUN 運用共通ルール**  
> 1. `AGENTS.md` → `docs/web-client/README.md` → `docs/server-modernization/phase2/INDEX.md` → `docs/managerdocs/PHASE2_MANAGER_ASSIGNMENT_OVERVIEW.md` → 各領域チェックリストの順で参照・更新し、同一 RUN_ID を連携する。  
> 2. WebORCA 接続先は `https://weborca-trial.orca.med.or.jp/`（BASIC 認証 `trial` / `weborcatrial`）のみとし、他環境や `curl --cert-type P12` を使った本番アクセスは禁止。  
> 3. RUN_ID は `YYYYMMDDThhmmssZ` 形式を採用し、指示・README・DOC_STATUS・ログ・証跡ディレクトリのすべてで同一値を共有する。観点ごとに派生 RUN_ID を使う場合は親 RUN_ID を明示し、ログ先頭と備考欄へ併記する。  
> 4. DOC_STATUS 更新は (a) 最終コミット確認 → (b) Active/Dormant/Archive 判定 → (c) 備考に RUN_ID / 証跡パスを追記 → (d) ハブドキュメントへ同日付反映、の順で行い、完了報告前にチェック。  
> 5. Legacy サーバー/クライアントは参照専用アーカイブであり、差分検証のためにのみ起動可（保守・稼働維持作業は禁止）。

## ステータス定義
- **Active**: 直近 30 日以内に更新 or 今後 30 日以内に作業予定がある。リンク切れがないことを確認し、担当者を必ず明記。
- **Dormant**: 31〜180 日間更新がなく、参照頻度が低下。次に参照する可能性があるイベント（例: リリース、検証ウィンドウ）を備考に記載し、担当者レビュー期限を設定。
- **Archive**: 180 日以上更新がなく、現行フローから切り離された資料。`docs/archive/<YYYYQn>/` 配下へ移動し、元ファイルにはスタブを残す。

## 棚卸し手順
1. `git log -1 --format='%cs %h' <path>` で最終更新日とコミットを記録。
2. `rg -n '<file name>' docs -g"*.md"` で参照元件数を確認し、Active 化が必要か判断。
3. ステータス変更時は本ファイルの表と `docs/web-client/README.md` / 関係する README を同時に更新。
4. Archive へ移動する場合は `docs/archive/<YYYYQn>/README.md` に理由と復活条件を追記し、PR 説明欄に「Archive Move」を付記。

## トラッキング対象（2025-11-07 更新）
| ドキュメント | スコープ | ステータス | 最終レビュー | 備考 / 次アクション |
| --- | --- | --- | --- | --- |
| [`docs/web-client/README.md`](../../README.md) | Web クライアント | Active | 2025-11-07 | 再構成済み。週次でリンク検査を実施し、Phase2 INDEX と同期する。
| [`README.md` helper 節](../../../README.md#helper-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88ops-toolshelper_send_parallel_requestsh) | Ops/Helper | Active | 2025-11-13 | helper compose サービス追加と `HELPER_INNER_COMMAND` フォールバック（RUN_ID=`20251119ThelperComposeEchoZ1`/`20251119ThelperFallbackEchoZ1`）を追記。`docs/server-modernization/phase2/operations/LEGACY_MODERNIZED_CAPTURE_RUNBOOK.md` §5/§8.1 と相互リンク済み。 |
| [`docs/web-client/architecture/REPOSITORY_OVERVIEW.md`](../../architecture/REPOSITORY_OVERVIEW.md) | Web クライアント | Active | 2025-11-12 | Modules 節へ共通モジュール共有方針と `-jakarta` classifier 併産手順を追記。`patches/common_shared_policy.md` へ根拠リンクを集約し、質問対応フローを一本化。 |
| [`docs/web-client/architecture/WEB_CLIENT_REQUIREMENTS.md`](../../architecture/WEB_CLIENT_REQUIREMENTS.md) | Web クライアント | Active | 2025-11-12 | §5.4 に facility=9001/`userName=9001:doctor1` を前提とした公開/共有タブの切替ガードと 403 フォールバック記載を追加し、§14.6 に `GET /stamp/tree/{facility}/{public|shared|published}`（RUN_ID=`20251113Tstamp{Public,Shared,Published}PlanZ1`）の API 定義を追記。`TRACEID_JMS_RUNBOOK.md` Appendix A.4 / `domain-transaction-parity.md` Appendix A.5 とリンク済み。 |
| [`docs/web-client/architecture/SERVER_MODERNIZATION_PLAN.md`](../../architecture/SERVER_MODERNIZATION_PLAN.md) | Web クライアント | Active | 2025-11-15 | Phase2 節へ ORCA REST ラッパー Backlog（タスク ORCA-REST-01〜04）と Runbook 参照先（`ORCA_CONNECTIVITY_VALIDATION.md` §4-5）を追記し、P0/P1 優先度と検証ステップを明文化。 |
| [`docs/server-modernization/phase2/domains/RESERVATION_BATCH_MIGRATION_NOTES.md`](../../../server-modernization/phase2/domains/RESERVATION_BATCH_MIGRATION_NOTES.md) | モダナイズ/連携 | Active | 2025-11-09 | §8 に Legacy WildFly10 復旧ログ／`ServerInfoResource` 証跡を追記し、CLAIM/DIAGNOSIS 検証ログから新規 artifacts へリンク済み。次回は ClaimSender/DiagnosisSender の修正結果と突合する。 |
| [`docs/server-modernization/phase2/domains/ORCA_REST_IMPLEMENTATION_NOTES.md`](../../../server-modernization/phase2/domains/ORCA_REST_IMPLEMENTATION_NOTES.md) | モダナイズ/外部連携（ORCA） | Active | 2025-11-14 | 担当: Hayato（2025-11-14 更新）<br>- API_PARITY / PHASE2_PROGRESS Sprint2 アンカー更新済<br>- ORCA_API_STATUS RUN_ID タグ整備済<br>- `ORCA_CONNECTIVITY_VALIDATION.md` §4.3-§4.4 テンプレ同期済<br>- `MODERNIZED_API_DOCUMENTATION_GUIDE.md` §3.2 参照済（Runbook 紐付け確認） |
| [`docs/server-modernization/phase2/operations/assets/orca-api-spec/README.md`](../../../server-modernization/phase2/operations/assets/orca-api-spec/README.md) | モダナイズ/連携 | Active | 2025-11-13 | firecrawl で 60 ページを Markdown 化し、`manifest.json` と `orca-api-matrix.with-spec.csv` から API 番号 ↔ 仕様ファイルを即時参照できるよう整理。Runbook/INDEX からリンク済み。 |
| [`docs/server-modernization/phase2/operations/assets/orca-tec-index/README.md`](../../../server-modernization/phase2/operations/assets/orca-tec-index/README.md) | モダナイズ/連携 | Active | 2025-11-13 | 技術情報トップ/CLAIM/PUSH/MONPE 等 15 ページを firecrawl 取得し、`raw/*.md` と `manifest.json` に整理。帳票・カスタマイズ資料へのリンクを Runbook/INDEX/ログと連携。 |
| [`docs/server-modernization/phase2/operations/assets/orca-use-guides/README.md`](../../../server-modernization/phase2/operations/assets/orca-use-guides/README.md) | モダナイズ/運用 | Active | 2025-11-13 | glserver SSL クライアント認証マニュアル（`glserver_ssl_client_verification4`）を firecrawl 取得し、証明書設定手順を Runbook から参照可能にした。今後も `/receipt/use/` 配下の運用ガイドを追加予定。 |
| [`docs/server-modernization/phase2/operations/assets/orca-trialsite/README.md`](../../../server-modernization/phase2/operations/assets/orca-trialsite/README.md) | モダナイズ/運用 | Active | 2025-11-14 | WebORCA トライアルサーバー情報を firecrawl 取得し、URL・資格情報・利用制限・初期データを `manifest.json` / `raw/trialsite.md` に整理。`mac-dev-login.local.md` や ORCA Runbook から引用可能にした。 |
| [`docs/server-modernization/MODERNIZED_REST_API_INVENTORY.md`](../../../server-modernization/MODERNIZED_REST_API_INVENTORY.md) | モダナイズ/連携 | Active | 2025-11-15 | §7 に Matrix No.6-18 & 33-37 の ORCA ラッパー状況表を追加し、`API_PARITY_MATRIX.md` の計画列と相互参照可能にした。 |
| [`docs/server-modernization/phase2/domains/API_PARITY_MATRIX.md`](../../../server-modernization/phase2/domains/API_PARITY_MATRIX.md) | モダナイズ/連携 | Active | 2025-11-15 | ORCA API 向け「実装計画」列と 18 件のラッパー計画表を追加し、エンドポイント案／DTO／依存サービス／リリーススプリントを整理。 |
| [`docs/server-modernization/phase2/operations/ORCA_API_STATUS.md`](../../../server-modernization/phase2/operations/ORCA_API_STATUS.md) | モダナイズ/連携 | Active | 2025-11-19 | Trial 切替（`https://weborca-trial.orca.med.or.jp/`, `trial/weborcatrial`）と CRUD 可ルールを反映。全 API 行を `RUN_ID=TorcaTrialCrudZ#`／`artifacts/.../trial/` と紐付け、`logs/2025-11-19-orca-trial-crud.md` から Evidence へジャンプできるよう整理。 |
| [`docs/server-modernization/phase2/operations/MODERNIZED_API_DOCUMENTATION_GUIDE.md`](../../../server-modernization/phase2/operations/MODERNIZED_API_DOCUMENTATION_GUIDE.md) | モダナイズ/連携 | Active | 2025-11-14 | モダナイズ REST/ORCA 連携資料のナビゲーションと最新ステータスを集約。`MODERNIZED_REST_API_INVENTORY.md` / `API_PARITY_MATRIX.md` / ORCA Runbook / Evidence ログの導線を一本化。 |
| [`docs/server-modernization/phase2/operations/logs/ORCA_HTTP_404405_HANDBOOK.md`](../../../server-modernization/phase2/operations/logs/ORCA_HTTP_404405_HANDBOOK.md) | モダナイズ/連携 | Active | 2025-11-19 | Trial 版ハンドブックへ刷新。`curl -u trial:weborcatrial` / `RUN_ID=TorcaTrialCrudZ#` の標準コマンドと `trial-crud-logging` セクションを追加し、`docs/server-modernization/phase2/operations/logs/2025-11-19-orca-trial-crud.md` を参照。 |
| [`docs/server-modernization/phase2/notes/orca-api-field-validation.md`](../../../server-modernization/phase2/notes/orca-api-field-validation.md) | モダナイズ/連携 | Active | 2025-11-19 | 凡例を「WebORCA Trial + CRUD 可」へ更新し、seed 記述は「参考アーカイブ／Trial UI で再登録」ルールに変更。No.19-38 の RUN_ID も `TorcaTrialCrudZ#` 前提に差し替えた。 |
| [`docs/server-modernization/phase2/operations/WORKER0_MESSAGING_BACKLOG.md`](../../../server-modernization/phase2/operations/WORKER0_MESSAGING_BACKLOG.md) | モダナイズ運用 | Archive | 2025-11-07 | 2025-11-15 に `docs/archive/2025Q4/server-modernization/phase2/operations/WORKER0_MESSAGING_BACKLOG.md` へ移動。JMS backlog は `domains/RESERVATION_BATCH_MIGRATION_NOTES.md` で継続管理。
| [`docs/server-modernization/phase2/notes/static-analysis-plan.md`](../../../server-modernization/phase2/notes/static-analysis-plan.md) | 共通（Ops） | Dormant | 2025-11-07 | Ops Runbook へ必要箇所を移したら Archive。Slack/PagerDuty 設定は Runbook 側で保守。
| [`docs/server-modernization/phase2/notes/common-dto-diff-A-M.md`](../../../server-modernization/phase2/notes/common-dto-diff-A-M.md) / [`N-Z`](../../../server-modernization/phase2/notes/common-dto-diff-N-Z.md) | 共通 DTO | Archive | 2025-11-07 | 2025-11-15 に `docs/archive/2025Q4/server-modernization/phase2/notes/` へ移動。Legacy DTO 再検証時のみ Archive + `docs/archive/2025Q4/dto-diff/` CSV を参照。
| [`docs/server-modernization/legacy-server-modernization-checklist.md`](../../../server-modernization/legacy-server-modernization-checklist.md) | Legacy サーバー計画 | Archive | 2025-11-07 | 2025-11-15 に `docs/archive/2025Q4/server-modernization/legacy-server-modernization-checklist.md` へ移動。現行計画は `docs/server-modernization/phase2/PHASE2_PROGRESS.md`/Runbook を参照。
| [`docs/server-modernization/phase2/operations/TRACEID_JMS_RUNBOOK.md`](../../../server-modernization/phase2/operations/TRACEID_JMS_RUNBOOK.md) | Network/Build | Active | 2025-11-12 | Appendix A.4 を Stamp 公開系 GET（RUN_ID=`20251113Tstamp{Public,Shared,Published}PlanZ1`）向けに再編し、`PARITY_HEADER_FILE=tmp/parity-headers/stamp_tree_<variation>_<RUN_ID>.headers`（`userName=9001:doctor1`）／helper コマンド（`--network legacy-vs-modern_default`）／`logs/send_parallel_request.log`／JMS before/after の保存先を定義。facility ミスマッチ 403（`RUN_ID=20251113TstampPublicPlanZ4`）の WARN ログ採取手順も追記した。 |
| [`docs/server-modernization/phase2/notes/license-config-check.md`](../../../server-modernization/phase2/notes/license-config-check.md) | モダナイズ/運用 | Active | 2025-11-13 | §7.9 に `ops/tools/license_monitor_job.sh` の実行フロー／`RUN_ID=20251122TlicenseNightlyZ1` 実績（Modernized のみ監視、Slack/PagerDuty 未送信ログ）を追加し、§7.10 へ `ops/db/maintenance/license_audit_cleanup.sql` 実行記録（maintenance/20251113TlicenseCleanupZ1）を追記。`latest_status.json` と成果物構造を確定。 |
| [`docs/server-modernization/phase2/operations/SECURITY_SECRET_HANDLING.md`](../../../server-modernization/phase2/operations/SECURITY_SECRET_HANDLING.md) | モダナイズ/運用 | Active | 2025-11-13 | License secrets plan documented: Vault への移管手順（生成→暗号化→デプロイ→ローテーション）と `tmp/license/README.md` の利用ルールを整備。Phase3 では Factor2/FIDO2 へ拡張予定。 |
| [`docs/server-modernization/phase2/operations/POSTGRES_BASELINE_RESTORE.md`](../../../server-modernization/phase2/operations/POSTGRES_BASELINE_RESTORE.md) | モダナイズ/DB | STABLE | 2025-11-13 | RUN_ID=`20251120TbaselineGateZ1` の Gate 再実証で §6 を更新（55433 ポート再割当・`LOCAL.FACILITY.0001:nurse` 追加入りシード再適用・`DROP TABLE flyway_schema_history` → `flyway baseline` 再実施の再起動注意を明文化）し、証跡 `artifacts/parity-manual/db-restore/20251120TbaselineGateZ1/` と down/up 時ログ採取ガイドを紐付けた。 |
| [`docs/server-modernization/phase2/SERVER_MODERNIZED_DEBUG_CHECKLIST.md`](../../../server-modernization/phase2/SERVER_MODERNIZED_DEBUG_CHECKLIST.md) | モダナイズ/運用 | Active | 2025-11-12 | RUN_ID=`20251116ThealthInsZ1` の HealthInsuranceModel 恒久化ログに加え、フェーズ4 backlog へ Factor2/FIDO/Messaging 失敗（`UnknownEntityException` / `IDocInfo` 重複、RUN_ID=`20251112Tfactor2{Totp,Fido}Z1`, `20251112TmessagingDiagZ1`）と Lab GET (`RUN_ID=20251112TlabReportZ1`, Modern JMS `messages-added=10L→12L`) の結果・残課題を追記。 |
| [`docs/server-modernization/phase2/operations/TRACEID_JMS_RUNBOOK.md`](../../../server-modernization/phase2/operations/TRACEID_JMS_RUNBOOK.md) | モダナイズ/運用 | Active | 2025-11-13 | Appendix A.6 を RUN_ID=`20251118TmessagingParityZ2`（Claim/MML）と `20251118TdiagnosisAuditZ2`（Legacy/Modern 診断監査）で更新し、`artifacts/parity-manual/messaging/20251118TdiagnosisAuditZ2/` から `d_audit_event` TSV を参照できるようにした。旧 RUN_ID=`20251112TmessagingDiagZ1` の失敗ログは参照用として残す。 |
| [`docs/server-modernization/phase2/operations/LEGACY_MODERNIZED_CAPTURE_RUNBOOK.md`](../../../server-modernization/phase2/operations/LEGACY_MODERNIZED_CAPTURE_RUNBOOK.md) | モダナイズ/運用 | Active | 2025-11-12 | §3.4「Legacy JMS before/after ログ採取」を新設。helper → `docker compose exec` 二段実行テンプレ、`before/after` 命名、`rg`/`diff`/`less` による確認方法、`PHASE2_PROGRESS.md`・チェックリストとの連携先を追記。 |
| [`artifacts/parity-manual/network/TEMPLATE/README.txt`](../../../../artifacts/parity-manual/network/TEMPLATE/README.txt) | モダナイズ/ネットワーク | Active | 2025-11-12 | ネットワーク復旧テンプレ／RUN_ID コピー手順と pfctl・curl・tcpdump・`docker compose logs` の採取コマンドを記載。Runbook §9 のチェックリスト完了ごとに本備考へ RUN_ID を追記し、DOC_STATUS をエビデンスで更新する。 |
| [`docs/server-modernization/phase2/PHASE2_PROGRESS.md`](../../../server-modernization/phase2/PHASE2_PROGRESS.md) | モダナイズ/運用 | Active | 2025-11-13 | RUN_ID=`20251122TenvCheckZ4`（`artifacts/parity-manual/env-status/20251122TenvCheckZ4/`）を追記。Legacy 8080 は compose 管理外のため `--skip-legacy` + `opendolphin-server.manual.log` で証跡化し、Modernized 9080 は Basic+MD5 で 200 (`X-Trace-Id=58364c00-b47b-453d-a8bf-b8511c084a37`) を維持。`ops/monitoring/otel-collector-config.yaml` の metricstransform / resource processor で `deployment` ラベル衝突を解消し、`otel-collector.logs.txt` から duplicate label WARN が消えたことを記録。README env-status 節に `--skip-legacy` + manual log 手順を反映。 |
| [`docs/server-modernization/phase2/notes/domain-transaction-parity.md`](../../../server-modernization/phase2/notes/domain-transaction-parity.md) | モダナイズ/ドメイン | Active | 2025-11-13 | Appendix A.2 の Factor2 行を RUN_ID=`20251118Tfactor2ParityZ2`（Modern=200 / Legacy=404 既知、JMS +3、`d_factor2_*` CSV あり）で更新し、Messaging backlog (RUN_ID=`20251112TmessagingDiagZ1`) は継続課題として残した。 |
| [`docs/web-client/operations/LEGACY_INTEGRATION_CHECKS.md`](../../operations/LEGACY_INTEGRATION_CHECKS.md) | Web クライアント | Active | 2025-11-07 | 旧/新サーバー切替検証の手順書。実施ログを `operations/logs/` に集約する。
| [`docs/web-client/process/SWING_PARITY_CHECKLIST.md`](../../process/SWING_PARITY_CHECKLIST.md) | Web クライアント（Swing parity） | Archive | 2025-11-13 | 2025-11-15 に `docs/archive/2025Q4/web-client/process/SWING_PARITY_CHECKLIST.md` へ移動。parity 追跡は `docs/web-client/planning/phase2/PHASE2_PROGRESS.md` を参照。 |
| [`docs/server-modernization/phase2/notes/touch-api-parity.md`](../../../server-modernization/phase2/notes/touch-api-parity.md) | モダナイズ/REST/Testing | Active | 2025-11-18 | §14 を追加し、`tmp/sql/touch_document_full_seed.sql` による `d_module.beanbytes`→`oid` 変換と RUN_ID=`20251118TtouchParityZ4` 非 dry-run parity（helper 経由で `ops/tools/send_parallel_request.sh` / `api_parity_response_check.py` 実行、`touch_document_full` 200 応答）を記録。dryRun 版 (§13) とあわせて Gate の基準 RUN_ID を明示した。 |
| [`docs/server-modernization/phase2/notes/test-data-inventory.md`](../../../server-modernization/phase2/notes/test-data-inventory.md) | モダナイズ/監査 | Active | 2025-11-10 | §2.4 を新設し、`artifacts/parity-manual/audit/20251110T132800Z/{legacy,modern}_d_audit_event.log` を棚卸。Legacy=0 行 / Modernized=旧データのみというギャップと、WildFly 未展開による再取得待ちを明記。 |
| [`docs/server-modernization/phase2/operations/TRACE_PROPAGATION_CHECK.md`](../../../server-modernization/phase2/operations/TRACE_PROPAGATION_CHECK.md) | モダナイズ/運用 | Active | 2025-11-12 | §7 に `RUN_ID=20251111TclaimfixZ3` の結果（Legacy/Modern200、《JMS messages-added=4L→5L》《d_audit_event` id=80/79/78》）を追記し、`TRACEID_JMS/20251111TclaimfixZ3/claim_send/` と `logs/{jms_dolphinQueue_read-resource,d_audit_event_claim}.txt`、`artifacts/parity-manual/db/20251111TclaimfixZ3/{legacy,modern}/audit_event_{backup.csv,status_log.txt,validation_log.txt}` へのリンクを更新。前 RUN_ID=`20251111TclaimfixZ2`（Legacy404／Modern500）は blockers セクションへ移動。 |
| [`docs/server-modernization/phase2/notes/ops-observability-plan.md`](../../../server-modernization/phase2/notes/ops-observability-plan.md) | モダナイズ/運用 | Active | 2025-11-10 | compose 既定値バイパス手順（`tmp/secrets-repro/missing_factor2|missing_sysad.env` の空白埋め）と WSL での `docker-compose` 不在ブロッカー、Mac/Docker Desktop での再取得計画を追記。 |
| [`docs/server-modernization/operations/API_PARITY_RESPONSE_CHECK.md`](../../../server-modernization/operations/API_PARITY_RESPONSE_CHECK.md) | モダナイズ/REST | Active | 2025-11-09 | 手動比較向けに `compare: "text"` を利用する config（tmp/parity-touch/20251109T060930Z）と実行例を追記。 |
| [`docs/server-modernization/phase2/operations/EXTERNAL_INTERFACE_COMPATIBILITY_RUNBOOK.md`](../../../server-modernization/phase2/operations/EXTERNAL_INTERFACE_COMPATIBILITY_RUNBOOK.md) | モダナイズ/運用 | Active | 2025-11-09 | Gate #44（MmlSenderBeanSmokeTest）を追加し、`tmp/mml-tests/` フィクスチャ確認→`mvn -Dtest=...` 実行→`tmp/mvn-mml.log` 証跡→`artifacts/parity-manual/CLAIM_DIAGNOSIS_FIX/<UTC>/` への保存手順を明文化。 |
| [`docs/server-modernization/phase2/notes/messaging-parity-check.md`](../../../server-modernization/phase2/notes/messaging-parity-check.md) | モダナイズ/連携 | Active | 2025-11-13 | §8.6 を新設し、Legacy `POST /karte/diagnosis/claim` 500 の再現条件（`tmp/diagnosis_seed.sql`、`dolphin.claim` logger 設定）と `RUN_ID=20251118TdiagnosisLegacyZ1` 証跡を追記。Legacy=200/Modern=200、JMS（Legacy 0→0 / Modern 5→6）、`artifacts/parity-manual/messaging/20251118TdiagnosisLegacyZ1/` への保存先と audit ギャップの TODO を明記。 |
| [`docs/server-modernization/phase2/notes/domain-transaction-parity.md`](../../../server-modernization/phase2/notes/domain-transaction-parity.md) | モダナイズ/ドメイン | Active | 2025-11-12 | §3.5 を RUN_ID=`20251116TreactorFixZ1` の Maven DuplicateProjectException 恒久対応ログ（help:effective-pom／package／`server-modernized-target-ls.txt`）へ差し替え、`mvn -f pom.server-modernized.xml -pl server-modernized -am <goal>` を必須手順として明文化。`patches/maven_duplicate_fix_plan.md`／チェックリスト更新とのひも付けも追記。 |
| [`ops/tests/api-smoke-test/rest_error_scenarios.manual.csv`](../../../ops/tests/api-smoke-test/rest_error_scenarios.manual.csv) / [`README.manual.md`](../../../ops/tests/api-smoke-test/README.manual.md#rest-例外ケース再現テンプレ最新版-run_id20251111t070532z-基準) | モダナイズ/REST 監査 | Active | 2025-11-12 | RUN_ID=`20251115TresterrexZ1` で `rest_error_{bad_request,unauthorized,internal}` を再取得し、`error=invalid_activity_param` 400 / `error=unauthorized` 401（`reason=authentication_failed`）/ `error=karte_lookup_failed` 500 の JSON 期待値と `artifacts/parity-manual/rest-errors/20251115TresterrexZ1/README.md` を追記。ヘッダーテンプレは `tmp/rest-error-headers/trace_http_*_20251115TresterrexZ1.headers` を基準に更新。 |
| [`docs/server-modernization/phase2/notes/storage-mode-checklist.md`](../../../server-modernization/phase2/notes/storage-mode-checklist.md) | モダナイズ/運用 | Active | 2025-11-13 | RUN_ID=`20251119TattachmentAutoZ1` で `run.sh --modes all` を再実行したが、`SystemResource#addFacilityAdmin` が `select nextval('facility_num')` で `relation "facility_num" does not exist` となり database モードの初期化で停止。`opendolphin_modern` に `d_users`/`facility_model`/`facility_num` 等のベーステーブルが生成されていないことを確認したため、`§5` に「ベースライン復旧前は自動スクリプト実行不可」と追記。`artifacts/parity-manual/attachments/20251119TattachmentAutoZ1/database/logs/server.log` に再現ログあり。Baseline 復旧（`local_synthetic_seed.sql` 適用 or Secrets dump リストア）後に検証予定。 |
| [`docs/server-modernization/phase2/notes/reporting-parity.md`](../../../server-modernization/phase2/notes/reporting-parity.md) | モダナイズ/帳票 | Active | 2025-11-13 | §6.5〜§7 に Legacy WAR への reporting.jar 差し替え手順と RUN_ID=`20251118TkarteJaZ{1,2}` の CLI 証跡（PDF/`pdffonts`/`pdftotext`/`diff-pdf`）を追記。`artifacts/parity-manual/reporting_karte_{ja,en}/README.md` にサマリを残し、Checklist フェーズ7-帳票の要件を満たした。今後はレセ電テンプレ拡充と `Chunk.NEWLINE` 由来の Helvetica 非埋め込み解消を残課題として扱う。 |
| [`docs/server-modernization/phase2/notes/rest-touch-diff-report.md`](../../../server-modernization/phase2/notes/rest-touch-diff-report.md) | モダナイズ/REST | Active | 2025-11-12 | ADM スナップショットフィクスチャを `ops/tests/fixtures/adm/adm10|adm20/<scenario>.json` へ移管し、`tmp/legacy-fixtures` には Stub を残した旨と RUN_ID=`20251116TadmSnapshotZ1` の定常実行ログ（Surefire/README 参照）を追記。CI 取り込み設計は Git 管理フィクスチャ前提に更新済み。 |

| [`security-elytron-migration.md`](../../../server-modernization/phase2/notes/security-elytron-migration.md) | モダナイズ/セキュリティ | Active | 2026-06-16 | LOGFILTER_HEADER_AUTH_ENABLED トグルと Elytron リリース基準を集約。ops/tools/logfilter_toggle.sh の使用方法・次アクションを記載。 |
| [`FACTOR2_RECOVERY_RUNBOOK.md`](../../../server-modernization/phase2/operations/FACTOR2_RECOVERY_RUNBOOK.md) | モダナイズ/運用 | Active(ドラフト) | 2026-06-16 | FACTOR2_AES_KEY_B64 欠落時の起動失敗→復旧ステップを整理。WildFly 起動ログは artifacts/parity-manual/secrets/ に保存し、Docker 利用環境で追補予定。 |

### モダナイズ/外部連携（ORCA）

> メモ: 週次テーブルを更新する際は `npm run orca-weekly` の出力（`tmp/orca-weekly-summary.{json,md}`）を貼り付けて README／PHASE2_PROGRESS／本表の値を同期し、`artifacts/orca-connectivity/validation/<UTC>/weekly_summary.log` に実行ログを残す。

| 週次日付 | 更新者 | 主な変更 | 次回アクション |
| --- | --- | --- | --- |
| W22 CLI Run (2025-11-15) | Codex | RUN_ID=`20251115T134513Z` で DNS/TLS（`nslookup_2025-11-15T22:50:38+09:00.txt`,`openssl_s_client_2025-11-15T22:50:42+09:00.txt`）と `/api01rv2/acceptlstv2`（HTTP200/`Api_Result=13`）、`/api01rv2/appointlstv2`（HTTP200/`Api_Result=12`）、`/api/api21/medicalmodv2`（HTTP200/`Api_Result=10`）を CLI から取得し、`artifacts/orca-connectivity/20251115T134513Z/{dns,tls,crud,coverage,blocked}`＋`docs/server-modernization/phase2/operations/logs/2025-11-20-orca-trial-crud.md` に反映。`coverage_matrix.md` では firecrawl 仕様 60 件を `Trial 提供=51 / Trial 非提供=9` へ分類し、Blocked ラベル `TrialSeedMissing` を追加。 | GUI 端末で doctor/patient seed を `trialsite.md#sample` に合わせて再登録し、`RUN_ID=20251115T134513Z` 証跡の CRUD を `Api_Result=00` へ更新。`blocked/README.md` の再開条件（Chrome 1024x768 + seed 再投入）を満たしたら、UI before/after を `ui/` に追記し DOC_STATUS を更新する。 |
| W22 TaskC Update (2025-11-21) | Codex | `20251120TrialConnectivityWSLZ1` へ nslookup/openssl を 14:37 JST で追録（`172.192.77.103` 応答・`*.orca.med.or.jp` TLS）し、`20251120TrialAppoint/AcceptCrudZ1` では XML payload（`payloads/appointlst_trial.xml`,`acceptlst_trial.xml`,`acceptmod_trial.xml`）で `curl -vv -u trial:weborcatrial ...` を実行（appointlst=HTTP200/`Api_Result=12`、acceptlst=HTTP200/`Api_Result=13`、acceptmod=HTTP404「APIが存在しません」）。`docs/server-modernization/phase2/operations/logs/2025-11-20-orca-trial-crud.md` に HTTP/Api_Result/証跡パスを追記し、`trialsite.md#limit` を引用して acceptmod / /orca14 / api21 系を Blocker=`TrialLocalOnly`（doctor seed + ローカル ORCA/ORMaster 待ち）として整理。 | TrialLocalOnly（/orca14 POST・ORMaster API）解除条件＝「ローカル ORCA 起動許可＋doctor seed 復旧＋GUI 端末確保」をもとに RUN_ID を再開。XML payload での再実測と UI before/after を `artifacts/orca-connectivity/20251120Trial*/` へ追加し、`trialsite` 禁止操作を引用した Blocker を更新する。 |
| W22 TaskA/B (2025-11-20) | Codex | RUN_ID=`20251120TrialCrudPrepZ1` を新設し、`artifacts/orca-connectivity/20251120TrialCrudPrepZ1/{README.md,data-check/,crud/,ui/}` を作成。`ORCA_CONNECTIVITY_VALIDATION.md` §4.3 と `trialsite.md`（Snapshot 2025-11-19）の方針を RUN_ID メモへ転記し、「新規登録／更新／削除 OK（トライアル環境でのみ）」＋ `curl -u trial:weborcatrial ...` 形式を明文化。CLI サンドボックスにネットワーク/GUI 制限があるため CRUD・UI 証跡は未取得であることを `docs/server-modernization/phase2/operations/logs/2025-11-20-orca-trial-crud.md` に Blocker として記載。checklist XML 化反映済（背景〜タスクB / 2025-11-20 15:05 JST）。 | ネットワーク許可済み端末で `dns/` / `tls/` / `crud/acceptmodv2` / `crud/appointmodv2` / `crud/medicalmodv2` 実測と UI before/after を取得し、`artifacts/orca-connectivity/20251120TrialCrudPrepZ1/` 配下へ追記。禁止操作が必要な場合は `trialsite.md#limit` を引用した Blocker をログへ追加。 |
| W22 TaskC (2025-11-15) | Codex | RUN_ID=`20251120TrialConnectivityWSLZ1` で DNS/TLS/`acceptlstv2`/`/20/adm/phr/phaseA` を WSL2 から再取得し、`trialsite` Snapshot（stat: 2025-11-15 08:24 JST）を README/ログに引用。`20251120TrialAppointCrudZ1`（`api01rv2/appointlstv2`）は HTTP200 でも `Api_Result=91→13→12`、`20251120TrialAppointWriteZ1`（`/orca14/appointmodv2`）は HTTP405、`20251120TrialMedicalCrudZ1`／`20251120TrialAcceptCrudZ1` は `Api_Result=10→14`／`13` で停止し、`trialsite`「職員情報 1010 行」に反して doctor seed が欠落していることを再確認。証跡は `artifacts/orca-connectivity/20251120Trial*/{README,crud}` と `docs/server-modernization/phase2/operations/logs/2025-11-20-orca-trial-crud.md` に集約。 | doctor seed と `/orca14` POST 開放を待ちつつ、GUI 端末で UI before/after を撮影して `artifacts/orca-connectivity/20251120Trial{AppointCrudZ1,AppointWriteZ1,AcceptCrudZ1}/ui/` を補完する。Unlock 後は `Api_Result=00` 取得とデータ戻しログを追記。 |
| W22 Update (2025-11-19) | Codex | Trial 切替完了。`RUN_ID=20251119TorcaTrialCrudZ1` で ORCA API/HTTP ハンドブック/DOC_STATUS/README を `https://weborca-trial.orca.med.or.jp` ＋ `trial/weborcatrial` 前提に更新し、`docs/server-modernization/phase2/operations/logs/2025-11-19-orca-trial-crud.md` を開設。`RUN_ID=20251120TrialConnectivityWSLZ1` では DNS/TLS/`acceptlstv2`（HTTP 200 / `Api_Result=91`）/`/20/adm/phr/phaseA`（HTTP 404）を `artifacts/orca-connectivity/20251120TrialConnectivityWSLZ1/` および `docs/server-modernization/phase2/operations/logs/2025-11-20-orca-trial-crud.md` に記録。CRUD 実測の Evidence パスも `artifacts/orca-connectivity/<RUN_ID>/trial/` へ統一。 | CRUD で生成したデータを順次削除しつつ、`ORCA_API_STATUS.md` の全 API 行を `RUN_ID=TorcaTrialCrudZ#` で埋める。`npm run orca-weekly` で Trial RUN_ID を README/PHASE2_PROGRESS/DOC_STATUS に波及させる。 |
| W22 Kickoff (2025-11-14) | Codex | Task-A/B: Demo/Dolphin/PHR ASP 再登録＆PHR 実装順序 doc を棚卸し。Task-C: RUN_ID=`20251114TphrEvidenceZ1` で `ORCA_CONNECTIVITY_VALIDATION.md` §4.3.1 / `logs/2025-11-13-orca-connectivity.md#task-c-phr-template` / `artifacts/orca-connectivity/TEMPLATE/phr-seq/README.md` を同期し、マネージャーチェックリストに反映。Task-D: RUN_ID=`20251115TorcaPHRSeqZ1` で Phase-A/B（PHR-02/03/10 + PHR-01/04/05/08/09）の curl を実施 (`pass=FJjmq/d7EP` で TLS 成功, HTTP 404)。Task-E: RUN_ID=`20251118TphrLayerPrepZ1` で Layer ID / 画像 / Signed URL 前提を Ops と合意。Task-F: RUN_ID=`20251119TorcaPHRSeqZ1` で Phase-C/D/E（PHR-06/07/11）を再測し、mTLS/Basic 成功→ORCA 側 `/20/adm/phr/*` 未開放のため HTTP 405/404 まで取得（`serverinfo/claim_conn.json` / `wildfly/phr_20251119TorcaPHRSeqZ1.log` / `screenshots/phr-0X_*_response.png` を更新）。Task-G: RUN_ID=`20251120TphrDtoReviewZ1` で DTO・署名 URL フォールバックのレビュー結果を記録し、RUN_ID=`20251121TtaskGImplZ1` で DTO 注釈・SignedUrl フォールバック・`PHRResourceTest` 追加を実装して Blocker を解消。 | 次アクション: (1) Modernized REST（WildFly）経路で Phase-A/B / Phase-C/D/E を提供し、RUN_ID=`20251115TorcaPHRSeqZ1` / `20251119TorcaPHRSeqZ1` を 200/403 + `d_audit_event`（`PHR_LAYER_ID_TOKEN_ISSUE`, `PHR_IMAGE_STREAM`, `PHR_CONTAINER_FETCH` 等）まで前進させる。 (2) `audit/sql/PHR_*.sql` と `logs/phr_container_summary.md` を Modernized 実測で差し替え、ORCA 週次（W22→W23）へ報告。 (3) Runbook (`ORCA_CONNECTIVITY_VALIDATION.md` §4.3.2) / `2025-11-19-phr-seq-phaseCDE.md` / `2025-11-18-phr-layerid-ready.md` を最新 RUN_ID と証跡パスで同期し、マネージャーチェックリスト Task-E をクローズできるよう進捗を記録。 (4) Task-G 完了報告を ORCA 週次へ展開し、残課題を S3 Export Track（フェーズF Blocker: `S3PhrExportStorage` 実装）へ引き継ぐ。 |
| W12〜W16 (2025-10-14〜2025-11-11) | Codex | WebORCA クラウド接続（`curl --cert-type P12`）への移行準備、53 API マトリクス整理、`artifacts/orca-connectivity/<UTC>/` 証跡テンプレと PHASE2_PROGRESS 報告の流れを確立。 | W17 でクラウド疎通証跡を再取得し、ServerInfoResource ガードと evidence 棚卸しルールをレビュー。 |
| W21 (2025-11-12〜2025-11-18) | Codex | `PHASE2_PROGRESS.md` の ORCA テンプレ節へ W18/W19 RUN_ID と Evidence パスを紐付け、`docs/web-client/README.md` ORCA セクションに「直近週次: 2025-11-13 (W21)」を追加してハブ同期を確認。週次棚卸しテーブル（本行）で進捗ログと依存ドキュメントの整合性を更新。 | W22 で 9080 port-forward 復旧後に Modernized 側 200 応答を含む ORCA 実測（`artifacts/orca-connectivity/<新RUN_ID>/`）を採取し、PHASE2_PROGRESS / DOC_STATUS / README を再同期。備考: Evidence Index 整備済み (2025-11-13)／HTTPエラー対応テンプレ作成済み (W38)。 |
| W21 (2025-11-13 再実行) | Codex | RUN_ID=`20251113TorcaP0OpsZ2` を発行し、`artifacts/orca-connectivity/20251113T012013Z/P0_retry/` と `docs/server-modernization/phase2/operations/logs/2025-11-13-orca-connectivity.md` を更新。`acceptlstv2` が 200/`Api_Result=21` まで前進し、Physician_Code=00001 がレスポンスへ反映されたことを PHASE2_PROGRESS 週次欄にも記録。W36 受付 seed（RUN_ID=`20251113TorcaP0OpsZ3`, UTC=`20251113T015810Z`）で `Medical_Information=01` 指定の 200/`Api_Result=00` を `artifacts/orca-connectivity/20251113T015810Z/seed/` に保存。 | Runbook §5 備考を 200/00 実績で更新済み。次は `/orca11`/`/orca14` POST 405 解除の追加タスクを W22 以降へエスカレーション。 |

| ドキュメント | スコープ | ステータス | 最終レビュー | 備考 / 次アクション |
| --- | --- | --- | --- | --- |
| [`docs/server-modernization/phase2/SERVER_MODERNIZED_STARTUP_BLOCKERS.md`](../../../server-modernization/phase2/SERVER_MODERNIZED_STARTUP_BLOCKERS.md) | モダナイズ運用 | Active | 2025-11-09 | 2025-11-09 更新: ORCA ネットワークの `db` alias が `DB_HOST` を上書きする衝突を Appendix 化し、Compose/CLI 差分テンプレと `jboss-cli` 証跡リンクを整理済。Blocking Issue 継続監視（優先度タグ付完了）。 |
| [`docs/server-modernization/phase2/operations/ORCA_CONNECTIVITY_VALIDATION.md`](../../../server-modernization/phase2/operations/ORCA_CONNECTIVITY_VALIDATION.md) | モダナイズ/外部連携 | Active | 2025-11-15 | RUN_ID=`20251115TrialConnectivityCodexZ1` を §4.3 へ追記し、Doctor seed データギャップ対処／`coverage/coverage_matrix.md` 更新／`blocked/README.md` 連携手順を明文化。`acceptlstv2`/`appointlstv2`/`medicalmodv2` の Trial 実測（Api_Result=13/12/14）と `acceptmodv2`/`appointmodv2` HTTP405 をログ化し、Evidence=`artifacts/orca-connectivity/20251115TrialConnectivityCodexZ1/{dns,tls,data-check,crud,coverage,blocked}` と同期。 |
| [`docs/managerdocs/PHASE2_ORCA_CONNECTIVITY_MANAGER_CHECKLIST.md`](../../managerdocs/PHASE2_ORCA_CONNECTIVITY_MANAGER_CHECKLIST.md) | モダナイズ/外部連携 | Active | 2025-11-15 | RUN_ID=`20251115TrialConnectivityCodexZ1` をタスクA〜Eへ追記。`data-check/README.md`（患者 5 桁・GUI 未取得）、`coverage_matrix.md`（firecrawl 79 API 区分）、`blocked/README.md`（HTTP405 + trialsite#limit + Doctor seed ギャップ）、`logs/2025-11-20-orca-trial-crud.md`、`DOC_STATUS` を互いにリンク。 |
| [`docs/managerdocs/PHASE2_ORCA_PHR_GAP_MANAGER_CHECKLIST.md`](../../managerdocs/PHASE2_ORCA_PHR_GAP_MANAGER_CHECKLIST.md) | モダナイズ/外部連携 | Active | 2025-11-15 | PHR RUN_ID とテンプレを共有する参照チェーン／RUN_ID・証跡・DOC_STATUS リンクの報告テンプレ／Archive 判定欄／`mac-dev-login.local.md` 現行チェック欄を追加し、ギャップ補完タスクの報告ルールを明文化。 |
| [`docs/managerdocs/PHASE2_ORCA_SPRINT2_MANAGER_CHECKLIST.md`](../../managerdocs/PHASE2_ORCA_SPRINT2_MANAGER_CHECKLIST.md) | モダナイズ/外部連携 | Active | 2025-11-15 | Sprint2 行にも参照開始順／RUN_ID・証跡・DOC_STATUS をまとめる報告テンプレ／Archive 判定欄／`mac-dev-login.local.md` 現行チェック欄を追加し、ワーカー指示テンプレを共通化。 |
| [`docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md`](../../managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md) | Web クライアント | Active | 2025-11-15 | 参照開始順（AGENTS → Web Client Hub → UX ガイド）と RUN_ID・証跡・DOC_STATUS をまとめる報告テンプレ / Archive 判定欄 / `mac-dev-login.local.md` 現行チェック欄を冒頭に追加し、UX/Ops 指示の共通ルールを明確化。 |
| [`docs/managerdocs/PHASE2_SERVER_FOUNDATION_MANAGER_CHECKLIST.md`](../../managerdocs/PHASE2_SERVER_FOUNDATION_MANAGER_CHECKLIST.md) | モダナイズ/基盤 | Active | 2025-11-15 | 参照開始順（AGENTS → Web Client Hub → Phase2 INDEX）と RUN_ID・証跡・DOC_STATUS を共有する報告テンプレ / Archive 判定欄 / `mac-dev-login.local.md` 現行チェック欄を追加し、foundation/legacy ドキュメント移行時の判定手順を明記。 |
| [`docs/managerdocs/PHASE2_MANAGER_ASSIGNMENT_OVERVIEW.md`](../../managerdocs/PHASE2_MANAGER_ASSIGNMENT_OVERVIEW.md) | 管理 | Active | 2025-11-15 | Phase2 ガバナンス必読チェーンとチェックリスト標準化（参照開始順／報告テンプレ／Archive 判定／端末手順チェック）を追記し、各領域行に 2025-11-15 更新メモを付加。新領域追加時も同テンプレに従う。 |

## 今後のタスク
- [ ] 2025-11-15 までに `DTO diff` を CSV 化し Archive へ移動。
- [x] JMS/予約 Runbook 統合後、`WORKER0_MESSAGING_BACKLOG.md` の stub 化を実施。
- [x] Archive フォルダ構成（`docs/archive/2025Q4/`）を整備し、README テンプレを配布。
