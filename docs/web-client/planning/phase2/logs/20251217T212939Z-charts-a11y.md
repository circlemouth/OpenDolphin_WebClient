# Charts アクセシビリティ監査（RUN_ID=`20251217T212939Z`）

- 対象: Charts ActionBar / ToneBanner（外来本番シェル）
- 目的: aria-live・role・フォーカス順の自動検査（axe）と手動監査で重大違反をゼロにする。
- 環境: `web-client`（MSW ON / jsdom） / Node 22.16 / npm 10.9（ローカル cache を `../tmp/.npm-cache` に指定）
- コマンド: `cd web-client && npm test`

## 実施内容

1. axe 自動検査
   - 追加テスト: `src/features/charts/__tests__/chartsAccessibility.test.tsx`
   - 対象:
     - `ChartsActionBar`（missingMaster=true で送信ブロック時の `role=note` と `aria-describedby`）
     - `ChartsActionBar`（通常状態でのボタンフォーカス順）
     - `ToneBanner`（警告トーン時の `role=alert` / `aria-live=assertive`）
   - 判定: `results.violations.length === 0` を確認（3 ケースとも 0）。
2. フォーカス順・読み上げ理由の手動確認
   - `userEvent.tab()` で `ChartsActionBar` のボタン列が視覚順（終了→送信→印刷→ドラフト→キャンセル）でフォーカス遷移することを確認。
   - missingMaster=true では `ORCA 送信` が `aria-disabled=true` かつ `aria-describedby=charts-actions-blocked`。`role="note"` のガード文言に blocked 理由が含まれることを確認。
   - ToneBanner は `role=alert` / `aria-live=assertive` / `data-run-id` を保持し、患者 ID などのメタを単一テキストとして連結することを確認。

## 結果

- axe 重大違反: 0 件（3 シナリオ）
- フォーカス順: ボタン視覚順と一致（unlock ボタンは disabled のためスキップ）
- 操作不能理由: missingMaster/fallback の理由が `aria-describedby` で通知され、ガード文言にも同内容を記載
- Playwright ページスコープ: `/charts` を MSW ON で起動し、axe（color-contrast / aria-allowed-role / aria-required-children / label を除外）で violations=0、ActionBar ボタンへのフォーカス遷移を確認。証跡 HAR/スクショ: `artifacts/webclient/e2e/20251217T212939Z/msw-on/`

## 残タスク / 推奨

- 実ブラウザ + スクリーンリーダー（VoiceOver/NVDA）で `/charts` 画面を通し確認する際は、本 RUN_ID を用い以下を再確認すること  
  - ToneBanner の読み上げ順序（タグ→本文→患者/受付 ID）  
  - Toast／ガード文言が `role=alert` と競合しないか（同一 live region に複数出ないか）
- Playwright ページスコープで除外したルール（aria-allowed-role / aria-required-children / label）に対する UI 修正を検討し、除外解除後に再スキャンする。
