# Web クライアントとオンプレクライアント機能差分チェックリスト

本チェックリストは、Web クライアントの機能が既存オンプレ（Swing）クライアントと同等かを確認し、差分解消に向けた次タスクを明確にするためのものである。各項目をレビューし、完了条件を満たしたらチェックを入れる。未完了の場合はフォローアップタスクを起票すること。

## 1. オーダー登録機能
- [ ] **ProgressCourse 以外のモジュール保存**: 処方・注射・検査など `Bundle*` モジュールがサーバーへ送信・保存されるか確認し、`DocInfoModel` の `hasRp`/`hasTreatment`/`hasLaboTest` フラグが適切に更新されるよう実装する。
- [ ] **スタンプ/ORCA UI とバックエンド連携**: Web 版のスタンプエディタおよび ORCA マスター検索で選択した項目がサーバーへ連携され、登録結果がカルテに反映される。
- [ ] **バリデーションとエラー処理**: オーダー送信時の入力検証、併用禁忌チェック、サーバーエラー表示が Swing クライアント同等以上であることを確認する。
- [ ] **ClaimItem 整合性確認**: オーダー登録後に `ClaimItem` や数量、剤型などがサーバー側データ要件（`features/ORDER_ENTRY_DATA_GUIDE.md`）を満たしていることを検証する。

### 推奨フォローアップタスク
- [ ] ORCA 連携テストケースの作成と自動化（モックまたはテストサーバー利用）。
- [ ] オーダーモジュール保存時の監査ログ整備とアラート条件定義。

## 2. 患者情報管理
- [ ] **編集 API 実装**: `/patient` 系エンドポイントの POST/PUT を Web クライアントで実行でき、患者属性・保険情報を更新可能にする。
- [ ] **UI/UX 確認**: 受付オペレーションに沿った入力動線（検索→編集→保存）が Swing クライアントと同等以上に成立しているか確認する。
- [ ] **変更履歴・監査**: 患者情報更新時に履歴が残るか、監査ログが取得できるかを確認し、不足する場合は仕様を策定する。

### 推奨フォローアップタスク
- [ ] エッジケース（多重保険、住所変更、匿名化等）のテストケース整備。
- [ ] 受付担当者向けマニュアルの更新および研修計画立案。

## 3. サマリ／問診・患者メモ
- [ ] **編集機能実装**: Web カルテ画面右ペインから問診サマリ・患者メモを新規作成／編集できる UI と API を実装する。
- [ ] **FreeDocument 連携**: サマリ文書を FreeDocument として保存し、Swing クライアントで閲覧・編集したデータと双方向で整合性がとれることを確認する。
- [ ] **自動保存とアクセス制御**: カルテクローズ時の自動保存、権限別の閲覧／編集制御が Swing クライアント同等に設定されているか確認する。

### 推奨フォローアップタスク
- [ ] 患者メモのバージョン履歴 UI の追加検討。
- [ ] 問診テンプレートの共有／配布フロー策定。

## 4. 予約・受付／スケジュール管理
- [x] **状態更新操作**: 待機→呼出→診察中といった状態遷移を Web 版で実行できるようにし、サーバーへ即時反映させる。
  - 2026-04-23: `ReceptionPage` に呼出/待機トグルを追加。ChartEvent (PVT_STATE) を介して `/chartEvent/event` を呼び出し、全端末へ即時同期する。
- [ ] **予約 CRUD**: 予約の登録／更新／削除を Web 版で操作できるよう実装し、`ScheduleDelegater` 相当の API 呼び出しを網羅する。
- [x] **受付メモ同期**: 待ち一覧のメモを編集した際にオンプレクライアントとリアルタイムで同期されるか確認する。
  - 2026-04-23: 受付カード内でインライン編集 UI を実装。保存時は ChartEvent (PVT_MEMO) を送出し、`useChartEventSubscription` でメモと安全メモバッジを更新。
- [ ] **通知と例外処理**: 予約変更時の通知、重複予約やキャンセル処理など例外系を設計し、テストを整備する。

### 推奨フォローアップタスク
- [ ] 予約画面の統合テストシナリオ整備と自動化。
- [ ] 患者向けリマインダー送信フローの検討（メール／SMS 等）。

## 運用メモ
- 各チェック項目の完了時には、対応する仕様・実装を `planning/WEB_CLIENT_WORK_PLAN.md` および関連ドキュメントに反映すること。
- ギャップが解消されない場合は課題管理ツールに Issue を登録し、優先度と担当者を明記する。
- 機能実装により既存ユーザーの運用が変わる場合は、移行手順や設定変更内容を `operations/` 配下の資料へ追記する。
