# 患者情報編集ガイド（Web クライアント）

## 概要
- `PatientsPage` に患者情報編集カードを追加し、既存検索結果から選択した患者の詳細を読み込んで編集できるようにした。
- 検索ヘッダの「新規患者登録」ボタンで空のフォームへ遷移し、`/patient` POST を使った新患登録を行う。既存患者を選択すると自動的に更新モードへ切り替わり、`/patient` PUT で保存する。
- 保存時は React Query の検索・カルテ詳細クエリを無効化し、最新状態を再取得するため受付・カルテ画面と整合する。

## フォーム構成
- 基本情報: 患者 ID、氏名、カナ氏名、性別、生年月日を必須項目として入力。未入力時はバリデーションエラーを表示。
- 連絡先: 電話番号・携帯番号・メールアドレス・郵便番号・住所を編集可能。空文字は自動的に未入力として送信される。
- メモ欄: 患者メモ、アプリメモ（安全情報）、家族/関係者メモを `TextArea` で入力。既存 Swing クライアントのメモフィールドと同じ項目を保持。
  - 患者メモはカルテ右ペインからも編集可能で、履歴ダイアログから過去バージョンをプレビュー・復元してから保存できる。復元操作は監査ログに `patient_memo_history_apply` として記録される。
- 予備フィールド: `reserve1〜reserve6` を横並びで編集できるよう配置し、院内運用で使用している拡張項目を維持。

## 健康保険情報の扱い
- 編集カード下部に健康保険リストを表示。既存保険がある場合は GUID、保険名称、区分コード、保険者番号、記号番号、開始日/期限をフォームとして提供。
- 追加ボタンで空の保険行を作成し、削除ボタンで行単位に削除できる。操作は `recordOperationEvent` により監査ログへ記録される。
- 保存時は `decodeHealthInsuranceBean` / `encodeHealthInsuranceBean` を利用し、Java Beans 形式の `beanBytes` を再生成。未対応プロパティは元の構造を保持するため既存データの互換性を損なわない。

## 監査・エラーハンドリング
- 新規登録、更新、保険行追加/削除で `recordOperationEvent` を発火し、患者 ID と操作モードを監査ログへ送る。
- 保存結果は `StatusBadge` で成功/失敗を即時表示し、失敗時はエラーメッセージをユーザーへ提示。React Query 側は `patientSearchQueryKey`、`patientDetailQueryKey`、`patientKarteQueryKey` を無効化して再取得する。

## 既存ユーザーへの影響
- 既存 Swing クライアントと同じテーブル・Bean を更新するため追加のデータ移行は不要。ただし Web 側での編集が増えるため、運用チームへ新規登録モードと保存確認フローを共有すること。
- 保険情報の入力は GUID・区分コード・保険者番号・記号番号が空の場合でも保存可能だが、審査請求上必要な項目は従来通り適切に入力するよう教育が必要。
