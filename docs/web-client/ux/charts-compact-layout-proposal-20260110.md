# Charts 画面 コンパクトレイアウト提案（RUN_ID=20260110T214118Z）

## 目的
- Charts 画面の情報過多を整理し、**初見で全体像が掴める**密度に調整する。
- **重複するUI/機能を共通化**し、レイアウトの一貫性・保守性を向上する。
- 「重要情報は上段に集約」「詳細は段階的に開く」構造で視認性を高める。

## 現状の課題（要約）
- **患者ヘッダ / 安全表示 / 診療情報バー**が分散し、同一情報（ID/氏名/年齢/受付/予約）を複数箇所で繰り返している。
- 4カラム + 右固定メニューにより**横幅消費が大きく**、視線移動が長くなる。
- カード同士の**余白/影/角丸が過剰**で、情報密度に対して視覚ノイズが強い。
- 複数エリアで**小さなカードが断片化**され、優先順位が掴みにくい。

## 変更提案（概要）
1. **上段を1つの“患者サマリ・バー”に統合**（患者ヘッダ + 診療バー + 安全表示）
2. **3カラム + ドッキング式ユーティリティ（右固定メニュー）**へ整理
3. **カード密度を上げるための共通UI規約**（余白・ボーダー・タイポ）を定義
4. **重複UIの共通化**（患者メタ・バッジ・監査系表示）
5. **詳細情報はアコーディオン/サブタブ化**し、初期表示は最小限

---

## 具体提案

### 1) 患者サマリ・バーの統合
**対象**: `charts-patient-header` / `charts-clinical-bar` / `charts-safety`

- **新規コンポーネント** `ChartsPatientSummaryBar` を作成
  - 左: 「患者名 + カナ + 性別/年齢」
  - 中: 「ID/受付/予約/診療日」
  - 右: 「安全表示（アイコン + ALERTトーン）」と `RUN_ID` を1行で表示
- **安全表示の詳細メタ**（和暦/ISO/予約等）は折りたたみ式にし、既定は閉じる
- **患者メモは別の軽量カードへ分離**し、右側または患者タブ内に移動

**効果**:
- 上段が1パネルに集約され、情報の視認性が向上
- 既読の安全情報は省略表示となり、視線が散らない

---

### 2) 3カラム化 + 右ユーティリティをドッキング
**現状**: 4カラム（左 / 中 / 右 / 右固定）

**提案レイアウト**:
- **左**: 患者タブ / 病名一覧 / 過去履歴
- **中**: SOAP記載 + DocumentTimeline
- **右**: OrcaSummary + MedicalOutpatientRecordPanel
- **右固定メニュー**: `DockedUtilityPanel`（必要時のみ展開）

**UI仕様**:
- **右固定メニューを「Docked」型に変更**し、初期はコンパクトボタン群のみ表示
- `診療操作/病名/処方/オーダー/文書` などは **「ユーティリティドロワー」に統合**
- 右ドロワーは `compact` / `expanded` を切り替え（compactは最小幅 240px 程度）

**効果**:
- 通常は3カラムに収まり、視線移動を減らせる
- 追加機能は“必要時だけ”展開され、平時の視認性を確保

---

### 3) カード密度・余白の調整
**対象**: `.charts-card` / `.charts-workbench__body` / `.patients-tab__card` / `.document-timeline` 等

- **共通スペーシング変数導入**
  - 例: `--charts-space-xs: 6px`, `--charts-space-sm: 10px`, `--charts-space-md: 14px`
- **カード内パディングを段階的に縮小**
  - `1.25rem → 0.85rem` など
- **角丸/影の削減**
  - 角丸: `22px → 14px`
  - 影: `box-shadow` の強さを半分以下に

**効果**:
- “カードの主張”が減り、情報が整理されて見える

---

### 4) 重複UIの共通化
**共通化候補**:
- **患者メタ行**（患者ID/受付ID/予約ID）
  - `PatientMetaRow` を `Charts/Patients/Reception` で共有
- **RUN_ID + missingMaster 表示**
  - `RunIdBadge` と `StatusPill` を共通化
- **監査系メタ表示**（`auditEvent`, `dataSourceTransition`）
  - `AuditSummaryInline` を共通パーツに

**狙い**:
- UI表現の統一と変更コストの削減
- 重要情報の場所と見た目が揃い、認知負荷を軽減

---

### 5) 情報の優先順位を明示する構造
- **“作業中”エリアは1つに集約**
  - SOAP + Timeline を「診療記録ワークスペース」に統合し、切替タブで表示
- **“参照情報”は右列へ寄せる**
  - OrcaSummary と MedicalOutpatientRecord をまとめ、参照専用と認識させる

**効果**:
- メインの作業領域が明確化
- 画面全体の構造が初見で理解可能

---

## UI共通化・コンポーネント化の案

| 項目 | 現状 | 共通化案 | 配置 | 備考 |
| --- | --- | --- | --- | --- |
| 患者ヘッダ | `charts-patient-header` | `ChartsPatientSummaryBar` | 上段固定 | safety表示統合 |
| 安全表示 | `charts-safety` | `PatientSafetyBanner` | SummaryBar内 | 詳細は折りたたみ |
| 監査メタ | DocumentTimeline/PatientsTab | `AuditMetaInline` | 共通 | 表示幅統一 |
| ID行 | 複数箇所で重複 | `PatientMetaRow` | SummaryBar/PatientsTab | shared/components |

---

## レイアウト試案（構成イメージ）
```
[SummaryBar: 患者/診療/安全/RunId]
----------------------------------
| 左列            | 中列            | 右列         |
| 患者タブ        | SOAPワークスペース | OrcaSummary  |
| 病名/履歴       | Timeline        | MedicalRecord|
----------------------------------
[DockedUtilityPanel: 病名/処方/オーダー/文書]
```

---

## 期待効果
- **一目で画面の構造が理解できる**（情報の階層が明確）
- **常用の作業領域が最大化**される
- **UIの統一感が高まり**、保守性が向上

---

## 実装優先度（提案）
1. 患者サマリ・バーの統合（インパクト最大）
2. 3カラム化 + ドッキングユーティリティ
3. スペーシング・カード密度調整
4. UI共通化パーツの抽出

---

## 検証観点
- 1440px / 1280px / 1024px / 900px の横幅で崩れないか
- 患者切替時にヘッダ情報が正しく更新されるか
- `missingMaster`/`fallbackUsed` の安全表示が視認性を維持するか
- 右ドロワー開閉で主要導線が隠れないか

---

## 補足
- 既存の `charts-workbench__body` grid を **3カラム**へ変更し、`charts-workbench__side` を `DockedUtilityPanel` として再配置することを前提。
- 共通コンポーネント化は `web-client/src/features/shared/` 配下に配置する想定（既存構成と整合）。
