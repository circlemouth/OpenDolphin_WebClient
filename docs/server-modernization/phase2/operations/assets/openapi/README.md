# OpenAPI for ORCA Master (ORCA-05/06/08)

- RUN_ID: 20251124T101000Z (parent=20251124T000000Z)
- 参照: `docs/server-modernization/MODERNIZED_REST_API_INVENTORY.md` ORCA セクション
- 目的: ORCA-05/06/08 の REST 契約を正式版 OpenAPI として公開し、web-client 向け型生成パイプラインを接続する。

## ファイル
- `orca-master-orca05-06-08.yaml` : 正式版。監査メタ必須化、住所 API の 404/空レスポンス仕様、エラー応答・enum を整理。
- `orca-master-orca05-06-08-draft.yaml`: 旧 draft（参考）。
- エラー/フォールバック設計とテスト網羅表: `../orca-db-schema/error-fallback-test-matrix.md`
- DB→DTO→UI 対応表: `../orca-db-schema/field-mapping/orca-master-field-matrix.md`（ORCA-05/06/08 主要列と型の対応を集約）
- コード体系レビュー・バリデーション草案: `../orca-master-code-systems.md`（JIS/薬効/材料/点数コードの桁・regex・422 判定草案、RUN_ID=20251124T163000Z）
- DB シード計画: `../orca-db-schema/seed-plan/orca-master-seed-plan.md`（ORCA-05/06/08 用 seed 項目・テンプレート配置手順、RUN_ID=20251124T130000Z）
- ロールバック/クリーンアップ手順: `../orca-master-rollback-plan.md`（seed 撤回・キャッシュ無効化・監査整合性チェック、RUN_ID=20251124T160000Z）
- ステージング計画: `../orca-master-staging-plan.md`（Dev→Stage→Prod 段階移行とフラグ切替、RUN_ID=20251124T194500Z）
- A/B 比較計画: `../orca-master-ab-compare-plan.md`（旧実装↔新 REST 並行検証のシナリオ・SLA・成果物規約、RUN_ID=20251124T151500Z）
- スキーマドリフト監視計画: `../orca-master-schema-drift-plan.md`（DB 実体 vs 定義書/OpenAPI の乖離検出ドラフト、RUN_ID=20251124T161500Z）
- リリース／ロールバック計画: `../orca-master-release-plan.md`（feature flag, 監視閾値, ロールバック手順）
- フォールトインジェクション計画: `../orca-master-resilience-plan.md`（timeout/5xx/429/DNS/TLS 障害時の期待挙動・MSW/curl 手順、RUN_ID=20251124T174500Z）
- Go-Live チェックリスト: `../orca-master-go-live-checklist.md`（接続先準備・証跡テンプレ・ロールバック導線、RUN_ID=20251124T184500Z）
- 監視ダッシュボード: `../assets/observability/orca-master-dashboard.json`（Grafana import 用ドラフト、RUN_ID=20251124T142000Z）
- セキュリティ/プライバシー チェックリスト: `../orca-master-security-privacy-checklist.md`（フィールド分類・マスキング・ログ/監査運用、RUN_ID=20251124T134500Z）
- CI/品質ゲート案（draft）: `../ci/README.md` / `../ci/orca-master-bridge-ci.yaml`（OpenAPI 再生成・MSW フィクスチャ・seed lint・typecheck）

## web-client 型生成パイプライン
1. 生成先を固定: `web-client/src/generated/orca-master.ts`（Git には含めず、lint/typecheck 対象）。
2. 実行コマンド（package.json に `openapi:orca-master` として登録）:
   ```bash
   cd web-client
   npm run openapi:orca-master
   ```
   - 内部で `openapi-typescript ../docs/server-modernization/phase2/operations/assets/openapi/orca-master-orca05-06-08.yaml --output src/generated/orca-master.ts --enum --export-type` を実行。
   - `web-client/src/types/orca.ts` との重複は生成後に整理する（監査メタは本 YAML をソースとする）。
3. チェックリスト（生成後に実施）
   - `npm run typecheck` または `npm run lint` で型整合を確認。
   - 生成ファイル先頭に `// @generated by openapi-typescript (RUN_ID=20251124T101000Z)` が付与されていることを確認。

## 未決事項
- スキーマ `DrugMasterEntry`/`InsurerEntry`/`TensuEntry` に今後サーバー実装で増える補足フィールド（例: `traceId`, `partial`, `missingTables`）をどう扱うか。サーバー側が確定した時点で YAML を更新し、再生成する。
