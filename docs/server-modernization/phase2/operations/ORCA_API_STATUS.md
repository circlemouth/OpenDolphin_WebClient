# ORCA ↔ モダナイズ版サーバー API 差異サマリ（2025-11-14）

## 1. スコープと参照資料
- 対象はモダナイズ版サーバーが ORCA と通信するために定義した 53 API（`assets/orca-api-matrix.with-spec.csv`）のうち、直近で疎通結果や仕様差異が判明しているもの。
- 公式仕様は firecrawl 取得済みの ORCA ドキュメント（`assets/orca-api-spec/manifest.json` および `raw/*.md`）を根拠とし、実測結果は `logs/2025-11-13-orca-connectivity.md`、`notes/orca-api-field-validation.md`、`PHASE2_PROGRESS.md` の RUN_ID 記録を引用する。
- 本サマリは `operations/ORCA_CONNECTIVITY_VALIDATION.md`（検証手順）と `logs/ORCA_HTTP_404405_HANDBOOK.md`（障害時テンプレ）の補助資料として運用する。

## 2. 通信状態別リスト

### 2.1 コア外来 API（Matrix No.1-18）仕様と実測
| No | ORCA API (class) | HTTP/必須ヘッダー | エンコーディング | 公式 Api_Result / Spec | 実測状況 / RUN_ID | 差異・備考 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | `/api01rv2/patientgetv2` (`id`) | `GET` + HTTP Basic(ormaster) + `Accept: application/json`, `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`patientget`, spec:`raw/patientget.md`） | `HTTP 404`（RUN_ID=`20251113TorcaP0OpsZ1/Z2`、`logs/2025-11-13-orca-connectivity.md`, `PHASE2_PROGRESS.md` W18/W21）。`20251114TorcaHttpLogZ1` は DNS 解決不可（curl:6）で 404 再取得保留。 | WebORCA 本番でも GET ルートは閉じたまま。開放依頼は行わず、実測 404 を Evidence 化して `orca-api-matrix` に記録する運用とする。 |
| 2 | `/orca14/appointmodv2` (`class=01/02`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`appointmod`, spec:`raw/appointmod.md`） | `HTTP 405 (Allow: OPTIONS, GET)`（RUN_ID=`20251113TorcaP0OpsZ1/Z2`）。`20251114TorcaHttpLogZ1` では DNS 解決不可（curl:6）でリクエスト未到達。 | WebORCA 本番は POST を受け付けない。モダナイズ側 REST も `/orca/appoint*` が未実装のため、405 証跡を継続取得しつつラッパー実装を優先する。 |
| 3 | `/api21/medicalmodv2` (`class=01-03`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`medicalmod`, spec:`raw/medicalmod.md`） | 直打ちは `HTTP 405`（RUN_ID=`20251113TorcaP0OpsZ1`）。`/api/api21/medicalmodv2` では `HTTP 200 / Api_Result=14`（ドクタ未登録、RUN_ID=`20251113TorcaDoctorManualW60`）。`20251114TorcaHttpLogZ1` では DNS 解決不可（curl:6）。 | 医師 seed を揃えても 405 ルートは現状閉鎖。サポート連携は不要で、405/`Api_Result` の推移を `artifacts/.../api21_medicalmodv2/` に蓄積して差分分析のみ行う。 |
| 4 | `/orca11/acceptmodv2` (`class=01/02`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`acceptmod`, spec:`raw/acceptmod.md`） | `HTTP 405 (Allow: OPTIONS, GET)`（RUN_ID=`20251113TorcaP0OpsZ1/Z2`）。`20251114TorcaHttpLogZ1` は DNS 解決不可（curl:6）で POST 未送信。 | 受付登録系は POST 禁止のまま。モダナイズ REST も未提供のため、Evidence のみ収集し Phase2 Sprint2 以降のラッパー実装で置き換える。 |
| 5 | `/api01rv2/acceptlstv2` (`class=01-03`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`acceptancelst`, spec:`raw/acceptancelst.md`） | `HTTP 200`。`Api_Result=13/21` → `00` へ前進（RUN_ID=`20251113TorcaP0OpsZ1/Z2/Z3`, `20251113TorcaProdCertZ1`。証跡: `logs/2025-11-13-orca-connectivity.md`, `PHASE2_PROGRESS.md` W18/W21/W36） | ORCA DB に医師・診療・受付ダミーを投入しないと `Api_Result=00` にならない。Runbook §4.3 に seed 手順済み。 |
| 6 | `/api01rv2/appointlstv2` (`class=01`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`appointlst`, spec:`raw/appointlst.md`） | 未実測（RUN_ID=`20251113TorcaP0OpsZ1` は #1-5 のみと `PHASE2_PROGRESS.md` W18 に記録） | モダナイズ版 REST には `/orca/appoint*` が無い（`MODERNIZED_REST_API_INVENTORY.md`）ため、Web クライアントから直接 ORCA を叩く設計・seed 準備が必要。 |
| 7 | `/orca102/medicatonmodv2` (`class=01-04`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`medicatonmod`, spec:`raw/medicatonmod.md`） | 未実測（RUN_ID=`20251113TorcaP0OpsZ1` 範囲外） | Modernized REST には点数登録 API が無く（`MODERNIZED_REST_API_INVENTORY.md` には GET のみ）、本 API のシナリオ再現が未着手。 |
| 8 | `/api01rv2/patientlst1v2` (`class=01/02`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`patientidlist`, spec:`raw/patientidlist.md`） | 未実測（RUN_ID=`20251113TorcaP0OpsZ1` 対象外） | 患者番号一括取得のモダナイズ版 REST は存在しない。差分同期ジョブ実装までは ORCA API 直接呼び出しが必要。 |
| 9 | `/api01rv2/patientlst2v2` (`class=01`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`patientlist`, spec:`raw/patientlist.md`） | 未実測（RUN_ID=`20251113TorcaP0OpsZ1` 対象外） | 同上。モダナイズ版患者バッチ API 不在のため、CSV/差分の要件整理が未完。 |
| 10 | `/api01rv2/patientlst3v2` (`class=01`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`patientshimei`, spec:`raw/patientshimei.md`） | 未実測（RUN_ID=`20251113TorcaP0OpsZ1` 対象外） | カナ検索 API もモダナイズ側ラッパーが無い。Web UI のかな検索要件は ORCA 直接呼び出し or DB レプリケーションで代替する必要あり。 |
| 11 | `/api01rv2/system01lstv2` (`class=01-07`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`systemkanri`, spec:`raw/systemkanri.md`） | `HTTP 200 / Api_Result=11`（Doctor 未登録、RUN_ID=`20251113TorcaDoctorManualW60`, `PHASE2_PROGRESS.md` W60） | 医師マスタが返らないため、`/api/api21/medicalmodv2` も `Api_Result=14` で停止。Modernized REST には `GET /orca/deptinfo` があるが医師情報は別途 seed 必須。 |
| 12 | `/api01rv2/medicalgetv2` (`class=01-04`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`medicalinfo`, spec:`raw/medicalinfo.md`） | 未実測（RUN_ID=`20251113TorcaP0OpsZ1` 対象外） | `MODERNIZED_REST_API_INVENTORY.md` に `/orca/medical*` が無く、カルテ取得をどうラップするか未定義。 |
| 13 | `/api01rv2/diseasegetv2` (`class=01`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`disease`, spec:`raw/disease.md`） | 未実測（RUN_ID=`20251113TorcaP0OpsZ1` 対象外） | Modernized 側には `GET /orca/disease/{name|import|active}`（`MODERNIZED_REST_API_INVENTORY.md`）が存在するため、ORCA API 直接呼び出しではなく既存 REST への統合も要検討。 |
| 14 | `/orca12/patientmodv2` (`class=01-04`) | `POST` + Basic + `Content-Type: application/xml; charset=UTF-8` | XML (UTF-8) | `Api_Result=0000`（manifest:`patientmod`, spec:`raw/patientmod.md`、`notes/orca-api-field-validation.md`） | `HTTP 200 / Api_Result=00 / Patient_ID=00002`（RUN_ID=`20251113TorcaPatientAutoStdZ1`, `PHASE2_PROGRESS.md` W56） | `kbncd=1065 (ORCBPTNUMCHG)` の 8 桁設定が前提。`RUN_ID=20251113TorcaPatientDigitsZ1` 証跡に基づきテンプレは UTF-8 固定。 |
| 15 | `/api01rv2/appointlst2v2` (`class=01`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`appointlst2`, spec:`raw/appointlst2.md`） | 未実測（RUN_ID=`20251113TorcaP0OpsZ1` 対象外） | Modernized REST には患者単位予約一覧 API が無い。ORCA API 呼び出し方式とキャッシュ要件を定義する必要がある。 |
| 16 | `/api01rv2/acsimulatev2` (`class=01`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`acsimulate`, spec:`raw/acsimulate.md`） | 未実測（RUN_ID=`20251113TorcaP0OpsZ1` 対象外） | 請求試算のモダナイズ REST は未実装。`MODERNIZED_REST_API_INVENTORY.md` への追加が必要。 |
| 17 | `/orca25/subjectivesv2` (`class=01/02`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`subjectives`, spec:`raw/subjectives.md`） | 未実測（RUN_ID=`20251113TorcaP0OpsZ1` 対象外） | 症状詳記 API もモダナイズ側に存在しない。カルテ UI 実装時は Web クライアント → ORCA 直送の設計要。 |
| 18 | `/api01rv2/visitptlstv2` (`class=01`) | `POST` + Basic + `Content-Type: application/json; charset=Shift_JIS` | JSON (Shift_JIS) | `Api_Result=0000`（manifest:`visitpatient`, spec:`raw/visitpatient.md`） | 未実測（RUN_ID=`20251113TorcaP0OpsZ1` 対象外） | 来院患者一覧を返すモダナイズ REST が無く、来院ウィジェット要件は ORCA API 直接連携で設計する必要がある。 |
| - | `/api01rv2/system01dailyv2` (`class=01`) | `POST` + Basic + `Content-Type: application/xml; charset=UTF-8` | XML (UTF-8) | `Api_Result=0000`（manifest:`system_daily`, spec:`raw/system_daily.md`） | `UTF-8` で `Api_Result=00`、Shift_JIS では `Api_Result=91`（RUN_ID=`20251113T002806Z`、`logs/2025-11-13-orca-connectivity.md`, `notes/orca-api-field-validation.md`） | `notes/orca-api-field-validation.md` に従い UTF-8 テンプレへ統一。 |

### 2.2 HTTP 404/405 詳細
上記 2.1 の実測列で示した通り、特に `/api01rv2/patientgetv2`・`/orca14/appointmodv2`・`/api21/medicalmodv2`・`/orca11/acceptmodv2` は HTTP 404/405 が継続している。再検証の足掛かりとして、Runbook で管理している 404/405 系 API を以下に整理する。

| ORCA API | 公式仕様で期待される挙動 | 実測ステータス | 再疎通準備中 | 差異/課題 |
| --- | --- | --- | --- | --- |
| `/api01rv2/patientgetv2` | GET で患者基本情報を返却（`raw/patientget.md`）。 | `404`（RUN_ID=`20251113TorcaP0OpsZ1/Z2`）。 | `curl --cert-type P12 -u "${ORCA_PROD_BASIC_USER}:${ORCA_PROD_BASIC_KEY}" -H 'Accept: application/json' 'https://weborca.cloud.orcamo.jp/api/api01rv2/patientgetv2?class=00'` を定期実行し、`artifacts/orca-connectivity/{{RUN_ID}}/httpdump/api01rv2_patientgetv2/` へ 404 証跡を保存する。 | WebORCA 本番でも GET ルートは未公開。サポート問い合わせは行わず、404 のまま API パリティ表へ記録。 |
| `/orca14/appointmodv2` | 予約登録/取消（`raw/appointmod.md`）。 | `405`（Allow: OPTIONS, GET）。RUN_ID=`20251113TorcaP0OpsZ1/Z2`. | `curl --cert-type P12 ... --data-binary '@assets/orca-api-requests/02_appointmodv2_request.json' 'https://weborca.cloud.orcamo.jp/orca14/appointmodv2?class=01'` を実行し、`artifacts/orca-connectivity/{{RUN_ID}}/httpdump/orca14_appointmodv2/` に 405 応答を蓄積する。 | POST は本番でも閉鎖。再疎通後も 405 であることをログ化し、ラッパー実装と業務代替策を優先。 |
| `/api21/medicalmodv2` | 診療行為登録（`raw/medicalmod.md`）。 | `405`（RUN_ID=`20251113TorcaP0OpsZ1`）／`Api_Result=14`（Doctor 未登録、RUN_ID=`20251113TorcaDoctorManualW60`）。 | 医師 seed を `system01lstv2` で再投入しつつ、`curl --cert-type P12 -u "${ORCA_PROD_BASIC_USER}:${ORCA_PROD_BASIC_KEY}" -H 'Accept: application/json' -H 'Content-Type: application/json; charset=Shift_JIS' --data-binary '@assets/orca-api-requests/03_medicalmodv2_request.json' 'https://weborca.cloud.orcamo.jp/api/api21/medicalmodv2?class=01'` を再試行し、`artifacts/orca-connectivity/{{RUN_ID}}/httpdump/api21_medicalmodv2/` に 405/`Api_Result` を保存する。 | 405 のままでも証跡を収集し、医師 seed との相関を分析する。ルート公開依頼は行わない。 |
| `/orca11/acceptmodv2` | 受付登録/取消（`raw/acceptmod.md`）。 | `405`（Allow: OPTIONS, GET）。RUN_ID=`20251113TorcaP0OpsZ1/Z2`. | `curl --cert-type P12 -u "${ORCA_PROD_BASIC_USER}:${ORCA_PROD_BASIC_KEY}" -H 'Accept: application/json' -H 'Content-Type: application/json; charset=Shift_JIS' --data-binary '@assets/orca-api-requests/04_acceptmodv2_request.json' 'https://weborca.cloud.orcamo.jp/orca11/acceptmodv2?class=01'` を実行し、`artifacts/orca-connectivity/{{RUN_ID}}/httpdump/orca11_acceptmodv2/` に 405 応答を保存する。 | 受付登録は本番でも POST 不可。サポート通報ではなく、REST ラッパー（ORCA-REST-01/02）実装と UI フローの代替案を優先。 |
| `/api21/medicalmodv23` | 初診算定日登録（No.46 / `raw/medicalmodv23.md`）。 | `405`（Allow: OPTIONS, GET）。RUN_ID=`20251113T002806Z`（`notes/orca-api-field-validation.md`） | - | XML 化済みでも 405。Evidence のみ更新し、REST 実装は Phase2 Sprint3 以降で対応。 |
| `/orca06/patientmemomodv2` | 患者メモ CRUD（No.53 / `raw/patientmemomodv2.md`）。 | `405`（Allow: GET）。RUN_ID=`20251113T002806Z`. | - | XML 送信でも拒否されるため、現状は 405 証跡を Runbook に残すのみ。 |
| `/orca31/hspmmv2` | 入院会計未作成チェック（No.39 / `raw/hspmm.md`）。 | `405`（Allow: OPTIONS, GET）。RUN_ID=`20251113T002806Z`. | - | 公式仕様は POST `Perform_Month` だが、本番では GET のみ。証跡を蓄積し、REST 側で代替レポートを検討。 |
| `/orca31/hsptinfmodv2` | 入退院登録（No.29 / `raw/hospido.md`）。`Request_Number=08/09` と病棟/病室/診療科コードを送る。 | 未実測（`/orca31/*` は POST 405 予想、Allow: OPTIONS, GET）。 | - | `hsconfwardv2` で取得したマスタを使って XML テンプレを整備し、405 証跡の採取のみ行う。サポート連携は不要。 |
| `/orca31/hsacctmodv2` | 外泊/食事/室料差額/入院会計作成（No.30/38/40 / `raw/hospgaihaku.md` 他）。`Request_Number=2/3/4/9` を用途別に使用。 | 未実測（`/orca31` POST は閉鎖中で 405 想定）。 | - | 用途別 XML を用意し、外泊コードや `Meal_Time`/`Meal_Type` をコード化したうえで 405 ログを `artifacts/.../hsacctmodv2/` に保存する。 |
| `/orca32/hsptevalmodv2` | 医療区分・ADL 登録（No.31 / `raw/hospadlentry.md`）。`Medical_Condition`/`ADL_Score` の日別 CSV を送る。 | 未実測（`/orca32` POST は未公開で 405 想定）。 | - | `hsptevalv2` 取得結果と往復できる CSV を実装し、405 証跡を残す。 |
| `/orca101/manageusersv2` | ユーザー管理（No.32 / `raw/userkanri.md`）。`Request_Number=01-04`。 | 未実測（`/orca101` POST は 405 想定）。 | - | 管理者 seed を整備しつつ XML テンプレを作成、405 ログを取って問い合わせ用 Runbook を更新する。 |
| `/orca21/medicalsetv2` | 診療セット登録（No.33 / `raw/setcode.md`）。`Request_Number=01-04`。 | 未実測（`/orca21` POST は 405 想定）。 | - | `Medical_Info` 配列を XML 化し、405 証跡取得後にスタンプ同期要件へ展開する。 |
| `/orca31/birthdeliveryv2` | 出産育児一時金（No.34 / `raw/childbirth.md`）。`Request_Number=01/02`。 | 未実測（`/orca31` POST は 405 想定）。 | - | `Submission_Provider`/`Delivery` のコード体系に合わせて XML テンプレを整備し、405 ログを取っておく。 |
| `/orca22/diseasev2`, `/orca22/diseasev3` | 病名登録 API（No.36/37 / `raw/diseasemod.md`, `raw/diseasemod2.md`）。 | 未実測（`/orca22` POST は 405 想定）。 | - | スタンプ同期に不可欠なため XML 化と 405 証跡を優先し、v2/v3 の差分を Runbook へ追記する。 |

### 2.3 モダナイズ側未実装（ラッパー未提供）
| ORCA API 群 | 公式仕様 | モダナイズ版サーバーの現状 | 差異 | REST ラッパー計画 |
| --- | --- | --- | --- | --- |
| `/api01rv2/patientlst1v2`, `/patientlst2v2`, `/patientlst3v2` など患者一括取得系 (manifest No.8-10) | 受付/患者同期のバッチ API を POST で提供。 | `MODERNIZED_REST_API_INVENTORY.md` の ORCA 節にはこれらの HTTP ラッパーは存在せず、Web クライアント向けには `GET /orca/disease/*` や `/orca/tensu/*` などのローカル DB 参照エンドポイントのみが公開されている。 | XML payload 未整備／seed も `assets/seeds/api21_medical_seed.sql` 由来の患者しか存在しないため、現状は JSON テンプレのまま直接 ORCA API を叩く想定。 | Phase2 Sprint2（2025-12、SERVER_MODERNIZATION_PLAN.md の ORCA-REST-02）で `POST /orca/patients/{id-list|batch|name-search}` を実装し、`ORCA_CONNECTIVITY_VALIDATION.md` §4.3/§5.1 の手順で RUN_ID 付き検証を実施。 |
| `/api01rv2/appointlst2v2`, `/api01rv2/acsimulatev2`, `/orca25/subjectivesv2` 等予約・請求・症状 API (manifest No.15-17) | 予約詳細 / 請求試算 / 症状詳記 API を POST 提供。 | `OrcaResource` には予約・請求系の REST エンドポイントが未定義（`MODERNIZED_REST_API_INVENTORY.md` では点数/病名/スタンプ連携のみ列挙）。 | XML テンプレは未移行（`assets/orca-api-requests/*.json` のみ）で seed も外来ダミー止まり。現時点では ORCA API へ直接 POST するしかなく、REST 化と XML 化を同時に進める必要がある。 | Phase2 Sprint2（2025-12、ORCA-REST-01/02）で `POST /orca/appointments/{list,patient}`, `/orca/billing/estimate`, `/orca/chart/subjectives` を並行実装し、`ORCA_CONNECTIVITY_VALIDATION.md` §4.2〜§4.4／§5.1 の P0 シナリオに従って RUN_ID 付き疎通証跡を取得する。 |
| `/api01rv2/hsconfbasev2`, `/hsconfwardv2`, `/hsmealv2`, `/hsptevalv2`, `/hsptinfv2`, `/hsacsimulatev2`, `/incomeinfv2`, `/systeminfv2`, `/patientlst6v2` (manifest No.19-28/35) | 入院マスタ／食事・ADL／仮会計／システム状態を返却する XML2 API 群。 | `RUN_ID=20251114TorcaInpatientMatrixZ1` で `assets/orca-api-requests/xml/19-35_*.xml` を再確認し、`operations/assets/seeds/inpatient_master_seed_20251114.md` に病棟03A/病室0311/食事/ADL/ユーザー権限の seed 候補を整理したが、`ORCAcertification/103867__JP_u00001294_client3948.p12` のパス不明で `curl --cert-type P12` を開始できず HTTP 証跡は未取得。その後 2025-11-22 に `APIキー:1acdf9...a9ab` を PKCS#12 パスとして `openssl pkcs12` / `curl --cert-type P12` へ指定したが `Mac verify error: invalid password?` で TLS 握手前に失敗し、`20251122TorcaInpatient19-38*` ディレクトリへもレスポンスを保存できなかった。 | 証明書パスフレーズを `ORCAcertification/` の平文ファイルから取得後に `artifacts/orca-connectivity/20251114TorcaInpatientMatrixZ1/inpatient/<API_ID>/` へ `request.xml` / `response.headers` / `response.xml` を保存し、`notes/orca-api-field-validation.md` §3 の各 No. に `Api_Result` を追記する。REST ラッパー側は `MODERNIZED_REST_API_INVENTORY.md`（§4）にも該当 API が無く、当面は ORCA API 直呼びで設計する。 | `patientlst6v2` については Phase2 Sprint2（2025-12、ORCA-REST-02）で `POST /orca/insurance/combinations` を実装予定。Runbook `ORCA_CONNECTIVITY_VALIDATION.md` §4.3/§4.4 で定義された患者系シナリオを参照し、それ以外の入院マスタ群は Sprint4 以降の Backlog として 405 証跡＋ラッパー実装計画を継続。証跡取得前提として `inpatient_master_seed_20251114.md` のマスタ投入と PKCS#12 パス管理を完了させる。 |
| `/orca31/hsptinfmodv2`, `/hsacctmodv2`, `/orca32/hsptevalmodv2`, `/orca101/manageusersv2`, `/orca21/medicalsetv2`, `/orca31/birthdeliveryv2`, `/orca22/disease{v2,v3}` (manifest No.29-34/36-37) | 入退院 CRUD・入院会計登録・ユーザー/スタンプ/病名 CRUD など `/orcaXX` プレフィックスの POST API。 | `server-modernized/src/main/java/open/orca/rest/OrcaResource.java` には GET 系（病名/点数/スタンプ）しかなく、POST 系 CRUD を呼び出す REST エンドポイントは未整備。 | `/orca31`/`/orca32`/`/orca101` なども `assets/orca-api-requests/xml/29-38_*.xml` で XML payload を整備したが、WebORCA 側が `Allow: OPTIONS, GET` のため seed 投入・405 証跡取得だけが進んでいる。まずは REST ラッパー実装と 405 証跡の蓄積を優先する。 | Disease/MedicalSet/BirthDelivery は Phase2 Sprint3〜4（2026-01〜02、ORCA-REST-03/04）で `POST /orca/disease{, /v3}`, `/orca/medical-sets`, `/orca/birth-delivery` を実装予定。入退院 CRUD 群（`/orca31/*`, `/orca32/*`, `/orca101/*`）も同スプリントで 405 証跡と XML テンプレ整備を完了させ、ルート公開待ちではなく REST 実装とエビデンス更新を継続する。 |

### 2.4 Matrix No.39-53（システム／通知／特殊 API）
| No | ORCA API | 公式仕様（形式/主フィールド） | 現状ステータス | 差異・備考 |
| --- | --- | --- | --- | --- |
| 39 | `/orca31/hspmmv2` | XML `<hspmmv2req>`（`Perform_Month` YYYY-MM 必須、`Patient_ID` 任意）。manifest:`hspmm` / [`raw/hspmm.md`](assets/orca-api-spec/raw/hspmm.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/hspmm.html) | `HTTP 405 (Allow: OPTIONS, GET)`（RUN_ID=`20251113T002806Z`、`logs/2025-11-13-orca-connectivity.md`, `notes/orca-api-field-validation.md`） | WebORCA 本番では POST が閉じており、入院会計未作成チェックは動作しない。閉鎖状態を Evidence 化して `orca-api-matrix` に残し、REST ラッパー設計へ集中する。 |
| 40 | `/orca31/hsacctmodv2`（室料差額） | XML `<private_objects>` で `Save_Request/Request_Number=3`、`Patient_ID`、`Admission_Date`、`Perform_Date`、`Room_Charge` を送信（manifest: *manual slug* `hospsagaku` / [`raw/hospsagaku.md`](assets/orca-api-spec/raw/hospsagaku.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/hospsagaku.html)）。 | RUN_ID 未設定（`logs/2025-11-13-orca-connectivity.md`、`PHASE2_PROGRESS.md` いずれにも記録なし）。 | 入院会計（API No.38）や未作成チェック（No.39）が 405 のため前提データを用意できず、室料差額登録の疎通が着手できていない。`notes/orca-api-field-validation.md` §3.1 に seed 要件を追記。 |
| 41 | `/api01rv2/pusheventgetv2` | JSON `pusheventgetv2req`（`event`, `user`, `start_time`, `end_time`）。manifest:`pusheventget` / [`raw/pusheventget.md`](assets/orca-api-spec/raw/pusheventget.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/pusheventget.html) | RUN_ID 未設定。`logs/2025-11-13-orca-connectivity.md` にも実行履歴なし。 | Push 通知取得は push-exchanger と ORCA イベント seed が必要。`notes/orca-api-field-validation.md` §3.2 に未検証メモを追加し、`ORCA_CONNECTIVITY_VALIDATION.md` §3 へ push-exchanger 準備を追記。 |
| 42 | `/orca42/receiptprintv3` | XML リクエスト（`Form_ID/Form_Mode/Print_Mode` 等）→ JSON レスポンスで `Data_Id` を返却し、`print002` PUSH 通知で PDF 取得を案内。manifest:`report_print` / [`raw/report_print.md`](assets/orca-api-spec/raw/report_print.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/report_print/index.html) | RUN_ID 未設定。 | `push-exchanger` を経由して `blobapi/<Data_Id>` を取るワークフローが Runbook に未整備。`notes/orca-api-field-validation.md` §3.2 で Push/PDF 依存関係を整理済み。 |
| 43 | `/orca51/masterlastupdatev3` | XML `<masterlastupdatev3req>` を送るだけで最新更新日一覧を XML で返却。manifest:`master_last_update` / [`raw/master_last_update.md`](assets/orca-api-spec/raw/master_last_update.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/master_last_update.html) | RUN_ID 未設定。 | キャッシュ更新条件を決めるための read-only API だが、`ORCA_CONNECTIVITY_VALIDATION.md` の基本手順（system01daily → masterlastupdate）をまだ実践できていない。次回 RUN で `system01dailyv2` 直後に実行して TTL を記録する。 |
| 44 | `/api01rv2/system01dailyv2` | XML `<system01_dailyreq>`（`Request_Number=01`, `Base_Date`）。manifest:`system_daily` / [`raw/system_daily.md`](assets/orca-api-spec/raw/system_daily.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/system_daily.html) | `UTF-8` で `Api_Result=00`、Shift_JIS は `Api_Result=91`（RUN_ID=`20251113T002806Z`）。 | `notes/orca-api-field-validation.md` W19 の通り UTF-8 固定とした。`ORCA_CONNECTIVITY_VALIDATION.md` §4.4 の例も UTF-8 XML へ差し替え済み。 |
| 45 | `/api01rv2/patientlst7v2` | XML `<patientlst7req>`（`Request_Number`, `Patient_ID`, `Base_Date`, `Memo_Class`, `Department_Code`）。manifest:`patient_memo_list` / [`raw/patient_memo_list.md`](assets/orca-api-spec/raw/patient_memo_list.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/patient_memo_list.html) | RUN_ID 未設定。 | 返却される Patient_Memo は `/orca06/patientmemomodv2`（現在 405）で登録する想定のため、取得のみ実行しても内容が空になる。`notes/orca-api-field-validation.md` §3.3 で依存 API を明記。 |
| 46 | `/api21/medicalmodv23` | XML `<medicalv2req3>`（`Request_Number`, `Patient_ID`, `Department_Code`, `First_Calculation_Date`, `LastVisit_Date`）。manifest:`first_calculation_date` / [`raw/first_calculation_date.md`](assets/orca-api-spec/raw/first_calculation_date.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/first_calculation_date.html) | `HTTP 405 (Allow: OPTIONS, GET)`（RUN_ID=`20251113T002806Z`）。 | XML へ修正済みでも 405。route 開放か WebORCA 設定変更が必要。`notes/orca-api-field-validation.md` §2 参照。 |
| 47 | `/orca36/hsfindv3` | XML `<hsfindv3req>`（`Patient_Information.Admission_Date` の範囲、`Ward_Number`、`Admission_Status`）。manifest:`hospfind` / [`raw/hospfind.md`](assets/orca-api-spec/raw/hospfind.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/hospfind.html) | RUN_ID 未設定。 | 入院患者 seed が無いうえ、No.39/40 が失敗中のため連携メリットが説明できていない。`logs/2025-11-13-orca-connectivity.md` に記録を作る前に seed 方針を決める。 |
| 48 | `/api01rv2/contraindicationcheckv2` | XML `<contraindication_checkreq>`（`Perform_Month`, `Check_Term`, `Medical_Information[]`）。manifest:`contraindication_check` / [`raw/contraindication_check.md`](assets/orca-api-spec/raw/contraindication_check.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/contraindication_check.html) | RUN_ID 未設定。 | 薬剤履歴と症状詳記の照会が必要で、`PHASE2_PROGRESS.md` にも試行記録が無い。禁忌チェック UI 着手前に ORCA DB の薬剤履歴 seed を整備する。 |
| 49 | `/api01rv2/insuranceinf1v2` | XML `<insuranceinfreq>`（`Request_Number`, `Base_Date`）。manifest:`insurance_list` / [`raw/insurance_list.md`](assets/orca-api-spec/raw/insurance_list.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/insurance_list.html) | RUN_ID 未設定。 | 保険・公費の初期キャッシュに使う前提だが、`PHASE2_PROGRESS.md` の ORCA 節に実行例が無い。`ORCA_CONNECTIVITY_VALIDATION.md` §3.1 に「基準日=当日で 1 回取得」を追加。 |
| 50 | `/api01rv2/subjectiveslstv2` | XML `<subjectiveslstreq>`（`Request_Number=01-03`, `Patient_ID`, `Perform_Date`, `InOut`, `Department_Code`, `Insurance_Combination_Number`）。manifest:`subjectiveslst` / [`raw/subjectiveslst.md`](assets/orca-api-spec/raw/subjectiveslst.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/subjectiveslst.html) | RUN_ID 未設定。 | 症状詳記コメント取得の UI 要件が未確定で、`PHASE2_PROGRESS.md` にも検証タスクが無い。W22 以降のカルテ UI タスクに合わせて Runbook を追記する。 |
| 51 | `/api01rv2/patientlst8v2` | XML `<patientlst8req>`（`Request_Number`, `Patient_ID`）。manifest:`kyuseirireki` / [`raw/kyuseirireki.md`](assets/orca-api-spec/raw/kyuseirireki.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/kyuseirireki.html) | RUN_ID 未設定。 | 旧姓履歴は Web クライアントの患者詳細で必須だが、ORCA DB に旧姓サンプルが無い。`notes/orca-api-field-validation.md` §3.4 に seed 例と UTF-8 必須のメモを追加。 |
| 52 | `/api01rv2/medicationgetv2` | XML `<medicationgetreq>`（`Request_Number=01/02`, `Request_Code`, `Base_Date`）。manifest:`medicationgetv2` / [`raw/medicationgetv2.md`](assets/orca-api-spec/raw/medicationgetv2.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/medicationgetv2.html) | RUN_ID 未設定（2024-11 掲載 API のため `PHASE2_PROGRESS.md` にも履歴なし）。 | 診療コード検索や選択式コメント取得に直結するため、`orca-api-matrix` の P0 カテゴリへ昇格済み。`ORCA_CONNECTIVITY_VALIDATION.md` §4.4 に実行スニペットを追加予定。 |
| 53 | `/orca06/patientmemomodv2` | XML `<patientmemomodv2req>`（`Request_Number`, `Patient_ID`, `Department_Code`, `Memo_Mode`, `Memo_Title`, `Memo_Text`）。manifest:`patientmemomodv2` / [`raw/patientmemomodv2.md`](assets/orca-api-spec/raw/patientmemomodv2.md) / [ORCA Project](https://www.orca.med.or.jp/receipt/tec/api/patientmemomodv2.html) | `HTTP 405 (Allow: GET)`（RUN_ID=`20251113T002806Z`）。 | JSON→XML 化しても 405。WebORCA 側で POST を閉じているため、患者メモ CRUD フロー全体が停止している。`notes/orca-api-field-validation.md` §2 参照。 |

## 3. 次アクション
1. **POST 405/404 の実測継続**: `patientgetv2` など P0 API は WebORCA 本番で閉鎖されたままなので、`ORCA_HTTP_404405_HANDBOOK.md` の手順で直接実測し、`artifacts/orca-connectivity/<RUN_ID>/` に 404/405 証跡を蓄積する（サポート問い合わせは行わない）。
2. **UTF-8/桁数ルールの恒常化**: `system01dailyv2` の UTF-8 必須や `patientmodv2` の 8 桁制約を `ops/modernized-server/docker/custom.properties`（エンコーディング）と Web クライアント UI（入力バリデーション）へ反映する。
3. **モダナイズ側ラッパー整備**: `patientlst*`, `acsimulatev2` などが `OrcaResource` に存在しないため、`orca-api-matrix` の P0/P1 を優先にサーバー REST 実装を追加し、`MODERNIZED_REST_API_INVENTORY.md` に追記する。
4. **台帳同期**: 本サマリで判明したステータスを `orca-api-matrix.with-spec.csv` の備考列にも転記し、API ごとの対応状況を一元化する。

---

- 参考: [`assets/orca-api-spec/manifest.json`](assets/orca-api-spec/manifest.json)、[`logs/2025-11-13-orca-connectivity.md`](logs/2025-11-13-orca-connectivity.md)、[`notes/orca-api-field-validation.md`](../notes/orca-api-field-validation.md)、[`PHASE2_PROGRESS.md`](../PHASE2_PROGRESS.md)、[`MODERNIZED_REST_API_INVENTORY.md`](../../MODERNIZED_REST_API_INVENTORY.md)
