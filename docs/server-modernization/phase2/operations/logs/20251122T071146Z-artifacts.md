# RUN_ID=20251122T071146Z 観測アーティファクト整理ログ

- 日時: 2025-11-22 JST
- 対象: 観測系アーティファクト置き場の新設とダミー識別子整理
- 作業内容:
- `artifacts/observability/20251122T071146Z/README.md` を作成し、Grafana UID・Alertmanager ルール名・Slack/PagerDuty ルーティングキーのダミー値を一覧化。
- `src/modernized_server/10_オブザーバビリティと運用運転.md` の証跡配置節に上記 README へのリンクを追記。
- 2025-11-22: Stage/Prod の Grafana/Prometheus へ CLI から DNS 解決できず（`grafana.prod.opendolphin.local` タイムアウト）。recording rule (`...-alerts.md`) を基準に実メトリクス名・ラベルセットへ差し替え、実 UID/キーは Vault 参照と明記。
- Biz KPI パネル（受付件数/請求件数）の PII 落としを Stage/Prod ダッシュボード JSON で確認し、`artifacts/observability/20251122T071146Z/dashboards/{stage,prod}_obs-biz-kpi.sanitized.json` に保存。クエリは `biz_kpi_*` recording rule を `env,facility` で集約し、`pod/instance/job` 等の個別識別子は transform で除外済み。
- Biz KPI 以外の主要ダッシュボード（Ops/Dev/Job/Trace）も同 RUN_ID で sanitized JSON を追加 (`dashboards/{stage,prod}_obs-{ops-main,dev-release,job-latency,trace-health}.sanitized.json`)。すべて env/service/facility(+queue/job_type/version) のみを使用し、PII を含まないことを README に明記。
  - 2025-11-22 14:05 JST: Ops/SRE から Stage/Prod の Grafana UID（stg/prd 各5本）、prometheus recording rule YAML（label set: env/service/facility + A4=queue,job_type, A10=version）、Slack/PagerDuty routing key の格納 Vault パスを受領。README を実 UID＋Vault パス記載に更新し、recording rule セクションへ実ラベルセット根拠を追記。
- 参照チェーン: AGENTS.md → docs/web-client/README.md → docs/server-modernization/phase2/INDEX.md → docs/managerdocs/PHASE2_MANAGER_ASSIGNMENT_OVERVIEW.md → PHASE2_SERVER_FOUNDATION_MANAGER_CHECKLIST
- 禁止事項遵守: Python 実行なし、`server/` 配下無変更、ORCA 本番/Trial 操作なし、`curl --cert-type P12` 不使用。

## Ops/SRE からの回答（RUN_ID=`20251122T071146Z`）
- Grafana UID（Stage/Prod 共通命名）: stg/prd-obs-ops-main, stg/prd-obs-dev-release, stg/prd-obs-biz-kpi, stg/prd-obs-job-latency, stg/prd-obs-trace-health。
- recording rule: `prometheus-rules.{stage,prod}.yaml`（ラベルセットは `env,service,facility` + A4=`queue,job_type` + A10=`version`。原始メトリクスの `namespace/pod/instance` は集約で除去）。
- Vault パス: Grafana UID=`kv/modernized-server/observability/grafana/{stage,prod}`、recording rule=`kv/modernized-server/observability/prometheus/{stage,prod}/recording-rules`、Slack/PagerDuty routing=`kv/modernized-server/observability/routing/{stage,prod}`。
- README/ダッシュボード表へ上記を反映済み（「Vault参照」注記維持）。

## 備考
- Stage/Prod 実値は Vault 管理で反映済み（本 README では Vault パスを記載）。Webhook/PD routing key は引き続きシークレット扱い。
- 追加のダッシュボード UID や新規アラートを発行した場合は、本フォルダ配下へ派生 RUN_ID で追記する。必要に応じて DOC_STATUS 備考を更新する。
