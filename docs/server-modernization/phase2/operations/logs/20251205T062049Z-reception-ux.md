# 20251205T062049Z Reception UX 実装ログ
- RUN_ID=`20251205T062049Z`

## 1. 背景と目的
- ReceptionPage と OrderConsole のリファクタリングで `tone=server` バナー、`ResolveMasterBadge`、`missingMaster` バッジ/メモを段階的に集約し、`aria-live` を OrderConsole 内の単一ライブリージョン（tone banner + `role=status` note）で制御する。`missingMaster` の入力/説明は OrderConsole だけに残し、Chart/Patients/Reception 間で `status-badge` クラスと `data-run-id` を共通化することでトーン整合と監査 carry-overを維持する。

## 2. 依存 API とフラグ起点
1. `web-client/src/libs/http/httpClient.ts::OUTPATIENT_API_ENDPOINTS`
   - `/orca/claim/outpatient/*` ～ `/orca/patients/local-search/*` + ORCA の Medical/Patient モジュールが `group='outpatient'` で集約され、レスポンスに `auditMetadata` として `missingMaster`/`cacheHit`/`fallbackUsed`/`dataSourceTransition` を添えている。`resolveMasterSource` が `dataSourceTransition=server` を返すタイミングでこれらのエンドポイントを叩き、`missingMaster` の真偽が `telemetryClient` の `funnels/outpatient` へ伝播。
2. `web-client/src/libs/telemetry/telemetryClient.ts::recordOutpatientFunnel`
   - `OutpatientFlagAttributes` を `resolve_master`/`charts_orchestration` の各 `stage` で記録し、`runId` + `missingMaster` + `cacheHit` + `dataSourceTransition` を `funnels/outpatient` に保存。Reception の `OrderConsole` と Charts/Patients がこの `recordOutpatientFunnel` の出力をトリガに tone を同期する想定のため、`missingMaster` フラグは ORCA 応答が切り替わるまで `tone=server` を維持する。
3. `web-client/src/features/reception/components/OrderConsole.tsx`
   - 上部に Step 1 (ToneBanner) → Step 2 (ResolveMasterBadge) の構造を追加し、`missingMaster` のトグル/キャッチアップ・`CacheHitBadge`/`MissingMasterBadge`・`missingMaster` メモ（`role=status` + `aria-live` 動的）を一つのコンポーネントへ集中させた。`data-run-id` は `OrderConsole` と各バッジ・note に埋め込まれ、Charts との carry-over 監査に利用しやすくした。
4. `web-client/src/features/reception/styles.ts::statusBadgeStyles`
   - `status-badge` 系スタイルを `statusBadgeStyles` へ分離し、Reception/OrderConsole が `Global styles={receptionStyles}` を通じて注入すると同時に、`StatusBadge` コンポーネントがこのスタイルを内部で `Global` で参照することで Charts/Patients でも共通化。
5. `web-client/src/features/shared/StatusBadge.tsx`
   - `statusBadgeStyles` を `Global` で読み込み、Badge コンポーネントを import するすべての画面で同一トーン・角丸・パディングを保持。`missingMaster`/`cacheHit` 表示はここを唯一のスタイル起点として Charts/Patients/Reception で再利用する。

## 3. `missingMaster` flag の起点確認
- ORCA から返る `missingMaster` は上記 `OUTPATIENT_API_ENDPOINTS` の `auditMetadata` に含まれ、`telemetryClient.recordOutpatientFunnel` への `payload.missingMaster` として再送信される。Navigation コンポーネントが `resolveMasterSource('server')` をコールした後、この flag が `true` のままであれば `ToneBanner` は error/warning を維持し、OrderConsole の `MissingMasterBadge` とメモも assertive で再取得を促す。`missingMaster` が `false` になると `ToneBanner` は info/warning へ降格・`CacheHitBadge` が success になり、`missingMaster` メモは polite となる。

## 4. 証跡と次アクション
- Artifact: `artifacts/webclient/ux-notes/20251205T062049Z-reception-ux-implementation.md`（props/flag のマッピング・ステップ構成・差分メモ）。
- Screenshot: `artifacts/webclient/ux-notes/20251205T062049Z-reception-ux-implementation.png`（Step 1＝tone banner・Step 2＝resolve master・missingMaster note）。
- Docs: `docs/web-client/ux/reception-schedule-ui-policy.md` に RUN_ID=`20251205T062049Z` 版の調整メモ・スクリーンショットの説明を追加済み。
- DOC_STATUS: `docs/web-client/planning/phase2/DOC_STATUS.md` の「Reception UX」行へ RUN_ID/証跡を追加し、README (`docs/web-client/README.md`) の RUN_ID コメントも更新する。
- 次アクション: Charts/Patients 側で録画済み `status-badge` CSS が反映されていることと、Playwright/Stage で `missingMaster` → `cacheHit` の tone → `dataSourceTransition=server` 連鎖を再確認する。
