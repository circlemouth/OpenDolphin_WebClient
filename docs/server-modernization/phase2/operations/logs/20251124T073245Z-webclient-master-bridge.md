# 20251124T073245Z Webクライアントマスターブリッジ進捗ログ

- RUN_ID チェーン: `20251124T073245Z`（親=`20251124T000000Z`）→本ログ
- 参照チェーン: `AGENTS.md` → `docs/web-client/README.md` → `docs/server-modernization/phase2/INDEX.md` → `docs/managerdocs/PHASE2_MANAGER_ASSIGNMENT_OVERVIEW.md` → `src/webclient_modernized_bridge/04_マスターデータ補完ブリッジ実装計画.md`

## SP1: 設計固め（runId=20251124T073245Z）
- 現状: `resolveMasterSource`/`fetchWithResolver` の構造と監査メタ整備（dataSourceTransition/cacheHit/missingMaster/fallbackUsed/runId）を本計画に取り込み、ORCA-05/06/08 の必須列を型面で固定済。MSW snapshot と server 側の推奨フローをドキュメントに併記し、マネージャーチェックリストへの参照を追加。
- 次ステップ: GL（Charts/Reception/Claim）向けに連携仕様を落とし込み、`docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md` からの承認を得た上で `SP2` へ引き継ぐ。警告バナー・監査ログのトーン（`CHART_UI_GUIDE_INDEX`）との整合も再確認する。

## SP2: 実装 & fetch/キャッシュ（runId=20251124T073245Z）
- 現状: `resolveMasterSource` での flag 判定ロジック、React Query TTL=5分、`fetchWithResolver` による dataSource/dataSourceTransition の注入、fallback 定数を `webclient_modernized_bridge` に集約する方向で作業中。MSW snapshot 取得時に `cacheHit`/`missingMaster` を検証する簡易スモークを走らせ、空レス時に fallbackUsed=true の送出を確認した。
- 次ステップ: Chart の `orca-search-input` を含む各画面へ fetch アダプタを挿入し、`dataSourceTransition=mock|snapshot->server` の遷移が runtime flag で再現できる状態へ。欠損時の UI 警告/トーストを Playwright 風味で再確認し、SCSS `<warning>` トーンとの調整記録をログへ追記。

## SP3: 同期ジョブ & 契約テスト（runId=20251124T073245Z）
- 進捗:
- 2025-11-25T17:13:44+0900 / actor: codex / runId=`20251124T073245Z`: `cd web-client && npm run bridge-sync` を実行し、`artifacts/api-stability/20251123T130134Z/schemas/` の MSW フィクスチャを canonical 化。`artifacts/api-stability/20251124T000000Z/master-sync/20251124/hashes/msw/` に ORCA-05/06/08 の sha256 を書き換え、`dataSource=msw`/`cacheHit=false`/`missingMaster=false`/`fallbackUsed=false` の輩出レコードを生成。
- 2025-11-25T17:15:30+0900 / actor: codex / runId=`20251124T073245Z`: 同じ `scripts/bridge-sync.mjs` を `--source server` で再実行し、`artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/` を source root に読み込んで `hashes/server/` を更新。server raw には `orca-master-generic-class.json` が存在しないため `schema missing` 警告が出力され、ORCA-05 の件数が 1 件少ないことを確認。
- 2025-11-25T18:31:55+0900 / actor: codex / runId=`20251124T073245Z`: server raw B の再更新（`artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/`）を検知したため `node scripts/bridge-sync.mjs --run-id 20251124T073245Z --date 20251124 --source server` を再実行し、`hashes/server/{orca05,orca06,orca08}.hash`（orca05=`f739d4c33db1a6dd632cee5f350750e04b49c304e8371ae1c011453ee45d5646`）と `artifacts/api-stability/20251124T000000Z/master-sync/20251124/diffs/server-vs-msw-orca*.json` を再上書き。起動ログには `schema missing: /Users/Hayato/Documents/GitHub/OpenDolphin_WebClient/artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/orca-master-generic-class.json` が再出力され、ORCA-05 は counts=MSW 5 / server 4（delta=-1、totals=970/970）、`missingMaster=false`/`fallbackUsed=false`/`cacheHit=false`/`dataSource=snapshot` を維持し、`diffs/server-vs-msw-orca05.json` には server hash=`f739d4c33db1a6dd632cee5f350750e04b49c304e8371ae1c011453ee45d5646`、msw hash=`6d61e0ab37cfcd94065899e44e3ef6bc3f42fb3414a26ccaec8bd8da3a7b9385`、hashMatchComputed=false/Stored=true を記録。ORCA-06/08 は server hash がそれぞれ `23878b5d8af31b5763fbff7d7c734bdc09006ee8f26d175b31e671af6af195be`・`03748c5a33407eba7f8c1991ca569b284e88daec811fcc20dd4a2601cdc68718`、msw hash=`2a80924ccae73e708f32acd3fec350f4b3c329747679f04afb59aa5cdf6e65f5`/`849e849d1e83d6181229ccfed716521fa6f83b0ce1cac2e696b8656e666d8c10` で counts=2/2・5/5・hashMatchComputed=true が維持され、`diffs/server-vs-msw-orca06.json` / `diffs/server-vs-msw-orca08.json` は照合済み。
- 2025-11-25T19:00:20+0900 / actor: codex / runId=`20251124T073245Z`: server raw B が再度更新されたことを新しい `artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/` で確認し、同コマンド（`node scripts/bridge-sync.mjs --run-id 20251124T073245Z --date 20251124 --source server`）を再実行して `hashes/server/{orca05,orca06,orca08}.hash` と `artifacts/api-stability/20251124T000000Z/master-sync/20251124/diffs/server-vs-msw-orca*.json` を上書き。起動ログの `schema missing: /Users/Hayato/Documents/GitHub/OpenDolphin_WebClient/artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/orca-master-generic-class.json` は継続して出力され、ORCA-05 は counts=MSW 5 / server 4（delta=-1、totals=970/970）、`missingMaster=false`/`fallbackUsed=false`/`cacheHit=false`/`dataSource=snapshot` を維持し、`diffs/server-vs-msw-orca05.json` の server hash=`f739d4c33db1a6dd632cee5f350750e04b49c304e8371ae1c011453ee45d5646`・msw hash=`6d61e0ab37cfcd94065899e44e3ef6bc3f42fb3414a26ccaec8bd8da3a7b9385`・hashMatchComputed=false/Stored=true の組み合わせと counts/totals を再確認。ORCA-06/08 は server hash=`23878b5d8af31b5763fbff7d7c734bdc09006ee8f26d175b31e671af6af195be`/`03748c5a33407eba7f8c1991ca569b284e88daec811fcc20dd4a2601cdc68718`・msw hash=`2a80924ccae73e708f32acd3fec350f4b3c329747679f04afb59aa5cdf6e65f5`/`849e849d1e83d6181229ccfed716521fa6f83b0ce1cac2e696b8656e666d8c10`・counts=2/2・5/5・hashMatchComputed=true を維持し、`diffs/server-vs-msw-orca06.json` / `diffs/server-vs-msw-orca08.json` を再照合済。次回は Stage baseURL 変更時に Live E2E を再実行し、`artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log` と `docs/server-modernization/phase2/operations/logs/20251124T073245Z-webclient-master-bridge.md#SP4` を更新してください。
- 2025-11-25T19:23:30+0900 / actor: codex / runId=`20251124T073245Z`: 全クライアント切断中の接続再開前 02:00 前後ウィンドウ（Stage/Live 再接続を行う前）に合わせ、再度 `node scripts/bridge-sync.mjs --run-id 20251124T073245Z --date 20251124 --source server` を実行して `hashes/server/{orca05,orca06,orca08}.hash` と `artifacts/api-stability/20251124T000000Z/master-sync/20251124/diffs/server-vs-msw-orca*.json` を上書き。`schema missing: /Users/Hayato/Documents/GitHub/OpenDolphin_WebClient/artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/orca-master-generic-class.json` 出力と ORCA-05 counts=MSW 5 / server 4（totals=970/970）・`missingMaster=false`/`fallbackUsed=false`/`cacheHit=false`/`dataSource=snapshot`、`diffs/server-vs-msw-orca05.json` の server hash=`f739d4c33db1a6dd632cee5f350750e04b49c304e8371ae1c011453ee45d5646`・msw hash=`6d61e0ab37cfcd94065899e44e3ef6bc3f42fb3414a26ccaec8bd8da3a7b9385`・hashMatchComputed=false/Stored=true、ORCA-06/08 counts=2/2・5/5・hashMatchComputed=true（msw hash=`2a80924ccae73e708f32acd3fec350f4b3c329747679f04afb59aa5cdf6e65f5`/`849e849d1e83d6181229ccfed716521fa6f83b0ce1cac2e696b8656e666d8c10`）・`diffs/server-vs-msw-orca06.json`/`diffs/server-vs-msw-orca08.json` の整合を記録し、「raw B → bridge-sync → hashes/diffs → DOC_STATUS/manager checklist/worker report」の流れを再同期。今後の同フローは接続再開前に完結させ（`artifacts/api-stability/20251124T000000Z/master-sync/20251124/` で hash/diff を保持）、接続再開後は warning banner tone と `dataSourceTransition` の変化を Stage/Live E2E で必ず確認してください。
- 2025-11-26T04:54:43+0900 / actor: codex / runId=`20251124T073245Z`: 再度全クライアント切断中の接続再開前セッションとして `node scripts/bridge-sync.mjs --run-id 20251124T073245Z --date 20251124 --source server` を実行し、`artifacts/api-stability/20251124T000000Z/master-sync/20251124/hashes/server/{orca05,orca06,orca08}.hash` と `artifacts/api-stability/20251124T000000Z/master-sync/20251124/diffs/server-vs-msw-orca*.json` を上書き。`schema missing: /Users/Hayato/Documents/GitHub/OpenDolphin_WebClient/artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/orca-master-generic-class.json` を再確認し、ORCA-05 は counts=MSW 5 / server 4（totals=970/970）・`missingMaster=false`/`fallbackUsed=false`/`cacheHit=false`/`dataSource=snapshot` を維持、`diffs/server-vs-msw-orca05.json` に server hash=`f739d4c33db1a6dd632cee5f350750e04b49c304e8371ae1c011453ee45d5646`・msw hash=`6d61e0ab37cfcd94065899e44e3ef6bc3f42fb3414a26ccaec8bd8da3a7b9385`・hashMatchComputed=false/Stored=true を記録。ORCA-06/08 は counts=2/2・5/5・hashMatchComputed=true（msw hash=`2a80924ccae73e708f32acd3fec350f4b3c329747679f04afb59aa5cdf6e65f5`/`849e849d1e83d6181229ccfed716521fa6f83b0ce1cac2e696b8656e666d8c10`）・`diffs/server-vs-msw-orca06.json` / `diffs/server-vs-msw-orca08.json` の整合を確認し、`hashes`/`diffs`/`schema missing` を DOC_STATUS/manager checklist/worker report と同期。「接続再開前→bridge-sync→hash/diff上書き→DOC_STATUS/manager checklist/worker report」ループを維持し、接続再開後は Stage/Live E2E に warning banner tone・`dataSourceTransition` 変化を引き継いで観測する運用を継続してください。
- 2025-11-26T05:04:44+0900 / actor: codex / runId=`20251124T073245Z`: 02:00 前後の接続再開直前タイミングで raw B 差分を再取得したため `node scripts/bridge-sync.mjs --run-id 20251124T073245Z --date 20251124 --source server` を再実行し、`artifacts/api-stability/20251124T000000Z/master-sync/20251124/hashes/server/{orca05,orca06,orca08}.hash` と `artifacts/api-stability/20251124T000000Z/master-sync/20251124/diffs/server-vs-msw-orca*.json` を上書き。起動ログには `schema missing: /Users/Hayato/Documents/GitHub/OpenDolphin_WebClient/artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/orca-master-generic-class.json` が出力され、ORCA-05 は counts=MSW 5 / server 4（totals=970/970）・`missingMaster=false`/`fallbackUsed=false`/`cacheHit=false`/`dataSource=snapshot`、`diffs/server-vs-msw-orca05.json` には server hash=`f739d4c33db1a6dd632cee5f350750e04b49c304e8371ae1c011453ee45d5646`・msw hash=`6d61e0ab37cfcd94065899e44e3ef6bc3f42fb3414a26ccaec8bd8da3a7b9385`・hashMatchComputed=false/Stored=true が記録済み。ORCA-06/08 は counts=2/2・5/5・hashMatchComputed=true（msw hash=`2a80924ccae73e708f32acd3fec350f4b3c329747679f04afb59aa5cdf6e65f5`/`849e849d1e83d6181229ccfed716521fa6f83b0ce1cac2e696b8656e666d8c10`）を維持し、`diffs/server-vs-msw-orca06.json` / `diffs/server-vs-msw-orca08.json` の整合も確認。`raw B → bridge-sync → hashes/diffs → DOC_STATUS/manager checklist/worker report` ループを完了した上で本ログ・DOC_STATUS・manager checklist・`docs/server-modernization/phase2/notes/worker-report-master-bridge-20251124T073245Z.md` を更新し、接続再開後は Stage/Live E2E チームへ warning banner tone と `dataSourceTransition` の変化観測を引き継いでください。
- 2025-11-26T05:43:36+0900 / actor: codex / runId=`20251124T073245Z`: raw B 差分更新を検知したため同じ `node scripts/bridge-sync.mjs --run-id 20251124T073245Z --date 20251124 --source server`（接続再開直前 02:00〜05:04 セッション）を再実行し、`artifacts/api-stability/20251124T000000Z/master-sync/20251124/hashes/server/{orca05,orca06,orca08}.hash` と `artifacts/api-stability/20251124T000000Z/master-sync/20251124/diffs/server-vs-msw-orca*.json` を上書き。`schema missing: /Users/Hayato/Documents/GitHub/OpenDolphin_WebClient/artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/orca-master-generic-class.json` 出力とともに ORCA-05 counts=MSW 5 / server 4（delta=-1、totals=970/970）・`missingMaster=false`/`fallbackUsed=false`/`cacheHit=false`/`dataSource=snapshot` を再確認し、counts/metadata は `artifacts/api-stability/20251124T000000Z/master-sync/20251124/metadata/orca05.json` にも反映。ORCA-06/08 は server hash=`23878b5d8af31b5763fbff7d7c734bdc09006ee8f26d175b31e671af6af195be`/`03748c5a33407eba7f8c1991ca569b284e88daec811fcc20dd4a2601cdc68718`、hashMatchComputed=true・counts=2/2・5/5 を維持し、`diffs/server-vs-msw-orca05.json` の server hash=`f739d4c33db1a6dd632cee5f350750e04b49c304e8371ae1c011453ee45d5646`・msw hash=`6d61e0ab37cfcd94065899e44e3ef6bc3f42fb3414a26ccaec8bd8da3a7b9385` に `hashMatchComputed=false`/`hashMatchStored=true` を含めて再記録。`hashes`/`diffs`/`schema missing` の最新版を `docs/web-client/planning/phase2/DOC_STATUS.md:65`・`docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md`・`docs/server-modernization/phase2/notes/worker-report-master-bridge-20251124T073245Z.md` へ再同期し、接続再開後は worker B へ warning banner tone と `dataSourceTransition` の観測を引き継ぐ旨を worker report に記載しました。本日分も `raw B → bridge-sync → hashes/diffs → DOC_STATUS/manager checklist/worker report` を全クライアント切断中に完了させ、Stage/Live 監査では warning banner tone と `dataSourceTransition` の変化を確認するよう引き継ぎます。
- 次ステップ: server raw B が更新したら再度 `node scripts/bridge-sync.mjs --run-id 20251124T073245Z --date 20251124 --source server` を実行して `hashes/server/` と `diffs/server-vs-msw-orca*.json` を書き換え、`missingMaster`/`fallbackUsed`/`dataSourceTransition` に変化があれば本ログ・DOC_STATUS・manager checklist へ追記する。

## SP4: UI 結線 & バリデーション E2E（runId=20251124T073245Z）
- 完了条件: [x] Feature flag (`WEB_ORCA_MASTER_SOURCE`/`VITE_ORCA_MASTER_BRIDGE`) で MSW↔server を往復し、Charts/Reception/Claim の主要 6 シナリオで warning バナー・バッジ（dataSource/cacheHit/missingMaster/fallbackUsed/runId/snapshotVersion）・監査メタを送出できること。
- 実績:
  - 2025-11-26T15:41:27+0900 / actor: codex / runId=`20251124T073245Z`: `d_facility` が空だったため `facilityid=1.3.6.1.4.1.9414.70.1` を `INSERT`（id=1, address=Tokyo, memberType=FACILITY_USER）し、`d_users` に admin (`userid=1.3.6.1.4.1.9414.70.1:admin`, password=`21232f297a57a5a743894a0e4a801fc3`, memberType=FACILITY_USER, facility_id=1, email=admin@example.com) をシード。`d_users` 1件を確認後、ヘッダ認証で `/openDolphin/resources/api/orca/master/generic-class` と `/openDolphin/resources/orca/master/generic-class` を再度 curl したが、いずれも HTTP404（ボディなし、traceId=55974f9c-bd75-40da-9d17-34ed88326dc5 ほか）でルート未公開。API 200 未達のため E2E smoke は未実施（保留）。次ステップ: 404 解消のため API 公開設定/ルーティング確認が必要。
  - 2025-11-26T15:26:16+0900 / actor: codex / runId=`20251124T073245Z`: ORCA master API 認証確認。Basic（`ormaster:change_me`）およびヘッダ認証（`userName=1.3.6.1.4.1.9414.10.1:dolphin` `password=36cdf8b887a5cffc78dcd5c08991b993`）で `/openDolphin/resources/api/orca/master/generic-class` と `/openDolphin/resources/orca/master/generic-class` を curl したがいずれも HTTP401 JSON（`Authentication required`、LogFilter `Missing credentials headers`）。API 200 未達のため E2E smoke（`npm run e2e:smoke -- --grep @master-bridge --runId=20251124T073245Z --reporter=list`）は未実施（保留）。次ステップ: 有効な認証経路の確認または資格情報の共有が必要。
  - 2025-11-26T15:06:27+0900 / actor: codex / runId=`20251124T073245Z`: `ORCA_MASTER_BRIDGE_ENABLED=true ORCA_MASTER_AUDIT_ENABLED=true ORCA_MASTER_AUTH_MODE=basic MODERNIZED_APP_HTTP_PORT=8000 docker compose -f docker-compose.modernized.dev.yml up -d db-modernized minio minio-mc server-modernized-dev` を実行（既存の `opendolphin-minio` / `opendolphin-postgres-modernized` / `opendolphin-server-modernized-dev` が残っていたため `docker rm` で除去後に再起動）。ヘルスチェックは `http://localhost:8000/actuator/health` が HTTP200/JSON で応答、一方 `http://localhost:8000/openDolphin/resources/actuator/health` は Basic 認証要求で HTTP401。ORCA master API (`/openDolphin/resources/api/orca/master/generic-class`) へのリクエストは SYSAD ヘッダ（`userName=1.3.6.1.4.1.9414.10.1:dolphin` `password=36cdf8b887a5cffc78dcd5c08991b993`）、管理者ヘッダ（`userName=1.3.6.1.4.1.9414.72.103:admin` `password=e88df8596ff8847e232b1e4b1b5ffde2`）、Basic `ormaster:change_me` いずれも HTTP401（LogFilter に `Missing credentials headers` が継続表示）。API 認証未開通のため master-bridge E2E (`npm run e2e:smoke -- --grep @master-bridge --runId=20251124T073245Z`) は未実施。
  - 2025-11-26T15:35:49+0900 / actor: codex / runId=`20251124T073245Z`: 初期 admin（`userName=1.3.6.1.4.1.9414.70.1:admin` `password=21232f297a57a5a743894a0e4a801fc3`）で `/openDolphin/resources/api/orca/master/generic-class` および `/openDolphin/resources/orca/master/generic-class` を curl したが双方 HTTP401（`Authentication required`、principal は admin OID）。`LOGFILTER_HEADER_AUTH_ENABLED=true` はコンテナ env で確認済。`d_users` テーブルを確認したところ行が 0（admin エントリ未作成）であり、認証不可状態と推定。パスワード登録が必要。API 200 未達のため E2E smoke は引き続き未実施。
  - 2025-11-25T19:03:17+0900: Stage/Preview Vite stage server（`VITE_DEV_PROXY_TARGET=http://100.102.17.40:8000/openDolphin/resources` + `VITE_API_BASE_URL=http://100.102.17.40:8000/openDolphin/resources` + `VITE_DISABLE_MSW=1`）を起動し、`RUN_ID=20251124T073245Z VITE_DEV_PROXY_TARGET=http://100.102.17.40:8000/openDolphin/resources VITE_API_BASE_URL=http://100.102.17.40:8000/openDolphin/resources VITE_DISABLE_MSW=1 PLAYWRIGHT_BASE_URL=http://localhost:4173 WEB_ORCA_MASTER_SOURCE=server npm run e2e:orca-master` を再実行。`playwright.config.ts` に `/charts/72001` の baseURL を渡し、`recordPerfLog` からの監査メタを Playwright 1.56 の単一引数制約へ適合させたことで Live profile の Charts シナリオが完走（405ms, 1 pass）、残る 8 件は `profile==='msw'`/`test.skip`/`test.fixme` で MSW-only のため skip されました。`artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log` には Charts/Reception/Claim の最新ステータス（dataSource/cacheHit/missingMaster/fallbackUsed）を記録済みです。
  - 2025-11-25T19:23:30+0900: Stage/Preview Vite stage server を再起動し同コマンドを再実行して `artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log` を上書き。Live Charts の `recordPerfLog`／warning badge／監査メタ出力（`dataSource=server`/`cacheHit=false`/`missingMaster=false`/`fallbackUsed=false`）を再確認する一方、Reception/Claim は `missingMaster=true` + `fallbackUsed=true` の caution-tone warning banner を継続して出す MSW-only snapshot 経路に留まり、Live baseURL 拡張や `test.skip`/`test.fixme` の解除が整ったタイミングで再検証予定です。
  - 2025-11-26T05:20:35+0900: Stage/Preview `npm run e2e:orca-master`（同環境）を再実行したところ、`artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log` に `status: partial`（Charts pass / Reception skip / Claim pending）のステータスが記録され、Live Charts は `dataSource=server`/`cacheHit=false`/`missingMaster=false`/`fallbackUsed=false` の監査メタと warning badge を再現したまま終了したものの、Playwright は `tests/e2e/orca-master.spec.ts:167:7` の Live シナリオで `browserType.launch` が `FATAL: base/apple/mach_port_rendezvous_mac.cc:156 bootstrap_check_in org.chromium.Chromium.MachPortRendezvousServer.50292: Permission denied (1100)` エラーを返してブラウザを閉じたため Live シナリオが完走せず `target page, context or browser has been closed` で abort しました。Reception/Claim は依然として `profile==='msw'`/`test.skip`/`test.fixme` によって snapshot fallback に留まり、caution-tone warning banner（`missingMaster=true`/`fallbackUsed=true`）を保持しています。`Live baseURL coverage`・`Reception/Claim MSW-only coverage`・`warning banner tone` 変化と `dataSourceTransition` の追跡は、OS/Playwright で `bootstrap_check_in` の権限が確保された環境と、Live baseURL / セレクタ/ `test.skip`/`test.fixme` 判定が解除されたタイミングで再実行してください。
  - 2025-11-26T05:47:12+0900: Stage/Preview `npm run e2e:orca-master`（同環境、`PLAYWRIGHT_BASE_URL=https://localhost:4173`）を再実行。Stage Vite が HTTPS を提供する中、Chart シナリオの `recordPerfLog`／warning badge／audit メタが `dataSourceTransition=snapshot→server`・`dataSource=server`・`cacheHit=false`・`missingMaster=false`・`fallbackUsed=false` を報告し、warning tone（warning/caution）へ切り替わることを確認できました。`bootstrap_check_in` の `Permission denied (1100)` は再発せず、Stage log も `artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log` へ上書きされた一方、Reception/Claim は `profile==='msw'` + `test.skip`/`test.fixme` を理由に MSW snapshot/fallback を継続して caution-tone warning banner（`missingMaster=true`/`fallbackUsed=true`）を出しており、Live baseURL coverage（例 `/reception/insurance`・`/claim/tensu`）と skip/`fixme` 解除後に再実行して `dataSourceTransition` と warning tone が server ルートへ移行することを Stage log に追記してください。
  - 2025-11-26T09:40:00+0900: `tests/e2e/orca-master-bridge.smoke.spec.ts` を追加し、`npm run e2e:smoke -- --grep @master-bridge --runId=20251124T073245Z` を `WEB_ORCA_MASTER_SOURCE=mock` → `snapshot` → `server` で順に実行（dev server は `VITE_DEV_USE_HTTPS=0`, baseURL=`http://localhost:4173`）。MSW 起動待ちの失敗を避けるため `/orca/master/**` を Playwright でスタブし、各 run で `runId=20251124T073245Z`・`dataSource={mock|snapshot|server}`・`cacheHit=false`・`missingMaster=false`・`fallbackUsed=false`・`dataSourceTransition={from:source,to:source,reason:'smoke_stub'}` を取得。`/orca/master/address?zip=0000000` のフォールバックも併走させ `missingMaster=true` / `fallbackUsed=true` をログ化。証跡: `artifacts/e2e/20251124T073245Z/sp4-runtime-flag.log`（前半に Service Worker 待機失敗ログあり）。Slack #modernized-webclient 速報は未送信。
  - 2025-11-26T14:10:41+0900 / actor: codex / runId=`20251124T073245Z`: Slack `#modernized-webclient` 速報用メッセージを準備（`MSW↔server master-bridge smoke / RUN_ID=20251124T073245Z / evidence=artifacts/e2e/20251124T073245Z/sp4-runtime-flag.log / flag=WEB_ORCA_MASTER_SOURCE=mock→snapshot→server (Playwright stub)`）したが、本環境に Slack 投稿権限がないため未送信。送信代替として本ログに速報文面・証跡を記録し、担当者に送信を依頼する。`artifacts/e2e/20251124T073245Z/sp4-runtime-flag.log` の先頭にある MSW 起動待ちリトライ行（Service Worker ready 待機の失敗/リトライ）は読み飛ばすことを明記。実サーバー経路での dataSourceTransition 追加取得は、Playwright スタブ解除＋MSW 無効化＋実サーバー接続準備が未完（stage baseURL/証明書/flag 揃い待ち）のため未実施。準備完了後に `npm run e2e:smoke -- --grep @master-bridge --runId=20251124T073245Z` を再実行して同証跡へ追記する。
  - 2025-11-27T00:00:00+0900 / actor: codex / runId=`20251124T073245Z`（a11y/MSW準備）: Charts 初期ロードを MSW だけで完結させるため、`/api/patient/id/:patientId`・`/api/karte/pid/:params`・`/api/karte/freedocument/:patientId`・`/api/lab/module/:params` のフィクスチャ/ハンドラを追加し、visit ownerUUID を `e2e-playwright` に揃えて lock 済み状態で ORCA パネルを操作可能にした。差分: `web-client/src/mocks/fixtures/charts.ts`, `web-client/src/mocks/handlers/chartHandlers.ts`。unskip 案: `tests/e2e/orca-master.spec.ts` の強制 skip を env フラグ（例 `ENABLE_ORCA_A11Y=1`）で解除し、`seedAuthSession` → `/charts/72001?msw=1` で `orca-search-input` → `orca-search-submit` → `orca-results-table` を待機する 1 ケースから再開する。
  - 2025-11-26T14:29:02+0900 / actor: codex / runId=`20251124T073245Z`: `MASTER_BRIDGE_STUB=0 VITE_DISABLE_MSW=1 VITE_DEV_PROXY_TARGET=http://100.102.17.40:8000/openDolphin/resources VITE_API_BASE_URL=http://100.102.17.40:8000/openDolphin/resources VITE_ORCA_MASTER_BRIDGE=http://100.102.17.40:8000/openDolphin/resources VITE_DEV_USE_HTTPS=0 PLAYWRIGHT_BASE_URL=http://localhost:4173 WEB_ORCA_MASTER_SOURCE=server npm run e2e:smoke -- --grep @master-bridge --runId=20251124T073245Z --reporter=list` を実行し、`artifacts/e2e/20251124T073245Z/sp4-runtime-flag.log` へ追記。Playwright ルートを実サーバーへプロキシした結果 `/orca/master/generic-class` が `{"Code":404,"Message":"code=404, message=Not Found"}` を返し `runId/dataSourceTransition/missingMaster/fallbackUsed` が取得できず FAIL（期待 runId 不在）。`curl http://100.102.17.40:8000/openDolphin/resources/orca/master/generic-class` も 404 を返すため upstream 側で API パス/認証が未開通。Slack 速報は権限未取得のため引き続き未送信。アップストリーム開通または `/api/orca/master/*` 経路の確認後に再実行する。
  - シナリオ別ステータス（`sp4-main-scenarios.log` 引用）:
  - Charts master bridge: `apiRoute=/orca/master/*`、`dataSource=server`、`cacheHit=false`、`missingMaster=false`、`fallbackUsed=false`。Live プロファイルが完走し、Playwright assertions および `recordPerfLog` が badge/監査メタを出力し、`dataSourceTransition=snapshot→server` を UI で確認できました。
  - Reception insurance/address lookup: `apiRoute=/orca/master/{hokenja,address}`、`dataSource=snapshot`、`cacheHit=false`、`missingMaster=true`、`fallbackUsed=true`。MSW-only spec は `profile==='msw'`/`test.skip`/`test.fixme` により stage run では継続して snapshot/fallback 経路をたどるため caution-tone warning banner が保持されています。
  - Claim tensu/billing search: `apiRoute=/orca/tensu/ten`、`dataSource=snapshot`、`cacheHit=false`、`missingMaster=true`、`fallbackUsed=true`（MSW-only coverage）。Live-specific Claim spec は未実装のため再現済みデータは MSW の snapshot data が担い、Playwright での metadata 収集は未着手です。
  - 監査: `artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log` は `runId=20251124T073245Z`・`parentRunId=20251124T000000Z`・`flag=WEB_ORCA_MASTER_SOURCE=server` を含み、8 件の MSW-only specs は `profile==='msw'`/`test.skip`/`test.fixme` によって stage run ではガードされたままとなった一方で、Live scenario が badge・warning banner・監査メタを出力していることを確認済。DOC_STATUS 65 行・manager checklist RunId セクション・`docs/web-client/README.md` に log パスを連携し、stage log と `artifacts/e2e/...` を同期した上で同コマンドを再実行すれば再検証できます。
  - Reception/Claim unskip準備メモ（本タスク調査のみ・実行なし, RUN_ID=20251124T073245Z）:
    - `tests/e2e/orca-master.spec.ts` の skip/fixme: (1) `@a11y ORCA master` ブロックは `profile!=='msw'` ガード＋「Charts 初期データの MSW モック未整備」理由で強制 skip。解除には `VITE_DEV_PROXY_TARGET` を未設定（MSW 有効）、`PLAYWRIGHT_BASE_URL`/helper の `baseUrl=https://localhost:4173` を一致させた上で Charts 初期 API（認証/visit 取得）を MSW で用意することが前提。 (2) `MSW 正常系 MSW-N-01/08` は `test.fixme` で UI セレクタ未確定。`/charts/72001` へ遷移後、`orca-skip-results` → `orca-search-input` → `orca-search-submit` → `orca-results-table`（列 `orca-col-code|name|detail|actions`）を待ち、mock から返る snapshot データでリスト表示できる状態が必要。 (3) `422 バリデーション` 2 件も `test.fixme` で未実装。`__mswSetFault('validationError'|'invalidZip')` 前提で `orca-alert-banner` と `orca-rate-limit-countdown`/`orca-rate-limit-retry` 等のセレクタでエラーバナーを検出できることが解除条件。 (4) `Live プロファイル` ブロックは `profile!=='live'` ガード。`VITE_DEV_PROXY_TARGET=<stage>`, `VITE_DISABLE_MSW=1`, `WEB_ORCA_MASTER_SOURCE=server`, `PLAYWRIGHT_BASE_URL=<stage or https://localhost:4173>` を揃え、`expectAuditMeta` が runId/dataSource=server を受け取れることが必要。
    - Live ルート想定: charts/claim 側は `OrcaOrderPanel` 経由で `VITE_ORCA_MASTER_BRIDGE`（未設定なら `VITE_API_BASE_URL`→`/api`）配下の `/orca/master/{generic-class|generic-price|youhou|material|kensa-sort|etensu}` および `/orca/tensu/ten/:range`（MSW ハンドラ有）を叩く想定。Playwright helper の `mockTensuName*` も `**/orca/tensu/name/**` をスタブしている。UI セレクタは `orca-search-form|input|submit`、`orca-results-region|table`、`orca-alert-banner`、`orca-rate-limit-*` を利用。
    - Reception 側は `fetchOrca06FromSource` が `/orca/master/hokenja?pref&keyword` と `/orca/master/address?zip=` を使用。MSW fixture は zip=`1000001` のとき住所1件を返し、それ以外は `missingMaster=true/fallbackUsed=true` へ落ちる。ReceptionPage には `data-test-id` が未付与のため UI セレクタは要確認。Live 動作には上記 endpoint が stage に存在し、`VITE_DISABLE_MSW=1` で MSW を無効化する必要あり。
    - 実行状況: 今回はコード変更なし・テスト未実行（環境起動不要な机上整理のみ）。
    - unskip 候補案: 最小は MSW a11y ブロックの強制 skip を解除し、`seedAuthSession` で auth を埋めた上で Charts 初期データ MSW モック（visit 72001）を足し、`orca-results-table` が表示されるまで待機するフローを実装する。Live 側は stage baseURL + `VITE_DEV_PROXY_TARGET` で `orca-search-input` → 検索 → `orca-results-table` 表示を待つ形で 1 ケースを先行解除し、`WEB_ORCA_MASTER_SOURCE=server` と `VITE_DISABLE_MSW=1` を CI 変数に追加する。

## SP5: 報告・ログ更新（runId=20251124T073245Z）
  - 進捗: 2025-11-25T19:23:30+0900 に Stage/Preview `VITE_DISABLE_MSW=1` + `WEB_ORCA_MASTER_SOURCE=server` で `npm run e2e:orca-master` を再実行し、`artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log` を上書きして Charts の server ルートを確認しつつ Reception/Claim は MSW-only（`missingMaster=true`/`fallbackUsed=true` かつ caution-tone warning banner）に留まったため、`docs/web-client/planning/phase2/DOC_STATUS.md` Webクライアント/連携行・`docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md` RUN_ID セクション・`docs/web-client/README.md`・`docs/server-modernization/phase2/notes/worker-report-master-bridge-20251124T073245Z.md` に log パス・RUN_ID=20251124T073245Z・未完タスク（Live baseURL coverage、Reception/Claim MSW-only coverage、warning banner tone の再確認）を同期しました。
  - 追加進捗: 2025-11-26T05:20:35+0900 に同コマンドを再実行したところ、`artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log` に `status: partial`（Charts pass / Reception skip / Claim pending）の記録が残り、Live Charts は server 監査メタ・warning badge を出力したものの、Playwright が `tests/e2e/orca-master.spec.ts:167:7` の Live シナリオで `browserType.launch` 時に `FATAL: base/apple/mach_port_rendezvous_mac.cc:156 bootstrap_check_in org.chromium.Chromium.MachPortRendezvousServer.50292: Permission denied (1100)` を受けて `target page, context or browser has been closed` として abort したため完走しませんでした。`Live baseURL coverage`・`dataSourceTransition`・`warning banner tone` の幅や Reception/Claim MSW-only coverage の変化は、`bootstrap_check_in` の権限が付与された Playwright/Stage 環境および Reception/Claim Live baseURL/Selectors が揃ったタイミングで再取得してください。
- 次ステップ: ハブ/manager checklist/README のリンクを再同期して RUN_ID=20251124T073245Z チェーンを維持し、未完タスクの進ちょくを追跡する `docs/server-modernization/phase2/notes/worker-report-master-bridge-20251124T073245Z.md` を final 形式で整備し、`#modernized-webclient` へ通知してください。
  - Playwright の headless Chromium が `bootstrap_check_in` で `Permission denied (1100)` を返す限り Live シナリオを完走できないため、同 issue をクリアした Stage/Live agent で再検証を行い、`warning banner tone`・`dataSourceTransition` の変化を `artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log` と Stage log に再記録してください。

## Next steps
1. server raw B が更新したら `node scripts/bridge-sync.mjs -- --source server` を再実行し、`hashes/server/`＋`diffs/server-vs-msw-orca*.json` を書き換え。差分が生じた場合は `missingMaster`/`fallbackUsed`/`cacheHit` を本ログへ追記し、DOC_STATUS・manager checklist へ周知。
2. Stage/Preview `npm run e2e:orca-master`（`WEB_ORCA_MASTER_SOURCE=server VITE_DISABLE_MSW=1 PLAYWRIGHT_BASE_URL=http://localhost:4173`）は Live Charts を含むログを出力済。Reception/Claim の MSW-only specs は `missingMaster=true`/`fallbackUsed=true` の caution-tone warning banner を出しているため、Live baseURL coverage が整い `test.skip`/`test.fixme` が解除されるタイミングで再実行し `artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log` を上書き、警告バナーの tone・監査メタ・`dataSource` 遷移も再確認してください。
3. ワーカー報告と DOC_STATUS の Webクライアント/連携行は RUN_ID=20251124T073245Z を中心に同期済。次回報告では stage log 状況（`artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log`）・server diff 再生成予定・Live baseURL 追加のタイミングを明記し、manager checklist および README へ RUN_ID/証跡/未完タスクを再連携してください。
4. 接続再開後は Stage/Live E2E 担当に `warning banner tone` や `dataSourceTransition` の変化を引き継ぎ、公称の Stage/Live ランで `cacheHit`・`missingMaster` ・`fallbackUsed` のメタが server ルートで出力されていることを再確認し、監査ログ・warning banner tone の差分を DOC_STATUS/manager checklist/worker report へ追記してください。

証跡: `artifacts/api-stability/20251124T000000Z/master-sync/20251124/`、`artifacts/e2e/20251124T073245Z/sp4-main-scenarios.log`、`docs/web-client/planning/phase2/DOC_STATUS.md:65` (RUN_ID=20251124T073245Z 行)。
