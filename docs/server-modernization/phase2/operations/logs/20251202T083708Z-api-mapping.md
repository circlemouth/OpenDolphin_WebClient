# RUN_ID=20251202T083708Z API マッピング更新ログ

## B: Patients/Administration 備考刷新
- 対象: `src/webclient_screens_plan/02_画面別 API マッピングとバージョン整合.md` の Patients / Administration 表、監査整合メモ。
- TrialLocalOnly/未実測/API_Result 未取得を備考に明記し、`/orca/patients/*`・`/orca/insurance/combinations`・`/orca/system/management`・`/orca/system/users` が `dataSource/cacheHit/fallbackUsed/version/api_result` 空であることを列挙。ORCA route 開放後に実測して監査フィールドを採取する計画を追記。
- Spec-based stub (`/orca/patient/mutation`, `/orca/medical-sets`, `/orca/medical/records`) と modernized DB 主体（PVT/Schedule/karte/認証・施設設定）を区別し、`/resources/orca/master/*` raw/B スナップショットのみ dataSource を取得済みであること、hashMatchComputed=false な orca05 差分再取得が必要なことを備考に反映。
- PHR (`/20/adm/phr/*`) 未実装で監査メタ取得不可の状態を Administration 表備考と監査整合メモに記載。
- 405/TrialLocalOnly 開放後の実測計画として `/orca/visits/mutation` `/orca/appointments/mutation` `/orca/patient/mutation` `/orca/system/*` の備考に `Api_Result/Api_Result_Message`＋audit（`dataSource/cacheHit/fallbackUsed/version/runId`）と期待ヘッダー（`Allow=POST/OPTIONS`, `Content-Type=application/xml; charset=Shift_JIS`, `X-Trace-Id`/`X-Request-Id`/`X-Facility-Id`）を採取する手順を追記し、監査整合メモにも同条件を明文化。

## 参照・証跡
- 更新ファイル: `src/webclient_screens_plan/02_画面別 API マッピングとバージョン整合.md`
- 参照データ: `artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/*`, `artifacts/api-stability/20251124T000000Z/master-sync/20251124/diffs/server-vs-msw-orca{05,06,08}.json`

## orca05 hashMatchComputed=false 調査（RUN_ID=20251202T083708Z）
- 原因: `artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/` に `orca05-generic-class.json` が欠落しており、server 側 snapshot が 4 件（msw 5 件）で delta=-1 となり hashMatchComputed=false。
- 再取得手順（可能）:
  1. raw B を再取得し、上記パスに `orca05-generic-class.json` を追加（同日付 20251124T153000Z 階層に揃える）。
  2. `node scripts/bridge-sync.mjs --run-id 20251202T083708Z --date 20251124 --source server` を実行し、`artifacts/api-stability/20251124T000000Z/master-sync/20251124/hashes/server/orca05.hash` と `.../diffs/server-vs-msw-orca05.json` を上書き（hashMatchComputed=true になる想定）。
  3. 証跡は上記 diff/hash パスを更新対象とし、必要に応じて本ログへ追記する（README/manager checklist/DOC_STATUS への反映は不要）。
- 再取得結果（20251202T083708Z）:
  - raw B に `orca05-generic-class.json` / `orca-master-generic-class.json` を追加後、`node scripts/bridge-sync.mjs --run-id 20251202T083708Z --date 20251124 --source server` を実行。
  - `artifacts/api-stability/20251124T000000Z/master-sync/20251124/hashes/server/orca05.hash` を `a067bac7f98ea18a4a06c335c9eea14cb161451f4ec470c5421ced614b38bfe0` に更新、`.../diffs/server-vs-msw-orca05.json` は `hashMatchComputed=true`（counts delta=0 server=5, msw=5）を確認。

## 次アクションメモ
- ORCA route 開放後に `/orca/patients/*`・`/orca/insurance/combinations`・`/orca/system/management`・`/orca/system/users` の Api_Result/監査フィールドを実測し、スタブに埋め込み。`server-vs-msw-orca05.json` の hashMismatch も再取得する。
- PHR REST 経路の有無と提供時期を確認し、決定後に監査フィールド方針を策定。
