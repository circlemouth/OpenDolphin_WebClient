# RUN_ID=20251212T090000Z Reception UX コンポーネント実装（04A2）

- 期間: 2025-12-12 09:00 - 2025-12-14 09:00 JST（優先度: high / 緊急度: medium）。CodexCLI2 04A2 では ReceptionPage/OrderConsole に `tone=server` バナー + `resolveMasterSource` バッジ + `missingMaster` 入力を組み込み、ARIA の粒度と `data-run-id` Carry-over を実装しました。
- 参照チェーン: `AGENTS.md` → `docs/web-client/README.md` → `docs/server-modernization/phase2/INDEX.md` → `docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md` → `docs/web-client/ux/ux-documentation-plan.md` → `docs/web-client/ux/reception-schedule-ui-policy.md` → `artifacts/webclient/ux-notes/20251212T090000Z-reception-ux.md`

## 1. 実装ポイント
- `web-client/src/features/reception/pages/ReceptionPage.tsx` に `OrderConsole` を配置し、 `tone=server` バナー（Error/Warning=assertive・Info=polite）と `aria-atomic=false` で最新状態だけを announce する `role=alert` 領域を追加。`[prefix][ステータス][患者ID/受付ID][送信先][次アクション]` 構造で文言を生成し、`data-run-id=20251212T090000Z` を常に含めることで Chart/Patients 側の carry-over と一致させる。
- `OrderConsole` に `resolveMasterSource` バッジ（`mock`→`snapshot`→`server`→`fallback` を視覚化）と、`cacheHit`/`missingMaster` status badge、`missingMaster` コメント入力を揃え、`missingMaster` true 時は `tone=server` の warning/error を維持しつつ `aria-live=assertive` で再送前の検知を補助。`data-run-id` を各 status badge に伝播することで Charts/Patients の badge と tone を揃える設計とした。
- `missingMaster`/`cacheHit` の状態変化は `StatusBadge` を再利用し、Charts で使う `missingMaster`・`cacheHit` 表示とトーンが CSS・ARIA で横断的に一致するようにした。ARIA アップデートは `artifacts/webclient/ux-notes/20251212T090000Z-reception-ux.md §ARIA 調整メモ` に記録。

## 2. API・監査メタ依存
- `resolveMasterSource(masterType)` の `dataSourceTransition=server|snapshot|fallback` フローを `docs/web-client/architecture/web-client-api-mapping.md §2` から取り込み、`/orca12/patientmodv2/outpatient`・`/orca/master/*` で `cacheHit`/`missingMaster` を受け取り、`OrderConsole` の `ToneBanner` と `AuditEvent` に `runId/dataSource/cacheHit/missingMaster/fallbackUsed/dataSourceTransition` を添付するキックオフを実装。`
- `/api01rv2/appointment/outpatient/*`・`/api01rv2/claim/outpatient/*` など `OUTPATIENT_API_ENDPOINTS` に登録した外来 endoint を `httpClient` 層経由で `auditMetadata` を付与し、`missingMaster` true が `tone=server` に転換する条件を `docs/server-modernization/phase2/operations/ORCA_API_STATUS.md` と照合しながら明記。
- `CacheHitBadge`/`MissingMasterBadge` では `role=status` + `aria-live` で `Chart/Patients` 側の badge `tone=polite/assertive` を再現し、`resolveMasterSource` badge には `transitionDescription`（例: `snapshot → server`）を加えて `data-source` 変化を可視化。

## 3. 証跡・追跡
- artifacts: `artifacts/webclient/ux-notes/20251212T090000Z-reception-ux.md` に実装スクリーンショット候補（`artifacts/webclient/ux-notes/20251212T090000Z-reception-ux.png`）、ARIA 調整メモ、API 依存と `missingMaster` の扱いを記録。
- docs: `docs/web-client/ux/reception-schedule-ui-policy.md` にスクリーンショット/ARIA 追記、`docs/web-client/planning/phase2/DOC_STATUS.md` の Web クライアント UX/Features 行に RUN_ID=20251212T090000Z + 本ログ/アーティファクト + `docs/web-client/ux/reception-schedule-ui-policy.md` を追記。
- manager checklist: この log と DOC_STATUS への反映を `docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md` の RUN_ID セクションで通知予定。

## 4. 次のアクション
1. Stage/Preview 環境で `VITE_DISABLE_MSW=1` + `VITE_DEV_PROXY_TARGET` を使い `data-run-id=20251212T090000Z` の `tone=server` バナーと `cacheHit`/`missingMaster` badge の carry-over を Playwright で再現し、スクリーンショット・ログを artifact に差し替え。
2. `docs/server-modernization/phase2/operations/logs/20251212T090000Z-reception-ux.md` と DOC_STATUS への記録を manager checklist で共有し、`ORDER_CONSOLE` 経路で `audit.logUiState` が `runId/dataSource/cacheHit/missingMaster/fallbackUsed/dataSourceTransition` を送信する回帰ケースを組み込む。
3. Charts/Patients 側の badge 実装（`status-badge` CSS・ARIA）に今回のトーンを継承させ、`missingMaster`/`cacheHit` の tooltips と `aria-live` の一貫性を確認するパターンを Playwright/a11y に追加。
