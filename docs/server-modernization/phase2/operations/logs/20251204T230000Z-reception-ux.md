# RUN_ID=20251204T230000Z Reception UX コンポーネント実装

- 期間: 2025-12-04 09:00 - 2025-12-04 18:00 JST（優先度: high / 緊急度: high）。CodexCLI1 `04A2` で ReceptionPage/OrderConsole の tone/missingMaster/resolveMasterSource 周りを本番相当の構成へ再配置し、スクリーンリーダーへの `aria-live` 出力を狙い通りに整理した。
- 参照チェーン: `AGENTS.md` → `docs/web-client/README.md` → `docs/server-modernization/phase2/INDEX.md` → `docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md` → `docs/web-client/ux/reception-schedule-ui-policy.md` → `artifacts/webclient/ux-notes/20251204T230000Z-reception-ux-implementation.md`。

## 1. 実装概要
- ReceptionPage が `masterSource`/`missingMaster`/`cacheHit`/`missingMasterNote` を state として保ち、`ToneBanner` と `ResolveMasterBadge` をページ直下に段階的に表示して `tone=server` の流れを可視化。`OrderConsole` は `CacheHitBadge`/`MissingMasterBadge` と各操作のみを描画し、`missingMaster` ノートの `aria-live` を状態に応じて `assertive`/`polite` で切り替えることで補助的読み上げを一箇所に集約した。
- `missingMaster` 入力欄自身は OrderConsole に残し、各フラグの切り替えは `onMasterSourceChange`/`onToggleMissingMaster`/`onToggleCacheHit` から呼び出される。`ToneBanner` は `fallback` または `missingMaster` で error、`server` で warning、`cacheHit` で info の tone を維持し、`transitionDescription` には `mock → snapshot`/`snapshot → server （tone=server）`/`server → fallback` を表示させた。
- スタイル面では `web-client/src/features/reception/styles.ts` を新設し、`tone-banner`/`resolve-master`/`order-console`/`status-badge` 系のセレクタを移植して `Global` で注入。Charts/Patients が既存の `status-badge` セレクタ群を再利用することで `missingMaster`/`cacheHit` の tone が Reception と一致するようにした。

## 2. API・監査依存
- `missingMaster`/`cacheHit` フラグの起点は `web-client/src/libs/http/httpClient.ts` の `OUTPATIENT_API_ENDPOINTS` に定義された `/api01rv2/claim/outpatient/*` / `/api01rv2/appointment/outpatient/*` / `/orca21/medicalmodv2/outpatient` / `/orca12/patientmodv2/outpatient`。これらの `auditMetadata` には `runId`/`dataSource`/`cacheHit`/`missingMaster`/`fallbackUsed`/`dataSourceTransition` を含むので、OrderConsole からの `ToneBanner`/`ResolveMasterBadge` にこの metadata を `data-run-id` 付きで伝播するなど `audit.logUiState` との整合性を確保する。
- `applyHeaderFlagsToInit` により Playwright の `x-use-mock-orca-queue` 等 header が全リクエストに乗り、`runId` や `dataSource` がブレない。`docs/web-client/architecture/web-client-api-mapping.md` で `resolveMasterSource` フローを再確認し、`dataSourceTransition=server` になるタイミングで `carrier` となる `ToneBanner` の text を `order-console` 側にも carry over することを確認した。

## 3. 証跡整備
- artifacts: `artifacts/webclient/ux-notes/20251204T230000Z-reception-ux-implementation.md`（props/flag 差分 + `status-badge` 共有 + スクリーンショット候補: `artifacts/webclient/ux-notes/20251204T230000Z-reception-ux-implementation.png`）。
- operations log: 本ファイル。DOC_STATUS には RUN_ID=20251204T230000Z の行を追加し、`docs/web-client/ux/reception-schedule-ui-policy.md` §10 で最新フローと `artifacts/...png` を参照するようにした。

## 4. 次の確認ステップ
1. Playwright/Stage で `tone=server` のシナリオを再現し、ReceptionPage→OrderConsole の banner/badge/`missingMaster` note が `data-run-id=20251204T230000Z` を保持することを録画。`aria-live` は error/warning で `assertive`、info で `polite` になるかを `vitest-axe` でも一度検証予定。
2. Charts/Patients 側の `status-badge` が `web-client/src/features/reception/styles.ts` を取り込むタイミングで、`missingMaster`/`cacheHit` の tone が Reception と一致していることを確認し、必要なら `docs/web-client/ux/ux-documentation-plan.md` の Charts セクションに追記。
