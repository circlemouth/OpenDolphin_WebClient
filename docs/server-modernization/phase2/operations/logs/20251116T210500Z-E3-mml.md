# 2025-11-16 紹介状/MML API 証跡ログ (RUN_ID=20251116T210500Z-E3)

- 参照チェーン: `AGENTS.md` → `docs/web-client/README.md` → `docs/server-modernization/phase2/INDEX.md` → `docs/managerdocs/PHASE2_ORCA_PHR_GAP_MANAGER_CHECKLIST.md`
- 指示: 【ワーカー指示】紹介状/MML API 証跡採取（RUN_ID=20251116T210500Z-E3）
- 成果物: `artifacts/external-interface/mml/20251116T210500Z-E3/README.md`

## 1. 手順
1. Legacy / Modernized 双方の `MmlResource` 実装を確認し、`/mml/letter{list,json}` および `/mml/labtest{list,json}` が `MmlServiceBean` と各 Converter (`LetterModuleConverter`, `NLaboModuleConverter`) を共用していることを確認。
2. 既存サンプル（`tmp/parity-letter/letter_get_legacy.json`, `artifacts/parity-manual/lab/20251112TlabReportZ1/lab_module_fetch/*`, `ops/tests/fixtures/adm/adm10/labo_item.json`）を棚卸し、レスポンス項目の実績を抽出。
3. 差分サマリを `artifacts/external-interface/mml/20251116T210500Z-E3/README.md` に整理し、未取得項目を TODO として記録。
4. Runbook (`EXTERNAL_INTERFACE_COMPATIBILITY_RUNBOOK.md`)、Gap ノート (EXT-03)、DOC_STATUS (W22) を更新。

## 2. 結果
- コード比較の結果、当該 4 エンドポイントは Legacy/Modernized で実装差分なし。`git diff` では追加改修不要であることを確認。
- 実測 `curl` ログは未取得のため、既存 JSON サンプルへのリンクと取得手順のみを確定。次 RUN で Legacy/Modernized 双方の HTTP 応答を採取する必要あり。

## 3. TODO / Blocker
| 項目 | 状態 | 補足 |
| --- | --- | --- |
| `/mml/letter/list` CSV 取得 | 未実施 | docker 禁止のため Legacy/Modernized サーバー未起動。WSL2/Docker ブロッカー解除後に `send_parallel_request.sh` で取得する。 |
| `/mml/letter/json` diff | 未実施 | `letter_get_legacy.json` を Legacy 基準に流用。Modernized 側 200 応答が未採取。 |
| `/mml/labtest/list` CSV 取得 | 未実施 | ラボ PK CSV の実績なし。`MmlServiceBean#getFacilityLabtestList` の戻り順序を Legacy DB Seed で確認予定。 |
| `/mml/labtest/json` diff | 未実施 | 《Legacy》 `NLaboModule` JSON は fixtures で確認。Modernized 応答は `curl` 後 diff を取得する。 |

## 4. 証跡リンク
- `artifacts/external-interface/mml/20251116T210500Z-E3/README.md`
- `tmp/parity-letter/letter_get_legacy.json`
- `artifacts/parity-manual/lab/20251112TlabReportZ1/lab_module_fetch/{legacy,modern}/response.json`
- `ops/tests/fixtures/adm/adm10/labo_item.json`

## 5. 次アクション案
1. Docker ブロッカー解消後に Legacy/Modernized サーバーを同時起動し、`send_parallel_request.sh GET /mml/letter/list` で CSV を採取。
2. 同手順で `GET /mml/letter/json/<pk>`、`GET /mml/labtest/list/<fid>`、`GET /mml/labtest/json/<pk>` を取得し、`diff -u legacy modern` を `artifacts/external-interface/mml/20251116T210500Z-E3/*.diff` へ保存。
3. 取得完了後、`EXTERNAL_INTERFACE_COMPATIBILITY_RUNBOOK.md` の EXT-03 行と `DOC_STATUS` W22 備考を `[証跡取得済]` へ更新。
