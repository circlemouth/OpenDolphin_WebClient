# 20251120T193040Z エラーハンドリング/監査ログ計画ログ

- RUN_ID: `20251120T193040Z`
- タスク: `src/modernized_server/05_エラーハンドリングと監査ログ強化.md`
- 作成: 2025-11-20 (JST) / 作業ステータス: 計画ドラフト（実装・接続作業なし）

## 1. 参照リンク
- 参照チェーン: `AGENTS.md` → `docs/web-client/README.md` → `docs/server-modernization/phase2/INDEX.md` → `docs/managerdocs/PHASE2_MANAGER_ASSIGNMENT_OVERVIEW.md` → `PHASE2_SERVER_FOUNDATION_MANAGER_CHECKLIST.md` / `PHASE2_ORCA_SPRINT2_MANAGER_CHECKLIST.md` / `PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md`
- 関連ドキュメント: `ORCA_API_STATUS.md`, `API_PARITY_MATRIX.md`, `MODERNIZED_REST_API_INVENTORY.md`, `TRACE_PROPAGATION_CHECK.md`
- ハブ反映予定: `docs/web-client/planning/phase2/DOC_STATUS.md`（モダナイズ/監査・エラーハンドリング行を追加予定）

## 2. 想定証跡ディレクトリ
- ログ: `docs/server-modernization/phase2/operations/logs/20251120T193040Z-error-audit.md`（本ファイル）
- アーティファクト（必要に応じて作成）: `artifacts/error-audit/20251120T193040Z/`

## 3. 計画メモ（ドラフト）
- 共通エラーフォーマット案: `status` / `code` / `message` / `traceId` / `blocker` / `orca.apiResult` / `details[]` を最小セットとし、ORCA 200/Api_Result≠00 の昇格基準を整理する。
- 監査ログ必須項目: TraceId/SpanId/RequestId、actor（user/facility/role）、patientId（マスク済み）、action、resource、payloadDigest、result、blocker。`d_audit_event` への格納位置とマスクルール（氏名・住所の部分マスク、自由記述のハッシュ化）を定義する。
- 障害対応テンプレ: WildFly `server.log` / `trace_http_*` / `metrics` / `httpdump` の採取手順を RUN_ID 付きで列挙し、GUI/ネットワーク制約時の収集代替（ログ提供依頼テンプレ）を記載する。

## 4. 次アクション
- 共通エラーフォーマットと監査ログポリシーの草案を `src/modernized_server/05_エラーハンドリングと監査ログ強化.md` に追記。
- DOC_STATUS へ本 RUN_ID とログパスを追加し、ハブ文書との整合を確認。
- 実装タスクとの連携ポイント（ORCA Trial 実測・API 契約確定・オブザーバビリティ計画）を整理し、必要に応じて派生 RUN_ID を作成する。
