# 2025-11-16 ORCA UI サーフェス同期ログ

- RUN_ID: `20251116T170500Z`
- 担当: Worker-D（Web クライアント連携ドキュメント/UX）
- 参照チェーン: `AGENTS.md` → `docs/web-client/README.md` → `docs/web-client/architecture/REST_API_INVENTORY.md` → `docs/web-client/process/API_UI_GAP_ANALYSIS.md` → `docs/web-client/planning/phase2/DOC_STATUS.md`
- 成果物: 本ログ、`docs/web-client/architecture/REST_API_INVENTORY.md` UI ステータス更新、`docs/web-client/process/API_UI_GAP_ANALYSIS.md` §0 追記、`docs/web-client/ux/API_SURFACE_AND_AUDIT_GUIDE.md` 新設、`docs/web-client/README.md` リンク更新、マネージャーチェックリスト（ORCA Sprint2 / Web Client Experience）同期、DOC_STATUS Web クライアント行 & ORCA 行更新。

## 1. ドキュメント更新サマリ
1. **REST API インベントリ**: 6 セクションすべてのテーブルに「UIステータス (RUN_ID=20251116T170500Z)」列を追加し、各 API を `実装済/実装予定/非対応` で分類。ReceptionPage/VisitManagementDialog/FacilitySchedulePage/PatientDataExportPage/SystemPreferencesPage/ChartsPage/OrcaOrderPanel/StampManagementPage へのリンクとロール・フェーズを明記。
2. **API_UI_GAP_ANALYSIS**: 新しい §0 「UI 配置サマリ」を追加し、ページ・代表 API・ロール・フェーズを俯瞰できる表を掲載。`ux/API_SURFACE_AND_AUDIT_GUIDE.md` との同期ルールを記述。
3. **UX ガイド**: `docs/web-client/ux/API_SURFACE_AND_AUDIT_GUIDE.md` を新設。ページ別 API／監査フック表、RUN_ID 表示ルール、Danger 操作の隔離方針、レイアウト/アクセシビリティ要件、更新手順を整理。
4. **README / Navigation**: `docs/web-client/README.md` の UX セクションに新ガイドを追加し、役割ごとの参照順序を最新化。
5. **Operations Log Cross-link**: 本ログを `API_SURFACE_AND_AUDIT_GUIDE.md` と REST API インベントリのステータス列から参照できるよう備考欄へ証跡リンクを付与。

## 2. UI 方針と ORCA 連携メモ
- **Administration**: SystemPreferencesPage と UserAdministrationPage に `/user*`, `/user/facility`, `/dolphin/*`, `/serverinfo/*` を集約。Cloud Zero や Facility 情報の操作は Ops/Admin のみ表示し、`audit.logAdministrativeAction` に RUN_ID を必須化。
- **Reception**: ReceptionPage + VisitManagementDialog で `/patient/pvt*`, `/pvt*`, `/pvt2*` を扱い、Legacy API は「詳細操作」タブに隔離。VisitSidebar で `/patient/documents/status` を常時表示し、カルテ下書きを Reception と ChartsPage へ共有。
- **Schedule / Export**: FacilitySchedulePage の予約詳細ダイアログに `/schedule/document` / `/schedule/pvt` / `/appo` を配置。PatientDataExportPage では `/patient/all` `/patient/custom/*` `/patient/count/*` を Administration グループ内に限定し、CSV/JSON 出力へ RUN_ID を埋め込む。
- **Charts / ORCA**: ChartsPage 右ペイン（DocumentTimelinePanel/DiagnosisPanel/ObservationPanel/ClaimAdjustmentPanel/MedicalCertificatesPanel）で `/karte/*`, `/lab/module`, `/letter/*`, `/mml/*` を使用。OrcaOrderPanel + StampManagementPage で `/orca/tensu/*`, `/orca/disease/*`, `/orca/interaction`, `/orca/inputset`, `/orca/stamp` を扱い、禁忌チェックやスタンプ同期の監査パスを統合。
- **リアルタイム / ReplayGap**: AppShell + ReplayGapProvider が `/chartEvent/*` を購読し、`chart-events.replay-gap` 受信時に RUN_ID と ops ログを紐付けた監査イベントを送出する。

## 3. Manager Checklist / DOC_STATUS 反映
- `docs/managerdocs/PHASE2_ORCA_SPRINT2_MANAGER_CHECKLIST.md` タスクCに本 RUN_ID の UI 連携更新を追記し、「DOC_STATUS 行 25: RUN_ID=20251116T170500Z, Evidence=logs/20251116T170500Z-orca-ui-sync.md」メモを記載。
- `docs/managerdocs/PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md` タスクA/B/D に「API サーフェス & 監査ガイド新設」「Reception/Admin 導線の RUN_ID 表示」「DOC_STATUS 連携」をマーク。
- `docs/web-client/planning/phase2/DOC_STATUS.md` では Web クライアント（API_UI_GAP_ANALYSIS 行）と ORCA 行（ORCA_API_STATUS 行）を更新し、RUN_ID / 本ログパス / ステータス Active を記録。

## 4. フォローアップ / TODO
1. **監査実装確認**: `libs/audit` の `logAdministrativeAction`, `logReceptionAction`, `logChartsAction`, `logOrcaQuery` に RUN_ID 渡し漏れがないか `npm run test:audit-mocks`（別途作成予定）で検証。
2. **Danger 操作 UI**: Phase6 で `DELETE /user/{userId}` UI を開放する際は `ux/API_SURFACE_AND_AUDIT_GUIDE.md` の Danger ガイドラインに沿って 2段階確認を実装。
3. **ReplayGap dispatch**: `/chartEvent/dispatch` を ReplayGapProvider に接続し、`docs/web-client/ux/API_SURFACE_AND_AUDIT_GUIDE.md` §3 の要件を満たしたら本ログと DOC_STATUS を再更新。
