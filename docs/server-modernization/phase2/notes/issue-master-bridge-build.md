# Master bridge build blockers (RUN_ID=20251126T150000Z)

- 発生日: 2025-11-26
- 対象: `web-client` + `server-modernized`
- 証跡ログ: `docs/server-modernization/phase2/operations/logs/20251126T150000Z-master-bridge-stub-update.md`

## 1. TypeScript 構文エラー（解消済）
- ファイル: `web-client/src/features/charts/api/orca-api.ts` 他
- 対応: `searchTensu`/`fetchOrca` 系のオブジェクトリテラルを `TensuMasterEntry`・`OrcaXX` 型に揃え、未使用の `RawTensuMaster` 定義と `test.use` 参照を整理。`App.tsx` の React Query `cacheTime` は `gcTime` に置き換え、`AlertBanner` の配置と各種型ガード・fixture も整備したことで `tsc` が正常に終了するコードベースになった。
- 再試行 (2025-11-26): 上記修正後 `npm run build` が通過したため、新しい `dist` を Stage/Preview へ展開し、`artifacts/e2e/20251126T150000Z/{stage-preview.log,playwright-orca-master.log,master-bridge-stub-check.log}` を再生成。Stage/Playwright/curl の再検証では `dataSource=server/runId=20251126T150000Z/missingMaster=false/fallbackUsed=false` と `warning banner tone=server` を観測し、`curl` 8 本で `dataSourceTransition=server->fallback`/`missingMaster=true`/`fallbackUsed=true` を確認したうえで `docs/server-modernization/phase2/operations/logs/20251126T150000Z-master-bridge-stub-update.md` へ反映。DOC_STATUS/manager checklist/worker report の RUN_ID セクションも上記ログパスと `Live coverage warning tone=server` イベントを同期済み。
- 備考: 現在のフォーカスは (1) raw B→bridge-sync→hashes/diffs→docs のループを維持して `artifacts/api-stability/20251124T000000Z/master-sync/20251124/` + `diffs`/`artifacts/e2e/20251126T150000Z/*` を上書き、(2) Reception/Claim coverage で `warning banner tone=server`/`dataSourceTransition=server` を Stage/Playwright で継続観測、(3) Stage/Playwright/curl のログを次 RUN_ID で上書いて比較すること。TypeScript ビルドエラーは解消済み。
- 再検証テンプレ: raw B 更新（ORCA 特材など）を感知したら `node scripts/bridge-sync.mjs --run-id 20251126T150000Z --date 20251124 --source server` で `artifacts/api-stability/20251124T000000Z/master-sync/20251124/hashes/server/{orca05.hash,orca06.hash,orca08.hash}` と `diffs/server-vs-msw-orca*.json` を上書きし `schema missing: artifacts/api-stability/20251124T151500Z/ab-compare/20251124T153000Z/raw/B/orca-master-generic-class.json` を確認した後、Stage Preview/Playwright/curl を同 RUN_ID で実行。Stage Preview: `VITE_DISABLE_MSW=1 VITE_DEV_PROXY_TARGET=http://localhost:8000/openDolphin/resources VITE_API_BASE_URL=http://localhost:8000/openDolphin/resources VITE_DEV_USE_HTTPS=1 npm run preview -- --host 0.0.0.0 --port 4173 --strictPort` で `artifacts/e2e/20251126T150000Z/stage-preview.log` を上書きし `warning banner tone=server`/`dataSourceTransition=server` を確認、Playwright: `RUN_ID=20251126T150000Z VITE_DISABLE_MSW=1 VITE_DEV_PROXY_TARGET=http://localhost:8000/openDolphin/resources VITE_API_BASE_URL=http://localhost:8000/openDolphin/resources PLAYWRIGHT_BASE_URL=https://localhost:4173 npx playwright test tests/e2e/orca-master.spec.ts` で `artifacts/e2e/20251126T150000Z/playwright-orca-master.log` に Live profile を残し、curl: admin header + eight endpoints `/resources/api/orca/master/{generic-class,generic-price,youhou,material,kensa-sort,hokenja,address,etensu}` で `dataSourceTransition=server->fallback`/`missingMaster=true`/`fallbackUsed=true`/`runId=20251126T150000Z`/`version=20251126`/`cacheHit=false`/`warning banner tone=server` を `artifacts/e2e/20251126T150000Z/master-bridge-stub-check.log` に記録。各実行後に DOC_STATUS 65 行・manager checklist 55 行・worker report/issue note の RUN_ID セクションを更新し、raw B 更新トリガー感知時にこの手順を再走することを明記。現時点では raw B 更新を追いかけず doc 整備と証跡整理に注力しており、次の raw B 更新感知時に本テンプレ順で再走する旨を記録。

## 2. `UserModel#getRegisteredDateAsString` 欠番（`mvn -pl server-modernized -DskipTests compile` → 成功）
- ファイル: `server-modernized/src/main/java/open/dolphin/session/UserServiceBean.java`、`open/dolphin/infomodel/UserModel`
- エラー: `シンボルを見つけられません: メソッド getRegisteredDateAsString()`（master でも同エラー）でコンパイルが停止していたが、LocalDate/DateTimeFormatter ベースの getter を `UserModel` に追加し `jakarta` classifier jar を `mvn -pl common install -DskipTests` で再インストールした結果、`UserServiceBean` の呼び出しが解決した。
- 影響: Modernized サーバーのビルドが完了せず Stage/Live 連携で `server` リソースを提供できない状況を解消し、RUN_ID=`20251126T150000Z` に紐づく `docs/server-modernization/phase2/operations/logs/20251126T150000Z-master-bridge-stub-update.md`/`docs/server-modernization/phase2/notes/worker-report-master-bridge-20251126T150000Z.md` にコンパイル成功を記録。
- 対応: 上記修正後に `mvn -pl server-modernized -DskipTests compile` を再実行したところ成功。`node scripts/bridge-sync.mjs --run-id 20251126T150000Z --date 20251124 --source server` を再実行して `hashes`/`diffs` を上書きし、`dataSourceTransition=server`/`missingMaster` の変化を `DOC_STATUS`/manager checklist/worker report に波及させて raw B→bridge-sync→hashes/diffs→docs の循環を継続する。

## 管理
- 担当者: Codex（Web クライアント UX/Features）
- 次報告: 上記タスクは完了したため `docs/web-client/planning/phase2/DOC_STATUS.md:65`・`PHASE2_WEB_CLIENT_EXPERIENCE_MANAGER_CHECKLIST.md`・`docs/server-modernization/phase2/notes/worker-report-master-bridge-20251126T150000Z.md` の RUN_ID セクションに最新ログ/証跡パス・`warning banner tone=server`/`dataSourceTransition=server` イベント・次アクションを追記済み。また、現行ループと Stage coverage を継続する予定を記録。 |
